var Zt=Object.defineProperty,Qt=Object.defineProperties;var es=Object.getOwnPropertyDescriptors;var it=Object.getOwnPropertySymbols;var ts=Object.prototype.hasOwnProperty,ss=Object.prototype.propertyIsEnumerable;var lt=(h,d,f)=>d in h?Zt(h,d,{enumerable:!0,configurable:!0,writable:!0,value:f}):h[d]=f,k=(h,d)=>{for(var f in d||(d={}))ts.call(d,f)&&lt(h,f,d[f]);if(it)for(var f of it(d))ss.call(d,f)&&lt(h,f,d[f]);return h},S=(h,d)=>Qt(h,es(d));var v=(h,d,f)=>new Promise((ve,K)=>{var Ce=F=>{try{j(f.next(F))}catch(O){K(O)}},G=F=>{try{j(f.throw(F))}catch(O){K(O)}},j=F=>F.done?ve(F.value):Promise.resolve(F.value).then(Ce,G);j((f=f.apply(h,d)).next())});import{c as rs,m as as,j as e,B as u,d as g,e as b,s as H,$ as Ae,aL as ct,S as ae,a0 as dt,a1 as gt,a2 as ut,f as B,I as N,R as ns,J as ne,Y as oe,K as ie,O as ht,a3 as le,F as os,aJ as is,D as ls,q as cs,cp as ds,A as Ne,h as L,U as gs,T as us}from"./index-CNFXvQ6i.js";import{r as p,b as pt}from"./vendor-DgfDxsY7.js";import{O as hs}from"./OMLoading-CoZ4HjgZ.js";import{I as mt}from"./IconFolder-DwrsRI4b.js";import{I as ps}from"./IconFolderPlus-BCCPxGv0.js";import{I as ms}from"./IconSparkles-CMoiRgUR.js";import{I as ft}from"./IconArrowRight-CiT2HsGB.js";import{I as xt}from"./IconUpload-Dg8t7FrH.js";import{I as Re}from"./IconTrash-ByQmiQ4q.js";import{I as yt}from"./IconDownload-dS1bPbvH.js";import{I as bt}from"./IconPhoto-CNpC1CR1.js";import{L as je}from"./LinearProgress-CsT3gD9e.js";import{I as fs}from"./IconChevronUp-BuY5Fay3.js";import{I as xs}from"./IconChevronDown-BZtjJdT6.js";import{C as ys}from"./Container-B70uReER.js";import{C as bs}from"./CardMedia-BiAk6D9g.js";import{I as js}from"./IconEdit-BeKYqWN2.js";import{D as ws}from"./DataGrid-BRPlE1RQ.js";import"./index-BvdvJza9.js";import"./toPropertyKey-BRA8pAMC.js";import"./typeof-QjJsDpFa.js";import"./Autocomplete-BUXbMMMT.js";import"./usePreviousProps-BWumOsHT.js";import"./ListSubheader-BJ21vu2H.js";import"./Badge-CzqvSSPX.js";import"./ListItemIcon-Ceo8X1mf.js";import"./ListItemText-Do-rLMnZ.js";import"./InputAdornment-v70Ylxh4.js";import"./TablePagination-1L0FWyTQ.js";import"./KeyboardArrowRight-CK1FNa4g.js";import"./LastPage-DyorFB-E.js";import"./TableCell-DwyxNY3j.js";import"./Toolbar-xnlWIY-y.js";import"./Skeleton-Dd7vBz6A.js";import"./useThemeProps-CHH644oI.js";/**
 * @license @tabler/icons-react v3.34.1 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const vs=[["path",{d:"M7 10h14l-4 -4",key:"svg-0"}],["path",{d:"M17 14h-14l4 4",key:"svg-1"}]],Cs=rs("outline","arrows-exchange","ArrowsExchange",vs),Be=["logos","backgrounds","icons","ui","records","misc"],Le="/images";function jt(h){return Be.includes(h.toLowerCase())}function ks(h,d){const f=h.replace(/^\/+|\/+$/g,"");return`${Le}/${f}/${d}`}function Is(h){const f=h.replace(/^\/images\//,"").replace(/^\//,"").split("/");return f.length>=2?f[0]:null}const Ss=H(ys)(({theme:h})=>({paddingTop:h.spacing(4),paddingBottom:h.spacing(4),minHeight:"100vh"})),Us=H(u)(({theme:h})=>({display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:h.spacing(2),marginTop:h.spacing(4),marginBottom:h.spacing(4),[h.breakpoints.down("md")]:{gridTemplateColumns:"repeat(4, 1fr)"},[h.breakpoints.down("sm")]:{gridTemplateColumns:"repeat(2, 1fr)",gap:h.spacing(1)}})),$s=H(gs)(({theme:h,isUsed:d})=>S(k({position:"relative",cursor:"pointer",transition:"transform 0.2s ease, box-shadow 0.2s ease"},d&&{background:"linear-gradient(90deg, rgba(200, 230, 201, 0.3) 0%, rgba(200, 230, 201, 0.1) 100%)",border:"2px solid rgba(76, 175, 80, 0.5)"}),{"&:hover":{transform:"scale(1.05)",boxShadow:h.shadows[8]}})),Ds=H(bs)(({theme:h})=>({width:"100%",height:"150px",objectFit:"cover",[h.breakpoints.down("sm")]:{height:"120px"}})),Es=H(u)(({theme:h})=>({position:"relative",width:"100%",maxWidth:"800px",margin:"0 auto",marginBottom:h.spacing(4)})),we=H(N)(({theme:h})=>({position:"absolute",top:"50%",transform:"translateY(-50%)",backgroundColor:h.palette.mode==="dark"?"rgba(255, 255, 255, 0.1)":"rgba(0, 0, 0, 0.05)",border:`2px solid ${h.palette.mode==="dark","#C8A24B"}`,color:"#C8A24B",width:56,height:56,zIndex:10,"&:hover":{backgroundColor:h.palette.mode==="dark"?"rgba(200, 162, 75, 0.2)":"rgba(200, 162, 75, 0.1)",borderColor:"#B8923A"},[h.breakpoints.down("sm")]:{width:44,height:44}})),zs=H(u)(({theme:h,isUsed:d})=>S(k({width:"100%",height:"400px",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:h.palette.mode==="dark"?"#1a1a1a":"#f5f5f5",borderRadius:"8px",overflow:"hidden"},d&&{background:"linear-gradient(90deg, rgba(200, 230, 201, 0.3) 0%, rgba(200, 230, 201, 0.1) 100%)",border:"3px solid rgba(76, 175, 80, 0.6)"}),{[h.breakpoints.down("md")]:{height:"300px"},[h.breakpoints.down("sm")]:{height:"250px"}})),pr=()=>{var rt,at;const h=as(),[d,f]=p.useState([]),[ve,K]=p.useState(!1),[Ce,G]=p.useState(!1),[j,F]=p.useState(null),[O,Me]=p.useState(!1),[ke,Q]=p.useState(0),[We,z]=p.useState(null),[U,ee]=p.useState([]),[wt,T]=p.useState({}),[ce,de]=p.useState(!1),[V,Ge]=p.useState([]),[P,q]=p.useState(0),[ge,vt]=p.useState("date"),[Y,Ct]=p.useState("desc"),[M,kt]=p.useState("all"),[W,Je]=p.useState(!1),[_e,Ie]=p.useState(!1),[w,He]=p.useState(""),[Se,It]=p.useState({directories:[],files:[]}),[St,Ke]=p.useState(!1),[Ut,ue]=p.useState(!1),[$t,he]=p.useState(!1),[pe,me]=p.useState(null),[Ve,Ue]=p.useState(""),[qe,Ye]=p.useState("review-required"),[D,Dt]=p.useState([]),[Et,$e]=p.useState(!1),[C,J]=p.useState({}),[Xe,Ze]=p.useState(!1),[De,fe]=p.useState(!1),[te,Qe]=p.useState(!1),[se,xe]=p.useState(!1),re=p.useRef(null),X=p.useRef(!1),ye=p.useRef(""),Ee=p.useRef(0),ze=t=>[...t].sort((r,a)=>{let o=0;switch(ge){case"date":const n=new Date(r.modified||r.created||0).getTime(),i=new Date(a.modified||a.created||0).getTime();o=n-i;break;case"name":o=r.name.localeCompare(a.name);break;case"size":o=(r.size||0)-(a.size||0);break;case"type":o=(r.type||"").localeCompare(a.type||"");break;case"location":o=(r.path||"").localeCompare(a.path||"");break;default:o=0}return Y==="asc"?o:-o}),x=pt.useMemo(()=>{if(!d||d.length===0)return[];let t=d;return M==="used"?t=d.filter(s=>s&&s.isUsed===!0):M==="unused"?t=d.filter(s=>s&&s.isUsed===!1):M==="not_checked"&&(t=d.filter(s=>s&&s.isUsed===void 0)),ze(t)},[d,M,ge,Y]);pt.useEffect(()=>{(x.length>0&&P>=x.length||x.length===0)&&q(0)},[x.length,P]);const et=()=>{x.length!==0&&q(t=>t===0?x.length-1:t-1)},tt=()=>{x.length!==0&&q(t=>t===x.length-1?0:t+1)},be=(t,s=!1)=>v(void 0,null,function*(){if(!(!t||t.length===0)){Je(!0);try{const r=t.filter(i=>i!=null),a=500,o=[];for(let i=0;i<r.length;i+=a)o.push(r.slice(i,i+a));let n={};for(let i=0;i<o.length;i++){const l=o[i],c=yield fetch("/api/gallery/check-usage",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({images:l.map(m=>({name:m.name||"",path:m.path||""}))})});if(c.ok){const m=yield c.json();m.success&&m.usage&&(n=k(k({},n),m.usage))}else{const m=yield c.json().catch(()=>({}));console.error(`Usage check failed for batch ${i+1}/${o.length}:`,m)}}f(i=>{if(!i||i.length===0)return i;const l=i.map(c=>{if(!c)return c;const m=n[c.name];return S(k({},c),{isUsed:m!==void 0?m:c.isUsed})});return ze(l)})}catch(r){console.error("Error checking image usage:",r)}finally{Je(!1)}}});p.useEffect(()=>{if(d.length>0){const t=ze(d);f(t)}},[ge,Y]),p.useEffect(()=>{!X.current&&M!=="all"&&d.length>0&&!W&&d.some(s=>s.isUsed===void 0)&&(X.current=!0,console.log(`ðŸ”„ Auto-checking usage due to filter change to: ${M}`),be(d,!0))},[M]),p.useEffect(()=>{X.current=!1,ye.current="",Ee.current=0},[w]),p.useEffect(()=>{v(void 0,null,function*(){yield R(),yield Yt()})},[]),p.useEffect(()=>{_()},[w]),p.useEffect(()=>{if(w==="")return;X.current=!1,Ee.current=0;const t=setTimeout(()=>{const s=w!==ye.current||ye.current==="";d.length>0&&w!==""&&s&&!W&&!X.current&&(ye.current=w,Ee.current=d.length,X.current=!0,be(d,!0))},800);return()=>clearTimeout(t)},[w]);const R=()=>v(void 0,null,function*(){var t,s;Ke(!0);try{const a=new URLSearchParams(window.location.search).get("debug")==="1"?"&debug=1":"",o=yield fetch(`/api/gallery/tree?depth=3${a}`,{credentials:"include"});if(o.ok){const n=yield o.json();console.log("ðŸ“ Directory tree loaded:",{directories:((t=n.directories)==null?void 0:t.length)||0,files:((s=n.files)==null?void 0:s.length)||0,path:n.path}),It(n),n.debug&&(console.log("ðŸ” [DEBUG] Directory tree debug info:",n.debug),n.debug.resolvedImagesRoot&&(console.log(`ðŸ” [DEBUG] Images root: ${n.debug.resolvedImagesRoot}`),console.log(`ðŸ” [DEBUG] Root exists: ${n.debug.rootExists}`),console.log(`ðŸ” [DEBUG] Root readable: ${n.debug.rootCanRead}`),n.debug.firstEntries&&n.debug.firstEntries.length>0&&console.log("ðŸ” [DEBUG] First entries:",n.debug.firstEntries)))}else{const n=yield o.json().catch(()=>({}));console.error("âŒ Error loading directory tree:",{status:o.status,error:n})}}catch(r){console.error("âŒ Error loading directory tree:",r)}finally{Ke(!1)}}),_=()=>v(void 0,null,function*(){try{const s=`/api/gallery/images?path=${encodeURIComponent(w===""?"":w)}&recursive=1`;console.log("Loading images from:",s);const r=yield fetch(s,{credentials:"include"});if(r.ok){const a=yield r.json();console.log("ðŸ–¼ï¸ Images loaded:",{count:a.count||0,path:a.path,recursive:a.recursive}),a.debug&&(console.log("ðŸ” [DEBUG] Images API debug info:",a.debug),a.debug.resolvedImagesRoot&&(console.log(`ðŸ” [DEBUG] Images root: ${a.debug.resolvedImagesRoot}`),console.log(`ðŸ” [DEBUG] Root exists: ${a.debug.rootExists}`),console.log(`ðŸ” [DEBUG] Root readable: ${a.debug.rootCanRead}`),a.debug.sampleImage&&console.log("ðŸ” [DEBUG] Sample image:",a.debug.sampleImage)));const o=[".jpg",".jpeg",".png",".gif",".tiff",".webp",".svg"],n=(a.images||[]).filter(c=>{var y;const E=((y=(c.name||c.path||"").split(".").pop())==null?void 0:y.toLowerCase())||"";return o.includes(`.${E}`)});new URLSearchParams(window.location.search).get("debug")==="1"&&n.length>0&&(console.log("ðŸ” [DEBUG] Sample image from API:",n[0]),console.log("ðŸ” [DEBUG] Sample image keys:",Object.keys(n[0])));const l=n.map((c,m)=>{var Z,nt;let E=null,y=null,$=null,A=null;c.metadataStatus==="error"?A=c.statError||"Failed to read file metadata":(c.size!==void 0&&c.size!==null&&c.size!==""&&(E=typeof c.size=="number"?c.size:parseInt(String(c.size),10),(isNaN(E)||E<0)&&(E=null,A="Invalid file size value")),y=c.modified&&c.modified!==""?c.modified:null,$=c.created&&c.created!==""?c.created:null);let I=c.url;if(!I&&c.path&&(I=c.path.startsWith("/")?c.path:`${Le}/${c.path}`),!I&&c.name){const ot=c.path?Is(c.path):null;ot?I=ks(ot,c.name):I=`${Le}/${Be[0]}/${c.name}`}return{id:`img-${m}-${c.name}`,name:c.name||"Unknown",path:c.path||c.url||c.name,url:I||"/images/incode/placeholder.png",created:$,modified:y,size:E,type:c.type||((nt=(Z=c.name)==null?void 0:Z.split(".").pop())==null?void 0:nt.toLowerCase())||"unknown",isUsed:void 0,metadataError:A||void 0}});f(l),q(0)}else{const a=yield r.json().catch(()=>({}));console.error("Gallery API error:",{status:r.status,statusText:r.statusText,error:a,url:s}),f([]),r.status===502&&console.error("Backend server may be down or the gallery API endpoint is not available")}}catch(t){console.error("Gallery API request failed:",{error:t.message,stack:t.stack}),f([])}}),Te=t=>{F(t),G(!0)},Fe=t=>{const s=window.open("","_blank");s&&(s.document.write(`
        <!DOCTYPE html>
        <html>
          <head>
            <title>${t.name}</title>
            <style>
              body {
                margin: 0;
                padding: 20px;
                font-family: Arial, sans-serif;
                background: #f5f5f5;
              }
              .container {
                max-width: 1200px;
                margin: 0 auto;
                background: white;
                padding: 20px;
                border-radius: 8px;
                box-shadow: 0 2px 8px rgba(0,0,0,0.1);
              }
              .image-info {
                margin-bottom: 20px;
                padding: 15px;
                background: #f9f9f9;
                border-radius: 4px;
              }
              .image-info h2 {
                margin: 0 0 10px 0;
                color: #333;
              }
              .image-info p {
                margin: 5px 0;
                color: #666;
              }
              .image-container {
                text-align: center;
                margin: 20px 0;
              }
              .image-container img {
                max-width: 100%;
                height: auto;
                border-radius: 4px;
                box-shadow: 0 2px 8px rgba(0,0,0,0.1);
              }
              .actions {
                margin-top: 20px;
                text-align: center;
              }
              .btn {
                padding: 10px 20px;
                margin: 0 10px;
                border: none;
                border-radius: 4px;
                cursor: pointer;
                font-size: 14px;
              }
              .btn-delete {
                background: #d32f2f;
                color: white;
              }
              .btn-delete:hover {
                background: #b71c1c;
              }
              .btn-close {
                background: #666;
                color: white;
              }
              .btn-close:hover {
                background: #444;
              }
            </style>
          </head>
          <body>
            <div class="container">
              <div class="image-info">
                <h2>Image Information</h2>
                <p><strong>Image Name:</strong> ${t.name}</p>
                <p><strong>Image Path:</strong> ${t.path}</p>
                <p><strong>Image Type:</strong> ${t.type||"Unknown"}</p>
                ${t.size?`<p><strong>Image Size:</strong> ${(t.size/1024).toFixed(2)} KB</p>`:""}
                ${t.created?`<p><strong>Created:</strong> ${new Date(t.created).toLocaleString()}</p>`:""}
              </div>
              <div class="image-container">
                <img src="${t.url}" alt="${t.name}" onerror="this.src='/images/incode/placeholder.png'" />
              </div>
              <div class="actions">
                <button class="btn btn-delete" onclick="deleteImage()">Delete Image</button>
                <button class="btn btn-close" onclick="window.close()">Close</button>
              </div>
            </div>
            <script>
              function deleteImage() {
                if (confirm('Are you sure you want to delete this image?')) {
                  const relativePath = '${t.path}'.replace(/^\\/images\\//, '');
                  fetch('/api/gallery/file', {
                    method: 'DELETE',
                    headers: {
                      'Content-Type': 'application/json',
                    },
                    credentials: 'include',
                    body: JSON.stringify({ path: relativePath })
                  })
                  .then(response => response.json())
                  .then(data => {
                    if (data.success) {
                      alert('Image deleted successfully');
                      window.close();
                      if (window.opener) {
                        window.opener.location.reload();
                      }
                    } else {
                      alert('Failed to delete image: ' + (data.message || 'Unknown error'));
                    }
                  })
                  .catch(error => {
                    console.error('Error:', error);
                    alert('Failed to delete image');
                  });
                }
              }
            <\/script>
          </body>
        </html>
      `),s.document.close())},st=t=>v(void 0,null,function*(){if(window.confirm(`Are you sure you want to delete "${t.name}"?`)){de(!0);try{const s=t.path.replace(/^\/images\//,"");console.log("ðŸ—‘ï¸ [Frontend] Single delete:",{name:t.name,originalPath:t.path,relativePath:s,selectedDirectory:w});const r=yield fetch("/api/gallery/file",{method:"DELETE",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({path:s})});if(console.log("ðŸ—‘ï¸ [Frontend] Delete response status:",r.status,r.statusText),r.ok){const a=yield r.json().catch(()=>({}));console.log("ðŸ—‘ï¸ [Frontend] Delete successful:",a),yield _(),yield R(),G(!1),F(null)}else{let a="Unknown error";try{const o=yield r.json();console.error("ðŸ—‘ï¸ [Frontend] Delete error response:",o),a=o.error||o.message||`HTTP ${r.status}: ${r.statusText}`}catch(o){console.error("ðŸ—‘ï¸ [Frontend] Failed to parse error response:",o),a=`HTTP ${r.status}: ${r.statusText}`}alert(`Failed to delete image: ${a}`)}}catch(s){console.error("ðŸ—‘ï¸ [Frontend] Error deleting image:",s),alert(`Failed to delete image: ${s.message||"Network error"}`)}finally{de(!1)}}}),zt=(t,s)=>v(void 0,null,function*(){try{const r=t.path.replace(/^\/images\//,""),a=s?`${s}/${t.name}`:t.name,o=yield fetch("/api/gallery/move",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({from:r,to:a,overwrite:!1})});if(o.ok)yield _(),yield R(),ue(!1),me(null);else{const n=yield o.json();alert(n.error||"Failed to move image")}}catch(r){console.error("Error moving image:",r),alert("Failed to move image")}}),Tt=(t,s)=>v(void 0,null,function*(){try{const r=t.path.replace(/^\/images\//,""),a=yield fetch("/api/gallery/rename",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({path:r,newName:s})});if(a.ok)yield _(),yield R(),he(!1),me(null),Ue("");else{const o=yield a.json();alert(o.error||"Failed to rename image")}}catch(r){console.error("Error renaming image:",r),alert("Failed to rename image")}}),Ft=t=>v(void 0,null,function*(){if(!t||!t.trim()){alert("Directory name cannot be empty");return}try{const s=w?`${w}/${t.trim()}`:t.trim(),r=yield fetch("/api/gallery/mkdir",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({path:s})});if(r.ok){yield R();const a=yield r.json();console.log("Directory created:",a)}else{const a=yield r.json(),o=a.error||"Failed to create directory",n=a.code?` (${a.code})`:"",i=a.path?`
Path: ${a.path}`:"";alert(`${o}${n}${i}`)}}catch(s){console.error("Error creating directory:",s),alert(`Failed to create directory: ${s.message||"Unknown error"}`)}}),Ot=()=>v(void 0,null,function*(){try{const t=yield fetch("/api/gallery/suggest-destination",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({images:d.map(s=>({path:s.path,name:s.name}))})});if(t.ok){const s=yield t.json();Dt(s.suggestions||[]),J({}),$e(!0)}else{const s=yield t.json();alert(s.error||"Failed to get catalog suggestions")}}catch(t){console.error("Error getting suggestions:",t),alert("Failed to get catalog suggestions")}}),Oe=t=>t.replace(/^\/images\//,"").replace(/^\/+/,""),Pt=()=>v(void 0,null,function*(){if(D.length!==0){Qe(!0);try{const t=D.map(r=>{const a=Oe(r.path),o=r.suggestedDir?`${r.suggestedDir}/${r.suggestedName}`:r.suggestedName;return{type:"move",from:a,to:o}}),s=yield fetch("/api/gallery/validate-actions",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({actions:t})});if(s.ok){const r=yield s.json(),a={};r.results.forEach((o,n)=>{a[n]={status:o.ok?"valid":"invalid",message:o.message,code:o.code}}),J(a),fe(!0)}else{const r=yield s.json();alert(r.error||"Failed to validate actions")}}catch(t){console.error("Error validating actions:",t),alert("Failed to validate actions")}finally{Qe(!1)}}}),At=t=>v(void 0,null,function*(){const s=D[t];if(s){xe(!0);try{const r=Oe(s.path),a=s.suggestedDir?`${s.suggestedDir}/${s.suggestedName}`:s.suggestedName,n=yield fetch("/api/gallery/apply-actions",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({actions:[{type:"move",from:r,to:a}],continueOnError:!1})});if(n.ok){const l=(yield n.json()).results[0];J(c=>S(k({},c),{[t]:{status:l.ok?"applied":"failed",message:l.message,code:l.code}})),l.ok&&(yield _(),yield R())}else{const i=yield n.json();J(l=>S(k({},l),{[t]:{status:"failed",message:i.error||"Failed to apply action",code:"APPLY_ERROR"}}))}}catch(r){console.error("Error applying action:",r),J(a=>S(k({},a),{[t]:{status:"failed",message:"Failed to apply action",code:"APPLY_ERROR"}}))}finally{xe(!1)}}}),Nt=()=>v(void 0,null,function*(){if(D.length===0)return;const t=Object.values(C).filter(s=>s.status==="invalid").length;if(!(t>0&&!confirm(`${t} suggestion(s) are invalid. Do you want to continue anyway? Only valid suggestions will be applied.`))){xe(!0);try{const s=D.map(a=>{const o=Oe(a.path),n=a.suggestedDir?`${a.suggestedDir}/${a.suggestedName}`:a.suggestedName;return{type:"move",from:o,to:n}}),r=yield fetch("/api/gallery/apply-actions",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({actions:s,continueOnError:!0})});if(r.ok){const a=yield r.json(),o={};a.results.forEach((n,i)=>{o[i]={status:n.ok?"applied":"failed",message:n.message,code:n.code}}),J(o),fe(!0),a.summary.ok>0&&(yield _(),yield R())}else{const a=yield r.json();alert(a.error||"Failed to apply actions")}}catch(s){console.error("Error applying actions:",s),alert("Failed to apply actions")}finally{xe(!1)}}}),Rt=()=>{const t={total:D.length,statuses:Object.entries(C).map(([r,a])=>({index:parseInt(r),suggestion:D[parseInt(r)],status:a.status,message:a.message,code:a.code})),summary:{total:D.length,valid:Object.values(C).filter(r=>r.status==="valid").length,invalid:Object.values(C).filter(r=>r.status==="invalid").length,applied:Object.values(C).filter(r=>r.status==="applied").length,failed:Object.values(C).filter(r=>r.status==="failed").length,pending:Object.values(C).filter(r=>r.status==="pending"||!r).length}},s=JSON.stringify(t,null,2);navigator.clipboard.writeText(s).then(()=>{alert("Summary copied to clipboard")}).catch(r=>{console.error("Failed to copy:",r),alert("Failed to copy summary")})},Bt=t=>{const s=C[t];if(!s||s.status==="pending")return e.jsx(L,{label:"Pending",size:"small",color:"default"});const r={valid:"success",invalid:"error",applied:"success",failed:"error"};return e.jsx(L,{label:s.status.charAt(0).toUpperCase()+s.status.slice(1),size:"small",color:r[s.status]||"default",title:s.message})},Lt=t=>{const s=Array.from(t.target.files||[]);if(s.length===0)return;const r=[],a=[];s.forEach(o=>{var l;const n=[".jpg",".jpeg",".tiff",".gif",".png"],i="."+((l=o.name.split(".").pop())==null?void 0:l.toLowerCase());if(!n.includes(i)){a.push(`${o.name}: Invalid file type. Allowed types: ${n.join(", ")}`);return}if(o.size>10*1024*1024){a.push(`${o.name}: File size must be less than 10MB`);return}r.push(o)}),a.length>0?z(a.join(`
`)):z(null),r.length>0&&ee(o=>[...o,...r])},Mt=(t,s="review-required")=>new Promise((r,a)=>{const o=new FormData;o.append("image",t),o.append("targetDir",s);const n=new XMLHttpRequest,i=`${t.name}-${t.size}`;T(l=>S(k({},l),{[i]:{progress:0,status:"uploading"}})),n.upload.addEventListener("progress",l=>{if(l.lengthComputable){const c=l.loaded/l.total*100;T(m=>{const E=S(k({},m),{[i]:S(k({},m[i]),{progress:c,status:"uploading"})}),y=Object.values(E),$=y.length>0?y.reduce((A,I)=>A+I.progress,0)/y.length:0;return Q($),E})}}),n.addEventListener("load",()=>{if(n.status===200)try{const l=JSON.parse(n.responseText);if(l.success)T(c=>S(k({},c),{[i]:{progress:100,status:"success"}})),r();else{const c=l.error||l.message||"Upload failed";T(m=>S(k({},m),{[i]:{progress:0,status:"error",error:c}})),a(new Error(c))}}catch(l){T(c=>S(k({},c),{[i]:{progress:100,status:"success"}})),r()}else{let l="Upload failed";try{const c=JSON.parse(n.responseText);l=c.error||c.message||l}catch(c){n.status===500?l="Internal server error. Please check server logs.":n.status===404?l="Upload endpoint not found. Backend needs to implement POST /api/gallery/upload":l=`Upload failed with status ${n.status}`}T(c=>S(k({},c),{[i]:{progress:0,status:"error",error:l}})),a(new Error(l))}}),n.addEventListener("error",()=>{const l="Upload failed. Backend endpoint /api/gallery/upload may not be available.";T(c=>S(k({},c),{[i]:{progress:0,status:"error",error:l}})),a(new Error(l))}),n.open("POST","/api/gallery/upload"),n.withCredentials=!0,n.send(o)}),Wt=()=>v(void 0,null,function*(){if(U.length===0){z("Please select at least one file");return}Me(!0),z(null),Q(0);const t={};U.forEach(s=>{const r=`${s.name}-${s.size}`;t[r]={progress:0,status:"pending"}}),T(t);try{const s=[];for(const r of U)try{yield Mt(r,"review-required")}catch(a){s.push(`${r.name}: ${a.message||"Upload failed"}`)}s.length>0?z(`Some files failed to upload:
${s.join(`
`)}`):(K(!1),ee([]),T({}),Q(0),re.current&&(re.current.value=""),window.location.href="/apps/gallery")}catch(s){z(s.message||"An error occurred during upload")}finally{Me(!1)}}),Gt=()=>{K(!0),ee([]),z(null),Q(0),T({})},Pe=()=>{O||(K(!1),ee([]),z(null),Q(0),T({}),re.current&&(re.current.value=""))},Jt=t=>{ee(s=>s.filter((r,a)=>a!==t))},_t=[{field:"name",headerName:"Image Name",flex:1,minWidth:200,renderCell:t=>{if(!t||!t.row)return e.jsx(g,{variant:"body2",children:"Unknown"});const s=t.row;return s?e.jsxs(u,{sx:{display:"flex",alignItems:"center",gap:1,py:1},children:[e.jsx(u,{component:"img",src:s.url||"/images/incode/placeholder.png",alt:s.name||"Unknown",sx:{width:40,height:40,objectFit:"cover",imageOrientation:"from-image",transform:"none",borderRadius:1,cursor:"pointer"},onError:r=>{r.target.src="/images/incode/placeholder.png"},onClick:()=>Te(s)}),e.jsx(g,{variant:"body2",sx:{cursor:"pointer",color:"primary.main"},onClick:()=>Te(s),children:t.value||"Unknown"})]}):e.jsx(g,{variant:"body2",children:"Unknown"})}},{field:"path",headerName:"Image Location",flex:2,minWidth:250},{field:"modified",headerName:"Date Modified",flex:1,minWidth:180,valueGetter:(t,s)=>s&&(s.modified||s.created)||null,valueFormatter:(t,s)=>{const r=(t==null?void 0:t.value)!==void 0?t.value:t,a=(s==null?void 0:s.row)||s;if(a&&a.metadataError)return"Error";if(!r||r==="")return"Unknown";try{const o=new Date(r);return isNaN(o.getTime())?"Unknown":o.toLocaleString()}catch(o){return"Unknown"}},renderCell:t=>{if(!t||!t.row)return e.jsx(g,{variant:"body2",children:"Unknown"});const s=t.row;if(!s)return e.jsx(g,{variant:"body2",children:"Unknown"});if(s.metadataError)return e.jsx(us,{title:s.metadataError,arrow:!0,children:e.jsx(g,{variant:"body2",color:"error",children:"Error"})});const r=s.modified||s.created;if(!r)return e.jsx(g,{variant:"body2",children:"Unknown"});try{const a=new Date(r);return isNaN(a.getTime())?e.jsx(g,{variant:"body2",children:"Unknown"}):e.jsx(g,{variant:"body2",children:a.toLocaleString()})}catch(a){return e.jsx(g,{variant:"body2",children:"Unknown"})}}},{field:"isUsed",headerName:"Usage Status",width:130,valueGetter:(t,s)=>!s||s.isUsed===void 0?"Unknown":s.isUsed?"Used":"Not Used",renderCell:t=>{if(!t||!t.row)return e.jsx(L,{label:"Unknown",size:"small",variant:"outlined"});const s=t.row;return s?s.isUsed===void 0&&W?e.jsx(L,{label:"Checking...",size:"small",variant:"outlined"}):s.isUsed===void 0?e.jsx(L,{label:"Not Checked",size:"small",variant:"outlined",color:"default"}):e.jsx(L,{label:s.isUsed?"Used":"Not Used",size:"small",sx:{backgroundColor:s.isUsed?"rgba(76, 175, 80, 0.2)":"rgba(244, 67, 54, 0.2)",color:s.isUsed?"success.main":"error.main",fontWeight:600}}):e.jsx(L,{label:"Unknown",size:"small",variant:"outlined"})}},{field:"type",headerName:"File Type",width:120},{field:"size",headerName:"File Size",width:120,valueGetter:(t,s)=>{if(!s)return null;const r=s.size;return r!=null?r:null},valueFormatter:(t,s)=>{const r=(t==null?void 0:t.value)!==void 0?t.value:t;if(r==null)return"Unknown";const a=typeof r=="number"?r:Number(r);if(isNaN(a)||a<0)return"Unknown";if(a===0)return"0 KB";const o=a/1024;return o<1024?`${o.toFixed(2)} KB`:`${(o/1024).toFixed(2)} MB`}},{field:"actions",headerName:"Actions",width:200,sortable:!1,filterable:!1,renderCell:t=>{if(!t||!t.row)return null;const s=t.row;return s?e.jsxs(ae,{direction:"row",spacing:1,children:[e.jsx(N,{size:"small",onClick:()=>Te(s),title:"View",children:e.jsx(bt,{size:18})}),e.jsx(N,{size:"small",onClick:()=>{me(s),Ue(s.name),he(!0)},title:"Rename",children:e.jsx(js,{size:18})}),e.jsx(N,{size:"small",onClick:()=>{me(s),Ye(w),ue(!0)},title:"Move",children:e.jsx(Cs,{size:18})}),e.jsx(N,{size:"small",color:"error",onClick:()=>st(s),disabled:ce,title:"Delete",children:e.jsx(Re,{size:18})})]}):null}}],Ht=()=>v(void 0,null,function*(){if(V.length===0){alert("Please select at least one image to delete");return}if(window.confirm(`Are you sure you want to delete ${V.length} image(s)?`)){de(!0);try{const s=x.filter(n=>V.includes(n.id||n.path)).map(n=>v(void 0,null,function*(){const i=n.path.replace(/^\/images\//,"");console.log("ðŸ—‘ï¸ [Frontend] Attempting to delete:",{name:n.name,originalPath:n.path,relativePath:i,selectedDirectory:w});try{const l=yield fetch("/api/gallery/file",{method:"DELETE",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({path:i})});if(!l.ok){let c="Unknown error";try{const m=yield l.json();c=m.error||m.message||`HTTP ${l.status}`}catch(m){c=`HTTP ${l.status}: ${l.statusText}`}return{success:!1,image:n.name,error:c,path:i}}return{success:!0,image:n.name,path:i}}catch(l){return console.error(`Error deleting ${n.name}:`,l),{success:!1,image:n.name,error:l.message||"Network error",path:i}}})),r=yield Promise.all(s),a=r.filter(n=>n.success),o=r.filter(n=>!n.success);if(a.length>0)if(yield _(),yield R(),Ge([]),o.length>0){const n=o.map(i=>`  - ${i.image}: ${i.error}`).join(`
`);alert(`Successfully deleted ${a.length} image(s).

Failed to delete ${o.length} image(s):
${n}`)}else alert(`Successfully deleted ${a.length} image(s)`);else{const n=o.map(i=>`  - ${i.image}: ${i.error}`).join(`
`);alert(`Failed to delete ${o.length} image(s):

${n}`)}}catch(t){console.error("Error deleting images:",t),alert(`An error occurred while deleting images: ${t.message||"Unknown error"}`)}finally{de(!1)}}}),Kt=()=>{if(d.length===0){alert("No images to export");return}const t=["Name","Path","Created","Type","Size"],s=d.map(i=>[i.name,i.path,i.created||"Unknown",i.type||"Unknown",i.size?`${(i.size/1024).toFixed(2)} KB`:"Unknown"]),r=[t.join(","),...s.map(i=>i.map(l=>`"${String(l).replace(/"/g,'""')}"`).join(","))].join(`
`),a=new Blob([r],{type:"text/csv;charset=utf-8;"}),o=document.createElement("a"),n=URL.createObjectURL(a);o.setAttribute("href",n),o.setAttribute("download",`gallery-images-${new Date().toISOString().split("T")[0]}.csv`),o.style.visibility="hidden",document.body.appendChild(o),o.click(),document.body.removeChild(o)},Vt=()=>v(void 0,null,function*(){try{Ie(!0),z(null);let t=[],s=0;const r=200;let a=!0,o=0,n=0,i=!1;for(;a;){const y=yield fetch(`/api/gallery/used-images?format=json&offset=${s}&limit=${r}`,{credentials:"include"});if(!y.ok){const A=yield y.text();let I="Failed to export used images list";try{const Z=JSON.parse(A);I=Z.error||Z.message||I}catch(Z){I=A||I}alert(`Error: ${I}`),z(I),Ie(!1);return}const $=yield y.json();$.success&&$.used?(t=[...t,...$.used],o=$.total_images||o,n=$.checked_images||n,i=$.limited||i,$.used.length<r||s+r>=n?a=!1:s+=r):a=!1}let l=`# Images Actively Used in Production

`;l+=`Generated: ${new Date().toISOString()}
`,l+=`Total Images: ${o}
`,l+=`Checked Images: ${n}
`,l+=`Used Images: ${t.length}
`,i&&(l+=`Note: Scanning was limited due to performance constraints
`),l+=`
## Used Images (${t.length})

`,t.forEach((y,$)=>{l+=`${$+1}. **${y.name}**
`,l+=`   - Path: ${y.path}
`,l+=`   - Size: ${y.size?(y.size/1024).toFixed(2)+" KB":"Unknown"}
`,l+=`   - Type: ${y.type?y.type.toUpperCase():"Unknown"}
`,l+=`   - Modified: ${y.modified?new Date(y.modified).toLocaleString():"Unknown"}
`,y.referencedIn&&y.referencedIn.length>0&&(l+=`   - Referenced in:
`,y.referencedIn.forEach(A=>{l+=`     - ${A}
`})),l+=`
`});const c=new Blob([l],{type:"text/plain;charset=utf-8;"}),m=document.createElement("a"),E=URL.createObjectURL(c);m.setAttribute("href",E),m.setAttribute("download",`used-images-${new Date().toISOString().split("T")[0]}.txt`),m.style.visibility="hidden",document.body.appendChild(m),m.click(),document.body.removeChild(m),URL.revokeObjectURL(E),alert(`Used images list exported successfully!
Total: ${o}, Checked: ${n}, Used: ${t.length}${i?" (limited)":""}`)}catch(t){console.error("Error exporting used images:",t);const s=t.message||"Failed to export used images list. Please check the browser console for details.";alert(`Error: ${s}`),z(s)}finally{Ie(!1)}}),qt=x.slice(0,8),Yt=()=>v(void 0,null,function*(){try{const t=yield fetch("/api/gallery/cleanup-empty-dirs",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include"});if(t.ok){const s=yield t.json();s.deleted&&s.deleted.length>0&&(console.log(`ðŸ—‘ï¸ Cleaned up ${s.deleted.length} empty directory(ies):`,s.deleted),yield R())}}catch(t){console.error("Error cleaning up empty directories:",t)}}),Xt=(t,s=0)=>{new Set(t.map(n=>n.name.toLowerCase()));const r=Be.map(n=>{const i=t.find(l=>l.name.toLowerCase()===n.toLowerCase());return i||{name:n,path:n,childrenCount:0,isEmpty:!0}}),a=t.filter(n=>!jt(n.name));return[...r,...a].map(n=>{const i=jt(n.name),l=n.isEmpty===!0;return e.jsx(u,{sx:{pl:s*2},children:e.jsxs(b,{fullWidth:!0,startIcon:e.jsx(mt,{size:16}),onClick:()=>!l&&He(n.path),disabled:l,sx:{justifyContent:"flex-start",textTransform:"none",color:l?"text.disabled":w===n.path?"#C8A24B":i?"#1976d2":"inherit",fontWeight:w===n.path?"bold":i?"600":"normal",backgroundColor:l?"rgba(0, 0, 0, 0.02)":i&&w!==n.path?"rgba(25, 118, 210, 0.08)":"transparent",border:i?"1px solid rgba(25, 118, 210, 0.2)":"none",borderRadius:i?1:0,mb:i?.5:0,opacity:l?.6:1,"&:hover":{backgroundColor:l?"rgba(0, 0, 0, 0.02)":i?"rgba(25, 118, 210, 0.12)":"rgba(0, 0, 0, 0.04)"}},children:[n.name," ",l?"(empty)":`(${n.childrenCount})`,i&&e.jsx(L,{label:l?"Empty":"Default",size:"small",sx:{ml:1,height:18,fontSize:"0.65rem",backgroundColor:l?"rgba(0, 0, 0, 0.05)":"rgba(25, 118, 210, 0.1)",color:l?"text.disabled":"#1976d2"}})]})},n.path)})};return e.jsxs(u,{sx:{minHeight:"100vh",display:"flex",flexDirection:"row"},children:[e.jsxs(u,{sx:{width:250,minWidth:250,p:2,borderRight:1,borderColor:"divider",bgcolor:"background.paper"},children:[e.jsx(g,{variant:"h6",sx:{mb:2},children:"Directories"}),e.jsx(b,{fullWidth:!0,startIcon:e.jsx(mt,{size:16}),onClick:()=>He(""),sx:{justifyContent:"flex-start",textTransform:"none",mb:1,color:w===""?"#C8A24B":"inherit",fontWeight:w===""?"bold":"normal"},children:"Root (All Images)"}),St?e.jsx(hs,{size:"sm",label:"Loading directories"}):Se.directories&&Se.directories.length>0?Xt(Se.directories):e.jsx(g,{variant:"body2",color:"text.secondary",sx:{mt:1,p:1},children:"No directories found. Images may still be available in root."}),e.jsx(b,{fullWidth:!0,startIcon:e.jsx(ps,{size:16}),onClick:()=>{const t=prompt("Enter directory name:");t&&Ft(t)},sx:{mt:2,justifyContent:"flex-start",textTransform:"none"},children:"New Folder"}),e.jsx(b,{fullWidth:!0,startIcon:e.jsx(ms,{size:16}),onClick:Ot,sx:{mt:1,justifyContent:"flex-start",textTransform:"none"},children:"Catalog Suggestions"})]}),e.jsx(u,{sx:{flex:1,display:"flex",flexDirection:"column"},children:e.jsxs(Ss,{maxWidth:"xl",children:[e.jsxs(u,{sx:{textAlign:"center",mb:4},children:[e.jsx(g,{variant:"h2",component:"h1",sx:{fontWeight:700,mb:2,fontFamily:'"Cormorant Garamond", "Palatino Linotype", "Book Antiqua", Palatino, Georgia, serif'},children:"Image Gallery"}),e.jsxs(g,{variant:"body1",color:"text.secondary",sx:{mb:2},children:["Browse images from ",e.jsx("code",{children:"/public/images/**"})," (all directories)"]}),d.length>0&&d.some(t=>t.isUsed===void 0)&&e.jsx(Ae,{severity:"info",sx:{mb:3},action:e.jsx(b,{color:"inherit",size:"small",onClick:()=>be(d,!0),disabled:W,children:W?"Checking...":"Check Now"}),children:'Usage status not computed. Click "Refresh Usage" or "Check Now" to determine which images are used in the codebase.'}),x.length>0&&e.jsxs(u,{sx:{display:"flex",alignItems:"center",justifyContent:"center",gap:4,mb:3},children:[e.jsx(we,{onClick:et,"aria-label":"Previous image",sx:{position:"relative",transform:"none"},children:e.jsx(ct,{size:28})}),e.jsx(we,{onClick:tt,"aria-label":"Next image",sx:{position:"relative",transform:"none"},children:e.jsx(ft,{size:28})})]}),e.jsxs(ae,{direction:"row",spacing:2,justifyContent:"center",alignItems:"center",sx:{mb:3,flexWrap:"wrap",gap:2},children:[e.jsx(b,{variant:"contained",startIcon:e.jsx(xt,{size:20}),onClick:Gt,sx:{backgroundColor:"#C8A24B",color:"#1a1a1a","&:hover":{backgroundColor:"#B8923A"}},children:"Upload Images"}),d.length>0&&e.jsx(b,{variant:"outlined",size:"small",onClick:()=>be(d,!0),disabled:W,title:W?"Checking image usage in codebase...":"Check all images for usage in codebase",children:W?"Checking...":"Refresh Usage"})]})]}),x.length>0&&e.jsxs(Es,{children:[e.jsx(we,{onClick:et,sx:{left:{xs:-20,sm:-28}},"aria-label":"Previous image",disabled:x.length===0,children:e.jsx(ct,{size:28})}),e.jsx(zs,{onClick:()=>x[P]&&Fe(x[P]),sx:{cursor:"pointer"},isUsed:((rt=x[P])==null?void 0:rt.isUsed)===!0,children:x[P]&&e.jsx(u,{component:"img",src:x[P].url,alt:x[P].name,sx:{maxWidth:"100%",maxHeight:"100%",objectFit:"contain",imageOrientation:"from-image"},onError:t=>{t.target.src="/images/incode/placeholder.png"}})}),e.jsx(we,{onClick:tt,sx:{right:{xs:-20,sm:-28}},"aria-label":"Next image",disabled:x.length===0,children:e.jsx(ft,{size:28})}),e.jsxs(u,{sx:{textAlign:"center",mt:2},children:[e.jsx(g,{variant:"subtitle1",fontWeight:600,children:(at=x[P])==null?void 0:at.name}),e.jsx(g,{variant:"caption",color:"text.secondary",children:x.length>0?`${P+1} of ${x.length}`:"0 of 0"})]})]}),x.length>0&&e.jsxs(u,{children:[e.jsx(g,{variant:"h5",sx:{mb:2,fontWeight:600},children:"Recent Images"}),e.jsx(Us,{children:qt.map((t,s)=>{const r=x.findIndex(a=>a.id===t.id||a.path===t.path);return e.jsx($s,{onClick:()=>{r>=0&&q(r),Fe(t)},isUsed:t.isUsed===!0,children:e.jsx(Ds,{component:"img",image:t.url,alt:t.name,onError:a=>{a.target.src="/images/incode/placeholder.png"}})},t.id||s)})})]}),e.jsxs(u,{sx:{mt:4},children:[e.jsxs(u,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(g,{variant:"h5",sx:{fontWeight:600},children:"All Images"}),e.jsxs(ae,{direction:"row",spacing:2,alignItems:"center",children:[d.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs(dt,{size:"small",sx:{minWidth:150},children:[e.jsx(gt,{children:"Sort By"}),e.jsxs(ut,{value:ge,label:"Sort By",onChange:t=>vt(t.target.value),children:[e.jsx(B,{value:"date",children:"Date Modified"}),e.jsx(B,{value:"name",children:"Name"}),e.jsx(B,{value:"size",children:"Size"}),e.jsx(B,{value:"type",children:"Type"}),e.jsx(B,{value:"location",children:"Location"})]})]}),e.jsx(N,{onClick:()=>Ct(Y==="asc"?"desc":"asc"),title:`Sort ${Y==="asc"?"Descending":"Ascending"}`,size:"small",children:Y==="asc"?"â†‘":"â†“"})]}),d.length>0&&e.jsxs(dt,{size:"small",sx:{minWidth:150},children:[e.jsx(gt,{children:"Usage Filter"}),e.jsxs(ut,{value:M,label:"Usage Filter",onChange:t=>kt(t.target.value),children:[e.jsx(B,{value:"all",children:"All Images"}),e.jsx(B,{value:"used",children:"Used in Codebase"}),e.jsx(B,{value:"unused",children:"Not Used"}),e.jsx(B,{value:"not_checked",children:"Not Checked"})]})]}),e.jsxs(b,{variant:"outlined",color:"error",startIcon:e.jsx(Re,{size:18}),onClick:Ht,disabled:ce||V.length===0,children:["Delete Selected (",V.length,")"]}),e.jsx(b,{variant:"outlined",startIcon:e.jsx(yt,{size:18}),onClick:Kt,disabled:d.length===0,children:"Export CSV"}),e.jsx(b,{variant:"outlined",color:"success",startIcon:e.jsx(yt,{size:18}),onClick:Vt,disabled:_e,children:_e?"Generating...":"Export Used Images List"})]})]}),e.jsx(ns,{sx:{height:600,width:"100%"},children:e.jsx(ws,{rows:x,columns:_t,getRowId:t=>t.id||t.path,checkboxSelection:!0,disableRowSelectionOnClick:!0,rowSelectionModel:V,onRowSelectionModelChange:t=>{Ge(t)},pageSizeOptions:[10,20,50,100],initialState:{pagination:{paginationModel:{pageSize:20}}},getRowClassName:t=>{if(!t||!t.row)return"";const s=t.row;return s?s.isUsed===!0?"gallery-row-used":s.isUsed===!1?"gallery-row-unused":"":""},sx:{"& .MuiDataGrid-cell:focus":{outline:"none"},"& .gallery-row-used":{background:"linear-gradient(90deg, rgba(200, 230, 201, 0.3) 0%, rgba(200, 230, 201, 0.1) 100%)","&:hover":{backgroundColor:"rgba(200, 230, 201, 0.4) !important"}},"& .gallery-row-unused":{background:"linear-gradient(90deg, rgba(255, 205, 210, 0.3) 0%, rgba(255, 205, 210, 0.1) 100%)","&:hover":{backgroundColor:"rgba(255, 205, 210, 0.4) !important"}}}})})]}),d.length===0&&e.jsxs(u,{sx:{textAlign:"center",py:8,border:`2px dashed ${h.palette.divider}`,borderRadius:2},children:[e.jsx(bt,{size:64,style:{opacity:.3,marginBottom:16}}),e.jsx(g,{variant:"h6",color:"text.secondary",children:"No images in gallery"}),e.jsx(g,{variant:"body2",color:"text.secondary",sx:{mt:1},children:"Upload your first image to get started"})]})]})}),e.jsxs(ne,{open:Ut,onClose:()=>ue(!1),children:[e.jsx(oe,{children:"Move Image"}),e.jsx(ie,{children:e.jsx(ht,{fullWidth:!0,label:"Target Directory",value:qe,onChange:t=>Ye(t.target.value),sx:{mt:1}})}),e.jsxs(le,{children:[e.jsx(b,{onClick:()=>ue(!1),children:"Cancel"}),e.jsx(b,{onClick:()=>pe&&zt(pe,qe),children:"Move"})]})]}),e.jsxs(ne,{open:$t,onClose:()=>he(!1),children:[e.jsx(oe,{children:"Rename Image"}),e.jsx(ie,{children:e.jsx(ht,{fullWidth:!0,label:"New Name",value:Ve,onChange:t=>Ue(t.target.value),sx:{mt:1}})}),e.jsxs(le,{children:[e.jsx(b,{onClick:()=>he(!1),children:"Cancel"}),e.jsx(b,{onClick:()=>pe&&Tt(pe,Ve),children:"Rename"})]})]}),e.jsxs(ne,{open:Et,onClose:()=>$e(!1),maxWidth:"md",fullWidth:!0,children:[e.jsx(oe,{children:e.jsxs(u,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(g,{variant:"h6",children:"Catalog Suggestions"}),Object.keys(C).length>0&&e.jsx(u,{sx:{display:"flex",gap:1,alignItems:"center"},children:e.jsxs(g,{variant:"caption",color:"text.secondary",children:["Total: ",D.length," | Valid: ",Object.values(C).filter(t=>t.status==="valid").length," | Invalid: ",Object.values(C).filter(t=>t.status==="invalid").length]})})]})}),e.jsxs(ie,{children:[e.jsxs(u,{sx:{mb:2,display:"flex",gap:1,flexWrap:"wrap",alignItems:"center"},children:[e.jsx(b,{variant:"outlined",onClick:Pt,disabled:D.length===0||te||se,startIcon:te?e.jsx(je,{sx:{width:16,height:16}}):null,children:te?"Validating...":"Dry Run"}),e.jsx(b,{variant:"contained",onClick:Nt,disabled:D.length===0||se||te,startIcon:se?e.jsx(je,{sx:{width:16,height:16}}):null,children:se?"Applying...":"Apply All"}),e.jsx(os,{control:e.jsx(is,{checked:Xe,onChange:t=>Ze(t.target.checked)}),label:"Show full summary"})]}),e.jsx(u,{sx:{maxHeight:400,overflow:"auto"},children:D.map((t,s)=>{const r=C[s];!r||r.status;const a=(r==null?void 0:r.status)==="valid",o=(r==null?void 0:r.status)==="invalid",n=(r==null?void 0:r.status)==="applied",i=(r==null?void 0:r.status)==="failed";return e.jsxs(u,{sx:{mb:2,p:2,border:1,borderColor:o||i?"error.main":a||n?"success.main":"divider",borderRadius:1,backgroundColor:a||n?"action.selected":"transparent"},children:[e.jsxs(u,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:1},children:[e.jsxs(u,{sx:{flex:1},children:[e.jsx(g,{variant:"subtitle2",children:t.path}),e.jsxs(g,{variant:"body2",color:"text.secondary",children:["Suggested: ",t.suggestedDir,"/",t.suggestedName]}),e.jsxs(g,{variant:"caption",color:"text.secondary",children:["Confidence: ",(t.confidence*100).toFixed(0),"%"]})]}),e.jsx(u,{sx:{ml:2},children:Bt(s)})]}),r&&r.message&&e.jsx(Ae,{severity:o||i?"error":a||n?"success":"info",sx:{mt:1,mb:1},children:r.message}),e.jsx(u,{sx:{display:"flex",gap:1,mt:1},children:e.jsx(b,{size:"small",variant:"outlined",onClick:()=>At(s),disabled:n||se||te,children:n?"Applied":"Apply"})})]},s)})}),Object.keys(C).length>0&&e.jsxs(e.Fragment,{children:[e.jsx(ls,{sx:{my:2}}),e.jsxs(u,{children:[e.jsxs(u,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",cursor:"pointer",p:1,"&:hover":{backgroundColor:"action.hover"}},onClick:()=>fe(!De),children:[e.jsxs(g,{variant:"subtitle2",children:["Summary: Succeeded: ",Object.values(C).filter(t=>t.status==="applied"||t.status==="valid").length,", Failed: ",Object.values(C).filter(t=>t.status==="failed"||t.status==="invalid").length]}),e.jsx(N,{size:"small",children:De?e.jsx(fs,{size:20}):e.jsx(xs,{size:20})})]}),e.jsxs(cs,{in:De,children:[e.jsx(u,{sx:{mt:1,maxHeight:300,overflow:"auto"},children:(Xe?Object.entries(C):Object.entries(C).filter(([t,s])=>s.status==="invalid"||s.status==="failed")).map(([t,s])=>{const r=parseInt(t),a=D[r];return a?e.jsxs(u,{sx:{p:1,mb:1,border:1,borderColor:"divider",borderRadius:1,backgroundColor:s.status==="invalid"||s.status==="failed"?"error.light":"success.light"},children:[e.jsxs(g,{variant:"body2",fontWeight:"bold",children:[a.path," â†’ ",a.suggestedDir,"/",a.suggestedName]}),e.jsxs(g,{variant:"caption",color:"text.secondary",children:["Status: ",s.status," | Code: ",s.code]}),s.message&&e.jsx(g,{variant:"caption",display:"block",sx:{mt:.5},children:s.message})]},r):null})}),e.jsx(u,{sx:{mt:1,display:"flex",justifyContent:"flex-end"},children:e.jsx(b,{size:"small",startIcon:e.jsx(ds,{size:16}),onClick:Rt,children:"Copy Summary"})})]})]})]})]}),e.jsx(le,{children:e.jsx(b,{onClick:()=>{$e(!1),J({}),Ze(!1),fe(!1)},children:"Close"})})]}),e.jsxs(ne,{open:Ce,onClose:()=>G(!1),maxWidth:"md",fullWidth:!0,children:[e.jsxs(oe,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(g,{variant:"h6",children:j==null?void 0:j.name}),e.jsx(N,{onClick:()=>G(!1),children:e.jsx(Ne,{})})]}),e.jsx(ie,{children:j&&e.jsxs(u,{children:[e.jsx(u,{sx:{mb:3,textAlign:"center"},children:e.jsx("img",{src:j.url,alt:j.name,style:{maxWidth:"100%",maxHeight:"400px",objectFit:"contain",borderRadius:"8px"},onError:t=>{t.target.src="/images/incode/placeholder.png"}})}),e.jsxs(ae,{spacing:2,children:[e.jsxs(u,{children:[e.jsx(g,{variant:"subtitle2",color:"text.secondary",children:"Image Name"}),e.jsx(g,{variant:"body1",children:j.name})]}),e.jsxs(u,{children:[e.jsx(g,{variant:"subtitle2",color:"text.secondary",children:"Image Path"}),e.jsx(g,{variant:"body1",sx:{wordBreak:"break-all"},children:j.path})]}),j.created&&e.jsxs(u,{children:[e.jsx(g,{variant:"subtitle2",color:"text.secondary",children:"Image Created"}),e.jsx(g,{variant:"body1",children:new Date(j.created).toLocaleString()})]}),j.type&&e.jsxs(u,{children:[e.jsx(g,{variant:"subtitle2",color:"text.secondary",children:"File Type"}),e.jsx(L,{label:j.type.toUpperCase(),size:"small"})]}),j.size&&e.jsxs(u,{children:[e.jsx(g,{variant:"subtitle2",color:"text.secondary",children:"File Size"}),e.jsxs(g,{variant:"body1",children:[(j.size/1024).toFixed(2)," KB"]})]})]})]})}),e.jsxs(le,{children:[e.jsx(b,{onClick:()=>j&&Fe(j),variant:"outlined",children:"Open in New Window"}),e.jsx(b,{onClick:()=>j&&st(j),variant:"contained",color:"error",startIcon:e.jsx(Re,{size:18}),disabled:ce,children:ce?"Deleting...":"Delete Image"}),e.jsx(b,{onClick:()=>G(!1),children:"Close"})]})]}),e.jsxs(ne,{open:ve,onClose:Pe,maxWidth:"sm",fullWidth:!0,children:[e.jsxs(oe,{children:["Upload Image to Gallery",e.jsx(N,{"aria-label":"close",onClick:Pe,sx:{position:"absolute",right:8,top:8},children:e.jsx(Ne,{size:20})})]}),e.jsx(ie,{children:e.jsxs(u,{sx:{mt:2},children:[e.jsx("input",{ref:re,type:"file",accept:".jpg,.jpeg,.tiff,.gif,.png",onChange:Lt,style:{display:"none"},id:"image-upload-input",multiple:!0}),e.jsx("label",{htmlFor:"image-upload-input",children:e.jsx(b,{variant:"outlined",component:"span",fullWidth:!0,startIcon:e.jsx(xt,{size:20}),sx:{mb:2},children:U.length>0?`Select More Images (${U.length} selected)`:"Select Images"})}),e.jsx(g,{variant:"caption",color:"text.secondary",display:"block",sx:{mb:2,textAlign:"center"},children:"Allowed formats: .jpg, .jpeg, .tiff, .gif, .png (You can select multiple files)"}),U.length>0&&e.jsxs(u,{sx:{mb:2},children:[e.jsxs(g,{variant:"subtitle2",sx:{mb:1,fontWeight:600},children:["Selected Images (",U.length,"):"]}),e.jsx(ae,{spacing:1,children:U.map((t,s)=>{const r=`${t.name}-${t.size}`,a=wt[r];return e.jsx(u,{sx:{p:2,bgcolor:"background.default",borderRadius:1,border:"1px solid",borderColor:(a==null?void 0:a.status)==="error"?"error.main":(a==null?void 0:a.status)==="success"?"success.main":"divider"},children:e.jsxs(u,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:1},children:[e.jsxs(u,{sx:{flex:1},children:[e.jsx(g,{variant:"body2",sx:{fontWeight:600,mb:.5},children:t.name}),e.jsxs(g,{variant:"caption",color:"text.secondary",display:"block",children:["Size: ",(t.size/1024/1024).toFixed(2)," MB"]}),a&&e.jsxs(e.Fragment,{children:[a.status==="uploading"&&e.jsxs(u,{sx:{mt:1},children:[e.jsx(je,{variant:"determinate",value:a.progress,size:"small"}),e.jsxs(g,{variant:"caption",color:"text.secondary",children:["Uploading... ",Math.round(a.progress),"%"]})]}),a.status==="success"&&e.jsx(g,{variant:"caption",color:"success.main",sx:{mt:.5,display:"block"},children:"âœ“ Uploaded successfully"}),a.status==="error"&&e.jsxs(g,{variant:"caption",color:"error.main",sx:{mt:.5,display:"block"},children:["âœ— ",a.error||"Upload failed"]})]})]}),!O&&e.jsx(N,{size:"small",onClick:()=>Jt(s),sx:{ml:1},color:"error",children:e.jsx(Ne,{size:18})})]})},s)})})]}),O&&U.length>0&&e.jsxs(u,{sx:{mt:2},children:[e.jsxs(g,{variant:"body2",color:"text.secondary",sx:{mb:1},children:["Overall Progress: ",Math.round(ke),"%"]}),e.jsx(je,{variant:"determinate",value:ke}),e.jsxs(g,{variant:"caption",color:"text.secondary",sx:{mt:1,display:"block"},children:["Uploading ",U.length," image",U.length>1?"s":"","..."]})]}),We&&e.jsx(Ae,{severity:"error",sx:{mt:2},children:We})]})}),e.jsxs(le,{children:[e.jsx(b,{onClick:Pe,disabled:O,children:"Cancel"}),e.jsx(b,{onClick:Wt,variant:"contained",disabled:U.length===0||O,sx:{backgroundColor:"#C8A24B",color:"#1a1a1a","&:hover":{backgroundColor:"#B8923A"}},children:O?`Uploading... (${Math.round(ke)}%)`:`Upload ${U.length} Image${U.length!==1?"s":""}`})]})]})]})};export{pr as default};
//# sourceMappingURL=Gallery-Dhn-2na3.js.map
