var A=Object.defineProperty,U=Object.defineProperties;var q=Object.getOwnPropertyDescriptors;var E=Object.getOwnPropertySymbols;var O=Object.prototype.hasOwnProperty,z=Object.prototype.propertyIsEnumerable;var D=(t,r,a)=>r in t?A(t,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[r]=a,S=(t,r)=>{for(var a in r||(r={}))O.call(r,a)&&D(t,a,r[a]);if(E)for(var a of E(r))z.call(r,a)&&D(t,a,r[a]);return t},w=(t,r)=>U(t,q(r));var P=(t,r,a)=>new Promise((j,n)=>{var o=i=>{try{g(a.next(i))}catch(x){n(x)}},v=i=>{try{g(a.throw(i))}catch(x){n(x)}},g=i=>i.done?j(i.value):Promise.resolve(i.value).then(o,v);g((a=a.apply(t,r)).next())});import{aK as G,be as H,l as J,k as K,j as e,B as k,C as M,R as X,d as Q,$ as W,G as c,O as h,S as V,e as $,A as Y}from"./index-CNFXvQ6i.js";import{r as f}from"./vendor-DgfDxsY7.js";import{I as Z}from"./IconCheck-DIkpgZMD.js";const se=()=>{var F;const{id:t}=G(),[r]=H(),a=J(),{user:j}=K(),n=!!t,o=r.get("church_id")||((F=j==null?void 0:j.church_id)==null?void 0:F.toString())||"",[v,g]=f.useState(n),[i,x]=f.useState(!1),[R,m]=f.useState(null),[L,C]=f.useState(!1),[l,I]=f.useState({first_name:"",last_name:"",death_date:"",burial_date:"",burial_location:"",age_at_death:"",priest_name:"",notes:""});f.useEffect(()=>{n&&t&&o&&P(void 0,null,function*(){var u;try{g(!0),m(null);const p=new URLSearchParams({church_id:o}),y=yield fetch(`/api/funeral-records/${t}?${p.toString()}`,{credentials:"include",headers:{"Content-Type":"application/json"}});if(!y.ok)throw new Error("Failed to load record");const _=yield y.json();if(_.success&&_.record){const s=_.record;I({first_name:s.first_name||s.name||"",last_name:s.last_name||s.lastname||"",death_date:s.death_date||"",burial_date:s.burial_date||"",burial_location:s.burial_location||"",age_at_death:((u=s.age_at_death)==null?void 0:u.toString())||"",priest_name:s.priest_name||s.priest||s.clergy||"",notes:s.notes||""})}}catch(p){m(p.message||"Failed to load record")}finally{g(!1)}})},[n,t,o]);const d=b=>u=>{I(p=>w(S({},p),{[b]:u.target.value})),m(null),C(!1)},T=b=>P(void 0,null,function*(){if(b.preventDefault(),!o){m("Church ID is required");return}x(!0),m(null),C(!1);try{const u=n?`/api/funeral-records/${t}`:"/api/funeral-records",p=n?"PUT":"POST",y=new URLSearchParams({church_id:o}),_=yield fetch(`${u}?${y.toString()}`,{method:p,credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(w(S({},l),{church_id:parseInt(o),age_at_death:l.age_at_death?parseInt(l.age_at_death):null}))});if(!_.ok){const N=yield _.json().catch(()=>({}));throw new Error(N.error||"Failed to save record")}const s=yield _.json();if(s.success)C(!0),setTimeout(()=>{a(`/apps/records/funeral?church_id=${o}`)},1500);else throw new Error(s.error||"Failed to save record")}catch(u){m(u.message||"Failed to save record")}finally{x(!1)}}),B=()=>{a(`/apps/records/funeral?church_id=${o}`)};return v?e.jsx(k,{sx:{p:3,display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px"},children:e.jsx(M,{})}):e.jsx(k,{sx:{p:3},children:e.jsxs(X,{sx:{p:3},children:[e.jsx(Q,{variant:"h4",gutterBottom:!0,children:n?"Edit Funeral Record":"New Funeral Record"}),R&&e.jsx(W,{severity:"error",sx:{mb:2},onClose:()=>m(null),children:R}),L&&e.jsxs(W,{severity:"success",sx:{mb:2},children:["Record ",n?"updated":"created"," successfully. Redirecting..."]}),e.jsxs("form",{onSubmit:T,children:[e.jsxs(c,{container:!0,spacing:2,children:[e.jsx(c,{item:!0,xs:12,sm:6,children:e.jsx(h,{fullWidth:!0,label:"First Name",value:l.first_name,onChange:d("first_name"),required:!0,margin:"normal"})}),e.jsx(c,{item:!0,xs:12,sm:6,children:e.jsx(h,{fullWidth:!0,label:"Last Name",value:l.last_name,onChange:d("last_name"),required:!0,margin:"normal"})}),e.jsx(c,{item:!0,xs:12,sm:6,children:e.jsx(h,{fullWidth:!0,label:"Death Date",type:"date",value:l.death_date,onChange:d("death_date"),InputLabelProps:{shrink:!0},margin:"normal"})}),e.jsx(c,{item:!0,xs:12,sm:6,children:e.jsx(h,{fullWidth:!0,label:"Burial Date",type:"date",value:l.burial_date,onChange:d("burial_date"),InputLabelProps:{shrink:!0},margin:"normal"})}),e.jsx(c,{item:!0,xs:12,sm:6,children:e.jsx(h,{fullWidth:!0,label:"Burial Location",value:l.burial_location,onChange:d("burial_location"),margin:"normal"})}),e.jsx(c,{item:!0,xs:12,sm:6,children:e.jsx(h,{fullWidth:!0,label:"Age at Death",type:"number",value:l.age_at_death,onChange:d("age_at_death"),margin:"normal",inputProps:{min:0}})}),e.jsx(c,{item:!0,xs:12,sm:6,children:e.jsx(h,{fullWidth:!0,label:"Priest",value:l.priest_name,onChange:d("priest_name"),margin:"normal"})}),e.jsx(c,{item:!0,xs:12,children:e.jsx(h,{fullWidth:!0,label:"Notes",value:l.notes,onChange:d("notes"),margin:"normal",multiline:!0,rows:4})})]}),e.jsxs(V,{direction:"row",spacing:2,sx:{mt:3},children:[e.jsx($,{type:"submit",variant:"contained",startIcon:e.jsx(Z,{size:18}),disabled:i,children:i?"Saving...":n?"Update Record":"Create Record"}),e.jsx($,{type:"button",variant:"outlined",startIcon:e.jsx(Y,{size:18}),onClick:B,disabled:i,children:"Cancel"})]})]})]})})};export{se as default};
//# sourceMappingURL=FuneralRecordEntryPage-BUicZo4U.js.map
