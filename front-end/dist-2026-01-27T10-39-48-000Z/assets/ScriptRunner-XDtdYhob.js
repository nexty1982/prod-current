var S=(r,d,m)=>new Promise((n,u)=>{var x=a=>{try{i(m.next(a))}catch(p){u(p)}},g=a=>{try{i(m.throw(a))}catch(p){u(p)}},i=a=>a.done?n(a.value):Promise.resolve(a.value).then(x,g);i((m=m.apply(r,d)).next())});import{a as M,j as e,k as D,R as j,$ as b,d as t,B as c,h as v,T as N,I as J,aH as U,G as E,a0 as W,a1 as Y,a2 as q,f as K,e as Q,C as k}from"./index-CNFXvQ6i.js";import{r as l}from"./vendor-DgfDxsY7.js";import{E as z}from"./Error-CoBrLw2j.js";import{T as V}from"./Terminal-C1boCPzu.js";import{S as X}from"./PlayArrow-CO_kfEcZ.js";import{A,a as F,b as H}from"./AccordionSummary-T6iDGiNS.js";import{C as Z}from"./CheckCircle-BEqfcR2Z.js";import{E as $}from"./ExpandMore-DbErwMz2.js";import{H as ee}from"./History-3adYHPRO.js";const se=M([e.jsx("path",{d:"M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2M12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8"},"0"),e.jsx("path",{d:"M12.5 7H11v6l5.25 3.15.75-1.23-4.5-2.67z"},"1")]),pe=()=>{var R;const{user:r}=D(),[d,m]=l.useState([]),[n,u]=l.useState(""),[x,g]=l.useState(!1),[i,a]=l.useState(null),[p,B]=l.useState([]),[f,I]=l.useState(!0),[O,w]=l.useState(!1),[T,h]=l.useState(""),y=(r==null?void 0:r.role)==="super_admin"||(r==null?void 0:r.role)==="admin",C=()=>S(void 0,null,function*(){if(y){I(!0),h("");try{const s=yield fetch("/api/scripts",{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}}),o=yield s.json();if(!s.ok)throw new Error(o.error||`HTTP ${s.status}`);if(o.success)m(o.scripts||[]),console.log("ðŸ“‹ Loaded scripts:",o.scripts);else throw new Error(o.error||"Failed to load scripts")}catch(s){console.error("âŒ Failed to load scripts:",s),h(s instanceof Error?s.message:"Failed to load scripts")}finally{I(!1)}}}),L=()=>S(void 0,null,function*(){if((r==null?void 0:r.role)==="super_admin"){w(!0);try{const s=yield fetch("/api/script-logs?limit=20",{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}}),o=yield s.json();s.ok&&o.success&&(B(o.logs||[]),console.log("ðŸ“œ Loaded execution logs:",o.logs))}catch(s){console.error("âŒ Failed to load logs:",s)}finally{w(!1)}}}),P=()=>S(void 0,null,function*(){if(!(!n||!y)){g(!0),a(null),h(""),d.find(s=>s.id===n);try{console.log(`ðŸš€ Executing script: ${n}`);const s=yield fetch("/api/run-script",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({scriptName:n,args:[]})}),o=yield s.json();if(!s.ok)throw new Error(o.error||`HTTP ${s.status}: ${o.message||"Script execution failed"}`);a(o),console.log("âœ… Script execution completed:",o),(r==null?void 0:r.role)==="super_admin"&&setTimeout(L,1e3)}catch(s){console.error("âŒ Script execution failed:",s),h(s instanceof Error?s.message:"Script execution failed")}finally{g(!1)}}}),_=s=>{try{return new Date(s).toLocaleString()}catch(o){return s}},G=s=>`${s/1e3}s`;return l.useEffect(()=>{C(),(r==null?void 0:r.role)==="super_admin"&&L()},[y,r==null?void 0:r.role]),y?e.jsxs(j,{elevation:2,sx:{p:3,m:2},children:[e.jsxs(c,{sx:{display:"flex",alignItems:"center",mb:3},children:[e.jsx(V,{sx:{mr:2,color:"primary.main"}}),e.jsx(t,{variant:"h4",component:"h1",children:"Script Runner"}),e.jsx(v,{label:r==null?void 0:r.role,color:"primary",size:"small",sx:{ml:2}}),e.jsx(c,{sx:{flexGrow:1}}),e.jsx(N,{title:"Refresh Scripts",children:e.jsx(J,{onClick:C,disabled:f,children:e.jsx(U,{})})})]}),e.jsx(t,{variant:"body1",color:"text.secondary",sx:{mb:3},children:"Execute pre-approved server scripts safely. Only whitelisted scripts can be run."}),T&&e.jsx(b,{severity:"error",sx:{mb:3},onClose:()=>h(""),children:T}),e.jsxs(E,{container:!0,spacing:3,children:[e.jsxs(E,{item:!0,xs:12,md:8,children:[e.jsxs(W,{fullWidth:!0,sx:{mb:3},children:[e.jsx(Y,{id:"script-select-label",children:"Select Script"}),e.jsx(q,{labelId:"script-select-label",value:n,label:"Select Script",onChange:s=>u(s.target.value),disabled:f||x,children:d.map(s=>e.jsx(K,{value:s.id,children:e.jsxs(c,{children:[e.jsx(t,{variant:"body1",children:s.name}),e.jsxs(t,{variant:"caption",color:"text.secondary",children:[s.description," â€¢ Timeout: ",G(s.timeout)]})]})},s.id))})]}),e.jsx(Q,{variant:"contained",color:"primary",size:"large",startIcon:x?e.jsx(k,{size:20}):e.jsx(X,{}),onClick:P,disabled:!n||x||f,sx:{mb:3},children:x?"Executing...":"Run Script"}),n&&!x&&e.jsx(b,{severity:"info",sx:{mb:3},children:e.jsxs(t,{variant:"body2",children:["Ready to execute: ",e.jsx("strong",{children:(R=d.find(s=>s.id===n))==null?void 0:R.name})]})})]}),e.jsx(E,{item:!0,xs:12,md:4,children:e.jsxs(j,{variant:"outlined",sx:{p:2},children:[e.jsx(t,{variant:"h6",gutterBottom:!0,children:"Available Scripts"}),e.jsx(t,{variant:"body2",color:"text.secondary",children:f?"Loading...":`${d.length} scripts available`}),d.map(s=>e.jsx(v,{label:s.name,size:"small",variant:n===s.id?"filled":"outlined",sx:{mr:1,mt:1},onClick:()=>u(s.id)},s.id))]})})]}),i&&e.jsxs(A,{defaultExpanded:!0,sx:{mb:3},children:[e.jsx(F,{expandIcon:e.jsx($,{}),children:e.jsxs(c,{sx:{display:"flex",alignItems:"center"},children:[i.success?e.jsx(Z,{color:"success",sx:{mr:1}}):e.jsx(z,{color:"error",sx:{mr:1}}),e.jsxs(t,{variant:"h6",children:["Execution Result: ",i.success?"Success":"Failed"]}),i.executionTime&&e.jsx(v,{icon:e.jsx(se,{}),label:_(i.executionTime),size:"small",sx:{ml:2}})]})}),e.jsxs(H,{children:[i.message&&e.jsx(t,{variant:"body1",sx:{mb:2},children:i.message}),i.stdout&&e.jsxs(c,{sx:{mb:2},children:[e.jsx(t,{variant:"subtitle2",gutterBottom:!0,children:"Output:"}),e.jsx(j,{variant:"outlined",sx:{p:2,backgroundColor:"grey.50",fontFamily:"monospace",fontSize:"0.875rem",maxHeight:"300px",overflow:"auto"},children:e.jsx("pre",{style:{margin:0,whiteSpace:"pre-wrap"},children:i.stdout})})]}),i.stderr&&e.jsxs(c,{sx:{mb:2},children:[e.jsx(t,{variant:"subtitle2",gutterBottom:!0,color:"error",children:"Error Output:"}),e.jsx(j,{variant:"outlined",sx:{p:2,backgroundColor:"error.light",color:"error.contrastText",fontFamily:"monospace",fontSize:"0.875rem",maxHeight:"300px",overflow:"auto"},children:e.jsx("pre",{style:{margin:0,whiteSpace:"pre-wrap"},children:i.stderr})})]})]})]}),(r==null?void 0:r.role)==="super_admin"&&e.jsxs(A,{sx:{mb:2},children:[e.jsx(F,{expandIcon:e.jsx($,{}),children:e.jsxs(c,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(ee,{sx:{mr:1}}),e.jsx(t,{variant:"h6",children:"Execution History"}),e.jsx(v,{label:`${p.length} entries`,size:"small",sx:{ml:2}})]})}),e.jsx(H,{children:O?e.jsxs(c,{sx:{display:"flex",alignItems:"center",py:2},children:[e.jsx(k,{size:20,sx:{mr:2}}),e.jsx(t,{children:"Loading execution history..."})]}):p.length>0?e.jsx(c,{children:p.map((s,o)=>e.jsx(c,{sx:{mb:1,p:1,backgroundColor:"grey.50",borderRadius:1},children:e.jsx(t,{variant:"body2",component:"div",sx:{fontFamily:"monospace"},children:s.rawLine})},o))}):e.jsx(t,{color:"text.secondary",children:"No execution history found"})})]}),e.jsx(b,{severity:"warning",sx:{mt:3},children:e.jsxs(t,{variant:"body2",children:[e.jsx("strong",{children:"Security Notice:"})," Only pre-approved scripts can be executed. All executions are logged for audit purposes. Use responsibly."]})})]}):e.jsx(j,{elevation:2,sx:{p:3,m:2},children:e.jsxs(b,{severity:"error",icon:e.jsx(z,{}),children:[e.jsx(t,{variant:"h6",children:"Access Denied"}),e.jsxs(t,{children:["You need super_admin or admin role to access the Script Runner. Current role: ",(r==null?void 0:r.role)||"none"]})]})})};export{pe as default};
//# sourceMappingURL=ScriptRunner-XDtdYhob.js.map
