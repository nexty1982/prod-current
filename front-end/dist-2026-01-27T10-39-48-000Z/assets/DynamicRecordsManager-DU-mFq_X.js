var Ue=Object.defineProperty,Ne=Object.defineProperties;var Je=Object.getOwnPropertyDescriptors;var ue=Object.getOwnPropertySymbols;var Qe=Object.prototype.hasOwnProperty,He=Object.prototype.propertyIsEnumerable;var ae=(r,e,s)=>e in r?Ue(r,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[e]=s,O=(r,e)=>{for(var s in e||(e={}))Qe.call(e,s)&&ae(r,s,e[s]);if(ue)for(var s of ue(e))He.call(e,s)&&ae(r,s,e[s]);return r},K=(r,e)=>Ne(r,Je(e));var ne=(r,e,s)=>ae(r,typeof e!="symbol"?e+"":e,s);var b=(r,e,s)=>new Promise((o,n)=>{var i=d=>{try{l(s.next(d))}catch(p){n(p)}},a=d=>{try{l(s.throw(d))}catch(p){n(p)}},l=d=>d.done?o(d.value):Promise.resolve(d.value).then(i,a);l((s=s.apply(r,e)).next())});import{c8 as Se,j as t,B as y,$ as ie,d as R,R as ce,aJ as me,h as we,I as Ce,M as We,f as Re,C as Ye,e as D,T as Ge,a0 as Xe,a1 as Ze,a2 as er,bd as rr,aH as tr}from"./index-CNFXvQ6i.js";import{r as m}from"./vendor-DgfDxsY7.js";import{u as le}from"./useQuery-BNSEWXyB.js";import{u as V}from"./useMutation-B2ZoL80x.js";import{a as C,F as sr,m as or,R as ar,b as nr}from"./RecordsModal-aF0duw_P.js";import{T as ke,a as Te,b as De,c as G,d as ve}from"./TableRow-AyUKSpjR.js";import{T as v}from"./TableCell-DwyxNY3j.js";import{M as ir}from"./MoreVert-CheergR_.js";import{L as cr}from"./ListItemIcon-Ceo8X1mf.js";import{L as lr}from"./ListItemText-Do-rLMnZ.js";import{S as xe}from"./Skeleton-Dd7vBz6A.js";import{T as ye}from"./TableChart-3Yt7LtnB.js";import{L as ge,a as fe}from"./LockOpen-DQf0k1xZ.js";import{U as dr}from"./Upload-BcbQUqYA.js";import{D as hr}from"./Download-8bMO9YJm.js";import"./AdapterDateFns-Xun6WJJX.js";import"./index-BvdvJza9.js";import"./useThemeProps-CHH644oI.js";import"./InputAdornment-v70Ylxh4.js";import"./index-B1ndscEH.js";import"./ListItem-KF7kizas.js";import"./listItemButtonClasses-Khq0AWwe.js";import"./index-CCbV6T5K.js";import"./index-B8Cm0CAq.js";import"./typeof-QjJsDpFa.js";import"./index-B9SIr0Qh.js";import"./index-DmKFFksY.js";import"./index-B8a_guEX.js";import"./index-Bl18lNLp.js";import"./toPropertyKey-BRA8pAMC.js";import"./Clear-yw_UiRbM.js";import"./Search-k1Rr3-Ib.js";import"./Badge-CzqvSSPX.js";import"./usePreviousProps-BWumOsHT.js";import"./FilterList--lVyI5-a.js";import"./DatePicker-DJ3ConIM.js";import"./Close-BQ-7S1uX.js";const S={discoverTables:r=>`/api/churches/${r}/tables/discover`,getTableSchema:(r,e)=>`/api/churches/${r}/tables/${e}/schema`,records:(r,e)=>`/api/churches/${r}/tables/${e}/records`,recordById:(r,e,s)=>`/api/churches/${r}/tables/${e}/records/${s}`,search:(r,e)=>`/api/churches/${r}/tables/${e}/search`,import:(r,e)=>`/api/churches/${r}/tables/${e}/import`,export:(r,e)=>`/api/churches/${r}/tables/${e}/export`,dropdownOptions:r=>`/api/churches/${r}/dropdown-options`,healthCheck:()=>"/api/health"};class pr{constructor(e){ne(this,"churchId");ne(this,"tableCache",new Map);this.churchId=e}discoverRecordTables(){return b(this,null,function*(){try{const e=yield C(S.discoverTables(this.churchId));return e.forEach(s=>{this.tableCache.set(s.tableName,s)}),{success:!0,data:e,message:`Discovered ${e.length} record tables`}}catch(e){return this.handleError(e,"Failed to discover record tables")}})}getTableSchema(e){return b(this,null,function*(){try{if(this.tableCache.has(e))return{success:!0,data:this.tableCache.get(e),message:"Table schema retrieved from cache"};const s=yield C(S.getTableSchema(this.churchId,e));return this.tableCache.set(e,s),{success:!0,data:s,message:"Table schema retrieved successfully"}}catch(s){return this.handleError(s,"Failed to retrieve table schema")}})}getRecords(e,s,o,n){return b(this,null,function*(){try{const i=new URLSearchParams;s&&Object.entries(s).forEach(([p,x])=>{x!=null&&x!==""&&i.append(p,x.toString())}),o&&(i.append("sortBy",o.field),i.append("sortOrder",o.direction)),n&&(i.append("page",n.page.toString()),i.append("limit",n.limit.toString()));const a=`${S.records(this.churchId,e)}?${i.toString()}`,l=yield C(a);return{success:!0,data:K(O({},l),{data:l.data.map(p=>this.transformRecordData(p,e))}),message:"Records retrieved successfully"}}catch(i){return this.handleError(i,"Failed to retrieve records")}})}getRecord(e,s){return b(this,null,function*(){try{const o=yield C(S.recordById(this.churchId,e,s));return{success:!0,data:this.transformRecordData(o,e),message:"Record retrieved successfully"}}catch(o){return this.handleError(o,"Failed to retrieve record")}})}createRecord(e,s){return b(this,null,function*(){try{const o=yield C(S.records(this.churchId,e),{method:"POST",body:JSON.stringify(s)});return{success:!0,data:this.transformRecordData(o,e),message:"Record created successfully"}}catch(o){return this.handleError(o,"Failed to create record")}})}updateRecord(e,s,o){return b(this,null,function*(){try{const n=yield C(S.recordById(this.churchId,e,s),{method:"PUT",body:JSON.stringify(o)});return{success:!0,data:this.transformRecordData(n,e),message:"Record updated successfully"}}catch(n){return this.handleError(n,"Failed to update record")}})}deleteRecord(e,s){return b(this,null,function*(){try{return yield C(S.recordById(this.churchId,e,s),{method:"DELETE"}),{success:!0,message:"Record deleted successfully"}}catch(o){return this.handleError(o,"Failed to delete record")}})}searchRecords(e,s,o,n,i){return b(this,null,function*(){try{const a=new URLSearchParams;a.append("q",s),o&&Object.entries(o).forEach(([x,j])=>{j!=null&&j!==""&&a.append(x,j.toString())}),n&&(a.append("sortBy",n.field),a.append("sortOrder",n.direction)),i&&(a.append("page",i.page.toString()),a.append("limit",i.limit.toString()));const l=`${S.search(this.churchId,e)}?${a.toString()}`,d=yield C(l);return{success:!0,data:K(O({},d),{data:d.data.map(x=>this.transformRecordData(x,e))}),message:"Search completed successfully"}}catch(a){return this.handleError(a,"Failed to search records")}})}importRecords(e,s,o){return b(this,null,function*(){try{const n=new FormData;n.append("file",s),o!=null&&o.mapping&&n.append("mapping",JSON.stringify(o.mapping)),o!=null&&o.skipValidation&&n.append("skipValidation","true");const i=yield C(S.import(this.churchId,e),{method:"POST",body:n});return{success:!0,data:i,message:`Successfully imported ${i.imported} records`}}catch(n){return this.handleError(n,"Failed to import records")}})}exportRecords(e,s,o){return b(this,null,function*(){try{const n=new URLSearchParams;n.append("format",s),o&&Object.entries(o).forEach(([d,p])=>{p!=null&&p!==""&&n.append(d,p.toString())});const i=`${S.export(this.churchId,e)}?${n.toString()}`,a=yield fetch(i,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});if(!a.ok)throw new Error(`Export failed: ${a.statusText}`);return{success:!0,data:yield a.blob(),message:"Records exported successfully"}}catch(n){return this.handleError(n,"Failed to export records")}})}getDropdownOptions(){return b(this,null,function*(){try{return{success:!0,data:yield C(S.dropdownOptions(this.churchId)),message:"Dropdown options retrieved successfully"}}catch(e){return this.handleError(e,"Failed to retrieve dropdown options")}})}healthCheck(){return b(this,null,function*(){try{return{success:!0,data:yield C(S.healthCheck()),message:"Health check completed"}}catch(e){return this.handleError(e,"Health check failed")}})}transformRecordData(e,s){const o=this.tableCache.get(s);if(!o)return e;const n=O({},e),i={},a={};return o.columns.forEach(l=>{const d=e[l.name];i[l.position]=d,a[l.position]=this.formatDisplayValue(d,l)}),n._columnPositions=i,n._displayData=a,n}formatDisplayValue(e,s){if(e==null)return"N/A";switch(s.type){case"date":return new Date(e).toLocaleDateString();case"number":return e.toString();case"boolean":return e?"Yes":"No";case"json":return typeof e=="string"?e:JSON.stringify(e);default:return String(e)}}handleError(e,s){console.error("Dynamic Records API Error:",e);let o=s;return e instanceof sr?(o=e.apiError.message,e.apiError.code):e instanceof Error&&(o=e.message),{success:!1,error:o,message:`Error: ${o}`}}}const U=r=>new pr(r),E={tables:r=>["dynamic-tables",r],tableSchema:(r,e)=>["table-schema",r,e],records:(r,e,s,o,n)=>["dynamic-records",r,e,s,o,n],record:(r,e,s)=>["dynamic-record",r,e,s],dropdownOptions:r=>["dropdown-options",r]};function ur(r){const e=m.useMemo(()=>U(r),[r]),{data:s,error:o,isLoading:n,refetch:i}=le({queryKey:E.tables(r),queryFn:()=>e.discoverRecordTables(),enabled:!!r,staleTime:10*60*1e3,retry:2});return{tables:(s==null?void 0:s.data)||[],isLoading:n,error:o||(s==null?void 0:s.error),refetch:i,success:(s==null?void 0:s.success)||!1}}function de(r,e){const s=m.useMemo(()=>U(r),[r]),{data:o,error:n,isLoading:i,refetch:a}=le({queryKey:E.tableSchema(r,e),queryFn:()=>s.getTableSchema(e),enabled:!!r&&!!e,staleTime:15*60*1e3,retry:2});return{schema:o==null?void 0:o.data,isLoading:i,error:n||(o==null?void 0:o.error),refetch:a,success:(o==null?void 0:o.success)||!1}}function mr(r,e,s={}){var p,x,j,T;const o=m.useMemo(()=>U(r),[r]),{data:n,error:i,isLoading:a,isFetching:l,refetch:d}=le({queryKey:E.records(r,e,s.filters,s.sort,s.pagination),queryFn:()=>o.getRecords(e,s.filters,s.sort,s.pagination),enabled:s.enabled!==!1&&!!r&&!!e,staleTime:5*60*1e3,retry:2});return{records:((p=n==null?void 0:n.data)==null?void 0:p.data)||[],total:((x=n==null?void 0:n.data)==null?void 0:x.total)||0,page:((j=n==null?void 0:n.data)==null?void 0:j.page)||1,totalPages:((T=n==null?void 0:n.data)==null?void 0:T.totalPages)||0,isLoading:a,isFetching:l,error:i||(n==null?void 0:n.error),refetch:d,success:(n==null?void 0:n.success)||!1}}function xr(r,e){const s=Se(),o=m.useMemo(()=>U(r),[r]),n=V({mutationFn:l=>o.createRecord(e,l),onSuccess:()=>{s.invalidateQueries({queryKey:E.records(r,e)})}}),i=V({mutationFn:({id:l,data:d})=>o.updateRecord(e,l,d),onSuccess:(l,{id:d})=>{s.invalidateQueries({queryKey:E.records(r,e)}),s.invalidateQueries({queryKey:E.record(r,e,d)})}}),a=V({mutationFn:l=>o.deleteRecord(e,l),onSuccess:()=>{s.invalidateQueries({queryKey:E.records(r,e)})}});return{create:n,update:i,delete:a}}function yr(r,e){const s=m.useMemo(()=>U(r),[r]),o=Se(),n=V({mutationFn:({file:a,options:l})=>s.importRecords(e,a,l),onSuccess:()=>{o.invalidateQueries({queryKey:E.records(r,e)})}}),i=V({mutationFn:({format:a,filters:l})=>s.exportRecords(e,a,l)});return{import:n,export:i}}function gr(r,e){const{schema:s,isLoading:o,error:n}=de(r,e);return{columns:m.useMemo(()=>s?s.columns.filter(a=>!a.isPrimaryKey).sort((a,l)=>a.position-l.position).map(a=>({key:`col_${a.position}`,label:a.displayName||a.name,width:a.width||"auto",sortable:a.sortable!==!1,position:a.position,type:a.type,render:(l,d)=>{if(d._displayData&&d._displayData[a.position]!==void 0)return d._displayData[a.position];const p=d[a.name];return jr(p,a)}})):[],[s]),isLoading:o,error:n,schema:s}}function fr(r,e){const{schema:s,isLoading:o,error:n}=de(r,e);return{fields:m.useMemo(()=>s?s.columns.filter(a=>!a.isPrimaryKey).sort((a,l)=>a.position-l.position).map(a=>({key:a.name,label:a.displayName||a.name,type:Sr(a.type),required:!a.nullable,placeholder:`Enter ${a.displayName||a.name.toLowerCase()}`,gridSize:{xs:12,sm:6,md:4},position:a.position})):[],[s]),isLoading:o,error:n,schema:s}}function br(r,e){const{schema:s,isLoading:o,error:n}=de(r,e);return{filters:m.useMemo(()=>s?s.columns.filter(a=>!a.isPrimaryKey&&(a.type==="text"||a.type==="date"||a.type==="number")).sort((a,l)=>a.position-l.position).map(a=>({key:a.name,label:a.displayName||a.name,type:wr(a.type),position:a.position})):[],[s]),isLoading:o,error:n,schema:s}}function jr(r,e){if(r==null)return"N/A";switch(e.type){case"date":return new Date(r).toLocaleDateString();case"number":return r.toString();case"boolean":return r?"Yes":"No";case"json":return typeof r=="string"?r:JSON.stringify(r);default:return String(r)}}function Sr(r){switch(r){case"date":return"date";case"number":return"number";case"boolean":return"switch";case"json":return"textarea";default:return"text"}}function wr(r){switch(r){case"date":return"date";case"number":return"text";default:return"text"}}const Cr=({churchId:r,tableName:e,onSave:s,onCancel:o})=>t.jsxs("div",{children:[t.jsx("h3",{children:"Dynamic Record Form"}),t.jsxs("p",{children:["Church ID: ",r]}),t.jsxs("p",{children:["Table: ",e]}),t.jsx("button",{onClick:()=>s({}),children:"Save"}),t.jsx("button",{onClick:o,children:"Cancel"})]});function be({records:r,columns:e,loading:s=!1,error:o=null,selectedRecords:n=[],onRecordSelect:i,onSelectAll:a,onRecordAction:l,onSort:d,sortField:p,sortDirection:x="asc",actions:j=[],emptyMessage:T="No records found",className:he="",showCheckboxes:X=!1,showActions:N=!0,dense:_=!1,stickyHeader:L=!0,maxHeight:$=600,primaryKeyField:k="id"}){const[A,B]=m.useState({}),Z=c=>{if(!d)return;d(c,p===c&&x==="asc"?"desc":"asc")},ee=(c,f)=>{B(w=>K(O({},w),{[f]:c.currentTarget}))},pe=c=>{B(f=>K(O({},f),{[c]:null}))},J=(c,f)=>{l==null||l(c,f),B({})},re=(c,f)=>{i==null||i(c,f)},Q=c=>{a==null||a(c)},H=c=>{var f;return c[k]||c.id||c._id||c[`${k}_id`]||String(((f=c._columnPositions)==null?void 0:f[0])||"")},te=r.length>0&&n.length===r.length,se=n.length>0&&n.length<r.length,q=m.useMemo(()=>[...e].sort((c,f)=>c.position-f.position),[e]);return s?t.jsx(kr,{columns:e.length,rows:10}):o?t.jsx(y,{sx:{p:3,textAlign:"center"},children:t.jsx(ie,{severity:"error",children:o})}):r.length===0?t.jsx(y,{sx:{p:3,textAlign:"center"},children:t.jsx(R,{variant:"body1",color:"text.secondary",children:T})}):t.jsx(ke,{component:ce,sx:{maxHeight:L?$:void 0,borderRadius:2,boxShadow:1},className:he,children:t.jsxs(Te,{stickyHeader:L,size:_?"small":"medium",children:[t.jsx(De,{children:t.jsxs(G,{children:[X&&t.jsx(v,{padding:"checkbox",children:t.jsx(me,{indeterminate:se,checked:te,onChange:c=>Q(c.target.checked)})}),q.map(c=>t.jsx(v,{align:c.align||"left",sx:{width:c.width,cursor:c.sortable?"pointer":"default",userSelect:"none",fontWeight:600,backgroundColor:"grey.50"},onClick:()=>c.sortable&&Z(c.key),children:t.jsxs(y,{sx:{display:"flex",alignItems:"center",gap:1},children:[c.label,c.sortable&&p===c.key&&t.jsx(we,{label:x==="asc"?"â†‘":"â†“",size:"small",color:"primary",variant:"outlined"})]})},c.key)),N&&j.length>0&&t.jsx(v,{align:"right",sx:{width:60,backgroundColor:"grey.50"},children:"Actions"})]})}),t.jsx(ve,{children:r.map((c,f)=>{const w=H(c),z=n.includes(w),M=A[w];return t.jsx(or.tr,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:f*.05},asChild:!0,children:t.jsxs(G,{hover:!0,selected:z,sx:{"&:nth-of-type(odd)":{backgroundColor:"grey.50"},"&:hover":{backgroundColor:"action.hover"}},children:[X&&t.jsx(v,{padding:"checkbox",children:t.jsx(me,{checked:z,onChange:u=>re(w,u.target.checked)})}),q.map(u=>{const F=u.render?u.render(null,c):Rr(c,u);return t.jsx(v,{align:u.align||"left",sx:{width:u.width},children:F},u.key)}),N&&j.length>0&&t.jsxs(v,{align:"right",children:[t.jsx(Ce,{size:"small",onClick:u=>ee(u,w),children:t.jsx(ir,{})}),t.jsx(We,{anchorEl:M,open:!!M,onClose:()=>pe(w),anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},children:j.map(u=>{var W;const F=((W=u.disabled)==null?void 0:W.call(u,c))||!1;return t.jsxs(Re,{onClick:()=>J(u.key,c),disabled:F,sx:{color:F?"text.disabled":`${u.color}.main`},children:[t.jsx(cr,{children:u.icon}),t.jsx(lr,{children:u.label})]},u.key)})})]})]})},w)})})]})})}function Rr(r,e){if(r._displayData&&r._displayData[e.position]!==void 0)return r._displayData[e.position];if(r._columnPositions&&r._columnPositions[e.position]!==void 0)return je(r._columnPositions[e.position],e.type);const s=e.key.replace("col_",""),o=r[s];return je(o,e.type)}function je(r,e){if(r==null)return"N/A";switch(e){case"date":return new Date(r).toLocaleDateString();case"number":return r.toString();case"boolean":return r?"Yes":"No";case"json":return typeof r=="string"?r:JSON.stringify(r);default:return String(r)}}function kr({columns:r=5,rows:e=10}){return t.jsx(ke,{component:ce,sx:{borderRadius:2,boxShadow:1},children:t.jsxs(Te,{children:[t.jsx(De,{children:t.jsx(G,{children:Array.from({length:r}).map((s,o)=>t.jsx(v,{children:t.jsx(xe,{animation:"wave",width:"100%",height:24})},o))})}),t.jsx(ve,{children:Array.from({length:e}).map((s,o)=>t.jsx(G,{children:Array.from({length:r}).map((n,i)=>t.jsx(v,{children:t.jsx(xe,{animation:"wave",width:i===0?60:i===1?120:100,height:20})},i))},o))})]})})}const Tr={BAPTISM:"baptism"},Dr={[Tr.BAPTISM]:{gradient:"linear-gradient(135deg, #1e3a8a 0%, #2563eb 100%)",header:"linear-gradient(135deg, #1e3a8a 0%, #2563eb 100%)",addButton:"linear-gradient(135deg, #b45309 0%, #c8a951 100%)"}};function pt({churchId:r,PDFDocument:e,ReadOnlyView:s}){const[o,n]=m.useState(""),[i,a]=m.useState(!1),[l,d]=m.useState(null),[p,x]=m.useState(!1),[j,T]=m.useState(!1),[he,X]=m.useState(!1),[N,_]=m.useState(""),[L,$]=m.useState({}),[k,A]=m.useState({field:"",direction:"asc"}),[B,Z]=m.useState(1),[ee,pe]=m.useState(10),{tables:J,isLoading:re,error:Q,refetch:H}=ur(r),{columns:te,isLoading:se,error:q,schema:c}=gr(r,o);fr(r,o);const{filters:f}=br(r,o),{records:w,total:z,page:M,totalPages:u,isLoading:F,error:W,refetch:P}=mr(r,o,{filters:L,sort:k,pagination:{page:B,limit:ee},enabled:!!o}),{delete:Ee}=xr(r,o),{import:Fe,export:Ie}=yr(r,o),Y=Dr.baptism,Le=m.useMemo(()=>[{key:"view",label:"View",icon:t.jsx("span",{children:"ðŸ‘ï¸"}),color:"primary"},{key:"edit",label:"Edit",icon:t.jsx("span",{children:"âœï¸"}),color:"primary"},{key:"delete",label:"Delete",icon:t.jsx("span",{children:"ðŸ—‘ï¸"}),color:"error"}],[]),$e=h=>{n(h),_(""),$({}),A({field:"",direction:"asc"}),Z(1)},Me=()=>{P()},Pe=()=>{_(""),$({}),A({field:"",direction:"asc"}),P()},Oe=(h,g)=>{A({field:h,direction:g})},_e=(h,g)=>{switch(h){case"view":d(g),x(!0);break;case"edit":d(g),x(!0);break;case"delete":Ae(g);break}},Ae=h=>b(this,null,function*(){const g=h.id||h._id||h[Object.keys(h)[0]];if(window.confirm("Are you sure you want to delete this record?"))try{yield Ee.mutateAsync(g),P()}catch(I){console.error("Delete error:",I)}}),Be=h=>{x(!1),d(null),P()},qe=h=>{console.error("Form error:",h)},ze=h=>b(this,null,function*(){try{yield Fe.mutateAsync({file:h}),T(!1),P()}catch(g){console.error("Import error:",g)}}),Ke=h=>b(this,null,function*(){try{const g=yield Ie.mutateAsync({format:h,filters:L});if(g.success&&g.data){const I=window.URL.createObjectURL(g.data),oe=document.createElement("a");oe.href=I,oe.download=`${o}-export.${h}`,oe.click(),window.URL.revokeObjectURL(I)}}catch(g){console.error("Export error:",g)}}),Ve=()=>{a(!i)};return re?t.jsxs(y,{sx:{p:3,textAlign:"center"},children:[t.jsx(Ye,{}),t.jsx(R,{sx:{mt:2},children:"Discovering record tables..."})]}):Q?t.jsxs(ie,{severity:"error",sx:{m:2},children:["Error discovering tables: ",Q,t.jsx(D,{onClick:()=>H(),sx:{ml:2},children:"Retry"})]}):J.length===0?t.jsxs(y,{sx:{p:3,textAlign:"center"},children:[t.jsx(R,{variant:"h6",color:"text.secondary",children:"No record tables found"}),t.jsx(R,{variant:"body2",color:"text.secondary",sx:{mt:1},children:"Tables should be named with pattern: om_church_##_*_records"}),t.jsx(D,{onClick:()=>H(),sx:{mt:2},children:"Refresh"})]}):t.jsxs(y,{sx:{width:"100%",height:"100%",background:Y.gradient,minHeight:"100vh",p:2},children:[t.jsxs(ce,{elevation:3,sx:{borderRadius:3,overflow:"hidden",background:"rgba(255, 255, 255, 0.95)",backdropFilter:"blur(10px)"},children:[t.jsxs(y,{sx:{p:3,background:Y.header,borderBottom:"1px solid rgba(0,0,0,0.1)"},children:[t.jsxs(y,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[t.jsxs(y,{sx:{display:"flex",alignItems:"center",gap:1},children:[t.jsx(ye,{sx:{color:"white",fontSize:32}}),t.jsx(R,{variant:"h4",component:"h1",sx:{fontWeight:600,color:"white"},children:"Dynamic Records Manager"})]}),t.jsxs(y,{sx:{display:"flex",gap:1,alignItems:"center"},children:[t.jsx(we,{label:i?"Locked":"Unlocked",color:i?"error":"success",icon:i?t.jsx(ge,{}):t.jsx(fe,{}),sx:{color:"white"}}),t.jsx(Ge,{title:"Toggle Lock",children:t.jsx(Ce,{onClick:Ve,sx:{color:"white"},children:i?t.jsx(ge,{}):t.jsx(fe,{})})})]})]}),t.jsx(y,{sx:{mb:2},children:t.jsxs(Xe,{fullWidth:!0,sx:{maxWidth:400},children:[t.jsx(Ze,{sx:{color:"white"},children:"Select Record Table"}),t.jsx(er,{value:o,onChange:h=>$e(h.target.value),label:"Select Record Table",sx:{color:"white","& .MuiOutlinedInput-notchedOutline":{borderColor:"white"},"& .MuiSvgIcon-root":{color:"white"}},children:J.map(h=>t.jsx(Re,{value:h.tableName,children:t.jsxs(y,{sx:{display:"flex",alignItems:"center",gap:1},children:[t.jsx(ye,{fontSize:"small"}),t.jsxs(y,{children:[t.jsx(R,{variant:"body1",children:h.displayName}),t.jsx(R,{variant:"caption",color:"text.secondary",children:h.tableName})]})]})},h.tableName))})]})}),o&&t.jsxs(y,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:[t.jsx(D,{variant:"contained",startIcon:t.jsx(rr,{}),onClick:()=>x(!0),disabled:i,sx:{background:Y.addButton,"&:hover":{background:Y.addButton,opacity:.9}},children:"Add Record"}),t.jsx(D,{variant:"outlined",startIcon:t.jsx(dr,{}),onClick:()=>T(!0),disabled:i,sx:{color:"white",borderColor:"white"},children:"Import"}),t.jsx(D,{variant:"outlined",startIcon:t.jsx(hr,{}),onClick:()=>Ke("csv"),sx:{color:"white",borderColor:"white"},children:"Export CSV"}),t.jsx(D,{variant:"outlined",startIcon:t.jsx(tr,{}),onClick:()=>P(),sx:{color:"white",borderColor:"white"},children:"Refresh"})]})]}),o?t.jsxs(t.Fragment,{children:[t.jsx(y,{sx:{p:3,pb:0},children:t.jsx(ar,{searchTerm:N,onSearchChange:_,onSearch:Me,onClear:Pe,filters:f,activeFilters:L,onFilterChange:$,onClearFilters:$({}),loading:F,resultsCount:z,showFilters:!0,showResultsCount:!0,searchPlaceholder:`Search ${(c==null?void 0:c.displayName)||o} records...`})}),t.jsx(y,{sx:{p:3,pt:0},children:se?t.jsx(be,{columns:[],records:[],loading:!0}):q?t.jsxs(ie,{severity:"error",children:["Error loading table schema: ",q]}):t.jsx(be,{records:w,columns:te,loading:F,error:W,onRecordAction:_e,onSort:Oe,sortField:k==null?void 0:k.field,sortDirection:k==null?void 0:k.direction,actions:Le,showCheckboxes:!i,showActions:!i,emptyMessage:`No ${(c==null?void 0:c.displayName)||o} records found`,primaryKeyField:c==null?void 0:c.primaryKey})}),t.jsxs(y,{sx:{p:3,pt:0,display:"flex",justifyContent:"center",alignItems:"center",gap:2},children:[t.jsxs(R,{variant:"body2",color:"text.secondary",children:["Showing ",w.length," of ",z," records (Page ",M," of ",u,")"]}),t.jsxs(y,{sx:{display:"flex",gap:1},children:[t.jsx(D,{variant:"outlined",size:"small",onClick:pagination.prevPage,disabled:M<=1,children:"Previous"}),t.jsx(D,{variant:"outlined",size:"small",onClick:pagination.nextPage,disabled:M>=u,children:"Next"})]})]})]}):t.jsxs(y,{sx:{p:3,textAlign:"center"},children:[t.jsx(R,{variant:"h6",color:"text.secondary",children:"Select a table to view records"}),t.jsx(R,{variant:"body2",color:"text.secondary",sx:{mt:1},children:"Choose from the dropdown above to start managing records"})]})]}),o&&t.jsx(Cr,{churchId:r,tableName:o,open:p,onClose:()=>{x(!1),d(null)},currentRecord:l,onSuccess:Be,onError:qe}),t.jsx(nr,{open:j,onClose:()=>T(!1),title:`Import ${o} Records`,maxWidth:"sm",children:t.jsxs(y,{sx:{p:2},children:[t.jsxs(R,{variant:"body1",sx:{mb:2},children:["Select a file to import records into ",o,". Supported formats: CSV, Excel."]}),t.jsx("input",{type:"file",accept:".csv,.xlsx,.xls",onChange:h=>{var I;const g=(I=h.target.files)==null?void 0:I[0];g&&ze(g)}})]})})]})}export{pt as DynamicRecordsManager,pt as default};
//# sourceMappingURL=DynamicRecordsManager-DU-mFq_X.js.map
