var ze=Object.defineProperty,Te=Object.defineProperties;var Ae=Object.getOwnPropertyDescriptors;var A=Object.getOwnPropertySymbols;var V=Object.prototype.hasOwnProperty,W=Object.prototype.propertyIsEnumerable;var X=Math.pow,G=(l,a,r)=>a in l?ze(l,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):l[a]=r,J=(l,a)=>{for(var r in a||(a={}))V.call(a,r)&&G(l,r,a[r]);if(A)for(var r of A(a))W.call(a,r)&&G(l,r,a[r]);return l},Y=(l,a)=>Te(l,Ae(a));var Z=(l,a)=>{var r={};for(var j in l)V.call(l,j)&&a.indexOf(j)<0&&(r[j]=l[j]);if(l!=null&&A)for(var j of A(l))a.indexOf(j)<0&&W.call(l,j)&&(r[j]=l[j]);return r};var ee=(l,a,r)=>new Promise((j,D)=>{var I=u=>{try{k(r.next(u))}catch(b){D(b)}},O=u=>{try{k(r.throw(u))}catch(b){D(b)}},k=u=>u.done?j(u.value):Promise.resolve(u.value).then(I,O);k((r=r.apply(l,a)).next())});import{c as de,l as Ue,c8 as Re,j as e,B as d,d as t,y as se,G as i,U as h,Q as x,x as Le,e as B,aI as qe,R as Pe,C as f,h as C,T as M,I as U,$ as te,M as He,f as F,A as Ne,X as Fe,J as Ke,Y as _e,K as $e,a3 as Ee}from"./index-CNFXvQ6i.js";import{u as S}from"./useQuery-BNSEWXyB.js";import{u as K}from"./useMutation-B2ZoL80x.js";import{r as y}from"./vendor-DgfDxsY7.js";import{a as g}from"./admin.api-Dmxxg8TD.js";import{T as Oe,a as p}from"./Tabs-Cer_vT2F.js";import{I as R}from"./IconChartBar-D9Vp24SD.js";import{I as Qe}from"./IconActivity-CSO9QyAx.js";import{I as _}from"./IconDatabase-CH6cZQUk.js";import{I as Ge}from"./IconServer-B8oNP648.js";import{I as ae}from"./IconDownload-dS1bPbvH.js";import{I as Ve}from"./IconUsers-DP7VmWEP.js";import{I as We}from"./IconPlus-MD6k0QmK.js";import{T as ne,a as re,b as ie,c as w,d as le}from"./TableRow-AyUKSpjR.js";import{T as n}from"./TableCell-DwyxNY3j.js";import{I as Xe}from"./IconHeart-ByAMdG9a.js";import{I as Je}from"./IconCalendar-CFhjd6Wg.js";import{f as ce}from"./index-B8Cm0CAq.js";import{f as Ye}from"./index-C1cWfy0P.js";import{I as Ze}from"./IconEye-D23pS7kv.js";import{I as es}from"./IconInfoCircle-BFNEY-4M.js";import{L as $}from"./LinearProgress-CsT3gD9e.js";import{I as oe}from"./IconCheck-DIkpgZMD.js";import"./api.config-C9UNSeTF.js";import"./KeyboardArrowRight-CK1FNa4g.js";import"./typeof-QjJsDpFa.js";import"./index-B9SIr0Qh.js";import"./index-DmKFFksY.js";import"./index-B8a_guEX.js";import"./index-CZC6yX5H.js";/**
 * @license @tabler/icons-react v3.34.1 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const ss=[["path",{d:"M3 21l18 0",key:"svg-0"}],["path",{d:"M10 21v-4a2 2 0 0 1 4 0v4",key:"svg-1"}],["path",{d:"M10 5l4 0",key:"svg-2"}],["path",{d:"M12 3l0 5",key:"svg-3"}],["path",{d:"M6 21v-7m-2 2l8 -8l8 8m-2 -2v7",key:"svg-4"}]],E=de("outline","building-church","BuildingChurch",ss);/**
 * @license @tabler/icons-react v3.34.1 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const ts=[["path",{d:"M10 21h4v-9h5v-4h-5v-5h-4v5h-5v4h5z",key:"svg-0"}]],as=de("outline","cross","Cross",ts);function v(D){var I=D,{children:l,value:a,index:r}=I,j=Z(I,["children","value","index"]);return e.jsx("div",Y(J({role:"tabpanel",hidden:a!==r,id:`admin-tabpanel-${r}`,"aria-labelledby":`admin-tab-${r}`},j),{children:a===r&&e.jsx(d,{sx:{p:3},children:l})}))}const Hs=()=>{const l=Ue(),[a,r]=y.useState(0),[j,D]=y.useState(null),[I,O]=y.useState(!1),[k,u]=y.useState(!1),[b,L]=y.useState(null),[he,xe]=y.useState(""),Q=Re(),{data:z=[],isLoading:je,refetch:ue}=S({queryKey:["admin-clients"],queryFn:g.clients.getAll,refetchInterval:3e4}),{data:q,isLoading:me}=S({queryKey:["admin-system-stats"],queryFn:g.system.getSystemStats,refetchInterval:15e3}),{data:ns,isLoading:ge}=S({queryKey:["admin-database-health"],queryFn:g.system.getDatabaseHealth,refetchInterval:2e4}),{data:o,isLoading:ye}=S({queryKey:["admin-server-metrics"],queryFn:g.system.getServerMetrics,refetchInterval:1e4}),{data:rs=[],isLoading:is}=S({queryKey:["admin-backups"],queryFn:g.system.getBackups,refetchInterval:6e4}),{data:m=[],isLoading:P,error:T}=S({queryKey:["admin-saas-metrics"],queryFn:g.metrics.getOrthodoxMetrics,refetchInterval:3e4,retry:3,retryDelay:s=>Math.min(1e3*X(2,s),3e4)});y.useEffect(()=>{},[m]);const pe=K({mutationFn:({clientId:s,status:c})=>g.clients.update(Number(s),{status:c}),onSuccess:()=>{Q.invalidateQueries({queryKey:["admin-clients"]}),L(null)}}),ve=K({mutationFn:s=>g.clients.testConnection(Number(s))}),H=K({mutationFn:g.backup.run,onSuccess:()=>{Q.invalidateQueries({queryKey:["admin-backups"]}),u(!1)}}),be=(s,c)=>{r(c)},fe=(s,c)=>{L(s.currentTarget),xe(c)},N=s=>{pe.mutate({clientId:he,status:s})},Ce=s=>ee(void 0,null,function*(){try{const c=yield ve.mutateAsync(s);console.log("Connection test result:",c)}catch(c){console.error("Connection test failed:",c)}}),Se=s=>{switch(s){case"active":return"success";case"inactive":return"error";case"maintenance":return"warning";default:return"default"}},Ie=s=>s?[s.cpuUsage<80?25:0,s.memoryUsage<85?25:0,s.diskUsage<90?25:0,s.uptime>24?25:15].reduce((we,De)=>we+De,0):0,ke=z.length,Be=z.filter(s=>s.status==="active").length,Me=z.reduce((s,c)=>s+(c.totalRecords||0),0);return e.jsxs(d,{sx:{width:"100%"},children:[e.jsxs(d,{sx:{mb:3},children:[e.jsx(t,{variant:"h4",component:"h1",gutterBottom:!0,children:"ðŸ›ï¸ Orthodox Metrics Admin Dashboard"}),e.jsx(t,{variant:"subtitle1",color:"textSecondary",children:"Multi-Tenant Church Management System Administration"})]}),e.jsx(d,{sx:{borderBottom:1,borderColor:"divider",mb:3},children:e.jsxs(Oe,{value:a,onChange:be,"aria-label":"admin dashboard tabs",children:[e.jsx(p,{icon:e.jsx(E,{}),label:"Client Sites"}),e.jsx(p,{icon:e.jsx(R,{}),label:"SaaS Metrics"}),e.jsx(p,{icon:e.jsx(Qe,{}),label:"System Health"}),e.jsx(p,{icon:e.jsx(_,{}),label:"Database Monitor"}),e.jsx(p,{icon:e.jsx(Ge,{}),label:"Server Metrics"}),e.jsx(p,{icon:e.jsx(ae,{}),label:"Backup Manager"}),e.jsx(p,{icon:e.jsx(se,{}),label:"System Settings"})]})}),e.jsx(v,{value:a,index:0,children:e.jsxs(i,{container:!0,spacing:3,children:[e.jsx(i,{item:!0,xs:12,md:3,children:e.jsx(h,{children:e.jsxs(x,{children:[e.jsxs(d,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(E,{size:24}),e.jsx(t,{variant:"h6",sx:{ml:1},children:"Total Clients"})]}),e.jsx(t,{variant:"h3",color:"primary",children:ke}),e.jsxs(t,{variant:"body2",color:"textSecondary",children:[Be," active sites"]})]})})}),e.jsx(i,{item:!0,xs:12,md:3,children:e.jsx(h,{children:e.jsxs(x,{children:[e.jsxs(d,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(Ve,{size:24}),e.jsx(t,{variant:"h6",sx:{ml:1},children:"Active Users"})]}),e.jsx(t,{variant:"h3",color:"success.main",children:(q==null?void 0:q.activeUsers)||0}),e.jsx(t,{variant:"body2",color:"textSecondary",children:"across all sites"})]})})}),e.jsx(i,{item:!0,xs:12,md:3,children:e.jsx(h,{children:e.jsxs(x,{children:[e.jsxs(d,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(R,{size:24}),e.jsx(t,{variant:"h6",sx:{ml:1},children:"Total Records"})]}),e.jsx(t,{variant:"h3",color:"info.main",children:Me}),e.jsx(t,{variant:"body2",color:"textSecondary",children:"church records managed"})]})})}),e.jsx(i,{item:!0,xs:12,md:3,children:e.jsx(h,{children:e.jsxs(x,{children:[e.jsxs(d,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(Le,{size:24}),e.jsx(t,{variant:"h6",sx:{ml:1},children:"System Health"})]}),e.jsxs(t,{variant:"h3",color:"warning.main",children:[Ie(o),"%"]}),e.jsx(t,{variant:"body2",color:"textSecondary",children:"overall health score"})]})})}),e.jsx(i,{item:!0,xs:12,children:e.jsx(h,{children:e.jsxs(x,{children:[e.jsxs(d,{sx:{display:"flex",justifyContent:"between",alignItems:"center",mb:2},children:[e.jsx(t,{variant:"h6",children:"Client Sites"}),e.jsxs(d,{children:[e.jsx(B,{variant:"outlined",startIcon:e.jsx(qe,{}),onClick:()=>ue(),sx:{mr:2},children:"Refresh"}),e.jsx(B,{variant:"contained",startIcon:e.jsx(We,{}),href:"/apps/church-management/wizard",children:"Add New Client"})]})]}),e.jsx(ne,{component:Pe,variant:"outlined",children:e.jsxs(re,{children:[e.jsx(ie,{children:e.jsxs(w,{children:[e.jsx(n,{children:"Church Name"}),e.jsx(n,{children:"Slug"}),e.jsx(n,{children:"Contact"}),e.jsx(n,{children:"Status"}),e.jsx(n,{children:"Records"}),e.jsx(n,{children:"Database"}),e.jsx(n,{children:"Created"}),e.jsx(n,{children:"Actions"})]})}),e.jsx(le,{children:je?e.jsx(w,{children:e.jsx(n,{colSpan:8,align:"center",children:e.jsx(f,{})})}):z.map(s=>e.jsxs(w,{children:[e.jsx(n,{children:e.jsx(t,{variant:"subtitle2",children:s.name})}),e.jsx(n,{children:e.jsx(C,{label:s.slug,size:"small",variant:"outlined"})}),e.jsx(n,{children:s.contact_email}),e.jsx(n,{children:e.jsx(C,{label:s.status,size:"small",color:Se(s.status)})}),e.jsx(n,{children:e.jsxs(d,{children:[e.jsxs(t,{variant:"body2",children:[e.jsx(Xe,{size:16,style:{marginRight:4}}),s.baptisms||0]}),e.jsxs(t,{variant:"body2",children:[e.jsx(Je,{size:16,style:{marginRight:4}}),s.marriages||0]}),e.jsxs(t,{variant:"body2",children:[e.jsx(as,{size:16,style:{marginRight:4}}),s.funerals||0]})]})}),e.jsx(n,{children:e.jsx(M,{title:s.database_name,children:e.jsx(C,{icon:e.jsx(_,{size:16}),label:"Connected",size:"small",color:"success",variant:"outlined"})})}),e.jsxs(n,{children:[e.jsx(t,{variant:"body2",children:ce(new Date(s.created_at),"MMM dd, yyyy")}),e.jsx(t,{variant:"caption",color:"textSecondary",children:Ye(new Date(s.created_at),{addSuffix:!0})})]}),"                                        ",e.jsxs(n,{children:[e.jsx(M,{title:"Church Admin Panel",children:e.jsx(U,{size:"small",onClick:()=>l(`/admin/church/${s.id}`),color:"primary",children:e.jsx(E,{})})}),e.jsx(M,{title:"Settings",children:e.jsx(U,{size:"small",onClick:c=>fe(c,s.id),children:e.jsx(se,{})})}),e.jsx(M,{title:"Test Connection",children:e.jsx(U,{size:"small",onClick:()=>Ce(s.id),children:e.jsx(_,{})})}),e.jsx(M,{title:"View Site",children:e.jsx(U,{size:"small",href:`/client/${s.slug}`,target:"_blank",children:e.jsx(Ze,{})})})]})]},s.id))})]})})]})})})]})}),e.jsxs(v,{value:a,index:1,children:[e.jsxs(d,{sx:{mb:3},children:[e.jsx(t,{variant:"h5",gutterBottom:!0,children:"ðŸ“Š SaaS Platform Metrics"}),e.jsx(t,{variant:"body2",color:"textSecondary",children:"Real-time metrics and analytics for the Orthodox Metrics SaaS platform"})]}),P&&e.jsxs(d,{sx:{display:"flex",justifyContent:"center",py:4},children:[e.jsx(f,{}),e.jsx(t,{variant:"body2",sx:{ml:2},children:"Loading SaaS metrics..."})]}),T&&e.jsxs(te,{severity:"error",sx:{mb:3},children:[e.jsx(t,{variant:"h6",children:"Failed to load SaaS metrics"}),e.jsx(t,{variant:"body2",children:T.message||"An unexpected error occurred while fetching metrics data."})]}),!P&&!T&&(!m||m.length===0)&&e.jsx(h,{children:e.jsxs(x,{sx:{textAlign:"center",py:6},children:[e.jsx(es,{size:48,color:"#757575",style:{marginBottom:16}}),e.jsx(t,{variant:"h6",gutterBottom:!0,children:"No metrics data available"}),e.jsx(t,{variant:"body2",color:"textSecondary",children:"SaaS metrics data is not available at this time. Please try again later."})]})}),!P&&!T&&m&&m.length>0&&e.jsxs(i,{container:!0,spacing:3,children:[e.jsx(i,{container:!0,item:!0,xs:12,spacing:3,children:m.slice(0,4).map((s,c)=>e.jsx(i,{container:!0,item:!0,xs:12,md:3,children:e.jsx(h,{sx:{width:"100%"},children:e.jsxs(x,{children:[e.jsxs(d,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(R,{size:24,color:"#2196f3"}),e.jsx(t,{variant:"h6",sx:{ml:1},children:s.name})]}),e.jsx(t,{variant:"h4",color:"primary",gutterBottom:!0,children:s.value}),s.description&&e.jsx(t,{variant:"body2",color:"textSecondary",children:s.description}),s.trend&&e.jsx(d,{sx:{mt:1},children:e.jsx(C,{label:`${s.trend>0?"+":""}${s.trend}%`,color:s.trend>0?"success":"error",size:"small"})})]})})},s.id||c))}),e.jsx(i,{container:!0,item:!0,xs:12,children:e.jsx(h,{sx:{width:"100%"},children:e.jsxs(x,{children:[e.jsx(t,{variant:"h6",gutterBottom:!0,children:"ðŸ“ˆ Detailed Metrics"}),e.jsx(ne,{children:e.jsxs(re,{children:[e.jsx(ie,{children:e.jsxs(w,{children:[e.jsx(n,{children:"Metric Name"}),e.jsx(n,{align:"right",children:"Value"}),e.jsx(n,{children:"Category"}),e.jsx(n,{children:"Last Updated"}),e.jsx(n,{children:"Status"})]})}),e.jsx(le,{children:m.map((s,c)=>e.jsxs(w,{children:[e.jsx(n,{children:e.jsxs(d,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(R,{size:16,style:{marginRight:8}}),e.jsxs(d,{children:[e.jsx(t,{variant:"body2",fontWeight:"medium",children:s.name}),s.description&&e.jsx(t,{variant:"caption",color:"textSecondary",children:s.description})]})]})}),e.jsx(n,{align:"right",children:e.jsx(t,{variant:"body2",fontWeight:"bold",children:s.value})}),e.jsx(n,{children:e.jsx(C,{label:s.category||"General",size:"small",variant:"outlined"})}),e.jsx(n,{children:e.jsx(t,{variant:"body2",color:"textSecondary",children:s.lastUpdated?ce(new Date(s.lastUpdated),"MMM dd, HH:mm"):"N/A"})}),e.jsx(n,{children:e.jsx(C,{label:s.status||"Active",color:s.status==="Active"?"success":"warning",size:"small"})})]},s.id||c))})]})})]})})}),m.some(s=>s.churchData)&&e.jsx(i,{container:!0,item:!0,xs:12,children:e.jsx(h,{sx:{width:"100%"},children:e.jsxs(x,{children:[e.jsx(t,{variant:"h6",gutterBottom:!0,children:"ðŸ›ï¸ Per-Church Usage Metrics"}),e.jsx(i,{container:!0,spacing:2,children:m.filter(s=>s.churchData).map((s,c)=>e.jsx(i,{container:!0,item:!0,xs:12,md:6,lg:4,children:e.jsx(h,{variant:"outlined",sx:{width:"100%"},children:e.jsxs(x,{children:[e.jsx(t,{variant:"subtitle2",gutterBottom:!0,children:s.churchData.name}),e.jsx(t,{variant:"h6",color:"primary",children:s.churchData.usage}),e.jsx($,{variant:"determinate",value:s.churchData.usage,sx:{mt:1}})]})})},c))})]})})})]})]}),e.jsx(v,{value:a,index:2,children:e.jsx(i,{container:!0,spacing:3,children:e.jsx(i,{item:!0,xs:12,children:e.jsx(h,{children:e.jsxs(x,{children:[e.jsx(t,{variant:"h6",gutterBottom:!0,children:"System Health Overview"}),me?e.jsx(f,{}):e.jsxs(i,{container:!0,spacing:2,children:[e.jsxs(i,{item:!0,xs:12,md:6,children:[e.jsx(t,{variant:"subtitle2",gutterBottom:!0,children:"CPU Usage"}),e.jsx($,{variant:"determinate",value:(o==null?void 0:o.cpuUsage)||0,color:(o==null?void 0:o.cpuUsage)>80?"error":"primary"}),e.jsxs(t,{variant:"body2",color:"textSecondary",children:[(o==null?void 0:o.cpuUsage)||0,"%"]})]}),e.jsxs(i,{item:!0,xs:12,md:6,children:[e.jsx(t,{variant:"subtitle2",gutterBottom:!0,children:"Memory Usage"}),e.jsx($,{variant:"determinate",value:(o==null?void 0:o.memoryUsage)||0,color:(o==null?void 0:o.memoryUsage)>85?"error":"primary"}),e.jsxs(t,{variant:"body2",color:"textSecondary",children:[(o==null?void 0:o.memoryUsage)||0,"%"]})]})]})]})})})})}),e.jsx(v,{value:a,index:3,children:e.jsx(i,{container:!0,spacing:3,children:e.jsx(i,{item:!0,xs:12,children:e.jsx(h,{children:e.jsxs(x,{children:[e.jsx(t,{variant:"h6",gutterBottom:!0,children:"Database Health Monitor"}),ge?e.jsx(f,{}):e.jsx(te,{severity:"success",icon:e.jsx(oe,{}),children:"All client databases are healthy and responding normally."})]})})})})}),e.jsx(v,{value:a,index:4,children:e.jsx(i,{container:!0,spacing:3,children:e.jsx(i,{item:!0,xs:12,children:e.jsx(h,{children:e.jsxs(x,{children:[e.jsx(t,{variant:"h6",gutterBottom:!0,children:"Server Performance Metrics"}),ye?e.jsx(f,{}):e.jsx(t,{children:"Server metrics will be displayed here..."})]})})})})}),e.jsx(v,{value:a,index:5,children:e.jsx(i,{container:!0,spacing:3,children:e.jsx(i,{item:!0,xs:12,children:e.jsx(h,{children:e.jsxs(x,{children:[e.jsxs(d,{sx:{display:"flex",justifyContent:"between",alignItems:"center",mb:2},children:[e.jsx(t,{variant:"h6",children:"Backup Management"}),e.jsx(B,{variant:"contained",startIcon:e.jsx(ae,{}),onClick:()=>u(!0),children:"Create Backup"})]}),e.jsx(t,{children:"Backup management interface will be displayed here..."})]})})})})}),e.jsx(v,{value:a,index:6,children:e.jsx(i,{container:!0,spacing:3,children:e.jsx(i,{item:!0,xs:12,children:e.jsx(h,{children:e.jsxs(x,{children:[e.jsx(t,{variant:"h6",gutterBottom:!0,children:"System Settings"}),e.jsx(t,{children:"System configuration settings will be displayed here..."})]})})})})}),e.jsxs(He,{anchorEl:b,open:!!b,onClose:()=>L(null),children:[e.jsxs(F,{onClick:()=>N("active"),children:[e.jsx(oe,{size:16,style:{marginRight:8}}),"Activate"]}),e.jsxs(F,{onClick:()=>N("inactive"),children:[e.jsx(Ne,{size:16,style:{marginRight:8}}),"Deactivate"]}),e.jsxs(F,{onClick:()=>N("maintenance"),children:[e.jsx(Fe,{size:16,style:{marginRight:8}}),"Maintenance Mode"]})]}),e.jsxs(Ke,{open:k,onClose:()=>u(!1),children:[e.jsx(_e,{children:"Create System Backup"}),e.jsx($e,{children:e.jsx(t,{children:"Create a backup of all client databases and system configuration?"})}),e.jsxs(Ee,{children:[e.jsx(B,{onClick:()=>u(!1),children:"Cancel"}),e.jsx(B,{onClick:()=>H.mutate(),variant:"contained",disabled:H.isPending,children:H.isPending?e.jsx(f,{size:20}):"Create Backup"})]})]})]})};export{Hs as default};
//# sourceMappingURL=OrthodoxMetricsAdmin-DJzhqt8r.js.map
