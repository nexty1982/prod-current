{"version":3,"file":"GitOperations-D3_h49mq.js","sources":["../../src/features/devel-tools/git-operations/GitOperations.tsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport {\n  Box,\n  Container,\n  Typography,\n  Paper,\n  Button,\n  Alert,\n  CircularProgress,\n  Stack,\n  Chip,\n  Divider,\n  Card,\n  CardContent,\n} from '@mui/material';\nimport { IconGitBranch, IconRefresh, IconCheck, IconX, IconAlertCircle } from '@tabler/icons-react';\nimport { useAuth } from '@/context/AuthContext';\n\ninterface GitStatusResponse {\n  success: boolean;\n  output?: string;\n  stderr?: string | null;\n  error?: string;\n  message?: string;\n}\n\ninterface BranchResult {\n  name: string;\n  status: 'created' | 'exists' | 'error';\n  message?: string;\n}\n\ninterface CreateBranchesResponse {\n  ok: boolean;\n  baseBranch: string;\n  baseSha: string;\n  results: BranchResult[];\n  error?: string;\n  message?: string;\n}\n\nconst GitOperations: React.FC = () => {\n  const { user } = useAuth();\n  const [loading, setLoading] = useState(false);\n  const [creatingBranches, setCreatingBranches] = useState(false);\n  const [gitStatus, setGitStatus] = useState<string | null>(null);\n  const [currentBranch, setCurrentBranch] = useState<string | null>(null);\n  const [isClean, setIsClean] = useState<boolean | null>(null);\n  const [error, setError] = useState<string | null>(null);\n  const [unauthorized, setUnauthorized] = useState(false);\n  const [branchResults, setBranchResults] = useState<CreateBranchesResponse | null>(null);\n\n  // Fetch git status on mount\n  useEffect(() => {\n    fetchGitStatus();\n  }, []);\n\n  const fetchGitStatus = async () => {\n    setLoading(true);\n    setError(null);\n    setUnauthorized(false);\n\n    try {\n      const response = await fetch('/api/ops/git/status', {\n        credentials: 'include',\n      });\n\n      if (response.status === 401 || response.status === 403) {\n        setUnauthorized(true);\n        setLoading(false);\n        return;\n      }\n\n      if (!response.ok) {\n        throw new Error(`HTTP ${response.status}`);\n      }\n\n      const data: GitStatusResponse = await response.json();\n\n      if (data.success && data.output) {\n        setGitStatus(data.output);\n        \n        // Parse branch from output (format: ## branch-name...)\n        const branchMatch = data.output.match(/^##\\s+([^\\s.]+)/m);\n        if (branchMatch) {\n          setCurrentBranch(branchMatch[1]);\n        }\n\n        // Check if clean (no modified/untracked files)\n        // Clean output only has branch info line, no file changes\n        const lines = data.output.split('\\n').filter(line => line.trim());\n        const hasChanges = lines.some(line => line.match(/^[ MADRCU?!]/));\n        setIsClean(!hasChanges);\n      } else {\n        setError(data.error || 'Failed to fetch git status');\n      }\n    } catch (err: any) {\n      setError(err.message || 'Failed to fetch git status');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const createDefaultBranches = async () => {\n    setCreatingBranches(true);\n    setError(null);\n    setBranchResults(null);\n\n    try {\n      const response = await fetch('/api/ops/git/branches/create-default', {\n        method: 'POST',\n        credentials: 'include',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n      });\n\n      if (response.status === 401 || response.status === 403) {\n        setUnauthorized(true);\n        setCreatingBranches(false);\n        return;\n      }\n\n      if (!response.ok) {\n        const errorData = await response.json();\n        throw new Error(errorData.message || `HTTP ${response.status}`);\n      }\n\n      const data: CreateBranchesResponse = await response.json();\n      setBranchResults(data);\n    } catch (err: any) {\n      setError(err.message || 'Failed to create branches');\n    } finally {\n      setCreatingBranches(false);\n    }\n  };\n\n  if (unauthorized) {\n    return (\n      <Container maxWidth=\"lg\" sx={{ py: 4 }}>\n        <Alert severity=\"error\" icon={<IconAlertCircle />}>\n          Not authorized. Admin or super_admin access required.\n        </Alert>\n      </Container>\n    );\n  }\n\n  return (\n    <Container maxWidth=\"lg\" sx={{ py: 4 }}>\n      <Box mb={4}>\n        <Stack direction=\"row\" spacing={2} alignItems=\"center\" mb={2}>\n          <IconGitBranch size={32} />\n          <Typography variant=\"h4\">Git Operations</Typography>\n        </Stack>\n        <Typography variant=\"body2\" color=\"text.secondary\">\n          Safe, allowlisted git operations for repository management\n        </Typography>\n      </Box>\n\n      {/* Git Status Section */}\n      <Card sx={{ mb: 4 }}>\n        <CardContent>\n          <Stack direction=\"row\" spacing={2} alignItems=\"center\" mb={2}>\n            <Typography variant=\"h6\">Git Status</Typography>\n            <Button\n              variant=\"outlined\"\n              size=\"small\"\n              startIcon={<IconRefresh />}\n              onClick={fetchGitStatus}\n              disabled={loading}\n            >\n              Refresh\n            </Button>\n          </Stack>\n\n          {loading && (\n            <Box display=\"flex\" justifyContent=\"center\" py={4}>\n              <CircularProgress />\n            </Box>\n          )}\n\n          {error && (\n            <Alert severity=\"error\" sx={{ mb: 2 }}>\n              {error}\n            </Alert>\n          )}\n\n          {gitStatus && !loading && (\n            <>\n              {currentBranch && (\n                <Box mb={2}>\n                  <Typography variant=\"subtitle2\" color=\"text.secondary\" gutterBottom>\n                    Current Branch\n                  </Typography>\n                  <Chip\n                    label={currentBranch}\n                    icon={<IconGitBranch size={16} />}\n                    color=\"primary\"\n                    variant=\"outlined\"\n                  />\n                </Box>\n              )}\n\n              {isClean !== null && (\n                <Box mb={2}>\n                  <Typography variant=\"subtitle2\" color=\"text.secondary\" gutterBottom>\n                    Repository Status\n                  </Typography>\n                  <Chip\n                    label={isClean ? 'Clean' : 'Dirty'}\n                    icon={isClean ? <IconCheck size={16} /> : <IconX size={16} />}\n                    color={isClean ? 'success' : 'warning'}\n                    variant=\"outlined\"\n                  />\n                </Box>\n              )}\n\n              <Divider sx={{ my: 2 }} />\n\n              <Typography variant=\"subtitle2\" color=\"text.secondary\" gutterBottom>\n                Raw Output\n              </Typography>\n              <Paper\n                variant=\"outlined\"\n                sx={{\n                  p: 2,\n                  bgcolor: 'background.default',\n                  fontFamily: 'monospace',\n                  fontSize: '0.875rem',\n                  whiteSpace: 'pre-wrap',\n                  wordBreak: 'break-word',\n                  maxHeight: '400px',\n                  overflow: 'auto',\n                }}\n              >\n                {gitStatus}\n              </Paper>\n            </>\n          )}\n        </CardContent>\n      </Card>\n\n      {/* Create Default Branches Section */}\n      <Card>\n        <CardContent>\n          <Typography variant=\"h6\" gutterBottom>\n            Create Default Branches\n          </Typography>\n          <Typography variant=\"body2\" color=\"text.secondary\" paragraph>\n            Creates the following branches from the current HEAD:\n            <ul>\n              <li><code>fix/build-events-users-softdelete</code></li>\n              <li><code>chore/gallery-dir-bootstrap</code></li>\n            </ul>\n            This operation is idempotent - existing branches will not be recreated.\n          </Typography>\n\n          <Button\n            variant=\"contained\"\n            startIcon={<IconGitBranch />}\n            onClick={createDefaultBranches}\n            disabled={creatingBranches || unauthorized}\n            sx={{ mb: 2 }}\n          >\n            {creatingBranches ? 'Creating...' : 'Create Default Branches'}\n          </Button>\n\n          {creatingBranches && (\n            <Box display=\"flex\" alignItems=\"center\" gap={2} mb={2}>\n              <CircularProgress size={20} />\n              <Typography variant=\"body2\">Creating branches...</Typography>\n            </Box>\n          )}\n\n          {branchResults && (\n            <Box mt={2}>\n              <Alert severity={branchResults.ok ? 'success' : 'error'} sx={{ mb: 2 }}>\n                {branchResults.ok\n                  ? `Branches processed. Base branch: ${branchResults.baseBranch} (${branchResults.baseSha.substring(0, 7)})`\n                  : branchResults.error || 'Failed to create branches'}\n              </Alert>\n\n              <Typography variant=\"subtitle2\" gutterBottom>\n                Results:\n              </Typography>\n              <Stack spacing={1}>\n                {branchResults.results.map((result, index) => (\n                  <Box key={index}>\n                    <Stack direction=\"row\" spacing={2} alignItems=\"center\">\n                      <Typography variant=\"body2\" sx={{ fontFamily: 'monospace', minWidth: '300px' }}>\n                        {result.name}\n                      </Typography>\n                      <Chip\n                        label={result.status}\n                        color={\n                          result.status === 'created'\n                            ? 'success'\n                            : result.status === 'exists'\n                            ? 'info'\n                            : 'error'\n                        }\n                        size=\"small\"\n                        icon={\n                          result.status === 'created' ? (\n                            <IconCheck size={14} />\n                          ) : result.status === 'exists' ? (\n                            <IconCheck size={14} />\n                          ) : (\n                            <IconX size={14} />\n                          )\n                        }\n                      />\n                      {result.message && (\n                        <Typography variant=\"caption\" color=\"text.secondary\">\n                          {result.message}\n                        </Typography>\n                      )}\n                    </Stack>\n                  </Box>\n                ))}\n              </Stack>\n            </Box>\n          )}\n        </CardContent>\n      </Card>\n    </Container>\n  );\n};\n\nexport default GitOperations;\n"],"names":["GitOperations","user","useAuth","loading","setLoading","useState","creatingBranches","setCreatingBranches","gitStatus","setGitStatus","currentBranch","setCurrentBranch","isClean","setIsClean","error","setError","unauthorized","setUnauthorized","branchResults","setBranchResults","useEffect","fetchGitStatus","__async","response","data","branchMatch","hasChanges","line","err","createDefaultBranches","errorData","Container","jsx","Alert","IconAlertCircle","jsxs","Box","Stack","IconGitBranch","Typography","Card","CardContent","Button","IconRefresh","CircularProgress","Fragment","Chip","IconCheck","IconX","Divider","Paper","result","index"],"mappings":"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"}