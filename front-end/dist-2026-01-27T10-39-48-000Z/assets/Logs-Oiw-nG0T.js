var be=Object.defineProperty,Se=Object.defineProperties;var Ie=Object.getOwnPropertyDescriptors;var V=Object.getOwnPropertySymbols;var we=Object.prototype.hasOwnProperty,Le=Object.prototype.propertyIsEnumerable;var _=(l,c,o)=>c in l?be(l,c,{enumerable:!0,configurable:!0,writable:!0,value:o}):l[c]=o,B=(l,c)=>{for(var o in c||(c={}))we.call(c,o)&&_(l,o,c[o]);if(V)for(var o of V(c))Le.call(c,o)&&_(l,o,c[o]);return l},U=(l,c)=>Se(l,Ie(c));var S=(l,c,o)=>new Promise((w,h)=>{var D=d=>{try{f(o.next(d))}catch(I){h(I)}},E=d=>{try{f(o.throw(d))}catch(I){h(I)}},f=d=>d.done?w(d.value):Promise.resolve(d.value).then(D,E);f((o=o.apply(l,c)).next())});import{j as e,U as G,Q as N,B as t,d as i,F as q,r as J,e as z,a0 as F,a1 as $,a2 as O,f as p,O as Ce,h as g,$ as ze}from"./index-CNFXvQ6i.js";import{r as x}from"./vendor-DgfDxsY7.js";const Q=styled(t)(({theme:l})=>({fontFamily:"monospace",fontSize:"12px",backgroundColor:l.palette.grey[900],color:l.palette.common.white,padding:l.spacing(1),borderRadius:l.shape.borderRadius,maxHeight:"500px",overflowY:"auto",border:`1px solid ${l.palette.grey[700]}`})),Y=styled(t)(({theme:l,level:c})=>{const o={debug:l.palette.grey[400],info:l.palette.info.main,warn:l.palette.warning.main,error:l.palette.error.main,fatal:l.palette.error.dark};return{display:"flex",alignItems:"flex-start",padding:l.spacing(.5,1),borderLeft:`3px solid ${o[c]}`,marginBottom:l.spacing(.5),backgroundColor:`${o[c]}15`,"&:hover":{backgroundColor:`${o[c]}25`}}}),$e=()=>{const[l,c]=x.useState(0),[o,w]=x.useState([]),[h,D]=x.useState([]),[E,f]=x.useState([]),[d,I]=x.useState("all"),[v,K]=x.useState("all"),[T,Z]=x.useState("both"),[L,ee]=x.useState(""),[R,ne]=x.useState(!0),[W,se]=x.useState(!0),[te,le]=x.useState(0),[ae,re]=x.useState(25),[oe,j]=x.useState(!1),[ie,y]=x.useState(""),[Ee,ce]=x.useState([]),A=useRef(null),b=useRef(null),C=[{name:"Authentication",icon:e.jsx(IconShield,{size:20}),description:"User authentication and authorization",logCount:0,lastActivity:new Date().toISOString()},{name:"Database",icon:e.jsx(IconDatabase,{size:20}),description:"Database queries and operations",logCount:0,lastActivity:new Date().toISOString()},{name:"API Server",icon:e.jsx(IconServer,{size:20}),description:"REST API endpoints and middleware",logCount:0,lastActivity:new Date().toISOString()},{name:"Email Service",icon:e.jsx(IconMail,{size:20}),description:"Email sending and notifications",logCount:0,lastActivity:new Date().toISOString()},{name:"File Upload",icon:e.jsx(IconUpload,{size:20}),description:"File uploads and processing",logCount:0,lastActivity:new Date().toISOString()},{name:"OCR Service",icon:e.jsx(IconFileText,{size:20}),description:"OCR processing and document analysis",logCount:0,lastActivity:new Date().toISOString()},{name:"Frontend",icon:e.jsx(IconTerminal,{size:20}),description:"Frontend application logs",logCount:0,lastActivity:new Date().toISOString()},{name:"Backend",icon:e.jsx(IconServer,{size:20}),description:"Backend application server logs",logCount:0,lastActivity:new Date().toISOString()},{name:"Error Logs",icon:e.jsx(IconBug,{size:20}),description:"System error logs",logCount:0,lastActivity:new Date().toISOString()},{name:"Combined",icon:e.jsx(IconAdjustments,{size:20}),description:"All logs combined",logCount:0,lastActivity:new Date().toISOString()}];x.useEffect(()=>(de(),k(),R?ge():M(),()=>M()),[R]),x.useEffect(()=>{xe()},[o,d,v,L]),x.useEffect(()=>{k()},[T,d,v]),x.useEffect(()=>{W&&A.current&&(A.current.scrollTop=A.current.scrollHeight)},[h,W]);const de=()=>S(void 0,null,function*(){try{const n=yield fetch("/api/logs/components",{method:"GET",credentials:"include"});if(n.ok){const a=(yield n.json()).components.map(r=>({component:r.name,level:r.level,enabled:r.enabled}));f(a)}else{const s=C.map(a=>({component:a.name,level:"info",enabled:!0}));f(s)}}catch(n){console.error("Error initializing log levels:",n);const s=C.map(a=>({component:a.name,level:"info",enabled:!0}));f(s)}}),k=()=>S(void 0,null,function*(){try{const n=new URLSearchParams({limit:"100",offset:"0",source:T,component:d,level:v}),s=yield fetch(`/api/logs?${n}`,{method:"GET",credentials:"include"});if(s.ok){const a=yield s.json();w(a.logs),a.components&&ce(a.components)}else console.error("Failed to load logs")}catch(n){console.error("Error loading logs:",n)}}),ge=()=>{if(typeof EventSource!="undefined"){const n=new EventSource(`/api/logs/stream?component=${d}&level=${v}`);n.onmessage=s=>{const a=JSON.parse(s.data);a.type==="log"&&w(r=>[...r,a.data].slice(-1e3))},n.onerror=s=>{console.error("EventSource failed:",s),n.close(),b.current=setInterval(()=>{H()},2e3)},b.current=n}else b.current=setInterval(()=>{H()},2e3)},M=()=>{b.current&&(b.current instanceof EventSource?b.current.close():clearInterval(b.current),b.current=null)},H=()=>S(void 0,null,function*(){try{const n=new URLSearchParams({limit:"10",offset:"0",component:d,level:v,source:T}),s=yield fetch(`/api/logs?${n}`,{method:"GET",credentials:"include"});if(s.ok){const a=yield s.json();a.logs.length>0&&w(r=>{const u=a.logs.filter(ve=>!r.some(ye=>ye.id===ve.id));return[...r,...u].slice(-1e3)})}}catch(n){console.error("Error fetching new logs:",n)}}),xe=()=>{let n=o;d!=="all"&&(n=n.filter(s=>s.component===d)),v!=="all"&&(n=n.filter(s=>s.level===v)),L&&(n=n.filter(s=>s.message.toLowerCase().includes(L.toLowerCase())||s.component.toLowerCase().includes(L.toLowerCase()))),D(n)},ue=(n,s)=>S(void 0,null,function*(){try{if((yield fetch(`/api/logs/shared/ui/legacy/${n}/level`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({level:s})})).ok)f(r=>r.map(u=>u.component===n?U(B({},u),{level:s}):u)),y(`Log level updated for ${n}`),j(!0);else throw new Error("Failed to update log level")}catch(a){console.error("Error updating log level:",a),y("Failed to update log level"),j(!0)}}),pe=n=>S(void 0,null,function*(){try{if((yield fetch(`/api/logs/shared/ui/legacy/${n}/toggle`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include"})).ok){f(r=>r.map(u=>u.component===n?U(B({},u),{enabled:!u.enabled}):u));const a=E.find(r=>r.component===n);y(`Logging ${a!=null&&a.enabled?"disabled":"enabled"} for ${n}`),j(!0)}else throw new Error("Failed to toggle component logging")}catch(s){console.error("Error toggling component:",s),y("Failed to toggle component logging"),j(!0)}}),he=()=>S(void 0,null,function*(){try{if((yield fetch("/api/logs",{method:"DELETE",credentials:"include"})).ok)w([]),y("Logs cleared"),j(!0);else throw new Error("Failed to clear logs")}catch(n){console.error("Error clearing logs:",n),y("Failed to clear logs"),j(!0)}}),me=()=>{const n=JSON.stringify(h,null,2),s=new Blob([n],{type:"application/json"}),a=URL.createObjectURL(s),r=document.createElement("a");r.href=a,r.download=`logs-${new Date().toISOString().split("T")[0]}.json`,r.click(),URL.revokeObjectURL(a),y("Logs exported successfully"),j(!0)},je=()=>S(void 0,null,function*(){try{if((yield fetch("/api/logs/test",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({count:10,component:"API Server"})})).ok)y("Test logs generated successfully"),j(!0),k();else throw new Error("Failed to generate test logs")}catch(n){console.error("Error generating test logs:",n),y("Failed to generate test logs"),j(!0)}}),X=n=>{switch(n){case"debug":return e.jsx(IconBug,{size:16});case"info":return e.jsx(IconInfoCircle,{size:16});case"warn":return e.jsx(IconAlertTriangle,{size:16});case"error":return e.jsx(IconX,{size:16});case"fatal":return e.jsx(IconX,{size:16});default:return e.jsx(IconInfoCircle,{size:16})}},P=n=>{switch(n){case"debug":return"default";case"info":return"info";case"warn":return"warning";case"error":return"error";case"fatal":return"error";default:return"default"}},m=(()=>{const n={debug:0,info:0,warn:0,error:0,fatal:0,total:o.length};return o.forEach(s=>{n.hasOwnProperty(s.level)&&n[s.level]++}),n})(),fe=[{to:"/",title:"Home"},{title:"Logs"}];return e.jsxs(PageContainer,{title:"Logs",description:"System logs and monitoring",children:[e.jsx(Breadcrumb,{title:"System Logs",items:fe}),e.jsx(G,{children:e.jsxs(N,{children:[e.jsxs(t,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,children:[e.jsx(i,{variant:"h4",children:"System Logs"}),e.jsxs(t,{display:"flex",gap:1,children:[e.jsx(q,{control:e.jsx(J,{checked:R,onChange:n=>ne(n.target.checked)}),label:"Real-time"}),e.jsx(q,{control:e.jsx(J,{checked:W,onChange:n=>se(n.target.checked)}),label:"Auto-scroll"}),e.jsx(z,{variant:"outlined",size:"small",startIcon:e.jsx(IconRefresh,{}),onClick:k,children:"Refresh"}),e.jsx(z,{variant:"outlined",size:"small",startIcon:e.jsx(IconDownload,{}),onClick:me,children:"Export"}),e.jsx(z,{variant:"outlined",size:"small",color:"error",startIcon:e.jsx(IconClearAll,{}),onClick:he,children:"Clear"}),e.jsx(z,{variant:"outlined",size:"small",color:"warning",startIcon:e.jsx(IconBug,{}),onClick:()=>je(),sx:{ml:1},children:"Test Logs"})]})]}),e.jsxs(Tabs,{value:l,onChange:(n,s)=>c(s),sx:{mb:3},children:[e.jsx(Tab,{label:e.jsxs(t,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(IconTerminal,{size:16}),"Site Logs",e.jsx(Badge,{badgeContent:h.length,color:"primary",max:999})]})}),e.jsx(Tab,{label:e.jsxs(t,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(IconAdjustments,{size:16}),"Component Logs"]})}),e.jsx(Tab,{label:e.jsxs(t,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(IconSettings,{size:16}),"Log Levels"]})})]}),l===0&&e.jsxs(t,{children:[e.jsx(t,{mb:3,children:e.jsxs(t,{display:"flex",gap:2,flexWrap:"wrap",alignItems:"center",children:[e.jsx(t,{minWidth:"200px",children:e.jsxs(F,{fullWidth:!0,size:"small",children:[e.jsx($,{children:"Log Level"}),e.jsxs(O,{value:v,label:"Log Level",onChange:n=>K(n.target.value),children:[e.jsx(p,{value:"all",children:"All Levels"}),e.jsx(p,{value:"debug",children:"Debug"}),e.jsx(p,{value:"info",children:"Info"}),e.jsx(p,{value:"warn",children:"Warning"}),e.jsx(p,{value:"error",children:"Error"}),e.jsx(p,{value:"fatal",children:"Fatal"})]})]})}),e.jsx(t,{minWidth:"200px",children:e.jsxs(F,{fullWidth:!0,size:"small",children:[e.jsx($,{children:"Component"}),e.jsxs(O,{value:d,label:"Component",onChange:n=>I(n.target.value),children:[e.jsx(p,{value:"all",children:"All Components"}),C.map(n=>e.jsx(p,{value:n.name,children:e.jsxs(t,{display:"flex",alignItems:"center",gap:1,children:[n.icon,n.name]})},n.name))]})]})}),e.jsx(t,{minWidth:"200px",children:e.jsxs(F,{fullWidth:!0,size:"small",children:[e.jsx($,{children:"Log Source"}),e.jsxs(O,{value:T,label:"Log Source",onChange:n=>Z(n.target.value),children:[e.jsx(p,{value:"both",children:e.jsxs(t,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(IconAdjustments,{size:16}),"All Sources"]})}),e.jsx(p,{value:"memory",children:e.jsxs(t,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(IconTerminal,{size:16}),"Real-time (Memory)"]})}),e.jsx(p,{value:"file",children:e.jsxs(t,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(IconFileText,{size:16}),"Log Files"]})})]})]})}),e.jsx(t,{flexGrow:1,minWidth:"300px",children:e.jsx(Ce,{fullWidth:!0,size:"small",placeholder:"Search logs...",value:L,onChange:n=>ee(n.target.value),InputProps:{startAdornment:e.jsx(IconSearch,{size:16,style:{marginRight:8}})}})})]})}),e.jsxs(t,{mb:2,display:"flex",gap:2,flexWrap:"wrap",alignItems:"center",children:[e.jsx(i,{variant:"body2",color:"textSecondary",sx:{fontWeight:"bold"},children:"Log Statistics:"}),e.jsx(g,{size:"small",label:`Total: ${m.total}`,variant:"outlined"}),e.jsx(g,{size:"small",label:`Debug: ${m.debug}`,color:"default",variant:"outlined"}),e.jsx(g,{size:"small",label:`Info: ${m.info}`,color:"info",variant:"outlined"}),e.jsx(g,{size:"small",label:`Warn: ${m.warn}`,color:"warning",variant:"outlined"}),e.jsx(g,{size:"small",label:`Error: ${m.error}`,color:"error",variant:"outlined"}),e.jsx(g,{size:"small",label:`Fatal: ${m.fatal}`,color:"error",variant:"outlined"}),(v!=="all"||d!=="all"||L)&&e.jsx(g,{size:"small",label:`Filtered: ${h.length}`,color:"secondary",variant:"filled"})]}),e.jsx(Q,{ref:A,children:h.length===0?e.jsx(t,{textAlign:"center",py:4,children:e.jsx(i,{variant:"body2",color:"textSecondary",children:"No logs found matching the current filters"})}):h.map(n=>e.jsxs(Y,{level:n.level,children:[e.jsx(t,{mr:2,display:"flex",alignItems:"center",minWidth:"120px",children:e.jsx(i,{variant:"caption",sx:{fontFamily:"monospace"},children:new Date(n.timestamp).toLocaleTimeString()})}),e.jsx(t,{mr:2,display:"flex",alignItems:"center",minWidth:"80px",children:e.jsx(g,{size:"small",label:n.level.toUpperCase(),color:P(n.level),icon:X(n.level),sx:{fontSize:"10px",height:"20px"}})}),e.jsx(t,{mr:2,minWidth:"120px",children:e.jsx(i,{variant:"caption",sx:{fontWeight:"bold"},children:n.component})}),e.jsx(t,{mr:2,minWidth:"60px",children:e.jsx(g,{size:"small",label:n.source==="file"?"FILE":"LIVE",color:n.source==="file"?"secondary":"success",sx:{fontSize:"9px",height:"18px",minWidth:"50px"}})}),e.jsxs(t,{flexGrow:1,children:[e.jsx(i,{variant:"caption",children:n.message}),n.details&&e.jsx(t,{mt:.5,children:e.jsx(i,{variant:"caption",sx:{opacity:.7},children:JSON.stringify(n.details)})})]})]},n.id))}),e.jsx(t,{mt:2,children:e.jsx(TablePagination,{component:"div",count:h.length,page:te,onPageChange:(n,s)=>le(s),rowsPerPage:ae,onRowsPerPageChange:n=>re(parseInt(n.target.value,10)),rowsPerPageOptions:[10,25,50,100]})}),e.jsxs(t,{mt:3,children:[e.jsx(i,{variant:"subtitle1",gutterBottom:!0,children:"Log Level Statistics"}),e.jsxs(t,{display:"flex",gap:2,children:[e.jsx(g,{label:`Total: ${m.total}`,color:"default"}),e.jsx(g,{label:`Debug: ${m.debug}`,color:"info"}),e.jsx(g,{label:`Info: ${m.info}`,color:"primary"}),e.jsx(g,{label:`Warning: ${m.warn}`,color:"warning"}),e.jsx(g,{label:`Error: ${m.error}`,color:"error"}),e.jsx(g,{label:`Fatal: ${m.fatal}`,color:"error",variant:"outlined"})]})]})]}),l===1&&e.jsxs(t,{children:[e.jsx(i,{variant:"h6",gutterBottom:!0,children:"Component Log Sources"}),e.jsx(i,{variant:"body2",color:"textSecondary",mb:3,children:"View logs from different components and sources. Each component may have both real-time logs and historical log files."}),e.jsx(t,{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(350px, 1fr))",gap:2,mb:3,children:C.map(n=>{const s=h.filter(u=>u.component===n.name),a=s.filter(u=>u.source==="file"),r=s.filter(u=>u.source!=="file");return e.jsx(G,{variant:"outlined",sx:{cursor:"pointer","&:hover":{bgcolor:"action.hover"}},onClick:()=>I(n.name),children:e.jsxs(N,{children:[e.jsxs(t,{display:"flex",alignItems:"center",gap:2,mb:2,children:[n.icon,e.jsxs(t,{flexGrow:1,children:[e.jsx(i,{variant:"h6",children:n.name}),e.jsx(i,{variant:"caption",color:"textSecondary",children:n.description})]}),e.jsx(Badge,{badgeContent:s.length,color:"primary",max:999})]}),e.jsxs(t,{display:"flex",gap:1,mb:1,children:[e.jsx(g,{size:"small",label:`${r.length} Live`,color:"success",variant:"outlined"}),e.jsx(g,{size:"small",label:`${a.length} File`,color:"secondary",variant:"outlined"})]}),s.length>0&&e.jsxs(i,{variant:"caption",color:"textSecondary",children:["Last activity: ",new Date(s[0].timestamp).toLocaleString()]})]})},n.name)})}),d!=="all"&&e.jsx(G,{variant:"outlined",children:e.jsxs(N,{children:[e.jsxs(t,{display:"flex",alignItems:"center",gap:2,mb:3,children:[e.jsxs(i,{variant:"h6",children:[d," Logs"]}),e.jsx(z,{size:"small",onClick:()=>I("all"),variant:"outlined",children:"Back to All"})]}),e.jsx(Q,{children:h.filter(n=>n.component===d).map(n=>e.jsxs(Y,{level:n.level,children:[e.jsx(t,{mr:2,display:"flex",alignItems:"center",minWidth:"120px",children:e.jsx(i,{variant:"caption",sx:{fontFamily:"monospace"},children:new Date(n.timestamp).toLocaleTimeString()})}),e.jsx(t,{mr:2,display:"flex",alignItems:"center",minWidth:"80px",children:e.jsx(g,{size:"small",label:n.level.toUpperCase(),color:P(n.level),icon:X(n.level),sx:{fontSize:"10px",height:"20px"}})}),e.jsx(t,{mr:2,minWidth:"60px",children:e.jsx(g,{size:"small",label:n.source==="file"?"FILE":"LIVE",color:n.source==="file"?"secondary":"success",sx:{fontSize:"9px",height:"18px",minWidth:"50px"}})}),e.jsxs(t,{flexGrow:1,children:[e.jsx(i,{variant:"caption",children:n.message}),n.details&&e.jsx(t,{mt:.5,children:e.jsx(i,{variant:"caption",sx:{opacity:.7},children:JSON.stringify(n.details)})})]})]},n.id))})]})})]}),l===2&&e.jsxs(t,{children:[e.jsx(i,{variant:"h6",gutterBottom:!0,children:"Configure Log Levels"}),e.jsx(i,{variant:"body2",color:"textSecondary",mb:3,children:"Set the minimum log level for each component. Logs below the selected level will not be captured."}),C.map(n=>{var a;const s=E.find(r=>r.component===n.name);return e.jsxs(Accordion,{children:[e.jsx(AccordionSummary,{expandIcon:e.jsx(IconChevronDown,{}),children:e.jsxs(t,{display:"flex",alignItems:"center",gap:2,width:"100%",children:[n.icon,e.jsxs(t,{flexGrow:1,children:[e.jsx(i,{variant:"h6",children:n.name}),e.jsx(i,{variant:"caption",color:"textSecondary",children:n.description})]}),e.jsxs(t,{display:"flex",alignItems:"center",gap:2,children:[e.jsx(g,{label:((a=s==null?void 0:s.level)==null?void 0:a.toUpperCase())||"INFO",color:P((s==null?void 0:s.level)||"info"),size:"small"}),e.jsx(J,{checked:(s==null?void 0:s.enabled)||!1,onChange:()=>pe(n.name),onClick:r=>r.stopPropagation()})]})]})}),e.jsx(AccordionDetails,{children:e.jsxs(t,{display:"flex",flexDirection:"column",gap:2,children:[e.jsxs(F,{fullWidth:!0,children:[e.jsx($,{children:"Log Level"}),e.jsxs(O,{value:(s==null?void 0:s.level)||"info",label:"Log Level",onChange:r=>ue(n.name,r.target.value),children:[e.jsx(p,{value:"debug",children:e.jsxs(t,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(IconBug,{size:16}),"Debug - All messages"]})}),e.jsx(p,{value:"info",children:e.jsxs(t,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(IconInfoCircle,{size:16}),"Info - General information"]})}),e.jsx(p,{value:"warn",children:e.jsxs(t,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(IconAlertTriangle,{size:16}),"Warning - Potential issues"]})}),e.jsx(p,{value:"error",children:e.jsxs(t,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(IconX,{size:16}),"Error - Error messages only"]})}),e.jsx(p,{value:"fatal",children:e.jsxs(t,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(IconX,{size:16}),"Fatal - Critical errors only"]})})]})]}),e.jsxs(ze,{severity:"info",sx:{mt:1},children:["Current setting: Only ",e.jsx("strong",{children:(s==null?void 0:s.level)||"info"})," level and above will be logged for ",n.name,"."]})]})})]},n.name)})]})]})}),e.jsx(Snackbar,{open:oe,autoHideDuration:3e3,onClose:()=>j(!1),message:ie})]})};export{$e as default};
//# sourceMappingURL=Logs-Oiw-nG0T.js.map
