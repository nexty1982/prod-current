var ne=Object.defineProperty,oe=Object.defineProperties;var re=Object.getOwnPropertyDescriptors;var $=Object.getOwnPropertySymbols;var ae=Object.prototype.hasOwnProperty,ie=Object.prototype.propertyIsEnumerable;var W=(r,o,n)=>o in r?ne(r,o,{enumerable:!0,configurable:!0,writable:!0,value:n}):r[o]=n,S=(r,o)=>{for(var n in o||(o={}))ae.call(o,n)&&W(r,n,o[n]);if($)for(var n of $(o))ie.call(o,n)&&W(r,n,o[n]);return r},A=(r,o)=>oe(r,re(o));var x=(r,o,n)=>new Promise((L,j)=>{var g=c=>{try{u(n.next(c))}catch(l){j(l)}},I=c=>{try{u(n.throw(c))}catch(l){j(l)}},u=c=>c.done?L(c.value):Promise.resolve(c.value).then(g,I);u((n=n.apply(r,o)).next())});import{a as V,j as e,B as h,d as i,U as G,Q as z,$ as w,e as p,aH as ce,G as H,p as le,h as de,I as ue,J as me,Y as xe,K as P,O as q}from"./index-CNFXvQ6i.js";import{r as a}from"./vendor-DgfDxsY7.js";import{J as he}from"./JITTerminal-DKk9Ymqn.js";import{T as pe,a as _}from"./Tabs-Cer_vT2F.js";import{T as K}from"./Terminal-C1boCPzu.js";import{D as je}from"./Download-8bMO9YJm.js";import{L as Q,a as ge}from"./ListItem-KF7kizas.js";import{L as Y}from"./ListItemText-Do-rLMnZ.js";import{S as fe}from"./Security-BsIhbVW8.js";import{D as ye}from"./Delete-DJJifwkV.js";import"./Close-BQ-7S1uX.js";import"./Warning-vHqfcY_5.js";import"./LinearProgress-CsT3gD9e.js";import"./KeyboardArrowRight-CK1FNa4g.js";import"./listItemButtonClasses-Khq0AWwe.js";const E=V(e.jsx("path",{d:"m17.6 9.48 1.84-3.18c.16-.31.04-.69-.26-.85-.29-.15-.65-.06-.83.22l-1.88 3.24c-2.86-1.21-6.08-1.21-8.94 0L5.65 5.67c-.19-.29-.58-.38-.87-.2-.28.18-.37.54-.22.83L6.4 9.48C3.3 11.25 1.28 14.44 1 18h22c-.28-3.56-2.3-6.75-5.4-8.52M7 15.25c-.69 0-1.25-.56-1.25-1.25s.56-1.25 1.25-1.25 1.25.56 1.25 1.25-.56 1.25-1.25 1.25m10 0c-.69 0-1.25-.56-1.25-1.25s.56-1.25 1.25-1.25 1.25.56 1.25 1.25-.56 1.25-1.25 1.25"})),ke=V(e.jsx("path",{d:"M12.65 10C11.83 7.67 9.61 6 7 6c-3.31 0-6 2.69-6 6s2.69 6 6 6c2.61 0 4.83-1.67 5.65-4H17v4h4v-4h2v-4zM7 14c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2"})),Be=()=>{const[r,o]=a.useState([]),[n,L]=a.useState(0),[j,g]=a.useState(!1),[I,u]=a.useState(null),[c,l]=a.useState(!1),[d,T]=a.useState({agentId:"",task:"",timeoutMinutes:15}),[O,U]=a.useState(!1),[C,m]=a.useState(null),[v,X]=a.useState(""),[R,M]=a.useState(!1),[B,D]=a.useState(null);a.useEffect(()=>{x(void 0,null,function*(){try{const t=yield fetch("/api/auth/profile");if(t.ok){const y=yield t.json();X(y.role)}}catch(t){console.error("Failed to get user profile:",t)}}),f()},[]);const f=()=>x(void 0,null,function*(){try{const s=yield fetch("/api/jit/sessions");if(s.ok){const t=yield s.json();o(t)}}catch(s){console.error("Failed to fetch sessions:",s)}}),Z=()=>x(void 0,null,function*(){if(!d.agentId||!d.task){m("Agent ID and task are required");return}U(!0),m(null);try{const s=yield fetch("/api/jit-terminal/agent-access",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(d)}),t=yield s.json();s.ok?(u(t.session.id),g(!0),l(!1),f(),T({agentId:"",task:"",timeoutMinutes:15})):m(t.message||"Failed to request agent access")}catch(s){m("Failed to connect to server"),console.error("Agent access request failed:",s)}finally{U(!1)}}),ee=s=>x(void 0,null,function*(){try{(yield fetch(`/api/jit/sessions/${s}`,{method:"DELETE"})).ok&&f()}catch(t){console.error("Failed to terminate session:",t)}}),se=()=>x(void 0,null,function*(){M(!0),m(null),D(null);try{const s=yield fetch("/api/jit/token",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({expiresInHours:24})}),t=yield s.json();if(s.ok){const y=new Blob([t.token],{type:"text/plain"}),b=window.URL.createObjectURL(y),k=document.createElement("a");k.href=b,k.download=".om-jit-token",document.body.appendChild(k),k.click(),document.body.removeChild(k),window.URL.revokeObjectURL(b),D("CLI token downloaded successfully! Expires in 24 hours."),setTimeout(()=>D(null),5e3)}else m(t.message||"Failed to generate CLI token")}catch(s){m("Failed to connect to server"),console.error("CLI token download failed:",s)}finally{M(!1)}}),te=s=>{const t=s-Date.now();if(t<=0)return"Expired";const y=Math.floor(t/6e4),b=Math.floor(t%6e4/1e3);return`${y}m ${b}s`},F=v==="admin"||v==="super_admin",J=r.filter(s=>!s.isAgent),N=r.filter(s=>s.isAgent);return e.jsxs(h,{sx:{p:3},children:[e.jsx(i,{variant:"h4",gutterBottom:!0,children:"JIT Terminal Console"}),e.jsxs(pe,{value:n,onChange:(s,t)=>L(t),sx:{mb:3},children:[e.jsx(_,{label:"User Sessions",icon:e.jsx(K,{})}),e.jsx(_,{label:"Agent Sessions",icon:e.jsx(E,{})})]}),v==="super_admin"&&e.jsx(G,{sx:{mb:3},children:e.jsxs(z,{children:[e.jsxs(i,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ke,{}),"CLI Access Token"]}),e.jsx(i,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Download a secure token for CLI access to JIT Terminal sessions. Store this token as ~/.om-jit-token for use with jitconnect script."}),B&&e.jsx(w,{severity:"success",sx:{mb:2},children:B}),C&&e.jsx(w,{severity:"error",sx:{mb:2},children:C}),e.jsx(p,{variant:"contained",startIcon:R?void 0:e.jsx(je,{}),onClick:se,disabled:R,sx:{mr:2},children:R?"Generating Token...":"ðŸ” Download CLI Access Token"}),e.jsx(i,{variant:"caption",color:"text.secondary",sx:{display:"block",mt:1},children:"Token expires in 24 hours. All CLI actions are logged and monitored."})]})}),F&&n===1&&e.jsxs(h,{sx:{mb:3},children:[e.jsx(p,{variant:"contained",startIcon:e.jsx(E,{}),onClick:()=>l(!0),sx:{mr:2},children:"Request Terminal Access"}),e.jsx(p,{variant:"outlined",startIcon:e.jsx(ce,{}),onClick:f,children:"Refresh Sessions"})]}),e.jsx(H,{container:!0,spacing:3,children:e.jsx(H,{item:!0,xs:12,children:e.jsx(G,{children:e.jsxs(z,{children:[e.jsx(i,{variant:"h6",gutterBottom:!0,children:n===0?"Active User Sessions":"Active Agent Sessions"}),e.jsxs(le,{children:[(n===0?J:N).map(s=>e.jsxs(Q,{children:[e.jsx(Y,{primary:e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:1},children:[s.isAgent?e.jsx(E,{}):e.jsx(K,{}),e.jsx(i,{variant:"subtitle1",children:s.isAgent?`Agent: ${s.agentId}`:s.userName}),s.isAgent&&e.jsx(de,{label:"AGENT",color:"primary",size:"small",icon:e.jsx(fe,{})})]}),secondary:e.jsxs(h,{children:[e.jsxs(i,{variant:"body2",color:"text.secondary",children:["Session ID: ",s.id]}),s.isAgent&&e.jsxs(i,{variant:"body2",color:"text.secondary",children:["Task: ",s.task]}),e.jsxs(i,{variant:"body2",color:"text.secondary",children:["Commands: ",s.commandCount," | Expires: ",te(s.expiryTime)]})]})}),e.jsxs(ge,{children:[e.jsx(p,{variant:"outlined",size:"small",onClick:()=>{u(s.id),g(!0)},sx:{mr:1},children:"Connect"}),e.jsx(ue,{onClick:()=>ee(s.id),children:e.jsx(ye,{})})]})]},s.id)),(n===0?J:N).length===0&&e.jsx(Q,{children:e.jsx(Y,{primary:`No active ${n===0?"user":"agent"} sessions`,secondary:n===1&&F?"Click 'Request Terminal Access' to start an agent session":void 0})})]})]})})})}),e.jsxs(me,{open:c,onClose:()=>l(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(xe,{children:"Request Agent Terminal Access"}),e.jsx(P,{children:e.jsxs(h,{sx:{pt:2},children:[C&&e.jsx(w,{severity:"error",sx:{mb:2},children:C}),e.jsx(q,{label:"Agent ID",value:d.agentId,onChange:s=>T(t=>A(S({},t),{agentId:s.target.value})),fullWidth:!0,margin:"normal",required:!0,placeholder:"e.g., omai, assistant-v2"}),e.jsx(q,{label:"Task Description",value:d.task,onChange:s=>T(t=>A(S({},t),{task:s.target.value})),fullWidth:!0,margin:"normal",required:!0,multiline:!0,rows:3,placeholder:"Describe what the agent needs to accomplish..."}),e.jsx(q,{label:"Timeout (minutes)",type:"number",value:d.timeoutMinutes,onChange:s=>T(t=>A(S({},t),{timeoutMinutes:parseInt(s.target.value)})),fullWidth:!0,margin:"normal",inputProps:{min:5,max:60}}),e.jsx(w,{severity:"info",sx:{mt:2},children:e.jsxs(i,{variant:"body2",children:[e.jsx("strong",{children:"Security Notice:"})," Agent sessions are restricted to whitelisted commands only. All actions are logged and monitored."]})})]})}),e.jsx(P,{children:e.jsxs(h,{sx:{display:"flex",gap:2,justifyContent:"flex-end"},children:[e.jsx(p,{onClick:()=>l(!1),children:"Cancel"}),e.jsx(p,{variant:"contained",onClick:Z,disabled:O||!d.agentId||!d.task,children:O?"Requesting...":"Request Access"})]})})]}),j&&I&&e.jsx(he,{isOpen:j,onClose:()=>{g(!1),u(null),f()},sessionId:I,user:{id:"current-user",name:"Current User",role:v}})]})};export{Be as default};
//# sourceMappingURL=JITTerminalConsole-jx_qG_rc.js.map
