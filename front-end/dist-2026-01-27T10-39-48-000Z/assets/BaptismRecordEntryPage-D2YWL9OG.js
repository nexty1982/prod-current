var U=Object.defineProperty,q=Object.defineProperties;var A=Object.getOwnPropertyDescriptors;var B=Object.getOwnPropertySymbols;var G=Object.prototype.hasOwnProperty,O=Object.prototype.propertyIsEnumerable;var W=(r,s,t)=>s in r?U(r,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[s]=t,C=(r,s)=>{for(var t in s||(s={}))G.call(s,t)&&W(r,t,s[t]);if(B)for(var t of B(s))O.call(s,t)&&W(r,t,s[t]);return r},S=(r,s)=>q(r,A(s));var w=(r,s,t)=>new Promise((j,n)=>{var c=i=>{try{p(t.next(i))}catch(x){n(x)}},_=i=>{try{p(t.throw(i))}catch(x){n(x)}},p=i=>i.done?j(i.value):Promise.resolve(i.value).then(c,_);p((t=t.apply(r,s)).next())});import{aK as z,be as H,l as J,k as K,j as e,B as k,C as M,R as X,d as Q,$ as D,G as l,O as u,S as V,e as F,A as Y}from"./index-CNFXvQ6i.js";import{r as f}from"./vendor-DgfDxsY7.js";import{I as Z}from"./IconCheck-DIkpgZMD.js";const ae=()=>{var E;const{id:r}=z(),[s]=H(),t=J(),{user:j}=K(),n=!!r,c=s.get("church_id")||((E=j==null?void 0:j.church_id)==null?void 0:E.toString())||"",[_,p]=f.useState(n),[i,x]=f.useState(!1),[R,m]=f.useState(null),[T,v]=f.useState(!1),[o,P]=f.useState({first_name:"",last_name:"",birth_date:"",reception_date:"",clergy:"",birthplace:"",parents:"",sponsors:"",entry_type:"",notes:""});f.useEffect(()=>{n&&r&&c&&w(void 0,null,function*(){try{p(!0),m(null);const h=new URLSearchParams({church_id:c}),g=yield fetch(`/api/baptism-records/${r}?${h.toString()}`,{credentials:"include",headers:{"Content-Type":"application/json"}});if(!g.ok)throw new Error("Failed to load record");const y=yield g.json();if(y.success&&y.record){const a=y.record;P({first_name:a.first_name||"",last_name:a.last_name||"",birth_date:a.birth_date||"",reception_date:a.reception_date||"",clergy:a.clergy||"",birthplace:a.birthplace||"",parents:a.parents||"",sponsors:a.sponsors||"",entry_type:a.entry_type||"",notes:a.notes||""})}}catch(h){m(h.message||"Failed to load record")}finally{p(!1)}})},[n,r,c]);const d=b=>h=>{P(g=>S(C({},g),{[b]:h.target.value})),m(null),v(!1)},$=b=>w(void 0,null,function*(){if(b.preventDefault(),!c){m("Church ID is required");return}x(!0),m(null),v(!1);try{const h=n?`/api/baptism-records/${r}`:"/api/baptism-records",g=n?"PUT":"POST",y=new URLSearchParams({church_id:c}),a=yield fetch(`${h}?${y.toString()}`,{method:g,credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(S(C({},o),{church_id:parseInt(c)}))});if(!a.ok){const N=yield a.json().catch(()=>({}));throw new Error(N.error||"Failed to save record")}const I=yield a.json();if(I.success)v(!0),setTimeout(()=>{t(`/apps/records/baptism?church_id=${c}`)},1500);else throw new Error(I.error||"Failed to save record")}catch(h){m(h.message||"Failed to save record")}finally{x(!1)}}),L=()=>{t(`/apps/records/baptism?church_id=${c}`)};return _?e.jsx(k,{sx:{p:3,display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px"},children:e.jsx(M,{})}):e.jsx(k,{sx:{p:3},children:e.jsxs(X,{sx:{p:3},children:[e.jsx(Q,{variant:"h4",gutterBottom:!0,children:n?"Edit Baptism Record":"New Baptism Record"}),R&&e.jsx(D,{severity:"error",sx:{mb:2},onClose:()=>m(null),children:R}),T&&e.jsxs(D,{severity:"success",sx:{mb:2},children:["Record ",n?"updated":"created"," successfully. Redirecting..."]}),e.jsxs("form",{onSubmit:$,children:[e.jsxs(l,{container:!0,spacing:2,children:[e.jsx(l,{item:!0,xs:12,sm:6,children:e.jsx(u,{fullWidth:!0,label:"First Name",value:o.first_name,onChange:d("first_name"),required:!0,margin:"normal"})}),e.jsx(l,{item:!0,xs:12,sm:6,children:e.jsx(u,{fullWidth:!0,label:"Last Name",value:o.last_name,onChange:d("last_name"),required:!0,margin:"normal"})}),e.jsx(l,{item:!0,xs:12,sm:6,children:e.jsx(u,{fullWidth:!0,label:"Birth Date",type:"date",value:o.birth_date,onChange:d("birth_date"),InputLabelProps:{shrink:!0},margin:"normal"})}),e.jsx(l,{item:!0,xs:12,sm:6,children:e.jsx(u,{fullWidth:!0,label:"Reception Date (Baptism Date)",type:"date",value:o.reception_date,onChange:d("reception_date"),InputLabelProps:{shrink:!0},margin:"normal"})}),e.jsx(l,{item:!0,xs:12,sm:6,children:e.jsx(u,{fullWidth:!0,label:"Clergy",value:o.clergy,onChange:d("clergy"),margin:"normal"})}),e.jsx(l,{item:!0,xs:12,sm:6,children:e.jsx(u,{fullWidth:!0,label:"Birthplace",value:o.birthplace,onChange:d("birthplace"),margin:"normal"})}),e.jsx(l,{item:!0,xs:12,sm:6,children:e.jsx(u,{fullWidth:!0,label:"Parents",value:o.parents,onChange:d("parents"),margin:"normal",multiline:!0,rows:2})}),e.jsx(l,{item:!0,xs:12,sm:6,children:e.jsx(u,{fullWidth:!0,label:"Sponsors (Godparents)",value:o.sponsors,onChange:d("sponsors"),margin:"normal",multiline:!0,rows:2})}),e.jsx(l,{item:!0,xs:12,sm:6,children:e.jsx(u,{fullWidth:!0,label:"Entry Type",value:o.entry_type,onChange:d("entry_type"),margin:"normal"})}),e.jsx(l,{item:!0,xs:12,children:e.jsx(u,{fullWidth:!0,label:"Notes",value:o.notes,onChange:d("notes"),margin:"normal",multiline:!0,rows:4})})]}),e.jsxs(V,{direction:"row",spacing:2,sx:{mt:3},children:[e.jsx(F,{type:"submit",variant:"contained",startIcon:e.jsx(Z,{size:18}),disabled:i,children:i?"Saving...":n?"Update Record":"Create Record"}),e.jsx(F,{type:"button",variant:"outlined",startIcon:e.jsx(Y,{size:18}),onClick:L,disabled:i,children:"Cancel"})]})]})]})})};export{ae as default};
//# sourceMappingURL=BaptismRecordEntryPage-D2YWL9OG.js.map
