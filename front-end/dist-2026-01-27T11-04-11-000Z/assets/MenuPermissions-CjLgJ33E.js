var q=Object.defineProperty,H=Object.defineProperties;var J=Object.getOwnPropertyDescriptors;var A=Object.getOwnPropertySymbols;var L=Object.prototype.hasOwnProperty,K=Object.prototype.propertyIsEnumerable;var O=(o,a,r)=>a in o?q(o,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[a]=r,p=(o,a)=>{for(var r in a||(a={}))L.call(a,r)&&O(o,r,a[r]);if(A)for(var r of A(a))K.call(a,r)&&O(o,r,a[r]);return o},x=(o,a)=>H(o,J(a));var I=(o,a,r)=>new Promise((S,b)=>{var v=c=>{try{f(r.next(c))}catch(w){b(w)}},j=c=>{try{f(r.throw(c))}catch(w){b(w)}},f=c=>c.done?S(c.value):Promise.resolve(c.value).then(v,j);f((r=r.apply(o,a)).next())});import{k as Y,j as e,B as u,$ as M,d as g,e as R,bd as Q,U as V,Q as G,J as X,Y as Z,K as ee,O as y,a0 as se,a1 as ne,a2 as te,f as ae,h as D,cr as re,a3 as ie,a5 as F,r as le,T as oe,I as ce}from"./index-BDfVhljI.js";import{r as h}from"./vendor-DgfDxsY7.js";import{S as de}from"./Security-nXquPuVk.js";import{A as ue,a as he,b as me}from"./AccordionSummary-D4_s6jxW.js";import{M as pe}from"./Menu-B6r3LPUA.js";import{E as xe}from"./ExpandMore-Bcngkytz.js";import{T as je,a as fe,b as ge,c as W,d as ye}from"./TableRow-CY_CMYLL.js";import{T as d}from"./TableCell-Cc2Re30I.js";import{E as be}from"./Edit-hEeKvKl5.js";const _e=()=>{const{isSuperAdmin:o}=Y(),[a,r]=h.useState({menuItems:[],availableRoles:[]}),[S,b]=h.useState(!0),[v,j]=h.useState(null),[f,c]=h.useState(null),[w,z]=h.useState(!1),[P,C]=h.useState(!1),[ve,B]=h.useState(null),[i,m]=h.useState({menu_key:"",title:"",path:"",icon:"",parent_id:null,sort_order:999,description:"",allowedRoles:[]});if(!o())return e.jsx(u,{p:3,children:e.jsx(M,{severity:"error",children:"You do not have permission to access menu permissions management. This feature is only available to super administrators."})});h.useEffect(()=>{T()},[]);const T=()=>I(void 0,null,function*(){try{b(!0);const s=yield fetch("/api/menu-permissions",{credentials:"include"});if(!s.ok)throw new Error("Failed to load menu permissions");const t=yield s.json();if(t.success)r({menuItems:t.menuItems,availableRoles:t.availableRoles});else throw new Error(t.message||"Failed to load menu permissions")}catch(s){j(s instanceof Error?s.message:"Failed to load menu permissions")}finally{b(!1)}}),N=(s,t)=>I(void 0,null,function*(){try{const n=yield fetch(`/api/menu-permissions/${s}`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({allowedRoles:t})});if(!n.ok)throw new Error("Failed to update menu permissions");const l=yield n.json();if(l.success)c("Menu permissions updated successfully"),T();else throw new Error(l.message||"Failed to update menu permissions")}catch(n){j(n instanceof Error?n.message:"Failed to update menu permissions")}}),U=(s,t,n)=>{let l=[...s.allowed_roles];n?l.includes(t)||l.push(t):l=l.filter(k=>k!==t),N(s.id,l)},$=()=>I(void 0,null,function*(){try{const s=yield fetch("/api/menu-permissions/menu-item",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(i)});if(!s.ok)throw new Error("Failed to create menu item");const t=yield s.json();if(t.success)c("Menu item created successfully"),C(!1),m({menu_key:"",title:"",path:"",icon:"",parent_id:null,sort_order:999,description:"",allowedRoles:[]}),T();else throw new Error(t.message||"Failed to create menu item")}catch(s){j(s instanceof Error?s.message:"Failed to create menu item")}}),E=a.menuItems.reduce((s,t)=>{const n=t.parent_id||"root";return s[n]||(s[n]=[]),s[n].push(t),s},{}),_=(s,t)=>e.jsxs(ue,{defaultExpanded:!0,children:[e.jsx(he,{expandIcon:e.jsx(xe,{}),children:e.jsxs(u,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(pe,{}),e.jsx(g,{variant:"h6",children:t}),e.jsx(D,{size:"small",label:`${s.length} items`})]})}),e.jsx(me,{children:e.jsx(je,{children:e.jsxs(fe,{size:"small",children:[e.jsx(ge,{children:e.jsxs(W,{children:[e.jsx(d,{children:e.jsx("strong",{children:"Menu Item"})}),e.jsx(d,{children:e.jsx("strong",{children:"Path"})}),e.jsx(d,{children:e.jsx("strong",{children:"Sort Order"})}),a.availableRoles.map(n=>e.jsx(d,{align:"center",children:e.jsx("strong",{children:n})},n)),e.jsx(d,{children:e.jsx("strong",{children:"Actions"})})]})}),e.jsx(ye,{children:s.map(n=>e.jsxs(W,{children:[e.jsx(d,{children:e.jsxs(u,{children:[e.jsx(g,{variant:"body2",fontWeight:"medium",children:n.title}),e.jsx(g,{variant:"caption",color:"text.secondary",children:n.menu_key})]})}),e.jsx(d,{children:e.jsx(g,{variant:"body2",fontFamily:"monospace",children:n.path||"-"})}),e.jsx(d,{children:e.jsx(D,{size:"small",label:n.sort_order})}),a.availableRoles.map(l=>e.jsx(d,{align:"center",children:e.jsx(le,{checked:n.allowed_roles.includes(l),onChange:k=>U(n,l,k.target.checked),size:"small",color:"primary"})},l)),e.jsx(d,{children:e.jsx(oe,{title:"Edit Menu Item",children:e.jsx(ce,{size:"small",onClick:()=>{B(n),z(!0)},children:e.jsx(be,{fontSize:"small"})})})})]},n.id))})]})})})]});return S?e.jsx(u,{p:3,children:e.jsx(g,{children:"Loading menu permissions..."})}):e.jsxs(u,{p:3,children:[e.jsxs(u,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,children:[e.jsxs(u,{display:"flex",alignItems:"center",gap:2,children:[e.jsx(de,{color:"primary"}),e.jsx(g,{variant:"h4",children:"Menu Permissions Management"})]}),e.jsx(R,{variant:"contained",startIcon:e.jsx(Q,{}),onClick:()=>C(!0),children:"Add Menu Item"})]}),e.jsx(M,{severity:"info",sx:{mb:3},children:"As a super administrator, you can control which menu items are visible to different user roles. Toggle the switches to grant or revoke access to specific menu items for each role."}),e.jsx(V,{children:e.jsxs(G,{children:[E.root&&_(E.root,"Main Menu Items"),Object.entries(E).filter(([s])=>s!=="root").map(([s,t])=>{const n=a.menuItems.find(l=>l.id.toString()===s);return _(t,`${(n==null?void 0:n.title)||"Unknown"} - Submenu Items`)})]})}),e.jsxs(X,{open:P,onClose:()=>C(!1),maxWidth:"md",fullWidth:!0,children:[e.jsx(Z,{children:"Create New Menu Item"}),e.jsx(ee,{children:e.jsxs(u,{display:"flex",flexDirection:"column",gap:2,mt:1,children:[e.jsx(y,{fullWidth:!0,label:"Menu Key",value:i.menu_key,onChange:s=>m(x(p({},i),{menu_key:s.target.value})),required:!0,helperText:"Unique identifier for this menu item"}),e.jsx(y,{fullWidth:!0,label:"Title",value:i.title,onChange:s=>m(x(p({},i),{title:s.target.value})),required:!0}),e.jsx(y,{fullWidth:!0,label:"Path",value:i.path,onChange:s=>m(x(p({},i),{path:s.target.value})),helperText:"Route path (e.g., /admin/users)"}),e.jsx(y,{fullWidth:!0,label:"Icon",value:i.icon,onChange:s=>m(x(p({},i),{icon:s.target.value})),helperText:"Icon component name"}),e.jsx(y,{fullWidth:!0,label:"Sort Order",type:"number",value:i.sort_order,onChange:s=>m(x(p({},i),{sort_order:parseInt(s.target.value)}))}),e.jsx(y,{fullWidth:!0,label:"Description",multiline:!0,rows:2,value:i.description,onChange:s=>m(x(p({},i),{description:s.target.value}))}),e.jsxs(se,{fullWidth:!0,children:[e.jsx(ne,{children:"Allowed Roles"}),e.jsx(te,{multiple:!0,value:i.allowedRoles,onChange:s=>m(x(p({},i),{allowedRoles:s.target.value})),input:e.jsx(re,{label:"Allowed Roles"}),renderValue:s=>e.jsx(u,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:s.map(t=>e.jsx(D,{label:t,size:"small"},t))}),children:a.availableRoles.map(s=>e.jsx(ae,{value:s,children:s},s))})]})]})}),e.jsxs(ie,{children:[e.jsx(R,{onClick:()=>C(!1),children:"Cancel"}),e.jsx(R,{onClick:$,variant:"contained",children:"Create"})]})]}),e.jsx(F,{open:!!f,autoHideDuration:4e3,onClose:()=>c(null),anchorOrigin:{vertical:"top",horizontal:"center"},children:e.jsx(M,{severity:"success",onClose:()=>c(null),children:f})}),e.jsx(F,{open:!!v,autoHideDuration:6e3,onClose:()=>j(null),anchorOrigin:{vertical:"top",horizontal:"center"},children:e.jsx(M,{severity:"error",onClose:()=>j(null),children:v})})]})};export{_e as default};
//# sourceMappingURL=MenuPermissions-CjLgJ33E.js.map
