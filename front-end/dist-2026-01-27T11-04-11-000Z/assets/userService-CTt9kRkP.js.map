{"version":3,"file":"userService-CTt9kRkP.js","sources":["../../src/shared/lib/userService.ts"],"sourcesContent":["// src/services/userService.ts\nexport interface User {\n    id: number;\n    email: string;\n    first_name: string;\n    last_name: string;\n    full_name?: string;\n    role: 'super_admin' | 'admin' | 'church_admin' | 'priest' | 'deacon' | 'editor' | 'viewer' | 'guest';\n    church_id: number | null;\n    church_name?: string;\n    is_active: boolean;\n    phone?: string;\n    preferred_language?: string;\n    created_at: string;\n    updated_at: string;\n    last_login?: string;\n    email_verified?: boolean;\n    timezone?: string;\n}\n\nexport interface NewUser {\n    email: string;\n    first_name: string;\n    last_name: string;\n    role: string;\n    church_id: string | null;\n    phone?: string;\n    preferred_language?: string;\n    send_welcome_email?: boolean;\n}\n\nexport interface UpdateUser {\n    email: string;\n    first_name: string;\n    last_name: string;\n    role: string;\n    church_id: string | null;\n    preferred_language?: string;\n    is_active: boolean;\n}\n\nexport interface ResetPasswordData {\n    new_password: string;\n    confirm_password: string;\n    auto_generate?: boolean;\n}\n\nexport interface Church {\n    id: number;\n    name: string;\n    email: string;\n    phone?: string;\n    city?: string;\n    country?: string;\n    is_active: boolean;\n}\n\nexport interface ApiResponse<T = any> {\n    success: boolean;\n    message?: string;\n    data?: T;\n    tempPassword?: string;\n    newPassword?: string;\n    users?: User[];\n    churches?: Church[];\n}\n\nclass UserService {\n    private baseUrl = '/api/admin';\n\n    // Get all users\n    async getUsers(): Promise<ApiResponse<User[]>> {\n        try {\n            const response = await fetch(`${this.baseUrl}/users`, {\n                credentials: 'include'\n            });\n\n            if (!response.ok) {\n                throw new Error(`HTTP error! status: ${response.status}`);\n            }\n\n            const data = await response.json();\n            return {\n                success: data.success,\n                users: data.users || [],\n                message: data.message\n            };\n        } catch (error) {\n            console.error('Error fetching users:', error);\n            return {\n                success: false,\n                message: 'Failed to fetch users',\n                users: []\n            };\n        }\n    }\n\n    // Create new user\n    async createUser(userData: NewUser): Promise<ApiResponse> {\n        try {\n            const response = await fetch(`${this.baseUrl}/users`, {\n                method: 'POST',\n                headers: {\n                    'Content-Type': 'application/json',\n                },\n                credentials: 'include',\n                body: JSON.stringify({\n                    ...userData,\n                    church_id: userData.church_id || null\n                })\n            });\n\n            const data = await response.json();\n\n            if (!response.ok) {\n                throw new Error(data.message || 'Failed to create user');\n            }\n\n            return {\n                success: data.success,\n                message: data.message,\n                tempPassword: data.tempPassword\n            };\n        } catch (error) {\n            console.error('Error creating user:', error);\n            return {\n                success: false,\n                message: error instanceof Error ? error.message : 'Failed to create user'\n            };\n        }\n    }\n\n    // Update user\n    async updateUser(userId: number, userData: UpdateUser): Promise<ApiResponse> {\n        try {\n            const response = await fetch(`${this.baseUrl}/users/${userId}`, {\n                method: 'PUT',\n                headers: {\n                    'Content-Type': 'application/json',\n                },\n                credentials: 'include',\n                body: JSON.stringify({\n                    ...userData,\n                    church_id: userData.church_id || null\n                })\n            });\n\n            const data = await response.json();\n\n            if (!response.ok) {\n                throw new Error(data.message || 'Failed to update user');\n            }\n\n            return {\n                success: data.success,\n                message: data.message\n            };\n        } catch (error) {\n            console.error('Error updating user:', error);\n            return {\n                success: false,\n                message: error instanceof Error ? error.message : 'Failed to update user'\n            };\n        }\n    }\n\n    // Delete user\n    async deleteUser(userId: number): Promise<ApiResponse> {\n        try {\n            const response = await fetch(`${this.baseUrl}/users/${userId}`, {\n                method: 'DELETE',\n                credentials: 'include'\n            });\n\n            const data = await response.json();\n\n            if (!response.ok) {\n                throw new Error(data.message || 'Failed to delete user');\n            }\n\n            return {\n                success: data.success,\n                message: data.message\n            };\n        } catch (error) {\n            console.error('Error deleting user:', error);\n            return {\n                success: false,\n                message: error instanceof Error ? error.message : 'Failed to delete user'\n            };\n        }\n    }\n\n    // Toggle user status\n    async toggleUserStatus(userId: number): Promise<ApiResponse> {\n        try {\n            const response = await fetch(`${this.baseUrl}/users/${userId}/toggle-status`, {\n                method: 'PUT',\n                credentials: 'include'\n            });\n\n            const data = await response.json();\n\n            if (!response.ok) {\n                throw new Error(data.message || 'Failed to update user status');\n            }\n\n            return {\n                success: data.success,\n                message: data.message\n            };\n        } catch (error) {\n            console.error('Error toggling user status:', error);\n            return {\n                success: false,\n                message: error instanceof Error ? error.message : 'Failed to update user status'\n            };\n        }\n    }\n\n    // Reset user password\n    async resetPassword(userId: number, passwordData?: ResetPasswordData): Promise<ApiResponse> {\n        try {\n            const response = await fetch(`${this.baseUrl}/users/${userId}/reset-password`, {\n                method: 'PATCH',\n                headers: {\n                    'Content-Type': 'application/json',\n                },\n                credentials: 'include',\n                body: JSON.stringify(passwordData || {})\n            });\n\n            const data = await response.json();\n\n            if (!response.ok) {\n                throw new Error(data.message || 'Failed to reset password');\n            }\n\n            return {\n                success: data.success,\n                message: data.message,\n                newPassword: data.newPassword\n            };\n        } catch (error) {\n            console.error('Error resetting password:', error);\n            return {\n                success: false,\n                message: error instanceof Error ? error.message : 'Failed to reset password'\n            };\n        }\n    }\n\n    // Get all churches\n    async getChurches(): Promise<ApiResponse<Church[]>> {\n        try {\n            const response = await fetch('/api/admin/churches', {\n                credentials: 'include'\n            });\n\n            if (!response.ok) {\n                throw new Error(`HTTP error! status: ${response.status}`);\n            }\n\n            const data = await response.json();\n            return {\n                success: data.success,\n                churches: data.churches || [],\n                message: data.message\n            };\n        } catch (error) {\n            console.error('Error fetching churches:', error);\n            return {\n                success: false,\n                message: 'Failed to fetch churches',\n                churches: []\n            };\n        }\n    }\n\n    // Utility functions\n    formatLastLogin(lastLogin?: string): string {\n        if (!lastLogin) return 'Never';\n\n        const date = new Date(lastLogin);\n        const now = new Date();\n        const diffInMs = now.getTime() - date.getTime();\n        const diffInDays = Math.floor(diffInMs / (1000 * 60 * 60 * 24));\n\n        if (diffInDays === 0) {\n            const diffInHours = Math.floor(diffInMs / (1000 * 60 * 60));\n            if (diffInHours === 0) {\n                const diffInMinutes = Math.floor(diffInMs / (1000 * 60));\n                return diffInMinutes <= 1 ? 'Just now' : `${diffInMinutes} minutes ago`;\n            }\n            return diffInHours === 1 ? '1 hour ago' : `${diffInHours} hours ago`;\n        } else if (diffInDays === 1) {\n            return 'Yesterday';\n        } else if (diffInDays < 7) {\n            return `${diffInDays} days ago`;\n        } else {\n            return date.toLocaleDateString();\n        }\n    }\n\n    getRoleBadgeColor(role: string): 'default' | 'primary' | 'secondary' | 'error' | 'info' | 'success' | 'warning' {\n        switch (role) {\n            case 'super_admin': return 'error';\n            case 'admin': return 'warning';\n            case 'priest': return 'primary';\n            case 'deacon': return 'info';\n            case 'manager': return 'secondary';\n            case 'user': return 'default';\n            case 'viewer': return 'default';\n            default: return 'default';\n        }\n    }\n\n    generateSecurePassword(): string {\n        const length = 16;\n        const charset = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*';\n        let password = '';\n\n        // Ensure at least one character from each category\n        const lowercase = 'abcdefghijklmnopqrstuvwxyz';\n        const uppercase = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';\n        const numbers = '0123456789';\n        const symbols = '!@#$%^&*';\n\n        password += lowercase[Math.floor(Math.random() * lowercase.length)];\n        password += uppercase[Math.floor(Math.random() * uppercase.length)];\n        password += numbers[Math.floor(Math.random() * numbers.length)];\n        password += symbols[Math.floor(Math.random() * symbols.length)];\n\n        // Fill the rest randomly\n        for (let i = 4; i < length; i++) {\n            password += charset[Math.floor(Math.random() * charset.length)];\n        }\n\n        // Shuffle the password\n        return password.split('').sort(() => Math.random() - 0.5).join('');\n    }\n}\n\nexport const userService = new UserService();\nexport default userService;\n"],"names":["UserService","__publicField","__async","response","data","error","userData","__spreadProps","__spreadValues","userId","passwordData","lastLogin","date","diffInMs","diffInDays","diffInHours","diffInMinutes","role","charset","password","lowercase","uppercase","numbers","symbols","i","userService"],"mappings":"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"}