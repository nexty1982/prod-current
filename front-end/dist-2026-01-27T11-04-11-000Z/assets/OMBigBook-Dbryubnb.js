var sr=Object.defineProperty,tr=Object.defineProperties;var rr=Object.getOwnPropertyDescriptors;var pt=Object.getOwnPropertySymbols;var nr=Object.prototype.hasOwnProperty,ar=Object.prototype.propertyIsEnumerable;var jt=(n,S,u)=>S in n?sr(n,S,{enumerable:!0,configurable:!0,writable:!0,value:u}):n[S]=u,Q=(n,S)=>{for(var u in S||(S={}))nr.call(S,u)&&jt(n,u,S[u]);if(pt)for(var u of pt(S))ar.call(S,u)&&jt(n,u,S[u]);return n},V=(n,S)=>tr(n,rr(S));var M=(n,S,u)=>new Promise((T,j)=>{var w=P=>{try{x(u.next(P))}catch(z){j(z)}},F=P=>{try{x(u.throw(P))}catch(z){j(z)}},x=P=>P.done?T(P.value):Promise.resolve(P.value).then(w,F);x((u=u.apply(n,S)).next())});import{j as e,R as K,B as r,d as s,S as O,O as Ce,p as Me,T as ae,I as se,D as ns,h as C,$ as Y,i as ks,e as k,a0 as $e,a1 as We,a2 as _e,f as ge,F as de,r as le,C as ce,aH as Fe,b9 as St,q as ir,U as Z,Q as ee,J as Ke,Y as Ge,K as Xe,a3 as Ye,G as p,Z as kt,b8 as gt,bd as ft}from"./index-BDfVhljI.js";import{b as Us,r as o}from"./vendor-DgfDxsY7.js";import{F as It,P as Vs,A as Ks,V as Gs,I as Xs,J as Ys,a as Zs,H as et,b as st,c as or,K as lr,C as cr,G as dr,T as xr,d as ps,L as ur,S as hr,e as mr,E as pr,M as jr,R as gr,f as fr,g as yt}from"./VideoFile-B503w0LS.js";import{I as Ns}from"./InputAdornment-ZC5rvhDf.js";import{S as tt}from"./Search-Dsdc-YTk.js";import{L as xe,a as Tt}from"./ListItem-CT-O2kow.js";import{L as yr}from"./ListItemButton-D_Q1X9Bc.js";import{L as Be}from"./ListItemIcon-C45d8pU7.js";import{L as ue}from"./ListItemText-ChoqKKOM.js";import{B as qe}from"./Psychology-BTDOy2py.js";import{S as is}from"./PlayArrow-B57F9d0M.js";import{D as gs}from"./Delete-BzvjJ98g.js";import{C as he}from"./Code-DnIlIjbl.js";import{D as js,T as bt}from"./TrendingUp-DHUZsPVG.js";import{S as os}from"./Storage-B3wr3cCg.js";import{D as as}from"./Description-BVhTogZV.js";import{V as Ze}from"./Visibility-DyzL3Bo2.js";import{C as br,S as vr}from"./Send-T0POBJWK.js";import{D as wr}from"./Download-Dy8080P5.js";import{A as He,a as Je,b as Qe}from"./AccordionSummary-D4_s6jxW.js";import{E as Ve}from"./ExpandMore-Bcngkytz.js";import{U as Cr}from"./Palette-Cxg6MXlF.js";import{C as Pt}from"./CheckCircle-BzDkpPsE.js";import{L as ts}from"./LinearProgress-D2-YLZ1_.js";import{S as Ps}from"./Security-nXquPuVk.js";import{T as Is}from"./Terminal-HmSMh2bI.js";import{C as vt}from"./Clear-ZuZ5epi3.js";import{a as wt,L as Sr}from"./LockOpen-DQYGN3jL.js";import{I as kr}from"./Info-mPVCfH-0.js";import{E as Mt}from"./Error-BzsfDbfb.js";import{W as Ir}from"./Warning-C63rUtT9.js";import{C as Tr}from"./Close-Cys3i2MM.js";import{S as Pr}from"./Schedule-BVPUy3BF.js";import{S as Ft}from"./Assessment-BNyxY7rh.js";import{F as Ts}from"./Folder-KuAGu-QG.js";import{B as Mr}from"./Badge-DJp7X618.js";import{T as Ws,a as _s,b as qs,c as rs,d as Hs}from"./TableRow-CY_CMYLL.js";import{T as q}from"./TableCell-Cc2Re30I.js";import{A as Ss}from"./Extension-DzuKGDCV.js";import{S as Fr,a as Er,b as Ar}from"./Stepper-C6XDBNTG.js";import{I as Ds}from"./GetApp-BehKszZY.js";import{B as Rr}from"./Breadcrumbs-neNWuVCu.js";import{L as $r}from"./Link-UeZU0xE4.js";import{M as Js,S as Or}from"./Speed-qQIdSu5L.js";import{F as zr}from"./FilterList-CoTe5e71.js";import{E as Dr}from"./Edit-hEeKvKl5.js";import{P as Br}from"./Pagination-ijqfgQom.js";import{T as Lr,a as Ee}from"./Tabs-VYJhMi1b.js";import{S as Bs}from"./School-BCjQ2lJ8.js";import{A as Ct}from"./Analytics-DuqgybNJ.js";import{C as Ur}from"./CloudUpload-zTcIYRxr.js";import{T as Nr}from"./Assignment-Cv8No_jQ.js";import{B as Ls}from"./Article-C287aENz.js";import"./listItemButtonClasses-VSU-3nzN.js";import"./usePreviousProps-BWumOsHT.js";import"./LastPage-DImRq0Fq.js";import"./KeyboardArrowRight-n0bX-S0N.js";const Wr=({files:n,selectedFile:S,onFileSelect:u,onFileExecute:T,onFileDelete:j,onQuestionnairePreview:w,isExecuting:F,settings:x={}})=>{const[P,z]=Us.useState(""),R=h=>{switch(h){case"markdown":case"text":return e.jsx(as,{});case"javascript":return e.jsx(st,{});case"sql":return e.jsx(os,{});case"shell":return e.jsx(he,{});case"python":return e.jsx(he,{});case"html":return e.jsx(et,{});case"css":return e.jsx(Zs,{});case"json":return e.jsx(Ys,{});case"xml":return e.jsx(he,{});case"image":return e.jsx(Xs,{});case"video":return e.jsx(Gs,{});case"audio":return e.jsx(Ks,{});case"archive":return e.jsx(js,{});case"pdf":return e.jsx(Vs,{});default:return e.jsx(he,{})}},D=h=>{const c={markdown:"primary",javascript:"secondary",sql:"info",shell:"warning",python:"success",html:"error",css:"info",json:"secondary",xml:"warning",text:"default",image:"success",video:"error",audio:"info",archive:"warning",pdf:"error",other:"default"};return e.jsx(C,{label:h.toUpperCase(),size:"small",color:c[h]||"default",variant:"outlined"})},y=n.filter(h=>h.name.toLowerCase().includes(P.toLowerCase())||h.type.toLowerCase().includes(P.toLowerCase())),v=h=>{if(h===0)return"0 Bytes";const c=1024,l=["Bytes","KB","MB","GB"],g=Math.floor(Math.log(h)/Math.log(c));return parseFloat((h/Math.pow(c,g)).toFixed(1))+" "+l[g]},N=h=>new Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}).format(h);return n.length===0?e.jsxs(K,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[e.jsx(r,{sx:{p:2,borderBottom:1,borderColor:"divider"},children:e.jsx(s,{variant:"h6",children:"Files"})}),e.jsx(r,{sx:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",p:3},children:e.jsxs(O,{spacing:2,alignItems:"center",children:[e.jsx(It,{sx:{fontSize:48,color:"grey.400"}}),e.jsx(s,{variant:"body1",color:"text.secondary",textAlign:"center",children:"No files uploaded yet"}),e.jsx(s,{variant:"body2",color:"text.secondary",textAlign:"center",children:"Use the Import tab to upload files"})]})})]}):e.jsxs(K,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[e.jsx(r,{sx:{p:2,borderBottom:1,borderColor:"divider"},children:e.jsxs(O,{spacing:2,children:[e.jsxs(s,{variant:"h6",children:["Files (",n.length,")"]}),e.jsx(Ce,{size:"small",placeholder:"Search files...",value:P,onChange:h=>z(h.target.value),InputProps:{startAdornment:e.jsx(Ns,{position:"start",children:e.jsx(tt,{})})},fullWidth:!0})]})}),e.jsx(Me,{sx:{flex:1,overflow:"auto",p:0},children:y.map((h,c)=>e.jsxs(Us.Fragment,{children:[e.jsx(xe,{disablePadding:!0,children:e.jsxs(yr,{selected:(S==null?void 0:S.id)===h.id,onClick:()=>u(h),sx:{"&.Mui-selected":{backgroundColor:"primary.light","&:hover":{backgroundColor:"primary.light"}}},children:[e.jsx(Be,{children:R(h.type)}),e.jsx(ue,{primary:e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(s,{variant:"body2",noWrap:!0,sx:{flex:1},children:h.name}),D(h.type)]}),secondary:e.jsxs(O,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(s,{variant:"caption",color:"text.secondary",children:v(h.size)}),e.jsx(s,{variant:"caption",color:"text.secondary",children:"â€¢"}),e.jsx(s,{variant:"caption",color:"text.secondary",children:N(h.uploadedAt)})]})}),e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:.5},children:[h.isQuestionnaire&&w&&e.jsx(ae,{title:"Preview Questionnaire",children:e.jsx(se,{size:"small",onClick:l=>{l.stopPropagation(),w(h)},color:"secondary",children:e.jsx(qe,{fontSize:"small"})})}),e.jsx(ae,{title:"Execute",children:e.jsx(se,{size:"small",onClick:l=>{l.stopPropagation(),T(h)},disabled:F,color:"primary",children:e.jsx(is,{fontSize:"small"})})}),e.jsx(ae,{title:"Delete",children:e.jsx(se,{size:"small",onClick:l=>{l.stopPropagation(),j(h.id)},color:"error",children:e.jsx(gs,{fontSize:"small"})})})]})]})}),c<y.length-1&&e.jsx(ns,{})]},h.id))}),y.length===0&&P&&e.jsx(r,{sx:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",p:3},children:e.jsxs(s,{variant:"body2",color:"text.secondary",children:['No files match "',P,'"']})})]})},_r=({file:n,onExecute:S,isExecuting:u,settings:T={}})=>{const j=h=>{switch(h){case"markdown":case"text":return e.jsx(as,{});case"javascript":return e.jsx(st,{});case"sql":return e.jsx(os,{});case"shell":return e.jsx(he,{});case"python":return e.jsx(he,{});case"html":return e.jsx(et,{});case"css":return e.jsx(Zs,{});case"json":return e.jsx(Ys,{});case"xml":return e.jsx(he,{});case"image":return e.jsx(Xs,{});case"video":return e.jsx(Gs,{});case"audio":return e.jsx(Ks,{});case"archive":return e.jsx(js,{});case"pdf":return e.jsx(Vs,{});default:return e.jsx(he,{})}},w=h=>{const c={markdown:"primary",javascript:"secondary",sql:"info",shell:"warning",python:"success",html:"error",css:"info",json:"secondary",xml:"warning",text:"default",image:"success",video:"error",audio:"info",archive:"warning",pdf:"error",other:"default"};return e.jsx(C,{label:h.toUpperCase(),size:"small",color:c[h]||"default",variant:"outlined"})},F=h=>{if(h===0)return"0 Bytes";const c=1024,l=["Bytes","KB","MB","GB"],g=Math.floor(Math.log(h)/Math.log(c));return parseFloat((h/Math.pow(c,g)).toFixed(1))+" "+l[g]},x=h=>new Intl.DateTimeFormat("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}).format(h),P=()=>M(void 0,null,function*(){if(n)try{yield navigator.clipboard.writeText(n.content)}catch(h){console.error("Failed to copy to clipboard:",h)}}),z=()=>{if(n){const h=new Blob([n.content],{type:"text/plain"}),c=URL.createObjectURL(h),l=document.createElement("a");l.href=c,l.download=n.name,document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(c)}},R=h=>e.jsx(r,{sx:{"& h1":{fontSize:"2rem",fontWeight:"bold",mb:2},"& h2":{fontSize:"1.5rem",fontWeight:"bold",mb:1.5},"& h3":{fontSize:"1.25rem",fontWeight:"bold",mb:1},"& p":{mb:1},"& code":{backgroundColor:"grey.100",padding:"2px 4px",borderRadius:"4px",fontFamily:"monospace"},"& pre":{backgroundColor:"grey.100",padding:2,borderRadius:"4px",overflow:"auto",fontFamily:"monospace"},"& ul, & ol":{pl:2},"& li":{mb:.5}},children:h.split(`
`).map((c,l)=>c.startsWith("# ")?e.jsx(s,{variant:"h4",component:"h1",children:c.substring(2)},l):c.startsWith("## ")?e.jsx(s,{variant:"h5",component:"h2",children:c.substring(3)},l):c.startsWith("### ")?e.jsx(s,{variant:"h6",component:"h3",children:c.substring(4)},l):c.startsWith("```")?e.jsx(r,{component:"pre",sx:{backgroundColor:"grey.100",p:2,borderRadius:1},children:c.substring(3)},l):c.startsWith("- ")?e.jsxs(s,{component:"li",children:["â€¢ ",c.substring(2)]},l):c.trim()===""?e.jsx(r,{sx:{height:8}},l):e.jsx(s,{paragraph:!0,children:c},l))}),D=h=>{try{const c=JSON.parse(h),l=T.autoExpandJson?JSON.stringify(c,null,2):JSON.stringify(c);return e.jsx(r,{component:"pre",sx:{backgroundColor:T.darkModeConsole?"#1e1e1e":"grey.50",color:T.darkModeConsole?"#ffffff":"text.primary",p:2,borderRadius:1,overflow:"auto",fontFamily:"monospace",fontSize:"0.875rem",whiteSpace:T.lineWrapInPreview?"pre-wrap":"pre"},children:l})}catch(c){return e.jsx(Y,{severity:"error",children:"Invalid JSON format"})}},y=(h,c)=>{const l=T.darkModeConsole!==!1,g=T.enableSyntaxHighlighting!==!1;return e.jsx(r,{component:"pre",sx:{backgroundColor:l?"#1e1e1e":"#f8f9fa",color:l?"#ffffff":"#212529",p:2,borderRadius:1,overflow:"auto",fontFamily:"monospace",fontSize:"0.875rem",whiteSpace:T.lineWrapInPreview?"pre-wrap":"pre",border:l?"1px solid #404040":"1px solid #dee2e6","& .keyword":{color:l?"#569cd6":"#d73a49"},"& .string":{color:l?"#ce9178":"#032f62"},"& .comment":{color:l?"#6a9955":"#6a737d"},"& .number":{color:l?"#b5cea8":"#005cc5"},"& .function":{color:l?"#dcdcaa":"#6f42c1"},"& .operator":{color:l?"#d4d4d4":"#d73a49"}},children:g?v(h,c):h})},v=(h,c)=>{if(!T.enableSyntaxHighlighting)return h;let l=h;return(c==="javascript"||c==="typescript")&&(l=l.replace(/\b(const|let|var|function|return|if|else|for|while|class|import|export|default|async|await)\b/g,'<span class="keyword">$1</span>').replace(/\b(console|log|error|warn|info)\b/g,'<span class="function">$1</span>').replace(/"([^"]*)"/g,'<span class="string">"$1"</span>').replace(/'([^']*)'/g,`<span class="string">'$1'</span>`).replace(/\/\/.*$/gm,'<span class="comment">$&</span>').replace(/\/\*[\s\S]*?\*\//g,'<span class="comment">$&</span>').replace(/\b(\d+)\b/g,'<span class="number">$1</span>')),c==="sql"&&(l=l.replace(/\b(SELECT|FROM|WHERE|INSERT|UPDATE|DELETE|CREATE|DROP|TABLE|INDEX|PRIMARY|FOREIGN|KEY|JOIN|LEFT|RIGHT|INNER|OUTER|GROUP|BY|ORDER|HAVING|UNION|ALL|DISTINCT|COUNT|SUM|AVG|MAX|MIN)\b/gi,'<span class="keyword">$1</span>').replace(/"([^"]*)"/g,'<span class="string">"$1"</span>').replace(/'([^']*)'/g,`<span class="string">'$1'</span>`).replace(/--.*$/gm,'<span class="comment">$&</span>').replace(/\b(\d+)\b/g,'<span class="number">$1</span>')),c==="python"&&(l=l.replace(/\b(def|class|import|from|as|if|elif|else|for|while|try|except|finally|with|return|yield|True|False|None)\b/g,'<span class="keyword">$1</span>').replace(/\b(print|len|range|str|int|float|list|dict|set)\b/g,'<span class="function">$1</span>').replace(/("""[\s\S]*?""")/g,'<span class="comment">$1</span>').replace(/('''[\s\S]*?''')/g,'<span class="comment">$1</span>').replace(/#.*$/gm,'<span class="comment">$&</span>').replace(/("([^"]*)")/g,'<span class="string">$1</span>').replace(/('([^']*)')/g,'<span class="string">$1</span>').replace(/\b(\d+)\b/g,'<span class="number">$1</span>')),l},N=()=>{if(!n)return null;const h=n.size/1024;if(T.maxPreviewFileSize&&h>T.maxPreviewFileSize)return e.jsx(Y,{severity:"warning",children:e.jsxs(s,{variant:"body2",children:["File is too large to preview (",h.toFixed(1)," KB). Maximum preview size is ",T.maxPreviewFileSize," KB."]})});const c=T.defaultPreviewMode||"auto";let l=n.type;switch(c==="raw"?l="text":c==="markdown"&&n.type==="text"?l="markdown":c==="code"&&["text","markdown"].includes(n.type)&&(l="javascript"),l){case"markdown":return R(n.content);case"json":return D(n.content);case"javascript":case"typescript":return y(n.content,"javascript");case"sql":return y(n.content,"sql");case"shell":return y(n.content,"bash");case"python":return y(n.content,"python");case"html":return y(n.content,"html");case"css":return y(n.content,"css");case"xml":return y(n.content,"xml");case"text":default:return e.jsx(r,{component:"pre",sx:{backgroundColor:T.darkModeConsole?"#1e1e1e":"grey.50",color:T.darkModeConsole?"#ffffff":"text.primary",p:2,borderRadius:1,overflow:"auto",fontFamily:"monospace",fontSize:"0.875rem",whiteSpace:T.lineWrapInPreview?"pre-wrap":"pre",border:T.darkModeConsole?"1px solid #404040":"1px solid #dee2e6"},children:n.content})}};return n?e.jsxs(K,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[e.jsx(r,{sx:{p:2,borderBottom:1,borderColor:"divider"},children:e.jsxs(O,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[e.jsxs(O,{direction:"row",spacing:2,alignItems:"center",children:[j(n.type),e.jsxs(r,{children:[e.jsx(s,{variant:"h6",noWrap:!0,children:n.name}),e.jsxs(O,{direction:"row",spacing:1,alignItems:"center",children:[w(n.type),e.jsx(s,{variant:"caption",color:"text.secondary",children:F(n.size)}),e.jsx(s,{variant:"caption",color:"text.secondary",children:"â€¢"}),e.jsx(s,{variant:"caption",color:"text.secondary",children:x(n.uploadedAt)})]})]})]}),e.jsxs(O,{direction:"row",spacing:1,children:[e.jsx(ae,{title:"Execute",children:e.jsx(se,{onClick:()=>S(n),disabled:u,color:"primary",size:"small",children:e.jsx(is,{})})}),e.jsx(ae,{title:"Copy to clipboard",children:e.jsx(se,{onClick:P,size:"small",children:e.jsx(br,{})})}),e.jsx(ae,{title:"Download",children:e.jsx(se,{onClick:z,size:"small",children:e.jsx(wr,{})})})]})]})}),e.jsx(r,{sx:{flex:1,overflow:"auto",p:2},children:N()})]}):e.jsx(K,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:e.jsx(r,{sx:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",p:3},children:e.jsxs(O,{spacing:2,alignItems:"center",children:[e.jsx(Ze,{sx:{fontSize:48,color:"grey.400"}}),e.jsx(s,{variant:"h6",color:"text.secondary",textAlign:"center",children:"No file selected"}),e.jsx(s,{variant:"body2",color:"text.secondary",textAlign:"center",children:"Select a file from the list to view its contents"})]})})})},Qs={defaultPreviewMode:"auto",autoExpandJson:!0,enableSyntaxHighlighting:!0,maxPreviewFileSize:1024,defaultScriptEngine:"node",executionTimeout:30,dryRunMode:!1,autoSaveConsoleOutput:!0,darkModeConsole:!0,lineWrapInPreview:!1,showHiddenFiles:!1,autoScrollConsole:!0,forwardToOMAIMemory:!0,tagForAgentReflection:!1,enableOMAIRecommendations:!0,useSecureStorage:!0,retryOnMountFailure:!0,autoProcessOnUpload:!1},qr=({settings:n,onSettingsChange:S,onSave:u,onReset:T})=>{const[j,w]=o.useState(!1),[F,x]=o.useState(!1),[P,z]=o.useState(!1),[R,D]=o.useState(null),[y,v]=o.useState(null),[N,h]=o.useState(0),c=(m,W)=>{const ie=V(Q({},n),{[m]:W});S(ie),w(!0)},l=()=>{u(),w(!1)},g=()=>{T(),w(!1)},L=()=>M(void 0,null,function*(){x(!0),h(0),D(null);try{const W=yield(yield fetch("/api/bigbook/process-all",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({useSecureStorage:n.useSecureStorage,retryOnFailure:n.retryOnMountFailure})})).json();D(W),h(100)}catch(m){console.error("File processing error:",m),D({success:!1,processedFiles:[],failedFiles:[],secureStorage:{mounted:!1,mountPath:"",retryCount:0},summary:{totalFiles:0,processedCount:0,failedCount:0,startTime:new Date().toISOString()}})}finally{x(!1)}}),me=()=>M(void 0,null,function*(){z(!0),v(null);try{const W=yield(yield fetch("/api/bigbook/test-secure-mount",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include"})).json();v(W.testResult)}catch(m){console.error("Mount test error:",m),v({mountPath:"/mnt/bigbook_secure",accessible:!1,writable:!1,error:m.message,testTime:new Date().toISOString()})}finally{z(!1)}});return e.jsx(r,{sx:{p:3,maxWidth:800,mx:"auto"},children:e.jsxs(O,{spacing:3,children:[e.jsxs(r,{children:[e.jsxs(s,{variant:"h4",component:"h1",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ks,{}),"Big Book Console Settings"]}),e.jsx(s,{variant:"body1",color:"text.secondary",children:"Configure file viewer, execution, UI behavior, and OMAI integration preferences"})]}),j&&e.jsx(Y,{severity:"info",action:e.jsxs(O,{direction:"row",spacing:1,children:[e.jsx(k,{size:"small",onClick:g,children:"Reset"}),e.jsx(k,{size:"small",variant:"contained",onClick:l,children:"Save Changes"})]}),children:"You have unsaved changes. Save them to apply the new settings."}),e.jsxs(He,{defaultExpanded:!0,children:[e.jsx(Je,{expandIcon:e.jsx(Ve,{}),children:e.jsxs(O,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(Ze,{}),e.jsx(s,{variant:"h6",children:"File Viewer Settings"})]})}),e.jsx(Qe,{children:e.jsxs(O,{spacing:3,children:[e.jsxs($e,{fullWidth:!0,children:[e.jsx(We,{children:"Default Preview Mode"}),e.jsxs(_e,{value:n.defaultPreviewMode,onChange:m=>c("defaultPreviewMode",m.target.value),label:"Default Preview Mode",children:[e.jsx(ge,{value:"auto",children:"Auto (Detect from file type)"}),e.jsx(ge,{value:"raw",children:"Raw Text"}),e.jsx(ge,{value:"markdown",children:"Markdown"}),e.jsx(ge,{value:"code",children:"Code (with syntax highlighting)"})]})]}),e.jsx(de,{control:e.jsx(le,{checked:n.autoExpandJson,onChange:m=>c("autoExpandJson",m.target.checked)}),label:"Auto-expand JSON files"}),e.jsx(de,{control:e.jsx(le,{checked:n.enableSyntaxHighlighting,onChange:m=>c("enableSyntaxHighlighting",m.target.checked)}),label:"Enable syntax highlighting"}),e.jsx(Ce,{fullWidth:!0,type:"number",label:"Max Preview File Size",value:n.maxPreviewFileSize,onChange:m=>c("maxPreviewFileSize",parseInt(m.target.value)),InputProps:{endAdornment:e.jsx(Ns,{position:"end",children:"KB"})},helperText:"Files larger than this will show truncated content"})]})})]}),e.jsxs(He,{children:[e.jsx(Je,{expandIcon:e.jsx(Ve,{}),children:e.jsxs(O,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(is,{}),e.jsx(s,{variant:"h6",children:"Execution Settings"})]})}),e.jsx(Qe,{children:e.jsxs(O,{spacing:3,children:[e.jsxs($e,{fullWidth:!0,children:[e.jsx(We,{children:"Default Script Engine"}),e.jsxs(_e,{value:n.defaultScriptEngine,onChange:m=>c("defaultScriptEngine",m.target.value),label:"Default Script Engine",children:[e.jsx(ge,{value:"node",children:"Node.js"}),e.jsx(ge,{value:"python",children:"Python"}),e.jsx(ge,{value:"sh",children:"Shell (Bash)"}),e.jsx(ge,{value:"sql",children:"SQL"})]})]}),e.jsx(Ce,{fullWidth:!0,type:"number",label:"Execution Timeout",value:n.executionTimeout,onChange:m=>c("executionTimeout",parseInt(m.target.value)),InputProps:{endAdornment:e.jsx(Ns,{position:"end",children:"seconds"})},helperText:"Maximum time to wait for script execution"}),e.jsx(de,{control:e.jsx(le,{checked:n.dryRunMode,onChange:m=>c("dryRunMode",m.target.checked)}),label:"Dry Run Mode (disable actual script effects)"}),e.jsx(de,{control:e.jsx(le,{checked:n.autoSaveConsoleOutput,onChange:m=>c("autoSaveConsoleOutput",m.target.checked)}),label:"Auto-save console output"})]})})]}),e.jsxs(He,{children:[e.jsx(Je,{expandIcon:e.jsx(Ve,{}),children:e.jsxs(O,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(Cr,{}),e.jsx(s,{variant:"h6",children:"UI Behavior"})]})}),e.jsx(Qe,{children:e.jsxs(O,{spacing:3,children:[e.jsx(de,{control:e.jsx(le,{checked:n.darkModeConsole,onChange:m=>c("darkModeConsole",m.target.checked)}),label:"Dark mode console"}),e.jsx(de,{control:e.jsx(le,{checked:n.lineWrapInPreview,onChange:m=>c("lineWrapInPreview",m.target.checked)}),label:"Line wrap in preview"}),e.jsx(de,{control:e.jsx(le,{checked:n.showHiddenFiles,onChange:m=>c("showHiddenFiles",m.target.checked)}),label:"Show hidden files"}),e.jsx(de,{control:e.jsx(le,{checked:n.autoScrollConsole,onChange:m=>c("autoScrollConsole",m.target.checked)}),label:"Auto-scroll console to bottom"})]})})]}),e.jsxs(He,{children:[e.jsx(Je,{expandIcon:e.jsx(Ve,{}),children:e.jsxs(O,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(qe,{}),e.jsx(s,{variant:"h6",children:"OMAI Integration"})]})}),e.jsx(Qe,{children:e.jsxs(O,{spacing:3,children:[e.jsx(de,{control:e.jsx(le,{checked:n.forwardToOMAIMemory,onChange:m=>c("forwardToOMAIMemory",m.target.checked)}),label:"Forward executed files to OMAI memory"}),e.jsx(de,{control:e.jsx(le,{checked:n.tagForAgentReflection,onChange:m=>c("tagForAgentReflection",m.target.checked)}),label:"Tag uploaded files for agent reflection"}),e.jsx(de,{control:e.jsx(le,{checked:n.enableOMAIRecommendations,onChange:m=>c("enableOMAIRecommendations",m.target.checked)}),label:"Enable OMAI recommendations after execution"}),e.jsx(Y,{severity:"info",children:e.jsx(s,{variant:"body2",children:"OMAI integration allows the AI agent to learn from your file operations and provide intelligent suggestions."})})]})})]}),e.jsxs(He,{children:[e.jsx(Je,{expandIcon:e.jsx(Ve,{}),children:e.jsxs(O,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(It,{}),e.jsx(s,{variant:"h6",children:"ðŸ“‚ File Processing"})]})}),e.jsx(Qe,{children:e.jsxs(O,{spacing:3,children:[e.jsxs(r,{children:[e.jsx(s,{variant:"subtitle1",gutterBottom:!0,sx:{fontWeight:"bold"},children:"Batch Processing"}),e.jsxs(O,{direction:"row",spacing:2,sx:{mb:2},children:[e.jsx(k,{variant:"contained",startIcon:F?e.jsx(ce,{size:16}):e.jsx(or,{}),onClick:L,disabled:F,color:"primary",children:F?"Processing...":"Process All Files"}),e.jsx(ae,{title:"Test if secure storage mount is accessible and writable",children:e.jsx(k,{variant:"outlined",startIcon:P?e.jsx(ce,{size:16}):e.jsx(Pt,{}),onClick:me,disabled:P,color:"secondary",children:P?"Testing...":"Test Secure Mount"})})]}),F&&e.jsxs(r,{sx:{width:"100%",mb:2},children:[e.jsx(ts,{variant:"indeterminate"}),e.jsx(s,{variant:"body2",color:"text.secondary",sx:{mt:1},children:"Processing files... This may take a few minutes."})]})]}),e.jsxs(r,{children:[e.jsx(s,{variant:"subtitle1",gutterBottom:!0,sx:{fontWeight:"bold"},children:"Storage Configuration"}),e.jsxs(O,{spacing:2,children:[e.jsx(de,{control:e.jsx(le,{checked:n.useSecureStorage,onChange:m=>c("useSecureStorage",m.target.checked)}),label:e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Ps,{fontSize:"small"}),e.jsx("span",{children:"Use Secure Storage (eCryptfs)"})]})}),e.jsx(de,{control:e.jsx(le,{checked:n.retryOnMountFailure,onChange:m=>c("retryOnMountFailure",m.target.checked)}),label:"Retry on mount failure (up to 3 attempts)"}),e.jsx(de,{control:e.jsx(le,{checked:n.autoProcessOnUpload,onChange:m=>c("autoProcessOnUpload",m.target.checked)}),label:"Auto-process files on upload"})]})]}),y&&e.jsxs(Y,{severity:y.accessible&&y.writable?"success":"error",sx:{mt:2},children:[e.jsx(s,{variant:"subtitle2",gutterBottom:!0,children:"Secure Mount Test Results"}),e.jsxs(O,{spacing:1,children:[e.jsxs(s,{variant:"body2",children:["Path: ",e.jsx("code",{children:y.mountPath})]}),e.jsxs(s,{variant:"body2",children:["Accessible: ",y.accessible?"âœ… Yes":"âŒ No"]}),e.jsxs(s,{variant:"body2",children:["Writable: ",y.writable?"âœ… Yes":"âŒ No"]}),y.error&&e.jsxs(s,{variant:"body2",color:"error",children:["Error: ",y.error]}),e.jsxs(s,{variant:"caption",color:"text.secondary",children:["Tested at: ",new Date(y.testTime).toLocaleString()]})]})]}),R&&e.jsxs(Y,{severity:R.success?"success":"error",sx:{mt:2},children:[e.jsx(s,{variant:"subtitle2",gutterBottom:!0,children:"Processing Results"}),e.jsxs(O,{spacing:1,children:[e.jsxs(s,{variant:"body2",children:["Total Files: ",R.summary.totalFiles]}),e.jsxs(s,{variant:"body2",children:["âœ… Processed: ",R.summary.processedCount]}),e.jsxs(s,{variant:"body2",children:["âŒ Failed: ",R.summary.failedCount]}),e.jsxs(s,{variant:"body2",children:["ðŸ”’ Secure Storage: ",R.secureStorage.mounted?"âœ… Mounted":"âŒ Not Available"]}),R.summary.durationMs&&e.jsxs(s,{variant:"body2",children:["Duration: ",(R.summary.durationMs/1e3).toFixed(2),"s"]})]})]}),R&&(R.processedFiles.length>0||R.failedFiles.length>0)&&e.jsxs(r,{children:[e.jsx(s,{variant:"subtitle1",gutterBottom:!0,sx:{fontWeight:"bold"},children:"Processing Log"}),e.jsx(K,{sx:{maxHeight:300,overflow:"auto",bgcolor:"#f5f5f5"},children:e.jsxs(Me,{dense:!0,children:[R.processedFiles.map((m,W)=>e.jsxs(xe,{children:[e.jsx(Be,{children:e.jsx(C,{label:"âœ“",size:"small",sx:{bgcolor:"#4caf50",color:"white",fontWeight:"bold"}})}),e.jsx(ue,{primary:m.fileName,secondary:`${(m.size/1024).toFixed(1)} KB ${m.securelyStored?"â€¢ Stored securely":""}`,primaryTypographyProps:{fontFamily:"monospace",fontSize:"0.875rem"}})]},`success-${W}`)),R.failedFiles.map((m,W)=>e.jsxs(xe,{children:[e.jsx(Be,{children:e.jsx(C,{label:"âœ—",size:"small",sx:{bgcolor:"#f44336",color:"white",fontWeight:"bold"}})}),e.jsx(ue,{primary:m.fileName,secondary:`Error: ${m.error}`,primaryTypographyProps:{fontFamily:"monospace",fontSize:"0.875rem"},secondaryTypographyProps:{color:"error"}})]},`failed-${W}`))]})})]}),e.jsx(Y,{severity:"info",children:e.jsx(s,{variant:"body2",children:"File processing converts uploaded .md files into the Big Book knowledge base. Enable secure storage for encrypted file storage using eCryptfs mounting."})})]})})]}),e.jsx(K,{sx:{p:2},children:e.jsxs(O,{direction:"row",spacing:2,justifyContent:"flex-end",children:[e.jsx(k,{variant:"outlined",startIcon:e.jsx(Fe,{}),onClick:g,children:"Reset to Defaults"}),e.jsx(k,{variant:"contained",startIcon:e.jsx(St,{}),onClick:l,disabled:!j,children:"Save Settings"})]})})]})})},Hr=({files:n,consoleOutput:S,isExecuting:u,onFileSelect:T,onFileExecute:j,onFileDelete:w,onQuestionnairePreview:F,onClearConsole:x,selectedFile:P})=>{const[z,R]=o.useState(!1),[D,y]=o.useState("files"),[v,N]=o.useState(Qs),h=()=>{R(!z)},c=L=>{N(L)},l=()=>{localStorage.setItem("bigbook-console-settings",JSON.stringify(v))},g=()=>{N(Qs)};return e.jsxs(r,{sx:{height:"100vh",display:"flex",flexDirection:"column"},children:[e.jsx(r,{sx:{p:2,borderBottom:1,borderColor:"divider",backgroundColor:"background.paper"},children:e.jsxs(O,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[e.jsxs(r,{children:[e.jsx(s,{variant:"h5",component:"h1",children:"Big Book Console"}),e.jsx(s,{variant:"body2",color:"text.secondary",children:"File explorer and execution console"})]}),e.jsxs(O,{direction:"row",spacing:1,children:[e.jsx(ae,{title:"Toggle Console",children:e.jsx(se,{onClick:h,color:"primary",children:e.jsx(Is,{})})}),z&&e.jsx(ae,{title:"Clear Console",children:e.jsx(se,{onClick:x,color:"error",children:e.jsx(vt,{})})}),e.jsx(ae,{title:"Refresh",children:e.jsx(se,{color:"primary",children:e.jsx(Fe,{})})}),e.jsx(ae,{title:"Settings",children:e.jsx(se,{onClick:()=>y(D==="files"?"settings":"files"),color:D==="settings"?"secondary":"primary",children:e.jsx(ks,{})})})]})]})}),e.jsxs(r,{sx:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden"},children:[D==="files"?e.jsxs(r,{sx:{flex:1,display:"flex",overflow:"hidden"},children:[e.jsx(r,{sx:{width:"30%",minWidth:300,borderRight:1,borderColor:"divider"},children:e.jsx(Wr,{files:n,selectedFile:P,onFileSelect:T,onFileExecute:j,onFileDelete:w,onQuestionnairePreview:F,isExecuting:u,settings:v})}),e.jsx(r,{sx:{flex:1},children:e.jsx(_r,{file:P,onExecute:j,isExecuting:u,settings:v})})]}):e.jsx(r,{sx:{flex:1,overflow:"auto"},children:e.jsx(qr,{settings:v,onSettingsChange:c,onSave:l,onReset:g})}),e.jsx(ir,{in:z,children:e.jsxs(r,{sx:{height:300,borderTop:1,borderColor:"divider"},children:[e.jsxs(r,{sx:{p:2,borderBottom:1,borderColor:"divider",backgroundColor:"grey.50",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(s,{variant:"h6",sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Is,{fontSize:"small"}),"Console Output"]}),e.jsxs(O,{direction:"row",spacing:1,children:[e.jsxs(s,{variant:"caption",color:"text.secondary",children:[S.length," messages"]}),e.jsx(k,{size:"small",startIcon:e.jsx(vt,{}),onClick:x,variant:"outlined",children:"Clear"})]})]}),e.jsx(r,{sx:{height:250,overflow:"auto",p:2,backgroundColor:v.darkModeConsole?"#1e1e1e":"#f8f9fa",color:v.darkModeConsole?"#ffffff":"#212529",fontFamily:"monospace",fontSize:"0.875rem"},children:S.length===0?e.jsx(r,{sx:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%"},children:e.jsx(s,{color:"grey.500",textAlign:"center",children:"No console output yet. Execute files to see results."})}):S.map(L=>e.jsxs(r,{sx:{mb:1},children:[e.jsxs(s,{component:"span",sx:{color:L.type==="error"?"#ff6b6b":L.type==="success"?"#51cf66":L.type==="warning"?"#ffd43b":L.type==="command"?"#74c0fc":"#ffffff",fontWeight:L.type==="command"?"bold":"normal"},children:["[",formatTimeOnly(L.timestamp),"] ",L.message]}),L.details&&e.jsx(s,{component:"div",sx:{color:"#adb5bd",ml:2,mt:.5,whiteSpace:"pre-wrap"},children:L.details})]},L.id))})]})})]}),e.jsxs(r,{sx:{p:1,borderTop:1,borderColor:"divider",backgroundColor:"grey.50",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(O,{direction:"row",spacing:2,alignItems:"center",children:[e.jsxs(s,{variant:"caption",color:"text.secondary",children:[n.length," files loaded"]}),P&&e.jsxs(e.Fragment,{children:[e.jsx(s,{variant:"caption",color:"text.secondary",children:"â€¢"}),e.jsxs(s,{variant:"caption",color:"text.secondary",children:["Selected: ",P.name]})]})]}),e.jsxs(O,{direction:"row",spacing:1,alignItems:"center",children:[u&&e.jsx(Y,{severity:"info",sx:{py:0,px:1},children:"Executing..."}),e.jsxs(s,{variant:"caption",color:"text.secondary",children:[S.length," console messages"]})]})]})]})},Jr=()=>{const[n,S]=o.useState(null),[u,T]=o.useState([]),[j,w]=o.useState(!1),[F,x]=o.useState(""),P=()=>M(void 0,null,function*(){w(!0),x("");try{const g=yield(yield fetch("/api/bigbook/storage/status")).json();g.success?S(g.status):x(g.error||"Failed to load storage status")}catch(l){x(l instanceof Error?l.message:"Failed to load storage status")}finally{w(!1)}}),z=()=>M(void 0,null,function*(){if(n!=null&&n.isMounted){w(!0),x("");try{const g=yield(yield fetch("/api/bigbook/storage/files")).json();g.success?T(g.files):x(g.error||"Failed to load files")}catch(l){x(l instanceof Error?l.message:"Failed to load files")}finally{w(!1)}}}),R=()=>M(void 0,null,function*(){w(!0),x("");try{const g=yield(yield fetch("/api/bigbook/storage/mount",{method:"POST"})).json();g.success?(yield P(),yield z()):x(g.error||"Failed to mount volume")}catch(l){x(l instanceof Error?l.message:"Failed to mount volume")}finally{w(!1)}}),D=()=>M(void 0,null,function*(){w(!0),x("");try{const g=yield(yield fetch("/api/bigbook/storage/unmount",{method:"POST"})).json();g.success?(yield P(),T([])):x(g.error||"Failed to unmount volume")}catch(l){x(l instanceof Error?l.message:"Failed to unmount volume")}finally{w(!1)}}),y=()=>M(void 0,null,function*(){if(window.confirm("Are you sure you want to rotate the encryption key? This will require remounting the volume.")){w(!0),x("");try{const g=yield(yield fetch("/api/bigbook/storage/rotate-key",{method:"POST"})).json();g.success?(yield P(),yield z()):x(g.error||"Failed to rotate key")}catch(l){x(l instanceof Error?l.message:"Failed to rotate key")}finally{w(!1)}}});o.useEffect(()=>{P()},[]),o.useEffect(()=>{n!=null&&n.isMounted&&z()},[n==null?void 0:n.isMounted]);const v=l=>{if(l===0)return"0 Bytes";const g=1024,L=["Bytes","KB","MB","GB"],me=Math.floor(Math.log(l)/Math.log(g));return parseFloat((l/Math.pow(g,me)).toFixed(2))+" "+L[me]},N=()=>n?n.error?e.jsx(Mt,{}):n.isMounted?e.jsx(Pt,{}):e.jsx(Ir,{}):e.jsx(kr,{}),h=()=>n?n.error?"error":n.isMounted?"success":"warning":"default",c=()=>n?n.error?"Error":n.isMounted?"Mounted":"Not Mounted":"Unknown";return e.jsxs(r,{sx:{p:3},children:[e.jsxs(s,{variant:"h4",gutterBottom:!0,children:[e.jsx(os,{sx:{mr:1,verticalAlign:"middle"}}),"Encrypted Storage Management"]}),F&&e.jsx(Y,{severity:"error",sx:{mb:2},children:F}),e.jsx(Z,{sx:{mb:3},children:e.jsxs(ee,{children:[e.jsxs(r,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2},children:[e.jsx(s,{variant:"h6",children:"Storage Status"}),e.jsx(r,{children:e.jsx(ae,{title:"Refresh Status",children:e.jsx(se,{onClick:P,disabled:j,children:e.jsx(Fe,{})})})})]}),j?e.jsxs(r,{sx:{display:"flex",alignItems:"center",justifyContent:"center",py:2},children:[e.jsx(ce,{size:24,sx:{mr:1}}),e.jsx(s,{children:"Loading..."})]}):n?e.jsxs(O,{spacing:2,children:[e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(C,{icon:N(),label:c(),color:h(),variant:"outlined"}),n.isMounted&&e.jsx(C,{icon:e.jsx(wt,{}),label:"Unlocked",color:"success",variant:"outlined"})]}),e.jsxs(r,{sx:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:2},children:[e.jsxs(r,{children:[e.jsx(s,{variant:"body2",color:"text.secondary",children:"Mount Path"}),e.jsx(s,{variant:"body1",fontFamily:"monospace",children:n.mountPath})]}),e.jsxs(r,{children:[e.jsx(s,{variant:"body2",color:"text.secondary",children:"Source Path"}),e.jsx(s,{variant:"body1",fontFamily:"monospace",children:n.sourcePath})]}),e.jsxs(r,{children:[e.jsx(s,{variant:"body2",color:"text.secondary",children:"File Count"}),e.jsx(s,{variant:"body1",children:n.fileCount})]}),e.jsxs(r,{children:[e.jsx(s,{variant:"body2",color:"text.secondary",children:"Total Size"}),e.jsx(s,{variant:"body1",children:v(n.totalSize)})]})]}),e.jsx(ns,{}),e.jsxs(r,{sx:{display:"flex",gap:1},children:[n.isMounted?e.jsx(k,{variant:"outlined",startIcon:e.jsx(Sr,{}),onClick:D,disabled:j,children:"Unmount Volume"}):e.jsx(k,{variant:"contained",startIcon:e.jsx(wt,{}),onClick:R,disabled:j,children:"Mount Volume"}),e.jsx(k,{variant:"outlined",startIcon:e.jsx(lr,{}),onClick:y,disabled:j||!n.isMounted,children:"Rotate Key"})]})]}):e.jsx(s,{color:"text.secondary",children:"No status available"})]})}),(n==null?void 0:n.isMounted)&&e.jsx(Z,{children:e.jsxs(ee,{children:[e.jsxs(r,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2},children:[e.jsxs(s,{variant:"h6",children:["Stored Files (",u.length,")"]}),e.jsx(ae,{title:"Refresh Files",children:e.jsx(se,{onClick:z,disabled:j,children:e.jsx(Fe,{})})})]}),j?e.jsxs(r,{sx:{display:"flex",alignItems:"center",justifyContent:"center",py:2},children:[e.jsx(ce,{size:24,sx:{mr:1}}),e.jsx(s,{children:"Loading files..."})]}):u.length>0?e.jsx(Me,{children:u.map(l=>e.jsxs(xe,{divider:!0,children:[e.jsx(Be,{children:e.jsx(os,{})}),e.jsx(ue,{primary:l.originalName,secondary:e.jsxs(r,{children:[e.jsxs(s,{variant:"body2",color:"text.secondary",children:["ID: ",l.fileId]}),e.jsxs(s,{variant:"body2",color:"text.secondary",children:["Size: ",v(l.size)," | Created: ",new Date(l.createdAt).toLocaleString()]}),e.jsx(s,{variant:"body2",color:"text.secondary",fontFamily:"monospace",fontSize:"0.75rem",children:l.relativePath})]})}),e.jsx(Tt,{children:e.jsxs(O,{direction:"row",spacing:1,children:[e.jsx(ae,{title:"Download",children:e.jsx(se,{size:"small",children:e.jsx(cr,{})})}),e.jsx(ae,{title:"Delete",children:e.jsx(se,{size:"small",color:"error",children:e.jsx(gs,{})})})]})})]},l.fileId))}):e.jsx(s,{color:"text.secondary",textAlign:"center",py:2,children:"No files stored in encrypted storage"})]})}),e.jsx(Z,{sx:{mt:3},children:e.jsxs(ee,{children:[e.jsxs(s,{variant:"h6",gutterBottom:!0,children:[e.jsx(Ps,{sx:{mr:1,verticalAlign:"middle"}}),"Security Information"]}),e.jsxs(O,{spacing:1,children:[e.jsx(s,{variant:"body2",children:"â€¢ Files are encrypted using eCryptFS with AES-256 encryption"}),e.jsx(s,{variant:"body2",children:"â€¢ Encryption keys are stored securely and never exposed in plaintext"}),e.jsx(s,{variant:"body2",children:"â€¢ Files are only accessible through the Big Book Viewer interface"}),e.jsx(s,{variant:"body2",children:"â€¢ Direct filesystem access is blocked via restrictive permissions"}),e.jsx(s,{variant:"body2",children:"â€¢ Volume auto-locks when unmounted or service stops"})]})]})})]})},Qr=({open:n,onClose:S,file:u,onSubmit:T})=>{var me;const[j,w]=o.useState(!1),[F,x]=o.useState(""),[P,z]=o.useState({}),[R,D]=o.useState(!1),[y,v]=o.useState(""),N=o.useRef(null),h=m=>{const W=[],ie=[{pattern:/eval\s*\(/,message:"eval() calls are not allowed"},{pattern:/Function\s*\(/,message:"Function constructor is not allowed"},{pattern:/innerHTML\s*=/,message:"innerHTML is not allowed"},{pattern:/dangerouslySetInnerHTML/,message:"dangerouslySetInnerHTML is not allowed"},{pattern:/document\.write/,message:"document.write is not allowed"},{pattern:/window\./,message:"Direct window access is restricted"},{pattern:/fetch\s*\(/,message:"fetch calls should be validated"},{pattern:/XMLHttpRequest/,message:"XMLHttpRequest is not allowed"}];for(const{pattern:b,message:B}of ie)b.test(m)&&W.push(B);return{isValid:W.length===0,issues:W}},c=m=>`
      (function() {
        'use strict';
        
        // Restricted globals
        const window = undefined;
        const document = undefined;
        const global = undefined;
        const process = undefined;
        const require = undefined;
        const module = undefined;
        const exports = undefined;
        
        // Safe React context
        const React = {
          useState: parent.React.useState,
          useEffect: parent.React.useEffect,
          useCallback: parent.React.useCallback,
          useMemo: parent.React.useMemo,
          createElement: parent.React.createElement,
          Fragment: parent.React.Fragment
        };
        
        // Safe UI components (limited subset)
        const { 
          Box, 
          Typography, 
          Button, 
          TextField, 
          Radio, 
          RadioGroup, 
          FormControl, 
          FormLabel, 
          FormControlLabel,
          Checkbox,
          Select,
          MenuItem,
          Slider,
          Stack,
          Card,
          CardContent
        } = parent.MUI;
        
        // Response handler
        const handleResponse = (questionId, answer) => {
          parent.postMessage({
            type: 'QUESTIONNAIRE_RESPONSE',
            data: { questionId, answer }
          }, '*');
        };
        
        // Component code
        ${m.replace(/import\s+.*?from\s+['"][^'"]*?['"];?/g,"").replace(/export\s+default\s+/,"").replace(/export\s+/,"")}
        
        // Render the component
        try {
          const component = typeof Questionnaire === 'function' 
            ? React.createElement(Questionnaire, { onResponse: handleResponse })
            : React.createElement('div', {}, 'Invalid questionnaire component');
          
          parent.ReactDOM.render(component, document.getElementById('questionnaire-root'));
        } catch (error) {
          parent.postMessage({
            type: 'QUESTIONNAIRE_ERROR',
            data: { message: error.message }
          }, '*');
        }
      })();
    `,l=()=>{if(!u||!u.isQuestionnaire||!u.content){v("Invalid questionnaire file");return}const m=h(u.content);if(!m.isValid){v(`Security validation failed: ${m.issues.join(", ")}`);return}w(!0),v("");try{const ie=`
        <!DOCTYPE html>
        <html>
        <head>
          <meta charset="utf-8">
          <title>Questionnaire Preview</title>
          <style>
            body { 
              font-family: 'Roboto', sans-serif; 
              margin: 16px; 
              background: #fafafa;
            }
            #questionnaire-root { 
              max-width: 800px; 
              margin: 0 auto; 
              background: white;
              border-radius: 8px;
              padding: 24px;
              box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            }
          </style>
          <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"><\/script>
          <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"><\/script>
          <script crossorigin src="https://unpkg.com/@mui/material@latest/umd/material-ui.development.js"><\/script>
        </head>
        <body>
          <div id="questionnaire-root">
            <div style="text-align: center; padding: 40px;">
              <div style="font-size: 18px; color: #666;">Loading questionnaire...</div>
            </div>
          </div>
          <script>
            // Set up communication
            window.addEventListener('message', function(event) {
              if (event.data.type === 'QUESTIONNAIRE_RESPONSE') {
                parent.postMessage(event.data, '*');
              } else if (event.data.type === 'QUESTIONNAIRE_ERROR') {
                parent.postMessage(event.data, '*');
              }
            });
            
            // Make React and MUI available
            window.React = React;
            window.ReactDOM = ReactDOM;
            window.MUI = MaterialUI;
            
            // Execute sandboxed component
            ${c(u.content)}
          <\/script>
        </body>
        </html>
      `;if(N.current){const b=N.current;b.srcdoc=ie}w(!1)}catch(W){v(`Failed to render component: ${W instanceof Error?W.message:"Unknown error"}`),w(!1)}};o.useEffect(()=>{const m=W=>{if(W.data.type==="QUESTIONNAIRE_RESPONSE"){const{questionId:ie,answer:b}=W.data.data;z(B=>V(Q({},B),{[ie]:{answer:b,timestamp:new Date}}))}else W.data.type==="QUESTIONNAIRE_ERROR"&&v(W.data.data.message)};return window.addEventListener("message",m),()=>window.removeEventListener("message",m)},[]),o.useEffect(()=>{n&&u&&u.isQuestionnaire&&l()},[n,u]);const g=()=>M(void 0,null,function*(){if(u!=null&&u.questionnaireMetadata){D(!0);try{const m={questionnaireId:u.questionnaireMetadata.id,responses:Object.entries(P).map(([W,ie])=>({questionId:W,answer:ie.answer,timestamp:ie.timestamp})),ageGroup:u.questionnaireMetadata.ageGroup,questionnaireTitle:u.questionnaireMetadata.title,progressPercent:Object.keys(P).length>0?100:0,isCompleted:!0};yield T(m),S()}catch(m){x(m instanceof Error?m.message:"Submission failed")}D(!1)}}),L=Object.keys(P).length;return e.jsxs(Ke,{open:n,onClose:S,maxWidth:"lg",fullWidth:!0,PaperProps:{sx:{height:"90vh",display:"flex",flexDirection:"column"}},children:[e.jsxs(Ge,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(qe,{color:"primary"}),e.jsx(s,{variant:"h6",children:((me=u==null?void 0:u.questionnaireMetadata)==null?void 0:me.title)||"Questionnaire Preview"})]}),e.jsx(se,{onClick:S,size:"small",children:e.jsx(Tr,{})})]}),e.jsxs(Xe,{sx:{flex:1,display:"flex",flexDirection:"column",p:0},children:[(u==null?void 0:u.questionnaireMetadata)&&e.jsx(Z,{sx:{m:2,mb:1},variant:"outlined",children:e.jsxs(ee,{sx:{py:2},children:[e.jsxs(O,{direction:"row",spacing:2,alignItems:"center",flexWrap:"wrap",children:[e.jsx(C,{icon:e.jsx(dr,{}),label:u.questionnaireMetadata.ageGroup,size:"small",color:"primary"}),e.jsx(C,{icon:e.jsx(xr,{}),label:`${u.questionnaireMetadata.estimatedDuration} min`,size:"small",color:"secondary"}),e.jsx(C,{icon:e.jsx(Ps,{}),label:"Sandboxed",size:"small",color:"success"}),e.jsxs(s,{variant:"body2",color:"text.secondary",children:["v",u.questionnaireMetadata.version," by ",u.questionnaireMetadata.author]})]}),u.questionnaireMetadata.description&&e.jsx(s,{variant:"body2",sx:{mt:1},children:u.questionnaireMetadata.description})]})}),(F||y)&&e.jsx(Y,{severity:"error",sx:{m:2},children:F||y}),j&&e.jsx(r,{sx:{display:"flex",justifyContent:"center",alignItems:"center",flex:1},children:e.jsxs(O,{alignItems:"center",spacing:2,children:[e.jsx(ce,{}),e.jsx(s,{children:"Loading questionnaire..."})]})}),!j&&!F&&!y&&e.jsx(r,{sx:{flex:1,border:1,borderColor:"divider",m:2,borderRadius:1},children:e.jsx("iframe",{ref:N,style:{width:"100%",height:"100%",border:"none",borderRadius:"4px"},sandbox:"allow-scripts allow-same-origin",title:"Questionnaire Preview"})}),L>0&&e.jsx(Z,{sx:{m:2,mt:0},variant:"outlined",children:e.jsxs(ee,{sx:{py:2},children:[e.jsxs(s,{variant:"subtitle2",gutterBottom:!0,children:["Responses Collected: ",L]}),e.jsx(r,{sx:{maxHeight:100,overflow:"auto"},children:Object.entries(P).map(([m,W])=>e.jsxs(s,{variant:"body2",color:"text.secondary",children:[m,": ",JSON.stringify(W.answer).substring(0,50),"..."]},m))})]})})]}),e.jsxs(Ye,{sx:{p:2,borderTop:1,borderColor:"divider"},children:[e.jsx(k,{onClick:S,disabled:R,children:"Cancel"}),e.jsx(k,{onClick:g,variant:"contained",disabled:L===0||R,startIcon:R?e.jsx(ce,{size:16}):e.jsx(vr,{}),children:R?"Submitting...":"Submit Responses"})]})]})},Vr=()=>{var ds,ys,Ue,ss,xs,Ne;const[n,S]=o.useState(null),[u,T]=o.useState(null),[j,w]=o.useState(null),[F,x]=o.useState(!1),[P,z]=o.useState(!1),[R,D]=o.useState(null),[y,v]=o.useState([]),[N,h]=o.useState(null),[c,l]=o.useState(""),[g,L]=o.useState(!1),[me,m]=o.useState(!1),[W,ie]=o.useState(24),[b,B]=o.useState(!1),[U,ye]=o.useState(null),[Oe,ze]=o.useState(!1);o.useEffect(()=>{fe(),d(),pe(),cs()},[]);const fe=()=>M(void 0,null,function*(){try{const I=yield(yield fetch("/api/bigbook/omai/status")).json();I.success&&S(I.status)}catch(f){console.error("Failed to load OMAI status:",f)}}),d=()=>M(void 0,null,function*(){try{const I=yield(yield fetch("/api/bigbook/omai/summary")).json();I.success&&I.summary&&T(I.summary)}catch(f){console.error("Failed to load discovery summary:",f)}}),pe=()=>M(void 0,null,function*(){try{const I=yield(yield fetch("/api/bigbook/omai/index")).json();I.success&&I.index&&w(I.index)}catch(f){console.error("Failed to load Big Book index:",f)}}),fs=()=>M(void 0,null,function*(){x(!0);try{(yield(yield fetch("/api/bigbook/omai/initialize",{method:"POST"})).json()).success&&(yield fe())}catch(f){console.error("Failed to initialize OMAI:",f)}finally{x(!1)}}),ls=()=>M(void 0,null,function*(){z(!0);try{if((yield(yield fetch("/api/bigbook/omai/discover",{method:"POST"})).json()).success){const be=setInterval(()=>M(void 0,null,function*(){yield fe(),yield d(),yield pe()}),5e3);setTimeout(()=>{clearInterval(be),z(!1)},3e5)}}catch(f){console.error("Failed to start discovery:",f),z(!1)}}),Le=f=>M(void 0,null,function*(){try{const I=f.toLowerCase().replace(/[^a-z0-9]/g,"_"),ke=yield(yield fetch(`/api/bigbook/omai/category/${I}`)).json();ke.success&&(v(ke.files),D(f))}catch(I){console.error("Failed to load category files:",I)}}),Pe=f=>M(void 0,null,function*(){try{const[I,be]=yield Promise.all([fetch(`/api/bigbook/omai/file/${f}`),fetch(`/api/bigbook/omai/file/${f}/content`)]),ke=yield I.json(),bs=yield be.json();ke.success&&bs.success&&(h(ke.file),l(bs.content),L(!0))}catch(I){console.error("Failed to load file details:",I)}}),Ms=()=>M(void 0,null,function*(){try{(yield(yield fetch("/api/bigbook/omai/schedule",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({intervalHours:W})})).json()).success&&(m(!1),yield fe())}catch(f){console.error("Failed to schedule discovery:",f)}}),cs=()=>M(void 0,null,function*(){try{const I=yield(yield fetch("/api/omai/learning-status")).json();I.success&&ye(I)}catch(f){console.error("Failed to load learning status:",f)}}),Fs=()=>M(void 0,null,function*(){B(!0);try{const I=yield(yield fetch("/api/omai/learn-now",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({forceRefresh:!0})})).json();I.success?(ze(!0),yield cs()):console.error("Learning refresh failed:",I.error)}catch(f){console.error("Failed to refresh learning:",f)}finally{B(!1)}}),Se=f=>{if(f===0)return"0 Bytes";const I=1024,be=["Bytes","KB","MB","GB"],ke=Math.floor(Math.log(f)/Math.log(I));return parseFloat((f/Math.pow(I,ke)).toFixed(2))+" "+be[ke]},Es=f=>{switch(f){case"ready":return"success";case"not_initialized":return"warning";case"error":return"error";default:return"default"}},Re=f=>f.includes("DevOps")?e.jsx(he,{}):f.includes("Documentation")?e.jsx(as,{}):f.includes("Backend")?e.jsx(he,{}):f.includes("Frontend")?e.jsx(he,{}):e.jsx(Ts,{});return e.jsxs(r,{sx:{p:3},children:[e.jsx(Z,{sx:{mb:3},children:e.jsxs(ee,{children:[e.jsxs(r,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:[e.jsxs(s,{variant:"h5",component:"h2",children:[e.jsx(ps,{sx:{mr:1,verticalAlign:"middle"}}),"OMAI Path Discovery"]}),e.jsxs(r,{children:[e.jsx(k,{variant:"outlined",startIcon:e.jsx(Fe,{}),onClick:fe,sx:{mr:1},children:"Refresh"}),e.jsx(k,{variant:"contained",color:"secondary",startIcon:b?e.jsx(ce,{size:16}):e.jsx(ps,{}),onClick:Fs,disabled:b,sx:{mr:1},children:b?"Learning...":"Refresh Learning"}),e.jsx(k,{variant:"contained",startIcon:e.jsx(Pr,{}),onClick:()=>m(!0),children:"Schedule"})]})]}),n&&e.jsx(Y,{severity:Es(n.status),sx:{mb:2},children:e.jsxs(s,{variant:"body2",children:[e.jsx("strong",{children:"Status:"})," ",n.status,n.message&&` - ${n.message}`,n.totalFiles&&` | ${n.totalFiles} files indexed`,n.lastDiscovery&&` | Last discovery: ${new Date(n.lastDiscovery).toLocaleString()}`]})}),e.jsxs(r,{display:"flex",gap:2,children:[(n==null?void 0:n.status)==="not_initialized"&&e.jsx(k,{variant:"contained",startIcon:e.jsx(is,{}),onClick:fs,disabled:F,children:F?e.jsx(ce,{size:20}):"Initialize OMAI"}),(n==null?void 0:n.status)==="ready"&&e.jsx(k,{variant:"contained",startIcon:P?e.jsx(ce,{size:20}):e.jsx(tt,{}),onClick:ls,disabled:P,children:P?"Discovering...":"Start Discovery"})]})]})}),u&&e.jsx(Z,{sx:{mb:3},children:e.jsxs(ee,{children:[e.jsxs(s,{variant:"h6",gutterBottom:!0,children:[e.jsx(Ft,{sx:{mr:1,verticalAlign:"middle"}}),"Discovery Summary"]}),e.jsxs(p,{container:!0,spacing:3,children:[e.jsx(p,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(K,{sx:{p:2,textAlign:"center"},children:[e.jsx(s,{variant:"h4",color:"primary",children:u.totalFiles}),e.jsx(s,{variant:"body2",color:"text.secondary",children:"Total Files"})]})}),e.jsx(p,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(K,{sx:{p:2,textAlign:"center"},children:[e.jsx(s,{variant:"h4",color:"success.main",children:Object.keys(u.categories).length}),e.jsx(s,{variant:"body2",color:"text.secondary",children:"Categories"})]})}),e.jsx(p,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(K,{sx:{p:2,textAlign:"center"},children:[e.jsx(s,{variant:"h4",color:"info.main",children:Se(u.totalSize)}),e.jsx(s,{variant:"body2",color:"text.secondary",children:"Total Size"})]})}),e.jsx(p,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(K,{sx:{p:2,textAlign:"center"},children:[e.jsx(s,{variant:"h4",color:"warning.main",children:Se(u.averageFileSize)}),e.jsx(s,{variant:"body2",color:"text.secondary",children:"Avg File Size"})]})})]}),e.jsxs(r,{mt:3,children:[e.jsx(s,{variant:"subtitle1",gutterBottom:!0,children:"Top Categories"}),e.jsx(p,{container:!0,spacing:1,children:u.topCategories.slice(0,6).map((f,I)=>e.jsx(p,{item:!0,children:e.jsx(C,{label:`${f.category}: ${f.count}`,variant:"outlined",size:"small",clickable:!0,onClick:()=>Le(f.category)})},I))})]})]})}),j&&e.jsx(Z,{children:e.jsxs(ee,{children:[e.jsxs(s,{variant:"h6",gutterBottom:!0,children:[e.jsx(Ts,{sx:{mr:1,verticalAlign:"middle"}}),"File Index - ",j.totalFiles," Files"]}),e.jsx(r,{mb:2,children:Object.entries(j.categories).map(([f,I])=>e.jsxs(He,{children:[e.jsx(Je,{expandIcon:e.jsx(Ve,{}),children:e.jsxs(r,{display:"flex",alignItems:"center",width:"100%",children:[Re(f),e.jsx(s,{sx:{ml:1,flex:1},children:f}),e.jsx(Mr,{badgeContent:I.count,color:"primary",sx:{mr:2}})]})}),e.jsxs(Qe,{children:[e.jsx(Ws,{children:e.jsxs(_s,{size:"small",children:[e.jsx(qs,{children:e.jsxs(rs,{children:[e.jsx(q,{children:"Name"}),e.jsx(q,{children:"Type"}),e.jsx(q,{children:"Size"}),e.jsx(q,{children:"Modified"}),e.jsx(q,{children:"Actions"})]})}),e.jsx(Hs,{children:I.files.slice(0,10).map(be=>e.jsxs(rs,{children:[e.jsx(q,{children:e.jsx(s,{variant:"body2",noWrap:!0,children:be.name})}),e.jsx(q,{children:e.jsx(C,{label:be.type,size:"small",variant:"outlined"})}),e.jsx(q,{children:Se(be.size)}),e.jsx(q,{children:new Date(be.modified).toLocaleDateString()}),e.jsx(q,{children:e.jsx(se,{size:"small",onClick:()=>Pe(be.id),children:e.jsx(Ze,{})})})]},be.id))})]})}),I.files.length>10&&e.jsxs(s,{variant:"caption",sx:{mt:1,display:"block"},children:["Showing 10 of ",I.files.length," files"]})]})]},f))})]})}),e.jsxs(Ke,{open:g,onClose:()=>L(!1),maxWidth:"lg",fullWidth:!0,children:[e.jsxs(Ge,{children:[N==null?void 0:N.name,(N==null?void 0:N.metadata.security.hasSecurityIssues)&&e.jsx(C,{icon:e.jsx(Ps,{}),label:"Security Redacted",color:"warning",size:"small",sx:{ml:2}})]}),e.jsx(Xe,{children:N&&e.jsxs(r,{children:[e.jsxs(p,{container:!0,spacing:2,mb:3,children:[e.jsxs(p,{item:!0,xs:12,sm:6,children:[e.jsx(s,{variant:"subtitle2",children:"Classification"}),e.jsx(s,{variant:"body2",children:N.classification.type}),e.jsx(s,{variant:"body2",color:"text.secondary",children:N.classification.category})]}),e.jsxs(p,{item:!0,xs:12,sm:6,children:[e.jsx(s,{variant:"subtitle2",children:"File Stats"}),e.jsxs(s,{variant:"body2",children:[N.metadata.fileStats.lines," lines, "," ",N.metadata.fileStats.words," words, "," ",Se(N.size)]})]})]}),e.jsx(s,{variant:"subtitle2",gutterBottom:!0,children:"Content Preview"}),e.jsx(Ce,{multiline:!0,rows:20,fullWidth:!0,variant:"outlined",value:c,InputProps:{readOnly:!0,sx:{fontFamily:"monospace",fontSize:"0.875rem"}}})]})}),e.jsx(Ye,{children:e.jsx(k,{onClick:()=>L(!1),children:"Close"})})]}),e.jsxs(Ke,{open:Oe,onClose:()=>ze(!1),maxWidth:"md",fullWidth:!0,children:[e.jsxs(Ge,{children:[e.jsx(ps,{sx:{mr:1,verticalAlign:"middle"}}),"OMAI Learning Refresh Complete"]}),e.jsx(Xe,{children:U&&e.jsxs(r,{children:[e.jsx(Y,{severity:"success",sx:{mb:2},children:"Learning refresh completed successfully! OMAI has updated its knowledge base."}),e.jsxs(p,{container:!0,spacing:2,children:[e.jsxs(p,{item:!0,xs:12,sm:6,children:[e.jsx(s,{variant:"subtitle2",gutterBottom:!0,children:"Learning Status"}),e.jsxs(s,{variant:"body2",children:["Active: ",(ds=U.learning)!=null&&ds.isActive?"Yes":"No"]}),e.jsxs(s,{variant:"body2",children:["Last Run: ",(ys=U.learning)!=null&&ys.lastRun?new Date(U.learning.lastRun).toLocaleString():"Never"]}),e.jsxs(s,{variant:"body2",children:["Files Processed: ",((Ue=U.learning)==null?void 0:Ue.totalFilesProcessed)||0]}),e.jsxs(s,{variant:"body2",children:["Memory Cache: ",((ss=U.learning)==null?void 0:ss.memoryCacheSize)||0," entries"]})]}),e.jsxs(p,{item:!0,xs:12,sm:6,children:[e.jsx(s,{variant:"subtitle2",gutterBottom:!0,children:"Learning Sources"}),e.jsx(Me,{dense:!0,children:U.sources&&Object.entries(U.sources).map(([f,I])=>e.jsx(xe,{divider:!0,children:e.jsx(ue,{primary:I.path,secondary:`${I.type} (${I.priority} priority)`})},f))})]})]}),e.jsxs(r,{mt:2,children:[e.jsx(s,{variant:"subtitle2",gutterBottom:!0,children:"Registered OMAI Agents"}),e.jsx(r,{children:(Ne=(xs=U.agents)==null?void 0:xs.registered)==null?void 0:Ne.map(f=>e.jsx(C,{label:f,size:"small",sx:{mr:1,mb:1}},f))})]})]})}),e.jsx(Ye,{children:e.jsx(k,{onClick:()=>ze(!1),children:"Close"})})]}),e.jsxs(Ke,{open:me,onClose:()=>m(!1),children:[e.jsx(Ge,{children:"Schedule Discovery"}),e.jsx(Xe,{children:e.jsx(Ce,{autoFocus:!0,margin:"dense",label:"Interval (hours)",type:"number",fullWidth:!0,variant:"outlined",value:W,onChange:f=>ie(parseInt(f.target.value)||24),helperText:"How often should OMAI scan for new/changed files?"})}),e.jsxs(Ye,{children:[e.jsx(k,{onClick:()=>m(!1),children:"Cancel"}),e.jsx(k,{onClick:Ms,variant:"contained",children:"Schedule"})]})]})]})},Kr=({open:n,onClose:S,file:u,onInstallComplete:T,onConsoleMessage:j})=>{const[w,F]=o.useState(0),[x,P]=o.useState(null),[z,R]=o.useState(!1),[D,y]=o.useState({targetDirectory:"src/components/",installMissingPackages:!0,registerInRegistry:!0,openPreview:!0,overwriteExisting:!1,bigBookAutoInstall:!1}),[v,N]=o.useState(null),[h,c]=o.useState(["src/components/","src/components/admin/","@/shared/ui/","src/components/custom/","src/pages/","src/views/","src/addons/"]),l=["Parse & Validate","Configure Installation","Install Component"];o.useEffect(()=>{n&&u&&w===0&&g()},[n,u,w]);const g=()=>M(void 0,null,function*(){var b;if(u){R(!0),j("info",`ðŸ” Parsing .tsx file: ${u.name}`);try{const B=yield u.text(),U=yield fetch("/api/bigbook/parse-tsx-component",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({fileName:u.name,content:B})});if(U.status===401||U.status===403){j("error","ðŸ” Authentication required: Please log in as super_admin or editor to use Big Book auto-install");return}if(!U.ok){j("error",`âŒ Server error: HTTP ${U.status} - ${U.statusText}`);return}const ye=yield U.json();ye.success?(P(ye.componentInfo),j("success",`âœ… Component parsed successfully: ${ye.componentInfo.componentName}`),ye.componentInfo.warnings.length>0&&ye.componentInfo.warnings.forEach(Oe=>{j("warning",`âš ï¸ ${Oe}`)}),F(1)):(j("error",`âŒ Failed to parse component: ${ye.error}`),(b=ye.errors)==null||b.forEach(Oe=>{j("error",`âŒ ${Oe}`)}))}catch(B){j("error",`âŒ Parse error: ${B instanceof Error?B.message:"Unknown error"}`)}finally{R(!1)}}}),L=()=>M(void 0,null,function*(){if(x){R(!0),F(2),j("info",`ðŸš€ Installing component: ${x.componentName}`);try{const b=D.bigBookAutoInstall?"/api/bigbook/install-bigbook-component":"/api/bigbook/install-tsx-component";j("info",D.bigBookAutoInstall?"ðŸ“š Installing as Big Book custom component with auto-menu integration...":"ðŸ§© Installing as standard TSX component...");const U=yield(yield fetch(b,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({componentInfo:x,installOptions:D})})).json();U.success?(N(U),j("success","ðŸŽ‰ Component installed successfully!"),j("info",`ðŸ“ Location: ${U.installedPath}`),U.packagesInstalled&&U.packagesInstalled.length>0&&j("success",`ðŸ“¦ Packages installed: ${U.packagesInstalled.join(", ")}`),U.registryUpdated&&j("success","ðŸ“ Component registered in registry"),U.menuUpdated&&j("success","ðŸ§© Component added to Big Book sidebar menu"),D.openPreview&&U.previewUrl&&j("info",`ðŸ”— Preview available at: ${U.previewUrl}`),T(U)):j("error",`âŒ Installation failed: ${U.error}`)}catch(b){j("error",`âŒ Installation error: ${b instanceof Error?b.message:"Unknown error"}`)}finally{R(!1)}}}),me=()=>M(void 0,null,function*(){if(v){R(!0),j("info",`ðŸ—‘ï¸ Removing component: ${x==null?void 0:x.componentName}`);try{const b=D.bigBookAutoInstall?"/api/bigbook/remove-bigbook-component":"/api/bigbook/remove-tsx-component",U=yield(yield fetch(b,{method:"DELETE",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({installationResult:v})})).json();U.success?(j("success","âœ… Component removed successfully"),N(null),F(1)):j("error",`âŒ Removal failed: ${U.error}`)}catch(b){j("error",`âŒ Removal error: ${b instanceof Error?b.message:"Unknown error"}`)}finally{R(!1)}}}),m=()=>e.jsx(r,{sx:{mt:2},children:z?e.jsxs(r,{display:"flex",alignItems:"center",justifyContent:"center",py:4,children:[e.jsx(ce,{sx:{mr:2}}),e.jsx(s,{children:"Parsing component file..."})]}):x?e.jsxs(r,{children:[e.jsxs(Y,{severity:x.isValid?"success":"error",sx:{mb:2},children:[e.jsx(s,{variant:"h6",children:x.isValid?"Valid React Component":"Invalid Component"}),e.jsxs(s,{variant:"body2",children:[x.componentName," (",x.size," bytes)"]})]}),e.jsxs(p,{container:!0,spacing:2,children:[e.jsx(p,{item:!0,xs:12,md:6,children:e.jsx(Z,{children:e.jsxs(ee,{children:[e.jsxs(s,{variant:"h6",gutterBottom:!0,children:[e.jsx(he,{sx:{mr:1,verticalAlign:"middle"}}),"Component Details"]}),e.jsxs(Me,{dense:!0,children:[e.jsx(xe,{children:e.jsx(ue,{primary:"Component Name",secondary:x.componentName})}),e.jsx(xe,{children:e.jsx(ue,{primary:"Export Type",secondary:x.isDefaultExport?"Default Export":"Named Export"})}),e.jsx(xe,{children:e.jsx(ue,{primary:"Uses JSX",secondary:x.hasJSX?"Yes":"No"})}),e.jsx(xe,{children:e.jsx(ue,{primary:"Uses Hooks",secondary:x.hasHooks?"Yes":"No"})})]})]})})}),e.jsx(p,{item:!0,xs:12,md:6,children:e.jsx(Z,{children:e.jsxs(ee,{children:[e.jsxs(s,{variant:"h6",gutterBottom:!0,children:[e.jsx(Ds,{sx:{mr:1,verticalAlign:"middle"}}),"Dependencies"]}),x.imports.length>0?e.jsxs(r,{sx:{mb:2},children:[e.jsx(s,{variant:"subtitle2",gutterBottom:!0,children:"Imports:"}),x.imports.map((b,B)=>e.jsx(C,{label:b,size:"small",sx:{mr:.5,mb:.5}},B))]}):null,x.missingPackages.length>0?e.jsxs(r,{children:[e.jsx(s,{variant:"subtitle2",gutterBottom:!0,color:"warning.main",children:"Missing Packages:"}),x.missingPackages.map((b,B)=>e.jsx(C,{label:b,size:"small",color:"warning",sx:{mr:.5,mb:.5}},B))]}):e.jsx(s,{variant:"body2",color:"success.main",children:"All dependencies available"})]})})})]}),(x.errors.length>0||x.warnings.length>0)&&e.jsxs(He,{sx:{mt:2},children:[e.jsx(Je,{expandIcon:e.jsx(Ve,{}),children:e.jsxs(s,{children:["Issues (",x.errors.length," errors, ",x.warnings.length," warnings)"]})}),e.jsxs(Qe,{children:[x.errors.map((b,B)=>e.jsx(Y,{severity:"error",sx:{mb:1},children:b},B)),x.warnings.map((b,B)=>e.jsx(Y,{severity:"warning",sx:{mb:1},children:b},B))]})]})]}):e.jsx(Y,{severity:"info",children:"Drop a .tsx file to begin parsing..."})}),W=()=>e.jsxs(r,{sx:{mt:2},children:[e.jsx(s,{variant:"h6",gutterBottom:!0,children:"Installation Configuration"}),e.jsxs(p,{container:!0,spacing:3,children:[e.jsx(p,{item:!0,xs:12,children:e.jsx(K,{sx:{p:2,mb:2,bgcolor:"primary.50",border:"1px solid",borderColor:"primary.200"},children:e.jsx(de,{control:e.jsx(le,{checked:D.bigBookAutoInstall,onChange:b=>{const B=b.target.checked;y(U=>V(Q({},U),{bigBookAutoInstall:B,targetDirectory:B?"src/components/bigbook/custom":"src/components/",registerInRegistry:!0}))},color:"primary"}),label:e.jsxs(r,{children:[e.jsx(s,{variant:"subtitle1",fontWeight:600,color:"primary.main",children:"ðŸš€ Big Book Auto-Install Mode"}),e.jsx(s,{variant:"body2",color:"text.secondary",children:"Install as Big Book custom component with automatic menu integration and routing"})]})})})}),e.jsx(p,{item:!0,xs:12,children:e.jsxs($e,{fullWidth:!0,children:[e.jsx(kt,{children:"Target Directory"}),e.jsx(Ce,{select:!0,value:D.targetDirectory,onChange:b=>y(B=>V(Q({},B),{targetDirectory:b.target.value})),SelectProps:{native:!0},sx:{mt:1},disabled:D.bigBookAutoInstall,helperText:D.bigBookAutoInstall?"Directory is automatically set for Big Book components":"Choose where to install the component",children:h.map(b=>e.jsx("option",{value:b,children:b},b))})]})}),e.jsx(p,{item:!0,xs:12,children:e.jsxs(K,{sx:{p:2},children:[e.jsx(s,{variant:"subtitle1",gutterBottom:!0,children:"Installation Options"}),e.jsx(de,{control:e.jsx(le,{checked:D.installMissingPackages,onChange:b=>y(B=>V(Q({},B),{installMissingPackages:b.target.checked}))}),label:e.jsxs(r,{children:[e.jsx(s,{variant:"body2",children:"Install Missing NPM Packages"}),e.jsx(s,{variant:"caption",color:"text.secondary",children:"Automatically install any missing dependencies"})]})}),e.jsx(de,{control:e.jsx(le,{checked:D.registerInRegistry,onChange:b=>y(B=>V(Q({},B),{registerInRegistry:b.target.checked}))}),label:e.jsxs(r,{children:[e.jsx(s,{variant:"body2",children:"Register in Component Registry"}),e.jsx(s,{variant:"caption",color:"text.secondary",children:"Add component to the system registry for discovery"})]})}),e.jsx(de,{control:e.jsx(le,{checked:D.openPreview,onChange:b=>y(B=>V(Q({},B),{openPreview:b.target.checked}))}),label:e.jsxs(r,{children:[e.jsx(s,{variant:"body2",children:"Open Component Preview"}),e.jsx(s,{variant:"caption",color:"text.secondary",children:"Launch component preview after installation"})]})}),e.jsx(de,{control:e.jsx(le,{checked:D.overwriteExisting,onChange:b=>y(B=>V(Q({},B),{overwriteExisting:b.target.checked}))}),label:e.jsxs(r,{children:[e.jsx(s,{variant:"body2",children:"Overwrite Existing Files"}),e.jsx(s,{variant:"caption",color:"text.secondary",children:"Replace files if they already exist"})]})})]})})]})]}),ie=()=>{var b;return e.jsx(r,{sx:{mt:2},children:z?e.jsxs(r,{display:"flex",alignItems:"center",justifyContent:"center",py:4,children:[e.jsx(ce,{sx:{mr:2}}),e.jsx(s,{children:"Installing component..."})]}):v?e.jsxs(r,{children:[e.jsxs(Y,{severity:"success",sx:{mb:2},children:[e.jsx(s,{variant:"h6",children:"Component Installed Successfully!"}),e.jsxs(s,{variant:"body2",children:[x==null?void 0:x.componentName," has been installed to ",v.installedPath]})]}),e.jsxs(p,{container:!0,spacing:2,children:[e.jsx(p,{item:!0,xs:12,md:6,children:e.jsx(Z,{children:e.jsxs(ee,{children:[e.jsx(s,{variant:"h6",gutterBottom:!0,children:"Installation Summary"}),e.jsxs(Me,{dense:!0,children:[e.jsxs(xe,{children:[e.jsx(Be,{children:e.jsx(Ts,{})}),e.jsx(ue,{primary:"Installed to",secondary:v.installedPath})]}),((b=v.packagesInstalled)==null?void 0:b.length)>0&&e.jsxs(xe,{children:[e.jsx(Be,{children:e.jsx(Ds,{})}),e.jsx(ue,{primary:"Packages Installed",secondary:v.packagesInstalled.join(", ")})]}),v.registryUpdated&&e.jsxs(xe,{children:[e.jsx(Be,{children:e.jsx(os,{})}),e.jsx(ue,{primary:"Registry Updated",secondary:"Component added to registry"})]})]})]})})}),e.jsx(p,{item:!0,xs:12,md:6,children:e.jsx(Z,{children:e.jsxs(ee,{children:[e.jsx(s,{variant:"h6",gutterBottom:!0,children:"Quick Actions"}),e.jsxs(r,{sx:{display:"flex",flexDirection:"column",gap:1},children:[v.previewUrl&&e.jsx(k,{variant:"outlined",startIcon:e.jsx(Ze,{}),onClick:()=>window.open(v.previewUrl,"_blank"),children:"View Component Preview"}),e.jsx(k,{variant:"outlined",color:"error",startIcon:e.jsx(Mt,{}),onClick:me,disabled:z,children:"Remove Component"})]})]})})})]})]}):e.jsx(Y,{severity:"info",children:"Ready to install component..."})})};return e.jsxs(Ke,{open:n,onClose:S,maxWidth:"md",fullWidth:!0,children:[e.jsx(Ge,{children:e.jsxs(r,{display:"flex",alignItems:"center",children:[e.jsx(Ss,{sx:{mr:1}}),"TSX Component Installation"]})}),e.jsxs(Xe,{children:[e.jsx(Fr,{activeStep:w,sx:{mb:3},children:l.map(b=>e.jsx(Er,{children:e.jsx(Ar,{children:b})},b))}),w===0&&m(),w===1&&W(),w===2&&ie()]}),e.jsxs(Ye,{children:[e.jsx(k,{onClick:S,children:v?"Close":"Cancel"}),w>0&&!v&&e.jsx(k,{onClick:()=>F(w-1),children:"Previous"}),w===0&&!x&&e.jsx(k,{variant:"contained",onClick:g,disabled:z||!u,startIcon:z?e.jsx(ce,{size:20}):e.jsx(he,{}),children:"Parse Component"}),w===0&&(x==null?void 0:x.isValid)&&e.jsx(k,{variant:"contained",onClick:()=>F(1),children:"Next: Configure"}),w===1&&x&&e.jsx(k,{variant:"contained",onClick:()=>F(2),disabled:!x.isValid,children:"Next: Install Component"}),w===2&&(x==null?void 0:x.isValid)&&!v&&e.jsx(k,{variant:"contained",onClick:L,disabled:z,startIcon:z?e.jsx(ce,{size:20}):e.jsx(Ds,{}),color:"primary",children:"Install Component"})]})]})};class Gr extends o.Component{constructor(S){super(S),this.state={hasError:!1}}static getDerivedStateFromError(S){return{hasError:!0}}componentDidCatch(S,u){console.error("ErrorBoundary caught an error:",S,u)}render(){return this.state.hasError?this.props.fallback:this.props.children}}const Xr=({componentName:n,onBack:S,onError:u})=>{const[T,j]=o.useState(!0),[w,F]=o.useState(null),[x,P]=o.useState(null),[z,R]=o.useState(null);o.useEffect(()=>{D()},[n]);const D=()=>M(void 0,null,function*(){j(!0),F(null);try{const v=yield fetch("/api/bigbook/custom-components-registry",{credentials:"include"});if(!v.ok)throw new Error("Failed to load custom components registry");const h=(yield v.json()).components[n];if(!h)throw new Error(`Component "${n}" not found in registry`);P(h);try{const c=h.path.replace("src/","../");console.log(`ðŸ“¦ Importing component from: ${c}`);const l=yield import(c);let g;if(h.isDefaultExport?g=l.default:g=l[h.name],!g)throw new Error(`Component "${n}" not found in module`);console.log("ðŸŽ‰ Component imported successfully"),R(()=>g)}catch(c){throw console.error("Component import error:",c),new Error(`Failed to load component: ${c instanceof Error?c.message:"Unknown error"}`)}}catch(v){const N=v instanceof Error?v.message:"Unknown error occurred";F(N),u==null||u(N)}finally{j(!1)}}),y=()=>{D()};return T?e.jsxs(r,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:300,flexDirection:"column",gap:2,children:[e.jsx(ce,{}),e.jsxs(s,{variant:"body2",color:"text.secondary",children:["Loading custom component: ",n]})]}):w?e.jsxs(r,{sx:{p:3},children:[e.jsxs(r,{display:"flex",alignItems:"center",gap:1,mb:2,children:[e.jsx(se,{onClick:S,size:"small",children:e.jsx(gt,{})}),e.jsx(s,{variant:"h6",children:"Custom Component Error"})]}),e.jsxs(Y,{severity:"error",sx:{mb:2},action:e.jsx(ae,{title:"Retry loading component",children:e.jsx(se,{color:"inherit",size:"small",onClick:y,children:e.jsx(Fe,{fontSize:"inherit"})})}),children:[e.jsxs(s,{variant:"subtitle2",gutterBottom:!0,children:["Failed to load component: ",n]}),e.jsx(s,{variant:"body2",children:w})]}),e.jsx(s,{variant:"body2",color:"text.secondary",children:"This usually happens when:"}),e.jsxs(r,{component:"ul",sx:{mt:1,mb:2},children:[e.jsx("li",{children:"The component file was moved or deleted"}),e.jsx("li",{children:"There are syntax errors in the component"}),e.jsx("li",{children:"Required dependencies are missing"}),e.jsx("li",{children:"The component export doesn't match the registry"})]})]}):e.jsxs(r,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[e.jsxs(K,{sx:{p:2,mb:2},children:[e.jsxs(r,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[e.jsxs(r,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(se,{onClick:S,size:"small",children:e.jsx(gt,{})}),e.jsxs(Rr,{children:[e.jsx($r,{color:"inherit",href:"#",onClick:v=>{v.preventDefault(),S()},sx:{cursor:"pointer"},children:"Big Book"}),e.jsx(s,{color:"text.primary",children:"Custom Components"}),e.jsx(s,{color:"text.primary",fontWeight:600,children:(x==null?void 0:x.displayName)||n})]})]}),e.jsx(r,{display:"flex",alignItems:"center",gap:1,children:e.jsx(ae,{title:"Refresh component",children:e.jsx(se,{onClick:y,size:"small",children:e.jsx(Fe,{})})})})]}),(x==null?void 0:x.description)&&e.jsx(s,{variant:"body2",color:"text.secondary",sx:{mt:1},children:x.description})]}),e.jsx(K,{sx:{flex:1,p:2,overflow:"auto"},children:e.jsx(o.Suspense,{fallback:e.jsx(r,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:200,children:e.jsx(ce,{})}),children:z?e.jsx(Gr,{fallback:e.jsxs(Y,{severity:"error",sx:{mt:2},children:[e.jsx(s,{variant:"subtitle2",gutterBottom:!0,children:"Component Runtime Error"}),e.jsxs(s,{variant:"body2",children:['The component "',n,'" encountered an error during rendering. Check the browser console for more details.']})]}),children:e.jsx(z,{})}):e.jsx(Y,{severity:"warning",children:e.jsxs(s,{variant:"body2",children:['Component "',n,'" loaded but is not renderable.']})})})})]})},Yr=()=>{const[n,S]=o.useState([]),[u,T]=o.useState(!1),[j,w]=o.useState(null),[F,x]=o.useState({}),[P,z]=o.useState(1),[R,D]=o.useState(1),[y,v]=o.useState(null),[N,h]=o.useState(!1),[c,l]=o.useState("create"),[g,L]=o.useState({title:"",content:"",category:"",priority:"medium",tags:[],access_level:"private",expires_at:""}),me=["learning","user_preference","system","analytics","tasks","knowledge"],m=["low","medium","high","critical"],W=["private","shared","public"];o.useEffect(()=>{ie()},[F,P]);const ie=()=>M(void 0,null,function*(){T(!0),w(null);try{console.log("Loading OMAI memories...",{filters:F,page:P}),yield new Promise(pe=>setTimeout(pe,500)),S([{id:"1",title:"User prefers dark mode",content:"The user consistently chooses dark mode themes and mentions preference for low-light interfaces.",category:"user_preference",priority:"medium",tags:["ui","theme","accessibility"],access_level:"private",usage_count:15,last_accessed_at:"2025-01-29T10:30:00Z",is_active:!0,created_at:"2025-01-20T09:00:00Z",updated_at:"2025-01-29T10:30:00Z"},{id:"2",title:"Church management workflow insights",content:"User frequently manages multiple churches and prefers bulk operations for administrative tasks.",category:"learning",priority:"high",tags:["workflow","admin","churches"],access_level:"shared",usage_count:8,last_accessed_at:"2025-01-28T14:20:00Z",is_active:!0,created_at:"2025-01-15T11:00:00Z",updated_at:"2025-01-28T14:20:00Z"},{id:"3",title:"OMAI training progress checkpoint",content:"Completed Phase 1 foundation training with 85% accuracy on site understanding tasks.",category:"system",priority:"high",tags:["training","checkpoint","progress"],access_level:"private",usage_count:3,is_active:!0,created_at:"2025-01-25T16:45:00Z",updated_at:"2025-01-25T16:45:00Z"}]),D(1)}catch(d){w(d instanceof Error?d.message:"Failed to load memories")}finally{T(!1)}}),b=()=>{L({title:"",content:"",category:"",priority:"medium",tags:[],access_level:"private",expires_at:""}),l("create"),h(!0)},B=d=>{L({title:d.title,content:d.content,category:d.category,priority:d.priority,tags:d.tags,access_level:d.access_level,expires_at:d.expires_at||""}),v(d),l("edit"),h(!0)},U=d=>{v(d),l("view"),h(!0)},ye=()=>M(void 0,null,function*(){try{console.log("Saving memory:",g),yield new Promise(d=>setTimeout(d,500)),h(!1),ie()}catch(d){w(d instanceof Error?d.message:"Failed to save memory")}}),Oe=d=>M(void 0,null,function*(){if(confirm("Are you sure you want to delete this memory?"))try{console.log("Deleting memory:",d),yield new Promise(pe=>setTimeout(pe,500)),ie()}catch(pe){w(pe instanceof Error?pe.message:"Failed to delete memory")}}),ze=d=>{switch(d){case"critical":return"error";case"high":return"warning";case"medium":return"info";case"low":return"default";default:return"default"}},fe=d=>{switch(d){case"public":return"ðŸŒ";case"shared":return"ðŸ‘¥";case"private":return"ðŸ”’";default:return"ðŸ“„"}};return e.jsxs(r,{sx:{p:3},children:[e.jsxs(r,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,children:[e.jsxs(r,{children:[e.jsxs(s,{variant:"h5",component:"h2",gutterBottom:!0,children:[e.jsx(Js,{sx:{mr:1,verticalAlign:"middle"}}),"OMAI Memory Management"]}),e.jsx(s,{variant:"body2",color:"text.secondary",children:"Store and manage OMAI's learning memories, preferences, and knowledge"})]}),e.jsxs(O,{direction:"row",spacing:2,children:[e.jsx(k,{variant:"outlined",startIcon:e.jsx(Fe,{}),onClick:ie,disabled:u,children:"Refresh"}),e.jsx(k,{variant:"contained",startIcon:e.jsx(ft,{}),onClick:b,children:"Add Memory"})]})]}),e.jsx(Z,{sx:{mb:3},children:e.jsxs(ee,{children:[e.jsxs(s,{variant:"h6",gutterBottom:!0,children:[e.jsx(zr,{sx:{mr:1,verticalAlign:"middle"}}),"Filters"]}),e.jsxs(p,{container:!0,spacing:2,children:[e.jsx(p,{item:!0,xs:12,md:3,children:e.jsx(Ce,{fullWidth:!0,label:"Search",placeholder:"Search memories...",value:F.search||"",onChange:d=>x(V(Q({},F),{search:d.target.value})),InputProps:{startAdornment:e.jsx(tt,{sx:{mr:1,color:"text.secondary"}})}})}),e.jsx(p,{item:!0,xs:12,md:3,children:e.jsxs($e,{fullWidth:!0,children:[e.jsx(We,{children:"Category"}),e.jsxs(_e,{value:F.category||"",label:"Category",onChange:d=>x(V(Q({},F),{category:d.target.value})),children:[e.jsx(ge,{value:"",children:"All Categories"}),me.map(d=>e.jsx(ge,{value:d,children:d},d))]})]})}),e.jsx(p,{item:!0,xs:12,md:3,children:e.jsxs($e,{fullWidth:!0,children:[e.jsx(We,{children:"Priority"}),e.jsxs(_e,{value:F.priority||"",label:"Priority",onChange:d=>x(V(Q({},F),{priority:d.target.value})),children:[e.jsx(ge,{value:"",children:"All Priorities"}),m.map(d=>e.jsx(ge,{value:d,children:d},d))]})]})}),e.jsx(p,{item:!0,xs:12,md:3,children:e.jsxs($e,{fullWidth:!0,children:[e.jsx(We,{children:"Status"}),e.jsxs(_e,{value:F.is_active===void 0?"":F.is_active?"active":"inactive",label:"Status",onChange:d=>x(V(Q({},F),{is_active:d.target.value===""?void 0:d.target.value==="active"})),children:[e.jsx(ge,{value:"",children:"All"}),e.jsx(ge,{value:"active",children:"Active"}),e.jsx(ge,{value:"inactive",children:"Inactive"})]})]})})]})]})}),j&&e.jsx(Y,{severity:"error",sx:{mb:2},onClose:()=>w(null),children:j}),u?e.jsxs(r,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"300px",children:[e.jsx(ce,{}),e.jsx(s,{variant:"body1",sx:{ml:2},children:"Loading memories..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(p,{container:!0,spacing:2,children:n.map(d=>e.jsx(p,{item:!0,xs:12,md:6,lg:4,children:e.jsx(Z,{children:e.jsxs(ee,{children:[e.jsxs(r,{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:2,children:[e.jsx(s,{variant:"h6",component:"h3",noWrap:!0,sx:{flex:1,mr:1},children:d.title}),e.jsxs(r,{display:"flex",gap:.5,children:[e.jsx(ae,{title:"View Memory",children:e.jsx(se,{size:"small",onClick:()=>U(d),children:e.jsx(Ze,{})})}),e.jsx(ae,{title:"Edit Memory",children:e.jsx(se,{size:"small",onClick:()=>B(d),children:e.jsx(Dr,{})})}),e.jsx(ae,{title:"Delete Memory",children:e.jsx(se,{size:"small",onClick:()=>Oe(d.id),children:e.jsx(gs,{})})})]})]}),e.jsx(s,{variant:"body2",color:"text.secondary",sx:{mb:2},children:d.content.length>100?`${d.content.substring(0,100)}...`:d.content}),e.jsxs(r,{display:"flex",flexWrap:"wrap",gap:1,mb:2,children:[e.jsx(C,{label:d.category,size:"small",icon:e.jsx(Ts,{}),variant:"outlined"}),e.jsx(C,{label:d.priority,size:"small",color:ze(d.priority)}),e.jsx(C,{label:`${fe(d.access_level)} ${d.access_level}`,size:"small",variant:"outlined"})]}),e.jsx(r,{display:"flex",flexWrap:"wrap",gap:.5,mb:2,children:d.tags.map(pe=>e.jsx(C,{label:pe,size:"small",icon:e.jsx(ur,{}),variant:"outlined"},pe))}),e.jsxs(r,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsxs(s,{variant:"caption",color:"text.secondary",children:["Used ",d.usage_count," times"]}),e.jsx(s,{variant:"caption",color:"text.secondary",children:new Date(d.created_at).toLocaleDateString()})]})]})})},d.id))}),n.length===0&&!u&&e.jsxs(r,{textAlign:"center",py:6,children:[e.jsx(Js,{sx:{fontSize:64,color:"text.secondary",mb:2}}),e.jsx(s,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"No memories found"}),e.jsx(s,{variant:"body2",color:"text.secondary",sx:{mb:3},children:"Start by creating your first OMAI memory to help the system learn and remember important information."}),e.jsx(k,{variant:"contained",startIcon:e.jsx(ft,{}),onClick:b,children:"Create First Memory"})]}),R>1&&e.jsx(r,{display:"flex",justifyContent:"center",mt:3,children:e.jsx(Br,{count:R,page:P,onChange:(d,pe)=>z(pe),color:"primary"})})]}),e.jsxs(Ke,{open:N,onClose:()=>h(!1),maxWidth:"md",fullWidth:!0,children:[e.jsxs(Ge,{children:[c==="create"&&"Create New Memory",c==="edit"&&"Edit Memory",c==="view"&&"Memory Details"]}),e.jsx(Xe,{children:c==="view"&&y?e.jsxs(r,{children:[e.jsx(s,{variant:"h6",gutterBottom:!0,children:y.title}),e.jsx(s,{variant:"body1",paragraph:!0,children:y.content}),e.jsx(ns,{sx:{my:2}}),e.jsxs(p,{container:!0,spacing:2,children:[e.jsxs(p,{item:!0,xs:6,children:[e.jsx(s,{variant:"subtitle2",children:"Category"}),e.jsx(s,{variant:"body2",children:y.category})]}),e.jsxs(p,{item:!0,xs:6,children:[e.jsx(s,{variant:"subtitle2",children:"Priority"}),e.jsx(s,{variant:"body2",children:y.priority})]}),e.jsxs(p,{item:!0,xs:6,children:[e.jsx(s,{variant:"subtitle2",children:"Access Level"}),e.jsx(s,{variant:"body2",children:y.access_level})]}),e.jsxs(p,{item:!0,xs:6,children:[e.jsx(s,{variant:"subtitle2",children:"Usage Count"}),e.jsx(s,{variant:"body2",children:y.usage_count})]})]}),e.jsxs(r,{mt:2,children:[e.jsx(s,{variant:"subtitle2",children:"Tags"}),e.jsx(r,{display:"flex",flexWrap:"wrap",gap:1,mt:1,children:y.tags.map(d=>e.jsx(C,{label:d,size:"small"},d))})]})]}):e.jsxs(O,{spacing:3,sx:{mt:2},children:[e.jsx(Ce,{fullWidth:!0,label:"Title",value:g.title,onChange:d=>L(V(Q({},g),{title:d.target.value})),disabled:c==="view"}),e.jsx(Ce,{fullWidth:!0,label:"Content",multiline:!0,rows:4,value:g.content,onChange:d=>L(V(Q({},g),{content:d.target.value})),disabled:c==="view"}),e.jsxs(p,{container:!0,spacing:2,children:[e.jsx(p,{item:!0,xs:6,children:e.jsxs($e,{fullWidth:!0,children:[e.jsx(We,{children:"Category"}),e.jsx(_e,{value:g.category,label:"Category",onChange:d=>L(V(Q({},g),{category:d.target.value})),disabled:c==="view",children:me.map(d=>e.jsx(ge,{value:d,children:d},d))})]})}),e.jsx(p,{item:!0,xs:6,children:e.jsxs($e,{fullWidth:!0,children:[e.jsx(We,{children:"Priority"}),e.jsx(_e,{value:g.priority,label:"Priority",onChange:d=>L(V(Q({},g),{priority:d.target.value})),disabled:c==="view",children:m.map(d=>e.jsx(ge,{value:d,children:d},d))})]})})]}),e.jsxs($e,{fullWidth:!0,children:[e.jsx(We,{children:"Access Level"}),e.jsx(_e,{value:g.access_level,label:"Access Level",onChange:d=>L(V(Q({},g),{access_level:d.target.value})),disabled:c==="view",children:W.map(d=>e.jsx(ge,{value:d,children:d},d))})]}),e.jsx(Ce,{fullWidth:!0,label:"Tags (comma-separated)",value:g.tags.join(", "),onChange:d=>L(V(Q({},g),{tags:d.target.value.split(",").map(pe=>pe.trim()).filter(Boolean)})),disabled:c==="view",helperText:"Enter tags separated by commas"})]})}),e.jsxs(Ye,{children:[e.jsx(k,{onClick:()=>h(!1),children:c==="view"?"Close":"Cancel"}),c!=="view"&&e.jsx(k,{variant:"contained",onClick:ye,children:c==="create"?"Create":"Save"})]})]})]})},aa=()=>{const[n,S]=o.useState(0),[u,T]=o.useState([]),[j,w]=o.useState([]),[F,x]=o.useState(!1),[P,z]=o.useState(null),[R,D]=o.useState(!1),[y,v]=o.useState({databaseUser:"root",databasePassword:"",useSudo:!0,sudoPassword:"",defaultDatabase:"omai_db",scriptTimeout:3e4,maxFileSize:10485760}),[N,h]=o.useState(Qs),[c,l]=o.useState(!1),[g,L]=o.useState(null),[me,m]=o.useState(null),[W,ie]=o.useState(!1),[b,B]=o.useState(null),[U,ye]=o.useState(!1),[Oe,ze]=o.useState(null),[fe,d]=o.useState(null),[pe,fs]=o.useState(!1),[ls,Le]=o.useState(null),[Pe,Ms]=o.useState(null),[cs,Fs]=o.useState([]),[Se,Es]=o.useState(null),[Re,ds]=o.useState(null),[ys,Ue]=o.useState(!1),[ss,xs]=o.useState("foundation"),[Ne,f]=o.useState(!1),[I,be]=o.useState(null),[ke,bs]=o.useState([]),[rt,Et]=o.useState([]),[nt,Zr]=o.useState(!1),[Ie,At]=o.useState(null),[Rt,As]=o.useState(!1),at=o.useRef(null),vs=o.useRef(null),it=o.useCallback(()=>{vs.current&&(vs.current.scrollTop=vs.current.scrollHeight)},[]);Us.useEffect(()=>{it()},[j,it]),o.useEffect(()=>{Rs(),ws(),ot(),ct(),dt(),zt()},[]);const Rs=()=>M(void 0,null,function*(){try{const i=yield(yield fetch("/api/omai/learning-progress")).json();i.success&&Ms(i.progress)}catch(t){console.error("Failed to load learning progress:",t)}}),ws=()=>M(void 0,null,function*(){try{const i=yield(yield fetch("/api/omai/training-sessions")).json();i.success&&Fs(i.sessions)}catch(t){console.error("Failed to load training sessions:",t)}}),ot=()=>M(void 0,null,function*(){try{const i=yield(yield fetch("/api/omai/knowledge-metrics")).json();i.success&&Es(i.metrics)}catch(t){console.error("Failed to load knowledge metrics:",t)}}),$t=t=>M(void 0,null,function*(){f(!0);try{const A=yield(yield fetch("/api/omai/start-training",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({phase:t})})).json();if(A.success){ds(A.session),Ue(!1);const _=setInterval(()=>{ws(),Rs()},5e3);setTimeout(()=>clearInterval(_),30*60*1e3)}}catch(i){console.error("Failed to start training session:",i)}finally{f(!1)}}),Ot=()=>M(void 0,null,function*(){if(Re)try{(yield(yield fetch(`/api/omai/stop-training/${Re.id}`,{method:"POST"})).json()).success&&(ds(null),ws())}catch(t){console.error("Failed to stop training session:",t)}}),lt=()=>M(void 0,null,function*(){f(!0);try{yield Promise.all([Rs(),ws(),ot(),ct(),dt()])}finally{f(!1)}}),ct=()=>M(void 0,null,function*(){try{const i=yield(yield fetch("/api/omai/ethics-progress")).json();i.success&&be(i.progress)}catch(t){console.error("Failed to load ethics progress:",t)}}),dt=()=>M(void 0,null,function*(){try{const i=yield(yield fetch("/api/omai/ethical-foundations")).json();i.success&&bs(i.foundations)}catch(t){console.error("Failed to load ethical foundations:",t)}}),zt=()=>M(void 0,null,function*(){try{const i=yield(yield fetch("/api/omai/omlearn-surveys")).json();i.success&&Et(i.surveys)}catch(t){console.error("Failed to load OMLearn surveys:",t)}});o.useEffect(()=>{n===5&&$s(),n===6&&Os()},[n]);const $s=()=>M(void 0,null,function*(){ie(!0),B(null);try{const t=yield fetch("/api/bigbook/registries",{credentials:"include"});if(!t.ok)throw new Error(`HTTP ${t.status}: ${t.statusText}`);const i=yield t.json();if(i.success)m(i.registries);else throw new Error(i.error||"Failed to load registries")}catch(t){B(t instanceof Error?t.message:"Unknown error"),a("error",`Failed to load registries: ${t instanceof Error?t.message:"Unknown error"}`)}finally{ie(!1)}}),Os=()=>M(void 0,null,function*(){fs(!0);try{const t=yield fetch("/api/bigbook/custom-components-registry",{credentials:"include"});if(t.ok){const i=yield t.json();d(i),a("success",`Loaded ${Object.keys(i.components||{}).length} custom components`)}else throw new Error("Failed to load custom components")}catch(t){console.error("Error loading custom components:",t),a("error",`Failed to load custom components: ${t instanceof Error?t.message:"Unknown error"}`)}finally{fs(!1)}}),Dt=t=>M(void 0,null,function*(){if(window.confirm(`Are you sure you want to remove the component "${t.displayName||t.name}"? This action cannot be undone.`)){a("info",`ðŸ—‘ï¸ Removing custom component: ${t.name}`);try{const i={componentName:t.name,installedPath:t.path,route:t.route,displayName:t.displayName,registryUpdated:!0,menuUpdated:!0},_=yield(yield fetch("/api/bigbook/remove-bigbook-component",{method:"DELETE",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({installationResult:i})})).json();if(_.success)a("success",`âœ… Component "${t.name}" removed successfully`),_.menuUpdated&&a("success","ðŸ§© Component removed from Big Book sidebar menu"),yield Os(),ls===t.name&&Le(null);else throw new Error(_.error||"Failed to remove component")}catch(i){a("error",`âŒ Failed to remove component: ${i instanceof Error?i.message:"Unknown error"}`)}}}),Bt=(t,i,A)=>M(void 0,null,function*(){try{const _=yield fetch(`/api/bigbook/toggle-item/${t}/${i}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({enabled:A}),credentials:"include"});if(!_.ok)throw new Error(`HTTP ${_.status}: ${_.statusText}`);const $=yield _.json();if($.success)m(X=>V(Q({},X),{[t]:V(Q({},X[t]),{items:V(Q({},X[t].items),{[i]:$.item})})})),a("success",`Item ${A?"enabled":"disabled"}: ${$.item.name||$.item.displayName||i}`);else throw new Error($.error||"Failed to toggle item")}catch(_){a("error",`Failed to toggle item: ${_ instanceof Error?_.message:"Unknown error"}`)}}),a=(t,i,A)=>{const _={id:Date.now().toString(),timestamp:new Date,type:t,content:i,source:t==="command"?"User":"System"};w($=>[...$,_])},Lt=o.useCallback(t=>M(void 0,null,function*(){var A,_,$,X,Te,te;t.preventDefault();const i=Array.from(t.dataTransfer.files);for(const E of i)try{const re=((A=E.name.split(".").pop())==null?void 0:A.toLowerCase())||"";if(re==="zip"&&(E.name.toLowerCase().includes("parish-map")||E.name.toLowerCase().includes("parishmap")||E.name.toLowerCase()==="_workspace_dist_parish-map.zip")){a("info",`ðŸ—ºï¸ Parish Map zip detected: ${E.name}. Starting auto-installation...`);try{const G=new FormData;G.append("parishMapZip",E);const H=yield(yield fetch("/api/bigbook/upload-parish-map",{method:"POST",body:G,credentials:"include"})).json();H.success?(a("success","ðŸŽ‰ Parish Map installed successfully!"),a("info",`ðŸ“ Component: ${H.addon.displayName}`),a("info",`ðŸ”— Available at: orthodoxmetrics.com${H.addon.route}`),a("info","ðŸ“ Updated Big Book Components Index"),a("success",'ðŸ§© Added to sidebar navigation under "Components" section'),a("info","ðŸ”„ Refresh the page to see the new menu item in the sidebar"),setTimeout(()=>{a("info",`Click here to visit: ${window.location.origin}${H.addon.route}`)},1e3)):a("error",`âŒ Parish Map installation failed: ${H.error}`)}catch(G){a("error",`âŒ Parish Map installation error: ${G instanceof Error?G.message:"Unknown error"}`)}continue}if(re==="tsx"){a("info",`ðŸ§© TSX Component detected: ${E.name}. Opening installation wizard...`),ze(E),ye(!0);continue}if(![".zip",".js",".json",".md",".sh"].includes(`.${re}`)){const G=new FileReader;G.onload=je=>M(void 0,null,function*(){var De,us,hs,ms;const H=(De=je.target)==null?void 0:De.result,ne=xt(re),J={id:Date.now().toString()+Math.random(),name:E.name,type:ne,content:H,size:E.size,uploaded:new Date,processed:!1,status:"pending"};T(ve=>[...ve,J]),a("info",`Uploading to encrypted storage: ${E.name} (${ne})`);try{const oe=yield(yield fetch("/api/bigbook/upload",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fileName:E.name,content:H,fileType:ne})})).json();if(oe.success){T(Ae=>Ae.map(es=>es.id===J.id?V(Q({},es),{status:"completed",result:{success:!0,output:"File uploaded successfully"}}):es));const we=oe.isQuestionnaire?`questionnaire (${((us=oe.questionnaireMetadata)==null?void 0:us.title)||"Unknown"})`:"file";a("success",`${we} uploaded to encrypted storage: ${E.name}`),oe.isQuestionnaire&&a("info",`Questionnaire detected: ${((hs=oe.questionnaireMetadata)==null?void 0:hs.ageGroup)||"Unknown age group"} - ${((ms=oe.questionnaireMetadata)==null?void 0:ms.estimatedDuration)||0} minutes`)}else T(we=>we.map(Ae=>Ae.id===J.id?V(Q({},Ae),{status:"error",result:{success:!1,error:oe.error}}):Ae)),a("error",`Upload failed: ${E.name} - ${oe.error}`)}catch(ve){T(oe=>oe.map(we=>we.id===J.id?V(Q({},we),{status:"error",result:{success:!1,error:ve instanceof Error?ve.message:"Unknown error"}}):we)),a("error",`Upload error: ${E.name} - ${ve instanceof Error?ve.message:"Unknown error"}`)}}),G.readAsText(E);continue}const zs={zip:"ðŸ“¦",js:"âš¡",json:"âš™ï¸",md:"ðŸ“",sh:"ðŸ”§"}[re]||"ðŸ“„";a("info",`${zs} Processing ${re.toUpperCase()} file: ${E.name}`);try{const G=new FormData;G.append("file",E);const je=re==="md"||re==="js";je&&G.append("notifyOMAI","true"),a("info","ðŸ”„ Sending to centralized ingestion system...");const H=yield fetch("/api/bigbook/ingest-file",{method:"POST",body:G,credentials:"include"});if(a("info",`ðŸ“¡ Response status: ${H.status} ${H.statusText}`),!H.ok){const J=yield H.text();a("error",`âŒ HTTP Error ${H.status}: ${J}`),H.status===401&&(a("error","ðŸ” Authentication failed. Please refresh page and try again."),a("info","ðŸ’¡ Tip: Make sure you're logged in as super_admin"));continue}const ne=yield H.json();if(ne.success){const{result:J}=ne;switch(a("success",`âœ… ${J.message}`),a("info",`ðŸ“‚ Type: ${J.type}/${J.category}`),J.type){case"addon":a("info",`ðŸ§© Component available at: ${((_=J.item)==null?void 0:_.route)||"N/A"}`),($=J.item)!=null&&$.enabled?a("success","âœ… Component enabled and ready to use"):a("warning","âš ï¸ Component requires manual enable in registry");break;case"doc":a("info",`ðŸ“– Document: ${((X=J.item)==null?void 0:X.title)||((Te=J.item)==null?void 0:Te.name)}`),(te=J.item)!=null&&te.webPath&&a("info",`ðŸ”— Web path: ${J.item.webPath}`);break;case"script":a("info","ðŸ”§ Script stored and made executable"),a("warning","âš ï¸ Script requires manual enable for security");break;case"config":a("info","âš™ï¸ Configuration active and available");break;case"data":a("info","ðŸ’¾ Data archived for manual processing");break}if(ne.registries){const De=Object.keys(ne.registries);a("info",`ðŸ“Š Updated registries: ${De.join(", ")}`)}je&&a("info","ðŸ§  OMAI notified for learning")}else a("error",`âŒ Ingestion failed: ${ne.error}`),ne.debug&&a("info",`ðŸ” Debug info: ${JSON.stringify(ne.debug)}`)}catch(G){a("error",`âŒ Ingestion error: ${G instanceof Error?G.message:"Unknown error"}`)}}catch(re){a("error",`File processing error: ${E.name} - ${re instanceof Error?re.message:"Unknown error"}`)}}),[]),Ut=t=>{t.preventDefault()},Nt=t=>M(void 0,null,function*(){var A,_,$,X,Te,te;const i=Array.from(t.target.files||[]);for(const E of i)try{const re=((A=E.name.split(".").pop())==null?void 0:A.toLowerCase())||"";if(re==="zip"&&(E.name.toLowerCase().includes("parish-map")||E.name.toLowerCase().includes("parishmap")||E.name.toLowerCase()==="_workspace_dist_parish-map.zip")){a("info",`ðŸ—ºï¸ Parish Map zip selected: ${E.name}. Starting auto-installation...`);try{const G=new FormData;G.append("parishMapZip",E),a("info","ðŸ”„ Sending request to /api/bigbook/upload-parish-map...");const je=yield fetch("/api/bigbook/upload-parish-map",{method:"POST",body:G,credentials:"include",headers:{}});if(a("info",`ðŸ“¡ Response status: ${je.status} ${je.statusText}`),!je.ok){const ne=yield je.text();a("error",`âŒ HTTP Error ${je.status}: ${ne}`),je.status===401&&(a("error","ðŸ” Authentication failed. Please refresh page and try again."),a("info","ðŸ’¡ Tip: Make sure you're logged in as super_admin"));return}const H=yield je.json();H.success?(a("success","ðŸŽ‰ Parish Map installed successfully!"),a("info",`ðŸ“ Component: ${H.addon.displayName}`),a("info",`ðŸ”— Available at: orthodoxmetrics.com${H.addon.route}`),a("info","ðŸ“ Updated Big Book Components Index"),a("success",'ðŸ§© Added to sidebar navigation under "Components" section'),a("info","ðŸ”„ Refresh the page to see the new menu item in the sidebar"),setTimeout(()=>{a("info",`Click here to visit: ${window.location.origin}${H.addon.route}`)},1e3)):(a("error",`âŒ Parish Map installation failed: ${H.error}`),H.debug&&a("info",`ðŸ” Debug info: ${JSON.stringify(H.debug)}`))}catch(G){a("error",`âŒ Parish Map installation error: ${G instanceof Error?G.message:"Unknown error"}`),console.error("Parish Map upload error:",G)}continue}if(re==="tsx"){a("info",`ðŸ§© TSX Component detected: ${E.name}. Opening installation wizard...`),ze(E),ye(!0);continue}if(![".zip",".js",".json",".md",".sh"].includes(`.${re}`)){const G=new FileReader;G.onload=je=>M(void 0,null,function*(){var De,us,hs,ms;const H=(De=je.target)==null?void 0:De.result,ne=xt(re),J={id:Date.now().toString()+Math.random(),name:E.name,type:ne,content:H,size:E.size,uploaded:new Date,processed:!1,status:"pending"};T(ve=>[...ve,J]),a("info",`Uploading to encrypted storage: ${E.name} (${ne})`);try{const oe=yield(yield fetch("/api/bigbook/upload",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fileName:E.name,content:H,fileType:ne})})).json();if(oe.success){T(Ae=>Ae.map(es=>es.id===J.id?V(Q({},es),{status:"completed",result:{success:!0,output:"File uploaded successfully"}}):es));const we=oe.isQuestionnaire?`questionnaire (${((us=oe.questionnaireMetadata)==null?void 0:us.title)||"Unknown"})`:"file";a("success",`${we} uploaded to encrypted storage: ${E.name}`),oe.isQuestionnaire&&a("info",`Questionnaire detected: ${((hs=oe.questionnaireMetadata)==null?void 0:hs.ageGroup)||"Unknown age group"} - ${((ms=oe.questionnaireMetadata)==null?void 0:ms.estimatedDuration)||0} minutes`)}else T(we=>we.map(Ae=>Ae.id===J.id?V(Q({},Ae),{status:"error",result:{success:!1,error:oe.error}}):Ae)),a("error",`Upload failed: ${E.name} - ${oe.error}`)}catch(ve){T(oe=>oe.map(we=>we.id===J.id?V(Q({},we),{status:"error",result:{success:!1,error:ve instanceof Error?ve.message:"Unknown error"}}):we)),a("error",`Upload error: ${E.name} - ${ve instanceof Error?ve.message:"Unknown error"}`)}}),G.readAsText(E);continue}const zs={zip:"ðŸ“¦",js:"âš¡",json:"âš™ï¸",md:"ðŸ“",sh:"ðŸ”§"}[re]||"ðŸ“„";a("info",`${zs} Processing ${re.toUpperCase()} file: ${E.name}`);try{const G=new FormData;G.append("file",E);const je=re==="md"||re==="js";je&&G.append("notifyOMAI","true"),a("info","ðŸ”„ Sending to centralized ingestion system...");const H=yield fetch("/api/bigbook/ingest-file",{method:"POST",body:G,credentials:"include"});if(a("info",`ðŸ“¡ Response status: ${H.status} ${H.statusText}`),!H.ok){const J=yield H.text();a("error",`âŒ HTTP Error ${H.status}: ${J}`),H.status===401&&(a("error","ðŸ” Authentication failed. Please refresh page and try again."),a("info","ðŸ’¡ Tip: Make sure you're logged in as super_admin"));continue}const ne=yield H.json();if(ne.success){const{result:J}=ne;switch(a("success",`âœ… ${J.message}`),a("info",`ðŸ“‚ Type: ${J.type}/${J.category}`),J.type){case"addon":a("info",`ðŸ§© Component available at: ${((_=J.item)==null?void 0:_.route)||"N/A"}`),($=J.item)!=null&&$.enabled?a("success","âœ… Component enabled and ready to use"):a("warning","âš ï¸ Component requires manual enable in registry");break;case"doc":a("info",`ðŸ“– Document: ${((X=J.item)==null?void 0:X.title)||((Te=J.item)==null?void 0:Te.name)}`),(te=J.item)!=null&&te.webPath&&a("info",`ðŸ”— Web path: ${J.item.webPath}`);break;case"script":a("info","ðŸ”§ Script stored and made executable"),a("warning","âš ï¸ Script requires manual enable for security");break;case"config":a("info","âš™ï¸ Configuration active and available");break;case"data":a("info","ðŸ’¾ Data archived for manual processing");break}if(ne.registries){const De=Object.keys(ne.registries);a("info",`ðŸ“Š Updated registries: ${De.join(", ")}`)}je&&a("info","ðŸ§  OMAI notified for learning")}else a("error",`âŒ Ingestion failed: ${ne.error}`),ne.debug&&a("info",`ðŸ” Debug info: ${JSON.stringify(ne.debug)}`)}catch(G){a("error",`âŒ Ingestion error: ${G instanceof Error?G.message:"Unknown error"}`)}}catch(re){a("error",`File processing error: ${E.name} - ${re instanceof Error?re.message:"Unknown error"}`)}}),xt=t=>{switch(t){case"sql":return"sql";case"md":case"markdown":return"markdown";case"js":case"jsx":case"ts":case"tsx":return"javascript";case"sh":case"bash":case"zsh":return"shell";case"py":case"python":return"python";case"html":case"htm":return"html";case"css":case"scss":case"sass":return"css";case"json":return"json";case"xml":return"xml";case"txt":case"log":return"text";case"jpg":case"jpeg":case"png":case"gif":case"svg":case"webp":return"image";case"mp4":case"avi":case"mov":case"wmv":return"video";case"mp3":case"wav":case"ogg":return"audio";case"zip":case"tar":case"gz":case"rar":return"archive";case"pdf":return"pdf";default:return"other"}},ut=t=>M(void 0,null,function*(){x(!0),a("command",`Executing: ${t.name}`);try{let i=t.content;if(t.encryptedPath)try{const X=yield(yield fetch(`/api/bigbook/storage/file/${t.id}?encryptedPath=${encodeURIComponent(t.encryptedPath)}`)).json();if(X.success)i=X.content;else throw new Error(`Failed to retrieve file from encrypted storage: ${X.error}`)}catch($){a("error",`Failed to retrieve file from encrypted storage: ${t.name}`,$ instanceof Error?$.message:"Unknown error"),x(!1);return}const _=yield(yield fetch("/api/bigbook/execute",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fileId:t.id,fileName:t.name,content:i,type:t.type,settings:y})})).json();_.success?a("success",`Execution completed: ${t.name}`,_.output):a("error",`Execution failed: ${t.name}`,_.error)}catch(i){a("error",`Execution error: ${t.name}`,i instanceof Error?i.message:"Unknown error")}finally{x(!1)}}),ht=t=>M(void 0,null,function*(){const i=u.find(A=>A.id===t);if(i!=null&&i.encryptedPath)try{const _=yield(yield fetch(`/api/bigbook/storage/file/${t}?encryptedPath=${encodeURIComponent(i.encryptedPath)}`,{method:"DELETE"})).json();_.success?(T($=>$.filter(X=>X.id!==t)),a("success",`File removed from encrypted storage: ${i.name}`)):a("error",`Failed to remove file from encrypted storage: ${i.name} - ${_.error}`)}catch(A){a("error",`Error removing file from encrypted storage: ${i.name} - ${A instanceof Error?A.message:"Unknown error"}`)}else T(A=>A.filter(_=>_.id!==t)),a("info","File removed from list")}),mt=()=>{w([])},Wt=()=>M(void 0,null,function*(){try{(yield fetch("/api/bigbook/settings",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(y)})).ok?(a("success","Settings saved successfully"),D(!1)):a("error","Failed to save settings")}catch(t){a("error","Error saving settings")}}),_t=t=>{var i;if(!t.isQuestionnaire){a("warning","File is not a questionnaire");return}L(t),l(!0),a("info",`Opening questionnaire preview: ${((i=t.questionnaireMetadata)==null?void 0:i.title)||t.name}`)},qt=t=>M(void 0,null,function*(){try{a("info",`Submitting questionnaire responses: ${t.questionnaireTitle}`);const A=yield(yield fetch("/api/bigbook/submit-response",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).json();A.success?a("success",`Questionnaire submitted successfully (${A.action}): ${t.questionnaireTitle}`,`Response ID: ${A.responseId}
Responses: ${t.responses.length} answers`):a("error",`Failed to submit questionnaire: ${A.error}`)}catch(i){a("error",`Error submitting questionnaire: ${i instanceof Error?i.message:"Unknown error"}`)}}),Ht=t=>{switch(t){case"sql":return e.jsx(os,{});case"markdown":return e.jsx(Ls,{});case"javascript":return e.jsx(st,{});case"shell":return e.jsx(he,{});case"python":return e.jsx(he,{});case"html":return e.jsx(et,{});case"css":return e.jsx(Zs,{});case"json":return e.jsx(Ys,{});case"xml":return e.jsx(he,{});case"text":return e.jsx(fr,{});case"image":return e.jsx(Xs,{});case"video":return e.jsx(Gs,{});case"audio":return e.jsx(Ks,{});case"archive":return e.jsx(js,{});case"pdf":return e.jsx(Vs,{});case"script":return e.jsx(he,{});default:return e.jsx(as,{})}},Jt=t=>{switch(t){case"sql":return e.jsx(C,{label:"SQL",size:"small",color:"primary"});case"markdown":return e.jsx(C,{label:"Markdown",size:"small",color:"info"});case"javascript":return e.jsx(C,{label:"JavaScript",size:"small",color:"warning"});case"shell":return e.jsx(C,{label:"Shell",size:"small",color:"success"});case"python":return e.jsx(C,{label:"Python",size:"small",color:"secondary"});case"html":return e.jsx(C,{label:"HTML",size:"small",color:"error"});case"css":return e.jsx(C,{label:"CSS",size:"small",color:"info"});case"json":return e.jsx(C,{label:"JSON",size:"small",color:"warning"});case"xml":return e.jsx(C,{label:"XML",size:"small",color:"secondary"});case"text":return e.jsx(C,{label:"Text",size:"small",color:"default"});case"image":return e.jsx(C,{label:"Image",size:"small",color:"success"});case"video":return e.jsx(C,{label:"Video",size:"small",color:"error"});case"audio":return e.jsx(C,{label:"Audio",size:"small",color:"info"});case"archive":return e.jsx(C,{label:"Archive",size:"small",color:"warning"});case"pdf":return e.jsx(C,{label:"PDF",size:"small",color:"error"});case"script":return e.jsx(C,{label:"Script",size:"small",color:"secondary"});default:return e.jsx(C,{label:"Other",size:"small",color:"default"})}},Qt=(t,i)=>{S(i)},Vt=()=>e.jsx(r,{children:e.jsx(Z,{sx:{mb:3},children:e.jsxs(ee,{children:[e.jsxs(r,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:[e.jsxs(s,{variant:"h5",component:"h2",children:[e.jsx(qe,{sx:{mr:1,verticalAlign:"middle"}}),"OMAI Learning Dashboard"]}),e.jsxs(r,{children:[e.jsx(k,{variant:"outlined",startIcon:Ne?e.jsx(ce,{size:16}):e.jsx(Fe,{}),onClick:lt,disabled:Ne,sx:{mr:1},children:"Refresh"}),e.jsx(k,{variant:"contained",startIcon:e.jsx(Bs,{}),onClick:()=>Ue(!0),disabled:!!Re,children:"Start Training"})]})]}),Pe&&e.jsxs(p,{container:!0,spacing:3,children:[e.jsx(p,{item:!0,xs:12,md:3,children:e.jsxs(K,{sx:{p:2,textAlign:"center"},children:[e.jsxs(s,{variant:"h4",color:"primary",children:[Math.round(Pe.overallProgress),"%"]}),e.jsx(s,{variant:"body2",color:"text.secondary",children:"Overall Progress"}),e.jsx(ts,{variant:"determinate",value:Pe.overallProgress,sx:{mt:1}})]})}),e.jsx(p,{item:!0,xs:12,md:3,children:e.jsxs(K,{sx:{p:2,textAlign:"center"},children:[e.jsx(s,{variant:"h4",color:"success.main",children:Pe.knowledgePoints}),e.jsx(s,{variant:"body2",color:"text.secondary",children:"Knowledge Points"})]})}),e.jsx(p,{item:!0,xs:12,md:3,children:e.jsxs(K,{sx:{p:2,textAlign:"center"},children:[e.jsx(s,{variant:"h4",color:"info.main",children:Pe.memoriesCreated}),e.jsx(s,{variant:"body2",color:"text.secondary",children:"Memories Created"})]})}),e.jsx(p,{item:!0,xs:12,md:3,children:e.jsxs(K,{sx:{p:2,textAlign:"center"},children:[e.jsx(s,{variant:"h4",color:"warning.main",children:Pe.filesProcessed}),e.jsx(s,{variant:"body2",color:"text.secondary",children:"Files Processed"})]})})]}),Pe&&e.jsxs(r,{mt:3,children:[e.jsx(s,{variant:"h6",gutterBottom:!0,children:"Current Learning Phase"}),e.jsxs(Y,{severity:"info",sx:{mb:2},children:[e.jsx(s,{variant:"subtitle1",children:e.jsx("strong",{children:Pe.currentPhase})}),e.jsxs(s,{variant:"body2",children:[Pe.completedSessions," of ",Pe.totalSessions," sessions completed"]}),e.jsxs(s,{variant:"body2",color:"text.secondary",children:["Last Activity: ",Pe.lastActivity]})]})]}),Re&&e.jsxs(r,{mt:3,children:[e.jsx(s,{variant:"h6",gutterBottom:!0,children:"Active Training Session"}),e.jsxs(K,{sx:{p:2,border:2,borderColor:"primary.main"},children:[e.jsxs(r,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:[e.jsxs(r,{children:[e.jsx(s,{variant:"subtitle1",color:"primary",children:Re.name}),e.jsxs(s,{variant:"body2",color:"text.secondary",children:["Phase: ",Re.phase]})]}),e.jsx(k,{variant:"outlined",color:"error",startIcon:e.jsx(hr,{}),onClick:Ot,size:"small",children:"Stop"})]}),e.jsx(ts,{variant:"determinate",value:Re.progress,sx:{mb:1}}),e.jsxs(s,{variant:"body2",align:"center",children:[Re.progress,"% Complete"]})]})]})]})})}),Kt=()=>e.jsxs(r,{children:[e.jsx(Z,{sx:{mb:3},children:e.jsxs(ee,{children:[e.jsxs(s,{variant:"h6",gutterBottom:!0,children:[e.jsx(Nr,{sx:{mr:1,verticalAlign:"middle"}}),"Training Sessions"]}),cs.length===0?e.jsx(Y,{severity:"info",children:"No training sessions found. Start your first training session to begin OMAI's learning journey."}):e.jsx(Ws,{children:e.jsxs(_s,{children:[e.jsx(qs,{children:e.jsxs(rs,{children:[e.jsx(q,{children:"Session Name"}),e.jsx(q,{children:"Phase"}),e.jsx(q,{children:"Status"}),e.jsx(q,{children:"Progress"}),e.jsx(q,{children:"Duration"}),e.jsx(q,{children:"Results"}),e.jsx(q,{children:"Actions"})]})}),e.jsx(Hs,{children:cs.map(t=>e.jsxs(rs,{children:[e.jsx(q,{children:t.name}),e.jsx(q,{children:e.jsx(C,{label:t.phase,size:"small",variant:"outlined"})}),e.jsx(q,{children:e.jsx(C,{label:t.status,color:t.status==="completed"?"success":t.status==="running"?"primary":t.status==="failed"?"error":"default",size:"small"})}),e.jsx(q,{children:e.jsxs(r,{display:"flex",alignItems:"center",children:[e.jsx(ts,{variant:"determinate",value:t.progress,sx:{width:100,mr:1}}),e.jsxs(s,{variant:"body2",children:[t.progress,"%"]})]})}),e.jsx(q,{children:t.duration?`${Math.round(t.duration/60)} min`:"-"}),e.jsx(q,{children:t.results&&e.jsx(ae,{title:`Files: ${t.results.filesProcessed}, Memories: ${t.results.memoriesCreated}, Knowledge: ${t.results.knowledgeExtracted}`,children:e.jsx(C,{label:`${t.results.filesProcessed} files`,size:"small",variant:"outlined"})})}),e.jsx(q,{children:e.jsx(se,{size:"small",children:e.jsx(Ze,{})})})]},t.id))})]})})]})}),e.jsx(Z,{children:e.jsxs(ee,{children:[e.jsx(s,{variant:"h6",gutterBottom:!0,children:"Training Phases"}),e.jsx(p,{container:!0,spacing:2,children:[{id:"foundation",name:"Foundation Knowledge",description:"Basic system understanding and file structure analysis",icon:e.jsx(he,{})},{id:"functional",name:"Functional Understanding",description:"API patterns, component relationships, and data flow",icon:e.jsx(Ct,{})},{id:"operational",name:"Operational Intelligence",description:"Deployment, monitoring, and performance patterns",icon:e.jsx(Or,{})},{id:"resolution",name:"Issue Resolution",description:"Problem-solving patterns and error handling",icon:e.jsx(mr,{})},{id:"predictive",name:"Predictive Capabilities",description:"Proactive maintenance and optimization",icon:e.jsx(bt,{})}].map(t=>e.jsx(p,{item:!0,xs:12,md:6,lg:4,children:e.jsxs(K,{sx:{p:2,cursor:"pointer","&:hover":{elevation:4}},onClick:()=>{xs(t.id),Ue(!0)},children:[e.jsxs(r,{display:"flex",alignItems:"center",mb:1,children:[t.icon,e.jsx(s,{variant:"subtitle1",sx:{ml:1},children:t.name})]}),e.jsx(s,{variant:"body2",color:"text.secondary",children:t.description})]})},t.id))})]})})]}),Gt=()=>e.jsx(r,{children:Se&&e.jsxs(e.Fragment,{children:[e.jsx(Z,{sx:{mb:3},children:e.jsxs(ee,{children:[e.jsxs(s,{variant:"h6",gutterBottom:!0,children:[e.jsx(Ft,{sx:{mr:1,verticalAlign:"middle"}}),"Knowledge Analytics"]}),e.jsxs(p,{container:!0,spacing:3,children:[e.jsx(p,{item:!0,xs:12,md:4,children:e.jsxs(K,{sx:{p:2,textAlign:"center"},children:[e.jsx(s,{variant:"h4",color:"primary",children:Se.totalMemories}),e.jsx(s,{variant:"body2",color:"text.secondary",children:"Total Memories"})]})}),e.jsx(p,{item:!0,xs:12,md:4,children:e.jsxs(K,{sx:{p:2,textAlign:"center"},children:[e.jsx(s,{variant:"h4",color:"success.main",children:Se.learningVelocity.memoriesPerWeek}),e.jsx(s,{variant:"body2",color:"text.secondary",children:"Memories/Week"})]})}),e.jsx(p,{item:!0,xs:12,md:4,children:e.jsxs(K,{sx:{p:2,textAlign:"center"},children:[e.jsxs(s,{variant:"h4",color:"info.main",children:[Math.round(Se.learningVelocity.knowledgeGrowthRate*100),"%"]}),e.jsx(s,{variant:"body2",color:"text.secondary",children:"Growth Rate"})]})})]})]})}),e.jsxs(p,{container:!0,spacing:3,sx:{mb:3},children:[e.jsx(p,{item:!0,xs:12,md:6,children:e.jsx(Z,{children:e.jsxs(ee,{children:[e.jsx(s,{variant:"h6",gutterBottom:!0,children:"Knowledge Categories"}),e.jsx(Me,{children:Object.entries(Se.categoriesDistribution).map(([t,i])=>e.jsxs(xe,{children:[e.jsx(ue,{primary:t}),e.jsx(C,{label:i,size:"small"})]},t))})]})})}),e.jsx(p,{item:!0,xs:12,md:6,children:e.jsx(Z,{children:e.jsxs(ee,{children:[e.jsx(s,{variant:"h6",gutterBottom:!0,children:"Priority Distribution"}),e.jsx(Me,{children:Object.entries(Se.priorityDistribution).map(([t,i])=>e.jsxs(xe,{children:[e.jsx(ue,{primary:t}),e.jsx(C,{label:i,size:"small",color:t==="critical"?"error":t==="high"?"warning":t==="medium"?"info":"default"})]},t))})]})})})]}),e.jsx(Z,{children:e.jsxs(ee,{children:[e.jsx(s,{variant:"h6",gutterBottom:!0,children:"Usage Patterns"}),e.jsxs(p,{container:!0,spacing:3,children:[e.jsxs(p,{item:!0,xs:12,md:4,children:[e.jsx(s,{variant:"subtitle1",gutterBottom:!0,children:"Most Used Memories"}),e.jsx(Me,{dense:!0,children:Se.usagePatterns.mostUsed.map((t,i)=>e.jsx(xe,{children:e.jsx(ue,{primary:t.title,secondary:`Used ${t.count} times`})},i))})]}),e.jsxs(p,{item:!0,xs:12,md:4,children:[e.jsx(s,{variant:"subtitle1",gutterBottom:!0,children:"Recently Accessed"}),e.jsx(Me,{dense:!0,children:Se.usagePatterns.recentlyAccessed.map((t,i)=>e.jsx(xe,{children:e.jsx(ue,{primary:t.title,secondary:new Date(t.lastAccessed).toLocaleString()})},i))})]}),e.jsxs(p,{item:!0,xs:12,md:4,children:[e.jsx(s,{variant:"subtitle1",gutterBottom:!0,children:"Trending Memories"}),e.jsx(Me,{dense:!0,children:Se.usagePatterns.trending.map((t,i)=>e.jsx(xe,{children:e.jsx(ue,{primary:t.title,secondary:e.jsxs(r,{display:"flex",alignItems:"center",children:[e.jsx(bt,{sx:{fontSize:16,mr:.5}}),t.trend>0?"+":"",t.trend,"%"]})})},i))})]})]})]})})]})}),Xt=()=>e.jsxs(r,{children:[e.jsx(Z,{sx:{mb:3},children:e.jsxs(ee,{children:[e.jsxs(r,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:[e.jsxs(s,{variant:"h5",component:"h2",children:[e.jsx(qe,{sx:{mr:1,verticalAlign:"middle"}}),"OMAI Ethics & Reasoning Foundation"]}),e.jsxs(r,{children:[e.jsx(k,{variant:"outlined",startIcon:nt?e.jsx(ce,{size:16}):e.jsx(Fe,{}),onClick:lt,disabled:nt,sx:{mr:1},children:"Refresh"}),e.jsx(k,{variant:"contained",startIcon:e.jsx(pr,{}),onClick:()=>window.open("/omlearn","_blank"),children:"Open OMLearn"})]})]}),I&&e.jsxs(p,{container:!0,spacing:3,children:[e.jsx(p,{item:!0,xs:12,md:3,children:e.jsxs(K,{sx:{p:2,textAlign:"center"},children:[e.jsxs(s,{variant:"h4",color:"primary",children:[I.completedSurveys,"/",I.totalSurveys]}),e.jsx(s,{variant:"body2",color:"text.secondary",children:"Surveys Completed"}),e.jsx(ts,{variant:"determinate",value:I.completedSurveys/I.totalSurveys*100,sx:{mt:1}})]})}),e.jsx(p,{item:!0,xs:12,md:3,children:e.jsxs(K,{sx:{p:2,textAlign:"center"},children:[e.jsx(s,{variant:"h4",color:"success.main",children:I.ethicalFoundationsCount}),e.jsx(s,{variant:"body2",color:"text.secondary",children:"Ethical Foundations"})]})}),e.jsx(p,{item:!0,xs:12,md:3,children:e.jsxs(K,{sx:{p:2,textAlign:"center"},children:[e.jsxs(s,{variant:"h4",color:"info.main",children:[Math.round(I.moralComplexityScore),"%"]}),e.jsx(s,{variant:"body2",color:"text.secondary",children:"Moral Complexity"})]})}),e.jsx(p,{item:!0,xs:12,md:3,children:e.jsxs(K,{sx:{p:2,textAlign:"center"},children:[e.jsx(s,{variant:"h4",color:"warning.main",children:I.reasoningMaturityLevel}),e.jsx(s,{variant:"body2",color:"text.secondary",children:"Reasoning Level"})]})})]}),e.jsxs(r,{mt:3,children:[e.jsx(s,{variant:"h6",gutterBottom:!0,children:"OMLearn Survey Progress"}),rt.length>0?e.jsx(p,{container:!0,spacing:2,children:rt.map(t=>e.jsx(p,{item:!0,xs:12,md:6,children:e.jsxs(K,{sx:{p:2},children:[e.jsxs(r,{display:"flex",justifyContent:"space-between",alignItems:"start",mb:1,children:[e.jsx(s,{variant:"subtitle1",children:t.title}),e.jsx(C,{label:t.status.replace("_"," "),color:t.status==="completed"?"success":t.status==="in_progress"?"primary":"default",size:"small"})]}),e.jsxs(s,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:[t.ageRange," â€¢ ",t.focus]}),e.jsxs(r,{display:"flex",alignItems:"center",mb:1,children:[e.jsx(ts,{variant:"determinate",value:t.completedQuestions/t.totalQuestions*100,sx:{width:"100%",mr:1}}),e.jsxs(s,{variant:"body2",children:[t.completedQuestions,"/",t.totalQuestions]})]})]})},t.id))}):e.jsx(Y,{severity:"info",children:"No OMLearn surveys found. Complete OMLearn assessments to establish OMAI's ethical foundation."})]})]})}),e.jsx(Z,{sx:{mb:3},children:e.jsxs(ee,{children:[e.jsxs(s,{variant:"h6",gutterBottom:!0,children:[e.jsx(jr,{sx:{mr:1,verticalAlign:"middle"}}),"Ethical Foundations"]}),ke.length>0?e.jsx(p,{container:!0,spacing:2,children:ke.slice(0,6).map(t=>e.jsx(p,{item:!0,xs:12,md:6,lg:4,children:e.jsxs(K,{sx:{p:2,cursor:"pointer","&:hover":{elevation:4}},onClick:()=>{At(t),As(!0)},children:[e.jsxs(r,{display:"flex",justifyContent:"between",alignItems:"start",mb:1,children:[e.jsx(s,{variant:"subtitle2",sx:{flexGrow:1,mr:1},children:t.question.length>80?`${t.question.substring(0,80)}...`:t.question}),e.jsx(C,{label:t.gradeGroup,size:"small",variant:"outlined"})]}),e.jsx(s,{variant:"body2",color:"text.secondary",sx:{display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden",mb:1},children:t.userResponse}),e.jsxs(r,{display:"flex",justifyContent:"between",alignItems:"center",children:[e.jsx(C,{label:t.category.replace("_"," "),size:"small",color:t.category==="moral_development"?"primary":t.category==="ethical_thinking"?"success":t.category==="reasoning_patterns"?"info":"default"}),e.jsxs(s,{variant:"caption",color:"text.secondary",children:["Weight: ",t.weight]})]})]})},t.id))}):e.jsx(Y,{severity:"warning",children:"No ethical foundations established yet. Complete OMLearn surveys to build OMAI's moral reasoning framework."}),ke.length>6&&e.jsx(r,{textAlign:"center",mt:2,children:e.jsxs(s,{variant:"body2",color:"text.secondary",children:["Showing 6 of ",ke.length," ethical foundations"]})})]})}),e.jsx(Z,{children:e.jsxs(ee,{children:[e.jsxs(s,{variant:"h6",gutterBottom:!0,children:[e.jsx(gr,{sx:{mr:1,verticalAlign:"middle"}}),"Moral Reasoning Categories"]}),e.jsx(p,{container:!0,spacing:3,children:[{category:"moral_development",name:"Moral Development",description:"Basic moral concepts and value formation",icon:"ðŸŒ±",color:"primary"},{category:"ethical_thinking",name:"Ethical Thinking",description:"Applied ethics and moral decision-making",icon:"ðŸ¤”",color:"success"},{category:"reasoning_patterns",name:"Reasoning Patterns",description:"Logical structures and thought processes",icon:"ðŸ§©",color:"info"},{category:"philosophical_concepts",name:"Philosophical Concepts",description:"Abstract moral and philosophical understanding",icon:"ðŸŽ­",color:"secondary"}].map(t=>{const i=ke.filter(A=>A.category===t.category);return e.jsx(p,{item:!0,xs:12,md:6,children:e.jsxs(K,{sx:{p:2,textAlign:"center"},children:[e.jsx(s,{variant:"h2",sx:{mb:1},children:t.icon}),e.jsx(s,{variant:"h6",color:`${t.color}.main`,gutterBottom:!0,children:t.name}),e.jsx(s,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:t.description}),e.jsx(s,{variant:"h4",color:`${t.color}.main`,children:i.length}),e.jsx(s,{variant:"caption",color:"text.secondary",children:"foundations established"})]})},t.category)})})]})})]});return e.jsxs(r,{sx:{p:3},children:[e.jsxs(O,{direction:"row",justifyContent:"space-between",alignItems:"center",sx:{mb:3},children:[e.jsxs(r,{children:[e.jsxs(s,{variant:"h4",component:"h1",gutterBottom:!0,children:[e.jsx(ps,{sx:{mr:1,verticalAlign:"middle"}}),"OMAI Learning Hub"]}),e.jsx(s,{variant:"body1",color:"text.secondary",children:"Comprehensive OMAI learning, memory management, and progress tracking"})]}),e.jsx(k,{variant:"outlined",startIcon:e.jsx(ks,{}),onClick:()=>D(!R),children:"Settings"})]}),e.jsxs(K,{sx:{width:"100%"},children:[e.jsxs(Lr,{value:n,onChange:Qt,sx:{borderBottom:1,borderColor:"divider"},children:[e.jsx(Ee,{label:"Learning Dashboard",icon:e.jsx(qe,{}),iconPosition:"start"}),e.jsx(Ee,{label:"Training Pathways",icon:e.jsx(Bs,{}),iconPosition:"start"}),e.jsx(Ee,{label:"Memory Management",icon:e.jsx(Js,{}),iconPosition:"start"}),e.jsx(Ee,{label:"Knowledge Analytics",icon:e.jsx(Ct,{}),iconPosition:"start"}),e.jsx(Ee,{label:"Ethics & Reasoning",icon:e.jsx(qe,{}),iconPosition:"start"}),e.jsx(Ee,{label:"OMAI Discovery",icon:e.jsx(ps,{}),iconPosition:"start"}),e.jsx(Ee,{label:"Imports & Scripts"}),e.jsx(Ee,{label:"File Console"}),e.jsx(Ee,{label:"Console"}),e.jsx(Ee,{label:"Encrypted Storage"}),e.jsx(Ee,{label:"Registry Management"}),e.jsx(Ee,{label:"Custom Components"})]}),e.jsxs(r,{sx:{p:3},children:[n===0&&Vt(),n===1&&Kt(),n===2&&e.jsx(Yr,{}),n===3&&Gt(),n===4&&Xt(),n===5&&e.jsx(Vr,{}),n===6&&e.jsxs(O,{spacing:3,children:[R&&e.jsx(Z,{children:e.jsxs(ee,{children:[e.jsxs(s,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ks,{}),"Big Book Settings"]}),e.jsxs(O,{spacing:3,children:[e.jsxs(r,{sx:{display:"flex",gap:2,flexWrap:"wrap"},children:[e.jsx(Ce,{sx:{flex:1,minWidth:250},label:"Database User",value:y.databaseUser,onChange:t=>v(i=>V(Q({},i),{databaseUser:t.target.value})),placeholder:"root"}),e.jsx(Ce,{sx:{flex:1,minWidth:250},type:"password",label:"Database Password",value:y.databasePassword,onChange:t=>v(i=>V(Q({},i),{databasePassword:t.target.value})),placeholder:"Enter database password"})]}),e.jsxs(r,{sx:{display:"flex",gap:2,flexWrap:"wrap"},children:[e.jsx(Ce,{sx:{flex:1,minWidth:250},label:"Default Database",value:y.defaultDatabase,onChange:t=>v(i=>V(Q({},i),{defaultDatabase:t.target.value})),placeholder:"omai_db"}),e.jsx(Ce,{sx:{flex:1,minWidth:250},type:"number",label:"Script Timeout (ms)",value:y.scriptTimeout,onChange:t=>v(i=>V(Q({},i),{scriptTimeout:parseInt(t.target.value)}))})]}),e.jsx(de,{control:e.jsx(le,{checked:y.useSudo,onChange:t=>v(i=>V(Q({},i),{useSudo:t.target.checked}))}),label:"Use Sudo for Script Execution"}),y.useSudo&&e.jsx(Ce,{fullWidth:!0,type:"password",label:"Sudo Password",value:y.sudoPassword,onChange:t=>v(i=>V(Q({},i),{sudoPassword:t.target.value})),placeholder:"Enter sudo password"}),e.jsx(k,{variant:"contained",startIcon:e.jsx(St,{}),onClick:Wt,children:"Save Settings"})]})]})}),e.jsx(Z,{children:e.jsxs(ee,{children:[e.jsx(s,{variant:"h6",gutterBottom:!0,children:"File Upload"}),e.jsxs(r,{sx:{border:"2px dashed",borderColor:"grey.300",borderRadius:2,p:4,textAlign:"center",cursor:"pointer","&:hover":{borderColor:"primary.main",backgroundColor:"action.hover"}},onDrop:Lt,onDragOver:Ut,onClick:()=>{var t;return(t=at.current)==null?void 0:t.click()},children:[e.jsx(Ur,{sx:{fontSize:48,color:"grey.500",mb:2}}),e.jsx(s,{variant:"h6",gutterBottom:!0,children:"Drop files here or click to upload"}),e.jsx(s,{variant:"body2",color:"text.secondary",children:"Supports all file types: .md, .js, .sh, .py, .sql, .html, .css, .json, .xml, .txt, .pdf, images, videos, audio, archives (max 10MB)"}),e.jsx(s,{variant:"body2",color:"primary.main",sx:{mt:1,fontWeight:"bold"},children:"ðŸ—ºï¸ Special: Drop Parish Map .zip files for auto-installation!"}),e.jsx("input",{ref:at,type:"file",multiple:!0,accept:".md,.js,.jsx,.ts,.tsx,.sh,.bash,.py,.sql,.html,.htm,.css,.scss,.sass,.json,.xml,.txt,.log,.pdf,.jpg,.jpeg,.png,.gif,.svg,.webp,.mp4,.avi,.mov,.wmv,.mp3,.wav,.ogg,.zip,.tar,.gz,.rar",onChange:Nt,style:{display:"none"}})]})]})}),u.length>0&&e.jsx(Z,{children:e.jsxs(ee,{children:[e.jsx(s,{variant:"h6",gutterBottom:!0,children:"Uploaded Files"}),e.jsx(Me,{children:u.map(t=>e.jsxs(xe,{divider:!0,children:[e.jsx(Be,{children:Ht(t.type)}),e.jsx(ue,{primary:t.name,secondary:`${(t.size/1024).toFixed(1)} KB â€¢ ${t.uploaded.toLocaleString()}`}),e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1},children:[Jt(t.type),e.jsx(ae,{title:"Execute",children:e.jsx(se,{onClick:()=>ut(t),disabled:F,color:"primary",children:e.jsx(is,{})})}),e.jsx(ae,{title:"Remove",children:e.jsx(se,{onClick:()=>ht(t.id),color:"error",children:e.jsx(gs,{})})})]})]},t.id))})]})})]}),n===7&&e.jsx(Hr,{files:u,consoleOutput:j,isExecuting:F,onFileSelect:z,onFileExecute:ut,onFileDelete:ht,onQuestionnairePreview:_t,onClearConsole:mt,selectedFile:P}),n===8&&e.jsxs(r,{children:[e.jsxs(O,{direction:"row",justifyContent:"space-between",alignItems:"center",sx:{mb:2},children:[e.jsx(s,{variant:"h6",children:"Console Output"}),e.jsx(k,{variant:"outlined",startIcon:e.jsx(Fe,{}),onClick:mt,size:"small",children:"Clear Console"})]}),e.jsx(K,{ref:vs,sx:{height:400,overflow:"auto",p:2,backgroundColor:"#1e1e1e",color:"#ffffff",fontFamily:"monospace",fontSize:"0.875rem"},children:j.length===0?e.jsx(s,{color:"grey.500",textAlign:"center",children:"No console output yet. Upload and execute files to see results."}):j.map(t=>e.jsxs(r,{sx:{mb:1},children:[e.jsxs(s,{component:"span",sx:{color:t.type==="error"?"#ff6b6b":t.type==="success"?"#51cf66":t.type==="warning"?"#ffd43b":t.type==="command"?"#74c0fc":"#ffffff",fontWeight:t.type==="command"?"bold":"normal"},children:["[",t.timestamp.toLocaleTimeString(),"] ",t.content]}),t.source&&e.jsxs(s,{variant:"caption",color:"text.secondary",sx:{ml:2},children:["(",t.source,")"]})]},t.id))})]}),n===9&&e.jsx(Jr,{}),n===10&&e.jsx(Zt,{}),n===11&&e.jsx(Yt,{})]})]}),e.jsx(Qr,{open:c,onClose:()=>{l(!1),L(null)},file:g,onSubmit:qt}),e.jsx(Kr,{open:U,onClose:()=>{ye(!1),ze(null)},file:Oe,onInstallComplete:t=>{a("success",`Component installation completed: ${t.componentName}`),t.previewUrl&&a("info",`Preview available at: ${t.previewUrl}`)},onConsoleMessage:a}),e.jsxs(Ke,{open:ys,onClose:()=>Ue(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsxs(Ge,{children:[e.jsx(Bs,{sx:{mr:1,verticalAlign:"middle"}}),"Start OMAI Training Session"]}),e.jsxs(Xe,{children:[e.jsx(s,{variant:"body1",paragraph:!0,children:"Select a training phase to begin OMAI's learning session. Each phase builds upon previous knowledge."}),e.jsxs($e,{fullWidth:!0,children:[e.jsx(kt,{children:"Training Phase"}),e.jsx(r,{mt:1,children:[{id:"foundation",name:"Foundation Knowledge",icon:"ðŸ—ï¸"},{id:"functional",name:"Functional Understanding",icon:"âš™ï¸"},{id:"operational",name:"Operational Intelligence",icon:"ðŸ”§"},{id:"resolution",name:"Issue Resolution",icon:"ðŸ› ï¸"},{id:"predictive",name:"Predictive Capabilities",icon:"ðŸ”®"}].map(t=>e.jsx(K,{sx:{p:2,mb:1,cursor:"pointer",border:ss===t.id?2:1,borderColor:ss===t.id?"primary.main":"divider"},onClick:()=>xs(t.id),children:e.jsxs(s,{variant:"subtitle1",children:[t.icon," ",t.name]})},t.id))})]})]}),e.jsxs(Ye,{children:[e.jsx(k,{onClick:()=>Ue(!1),children:"Cancel"}),e.jsx(k,{onClick:()=>$t(ss),variant:"contained",disabled:Ne,startIcon:Ne?e.jsx(ce,{size:16}):e.jsx(is,{}),children:Ne?"Starting...":"Start Training"})]})]}),e.jsxs(Ke,{open:Rt,onClose:()=>As(!1),maxWidth:"md",fullWidth:!0,children:[e.jsx(Ge,{children:Ie&&e.jsxs(e.Fragment,{children:[e.jsx(qe,{sx:{mr:1,verticalAlign:"middle"}}),"Ethical Foundation Details",e.jsx(C,{label:Ie.gradeGroup,size:"small",sx:{ml:2}})]})}),e.jsx(Xe,{children:Ie&&e.jsxs(r,{children:[e.jsx(s,{variant:"h6",gutterBottom:!0,color:"primary",children:"Question"}),e.jsx(s,{variant:"body1",paragraph:!0,children:Ie.question}),e.jsx(s,{variant:"h6",gutterBottom:!0,color:"primary",children:"Your Response"}),e.jsx(s,{variant:"body1",paragraph:!0,children:Ie.userResponse}),e.jsx(s,{variant:"h6",gutterBottom:!0,color:"primary",children:"Reasoning"}),e.jsx(s,{variant:"body1",paragraph:!0,children:Ie.reasoning}),e.jsx(ns,{sx:{my:2}}),e.jsxs(p,{container:!0,spacing:2,children:[e.jsxs(p,{item:!0,xs:6,children:[e.jsx(s,{variant:"subtitle2",color:"primary",children:"Category"}),e.jsx(s,{variant:"body2",children:Ie.category.replace("_"," ")})]}),e.jsxs(p,{item:!0,xs:6,children:[e.jsx(s,{variant:"subtitle2",color:"primary",children:"Weight"}),e.jsx(s,{variant:"body2",children:Ie.weight})]}),e.jsxs(p,{item:!0,xs:6,children:[e.jsx(s,{variant:"subtitle2",color:"primary",children:"Confidence"}),e.jsxs(s,{variant:"body2",children:[Ie.confidence,"%"]})]}),e.jsxs(p,{item:!0,xs:6,children:[e.jsx(s,{variant:"subtitle2",color:"primary",children:"Created"}),e.jsx(s,{variant:"body2",children:new Date(Ie.createdAt).toLocaleString()})]})]}),Ie.appliedContexts.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(ns,{sx:{my:2}}),e.jsx(s,{variant:"subtitle2",color:"primary",gutterBottom:!0,children:"Applied Contexts"}),e.jsx(r,{display:"flex",flexWrap:"wrap",gap:1,children:Ie.appliedContexts.map((t,i)=>e.jsx(C,{label:t,size:"small",variant:"outlined"},i))})]}),Ie.lastReferenced&&e.jsxs(e.Fragment,{children:[e.jsx(ns,{sx:{my:2}}),e.jsx(s,{variant:"subtitle2",color:"primary",children:"Last Referenced"}),e.jsx(s,{variant:"body2",children:new Date(Ie.lastReferenced).toLocaleString()})]})]})}),e.jsx(Ye,{children:e.jsx(k,{onClick:()=>As(!1),children:"Close"})})]})]})};export{aa as default};
//# sourceMappingURL=OMBigBook-Dbryubnb.js.map
