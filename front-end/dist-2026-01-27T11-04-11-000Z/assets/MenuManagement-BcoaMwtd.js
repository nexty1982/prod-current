var L=Object.defineProperty,U=Object.defineProperties;var N=Object.getOwnPropertyDescriptors;var I=Object.getOwnPropertySymbols;var O=Object.prototype.hasOwnProperty,W=Object.prototype.propertyIsEnumerable;var R=(i,r,t)=>r in i?L(i,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[r]=t,T=(i,r)=>{for(var t in r||(r={}))O.call(r,t)&&R(i,t,r[t]);if(I)for(var t of I(r))W.call(r,t)&&R(i,t,r[t]);return i},w=(i,r)=>U(i,N(r));var S=(i,r,t)=>new Promise((f,j)=>{var C=a=>{try{x(t.next(a))}catch(g){j(g)}},b=a=>{try{x(t.throw(a))}catch(g){j(g)}},x=a=>a.done?f(a.value):Promise.resolve(a.value).then(C,b);x((t=t.apply(i,r)).next())});import{c as Y,k as D,j as e,B as o,$ as v,C as J,d as m,e as E,aI as K,U as Q,Q as G,R as X,T as Z,h as V,F as ee,r as se}from"./index-BDfVhljI.js";import{r as p,b as ne}from"./vendor-DgfDxsY7.js";import{I as te}from"./IconDeviceFloppy-BRZw01Q4.js";import{T as re,a as ae,b as ie,c as F,d as oe}from"./TableRow-CY_CMYLL.js";import{T as c}from"./TableCell-Cc2Re30I.js";import{I as z}from"./IconLock-CXRpHBr6.js";/**
 * @license @tabler/icons-react v3.34.1 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=[["path",{d:"M4 8l16 0",key:"svg-0"}],["path",{d:"M4 16l16 0",key:"svg-1"}]],ce=Y("outline","menu","Menu",le),B=["admin","church_admin","priest","deacon","editor","viewer"],je=()=>{const{isSuperAdmin:i}=D(),[r,t]=p.useState([]),[f,j]=p.useState(!0),[C,b]=p.useState(!1),[x,a]=p.useState(null),[g,M]=p.useState(null),[d,k]=p.useState([]);if(!i())return e.jsx(o,{p:3,children:e.jsx(v,{severity:"error",children:"You do not have permission to access menu management. Only super administrators can manage menu permissions."})});p.useEffect(()=>{_()},[]);const _=()=>S(void 0,null,function*(){try{j(!0),a(null);const s=yield fetch("/api/menu-management/permissions",{credentials:"include"});if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const n=yield s.json();n.success?t(n.menuPermissions):a(n.message||"Failed to fetch menu permissions")}catch(s){console.error("Error fetching menu permissions:",s),a("Failed to load menu permissions. Please try again.")}finally{j(!1)}}),$=(s,n,l)=>{t(u=>u.map(h=>h.id===s?w(T({},h),{permissions:w(T({},h.permissions),{[n]:l})}):h)),k(u=>{const h=u.findIndex(y=>y.menu_item_id===s&&y.role===n);if(h>=0){const y=[...u];return y[h]={menu_item_id:s,role:n,is_visible:l},y}else return[...u,{menu_item_id:s,role:n,is_visible:l}]})},q=()=>S(void 0,null,function*(){if(d.length!==0)try{b(!0),a(null),M(null);const s=yield fetch("/api/menu-management/permissions",{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({updates:d})});if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const n=yield s.json();n.success?(M(`Successfully updated ${n.updatedCount} menu permissions`),k([]),setTimeout(()=>{_()},1e3)):a(n.message||"Failed to update menu permissions")}catch(s){console.error("Error saving menu permissions:",s),a("Failed to save menu permissions. Please try again.")}finally{b(!1)}}),A=()=>r.filter(s=>s.parent_id===null),H=s=>r.filter(n=>n.parent_id===s),P=(s,n=!1)=>e.jsxs(F,{sx:{backgroundColor:n?"action.hover":"inherit"},children:[e.jsxs(c,{children:[e.jsxs(o,{display:"flex",alignItems:"center",gap:1,children:[n&&e.jsx(o,{width:20}),e.jsx(m,{variant:n?"body2":"body1",fontWeight:n?"normal":"medium",children:s.title}),s.is_system_required&&e.jsx(Z,{title:"System required - cannot be disabled",children:e.jsx(z,{size:16,color:"orange"})})]}),s.description&&e.jsx(m,{variant:"caption",color:"text.secondary",display:"block",children:s.description})]}),e.jsx(c,{children:e.jsx(V,{label:s.menu_key,size:"small",variant:"outlined"})}),e.jsx(c,{children:s.path||"-"}),B.map(l=>e.jsx(c,{align:"center",children:e.jsx(ee,{control:e.jsx(se,{checked:s.permissions[l]||!1,onChange:u=>$(s.id,l,u.target.checked),disabled:s.is_system_required&&!s.permissions[l],size:"small"}),label:""})},l))]},s.id);return f?e.jsx(o,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:e.jsx(J,{})}):e.jsxs(o,{p:3,children:[e.jsxs(o,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,children:[e.jsxs(o,{children:[e.jsx(m,{variant:"h4",gutterBottom:!0,children:"Menu Management"}),e.jsx(m,{variant:"body2",color:"text.secondary",children:"Control which menu items are visible to each user role"})]}),e.jsxs(o,{display:"flex",gap:1,children:[e.jsx(E,{variant:"outlined",startIcon:e.jsx(K,{}),onClick:_,disabled:f,children:"Refresh"}),e.jsxs(E,{variant:"contained",startIcon:e.jsx(te,{}),onClick:q,disabled:C||d.length===0,children:["Save Changes ",d.length>0&&`(${d.length})`]})]})]}),x&&e.jsx(v,{severity:"error",sx:{mb:2},children:x}),g&&e.jsx(v,{severity:"success",sx:{mb:2},children:g}),d.length>0&&e.jsxs(v,{severity:"info",sx:{mb:2},children:["You have ",d.length,' unsaved changes. Click "Save Changes" to apply them.']}),e.jsx(Q,{children:e.jsxs(G,{children:[e.jsxs(o,{display:"flex",alignItems:"center",gap:1,mb:2,children:[e.jsx(ce,{}),e.jsx(m,{variant:"h6",children:"Menu Permissions by Role"})]}),e.jsx(re,{component:X,variant:"outlined",children:e.jsxs(ae,{size:"small",children:[e.jsx(ie,{children:e.jsxs(F,{children:[e.jsx(c,{children:"Menu Item"}),e.jsx(c,{children:"Key"}),e.jsx(c,{children:"Path"}),B.map(s=>e.jsx(c,{align:"center",children:e.jsx(m,{variant:"caption",fontWeight:"bold",children:s.replace("_"," ").toUpperCase()})},s))]})}),e.jsx(oe,{children:A().map(s=>e.jsxs(ne.Fragment,{children:[P(s),H(s.id).map(n=>P(n,!0))]},s.id))})]})}),e.jsx(o,{mt:2,children:e.jsxs(m,{variant:"caption",color:"text.secondary",children:[e.jsx(z,{size:14,style:{verticalAlign:"middle",marginRight:4}}),"System required items cannot be disabled and are always visible to all roles."]})})]})})]})};export{je as default};
//# sourceMappingURL=MenuManagement-BcoaMwtd.js.map
