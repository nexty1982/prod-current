var ne=Object.defineProperty,ie=Object.defineProperties;var le=Object.getOwnPropertyDescriptors;var M=Object.getOwnPropertySymbols;var P=Object.prototype.hasOwnProperty,E=Object.prototype.propertyIsEnumerable;var F=(s,t,a)=>t in s?ne(s,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[t]=a,y=(s,t)=>{for(var a in t||(t={}))P.call(t,a)&&F(s,a,t[a]);if(M)for(var a of M(t))E.call(t,a)&&F(s,a,t[a]);return s},L=(s,t)=>ie(s,le(t));var O=(s,t)=>{var a={};for(var r in s)P.call(s,r)&&t.indexOf(r)<0&&(a[r]=s[r]);if(s!=null&&M)for(var r of M(s))t.indexOf(r)<0&&E.call(s,r)&&(a[r]=s[r]);return a};var B=(s,t,a)=>new Promise((r,l)=>{var j=d=>{try{v(a.next(d))}catch(f){l(f)}},b=d=>{try{v(a.throw(d))}catch(f){l(f)}},v=d=>d.done?r(d.value):Promise.resolve(d.value).then(j,b);v((a=a.apply(s,t)).next())});import{k as oe,j as e,B as c,$ as h,d as n,e as I,C as ce,U as T,Q as D,h as o,G as $,R as N}from"./index-BDfVhljI.js";import{r as m}from"./vendor-DgfDxsY7.js";import{S as de}from"./Assessment-BNyxY7rh.js";import{S as xe}from"./PlayArrow-B57F9d0M.js";import{D as R}from"./Download-Dy8080P5.js";import{L as me}from"./LinearProgress-D2-YLZ1_.js";import{T as he,a as g}from"./Tabs-VYJhMi1b.js";import{F as V}from"./Folder-KuAGu-QG.js";import{M as U}from"./Menu-B6r3LPUA.js";import{P as je}from"./People-_FyghlwF.js";import{C as ue}from"./Web-GEvO_HVL.js";import{S as pe}from"./Storage-B3wr3cCg.js";import{W as H}from"./Warning-C63rUtT9.js";import{I as ye}from"./Info-mPVCfH-0.js";import{A as be,a as ve,b as fe}from"./AccordionSummary-D4_s6jxW.js";import{E as Se}from"./ExpandMore-Bcngkytz.js";import{T as G,a as J,b as Q,c as A,d as _}from"./TableRow-CY_CMYLL.js";import{T as i}from"./TableCell-Cc2Re30I.js";import{C as q}from"./CheckCircle-BzDkpPsE.js";import{E as W}from"./Error-BzsfDbfb.js";import"./KeyboardArrowRight-n0bX-S0N.js";function C(s){const j=s,{children:t,value:a,index:r}=j,l=O(j,["children","value","index"]);return e.jsx("div",L(y({role:"tabpanel",hidden:a!==r,id:`survey-tabpanel-${r}`,"aria-labelledby":`survey-tab-${r}`},l),{children:a===r&&e.jsx(c,{sx:{p:3},children:t})}))}function w(s){return{id:`survey-tab-${s}`,"aria-controls":`survey-tabpanel-${s}`}}const qe=()=>{const{user:s}=oe(),[t,a]=m.useState(0),[r,l]=m.useState(!1),[j,b]=m.useState(0),[v,d]=m.useState(null),[f,K]=m.useState(null),[X,Y]=m.useState(null),[Z,ee]=m.useState(null),[se,re]=m.useState(null);if(!s||s.role!=="super_admin")return e.jsx(c,{sx:{p:3},children:e.jsxs(h,{severity:"error",sx:{mb:2},children:[e.jsx(n,{variant:"h6",children:"Access Denied"}),e.jsxs(n,{children:["This tool is only accessible to users with super_admin privileges. Current role: ",(s==null?void 0:s.role)||"Not authenticated"]})]})});const ae=(x,u)=>{a(u)},te=()=>B(void 0,null,function*(){l(!0),b(0);try{const x=[{name:"Filesystem Analysis",endpoint:"/api/survey/filesystem",setter:d},{name:"Menu Audit",endpoint:"/api/survey/menu-audit",setter:K},{name:"Role Mapping",endpoint:"/api/survey/user-roles",setter:Y},{name:"Database Analysis",endpoint:"/api/survey/database-analysis",setter:re},{name:"Site Crawler",endpoint:"/api/survey/start-crawler",setter:ee}];for(let u=0;u<x.length;u++){const p=x[u];b(u/x.length*100),console.log(`ðŸ”„ Executing: ${p.name}`);try{const S=yield fetch(p.endpoint,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include"});if(S.ok){const k=yield S.json();k.success?(p.setter(k),console.log(`âœ… ${p.name} completed`)):console.error(`âŒ ${p.name} failed:`,k.error)}else console.error(`âŒ ${p.name} failed with status:`,S.status)}catch(S){console.error(`âŒ ${p.name} error:`,S)}b((u+1)/x.length*100)}console.log("ðŸŽ‰ Survey complete!")}catch(x){console.error("âŒ Survey failed:",x)}finally{l(!1)}}),z=x=>{console.log(`Exporting results as ${x}`)};return e.jsxs(c,{sx:{width:"100%",p:3},children:[e.jsxs(c,{sx:{mb:3},children:[e.jsxs(n,{variant:"h4",sx:{mb:1,display:"flex",alignItems:"center",gap:1},children:[e.jsx(de,{color:"primary"}),"OrthodoxMetrics Site Survey"]}),e.jsx(n,{variant:"body1",color:"textSecondary",sx:{mb:2},children:"Comprehensive internal site analysis and audit tool for super administrators"}),e.jsxs(c,{sx:{display:"flex",gap:2,flexWrap:"wrap"},children:[e.jsx(I,{variant:"contained",startIcon:r?e.jsx(ce,{size:16}):e.jsx(xe,{}),onClick:te,disabled:r,size:"large",children:r?"Running Survey...":"Start Complete Survey"}),e.jsx(I,{variant:"outlined",startIcon:e.jsx(R,{}),onClick:()=>z("json"),disabled:r,children:"Export JSON"}),e.jsx(I,{variant:"outlined",startIcon:e.jsx(R,{}),onClick:()=>z("csv"),disabled:r,children:"Export CSV"}),e.jsx(I,{variant:"outlined",startIcon:e.jsx(R,{}),onClick:()=>z("md"),disabled:r,children:"Export Markdown"})]}),r&&e.jsxs(c,{sx:{mt:2},children:[e.jsx(me,{variant:"determinate",value:j}),e.jsxs(n,{variant:"body2",sx:{mt:1},children:["Survey Progress: ",Math.round(j),"%"]})]})]}),e.jsx(c,{sx:{borderBottom:1,borderColor:"divider"},children:e.jsxs(he,{value:t,onChange:ae,"aria-label":"survey tabs",children:[e.jsx(g,y({label:"Filesystem Audit",icon:e.jsx(V,{}),iconPosition:"start"},w(0))),e.jsx(g,y({label:"Menu Map",icon:e.jsx(U,{}),iconPosition:"start"},w(1))),e.jsx(g,y({label:"Role/Access Matrix",icon:e.jsx(je,{}),iconPosition:"start"},w(2))),e.jsx(g,y({label:"Live Crawler Console",icon:e.jsx(ue,{}),iconPosition:"start"},w(3))),e.jsx(g,y({label:"Database Snapshot",icon:e.jsx(pe,{}),iconPosition:"start"},w(4)))]})}),e.jsx(C,{value:t,index:0,children:e.jsx(ge,{data:v})}),e.jsx(C,{value:t,index:1,children:e.jsx(Ce,{data:f})}),e.jsx(C,{value:t,index:2,children:e.jsx(we,{data:X})}),e.jsx(C,{value:t,index:3,children:e.jsx(Te,{data:Z})}),e.jsx(C,{value:t,index:4,children:e.jsx(De,{data:se})})]})},ge=({data:s})=>{var t,a;return e.jsx(T,{children:e.jsxs(D,{children:[e.jsx(n,{variant:"h6",sx:{mb:2},children:"ðŸ—‚ Filesystem Analysis"}),e.jsx(h,{severity:"info",sx:{mb:2},children:"Scans the entire /prod directory for TypeScript, JavaScript, and SQL files. Shows last modified dates and identifies unused files."}),s&&s.success?e.jsxs(c,{children:[e.jsxs(c,{sx:{mb:3,display:"flex",gap:2,flexWrap:"wrap"},children:[e.jsx(o,{label:`Total Files: ${s.summary.totalFiles}`,color:"primary",icon:e.jsx(V,{})}),e.jsx(o,{label:`Stale Files (60+ days): ${s.summary.staleFiles}`,color:"warning",icon:e.jsx(H,{})}),e.jsx(o,{label:`Categories: ${Object.keys(s.summary.categories).length}`,color:"info",icon:e.jsx(ye,{})})]}),e.jsxs(be,{sx:{mb:2},children:[e.jsx(ve,{expandIcon:e.jsx(Se,{}),children:e.jsx(n,{variant:"subtitle1",children:"ðŸ“Š File Categories & Extensions"})}),e.jsx(fe,{children:e.jsxs($,{container:!0,spacing:2,children:[e.jsxs($,{item:!0,xs:12,md:6,children:[e.jsx(n,{variant:"subtitle2",gutterBottom:!0,children:"Categories"}),(t=s.summary)!=null&&t.categories?Object.entries(s.summary.categories).map(([r,l])=>e.jsxs(c,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[e.jsx(n,{variant:"body2",children:r}),e.jsx(o,{size:"small",label:l})]},r)):e.jsx(n,{variant:"body2",color:"textSecondary",children:"No category data"})]}),e.jsxs($,{item:!0,xs:12,md:6,children:[e.jsx(n,{variant:"subtitle2",gutterBottom:!0,children:"Extensions"}),(a=s.summary)!=null&&a.extensions?Object.entries(s.summary.extensions).map(([r,l])=>e.jsxs(c,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[e.jsx(n,{variant:"body2",sx:{fontFamily:"monospace"},children:r}),e.jsx(o,{size:"small",label:l})]},r)):e.jsx(n,{variant:"body2",color:"textSecondary",children:"No extension data"})]})]})})]}),e.jsx(G,{component:N,sx:{maxHeight:400},children:e.jsxs(J,{stickyHeader:!0,size:"small",children:[e.jsx(Q,{children:e.jsxs(A,{children:[e.jsx(i,{children:"Path"}),e.jsx(i,{children:"Category"}),e.jsx(i,{children:"Size"}),e.jsx(i,{children:"Last Modified"}),e.jsx(i,{children:"Status"})]})}),e.jsx(_,{children:s.data.slice(0,100).map((r,l)=>e.jsxs(A,{children:[e.jsx(i,{children:e.jsx(n,{variant:"body2",sx:{fontFamily:"monospace",fontSize:"0.75rem"},children:r.path})}),e.jsx(i,{children:e.jsx(o,{size:"small",label:r.category})}),e.jsx(i,{children:e.jsxs(n,{variant:"body2",children:[(r.size/1024).toFixed(1)," KB"]})}),e.jsx(i,{children:e.jsx(n,{variant:"body2",children:new Date(r.lastModified).toLocaleDateString()})}),e.jsx(i,{children:r.isStale?e.jsx(o,{size:"small",label:"Stale",color:"warning",icon:e.jsx(H,{})}):e.jsx(o,{size:"small",label:"Active",color:"success",icon:e.jsx(q,{})})})]},l))})]})}),s.data.length>100&&e.jsxs(n,{variant:"caption",color:"textSecondary",sx:{mt:1,display:"block"},children:["Showing first 100 of ",s.data.length," files. Export for complete data."]}),e.jsxs(n,{variant:"caption",color:"textSecondary",sx:{mt:2,display:"block"},children:["Last updated: ",new Date(s.timestamp).toLocaleString()]})]}):e.jsx(h,{severity:"info",children:'Click "Start Complete Survey" to analyze the filesystem structure'})]})})},Ce=({data:s})=>{var t;return e.jsx(T,{children:e.jsxs(D,{children:[e.jsx(n,{variant:"h6",sx:{mb:2},children:"ðŸ§­ Menu Structure Audit"}),e.jsx(h,{severity:"info",sx:{mb:2},children:"Analyzes vertical, horizontal, and quick link menus. Shows role-based visibility and orphaned routes."}),s&&s.success?e.jsxs(c,{children:[e.jsxs(c,{sx:{mb:3,display:"flex",gap:2,flexWrap:"wrap"},children:[e.jsx(o,{label:`Total Menu Items: ${s.summary.totalItems}`,color:"primary",icon:e.jsx(U,{})}),e.jsx(o,{label:`Orphaned Routes: ${s.summary.orphanedRoutes}`,color:"error",icon:e.jsx(W,{})}),(t=s.summary)!=null&&t.menuTypes?Object.entries(s.summary.menuTypes).map(([a,r])=>e.jsx(o,{label:`${a}: ${r}`,color:"info"},a)):null]}),e.jsx(G,{component:N,sx:{maxHeight:400},children:e.jsxs(J,{stickyHeader:!0,size:"small",children:[e.jsx(Q,{children:e.jsxs(A,{children:[e.jsx(i,{children:"Title"}),e.jsx(i,{children:"Route"}),e.jsx(i,{children:"Menu Type"}),e.jsx(i,{children:"Roles"}),e.jsx(i,{children:"Visible To"}),e.jsx(i,{children:"Status"})]})}),e.jsx(_,{children:s.data.map((a,r)=>e.jsxs(A,{children:[e.jsx(i,{children:e.jsx(n,{variant:"body2",children:a.title})}),e.jsx(i,{children:e.jsx(n,{variant:"body2",sx:{fontFamily:"monospace"},children:a.route})}),e.jsx(i,{children:e.jsx(o,{size:"small",label:a.menuType})}),e.jsx(i,{children:e.jsx(c,{sx:{display:"flex",gap:.5,flexWrap:"wrap"},children:a.roles.map(l=>e.jsx(o,{size:"small",label:l,variant:"outlined"},l))})}),e.jsx(i,{children:e.jsxs(n,{variant:"body2",children:[a.visibleToUsers.length," users"]})}),e.jsx(i,{children:a.isOrphaned?e.jsx(o,{size:"small",label:"Orphaned",color:"error",icon:e.jsx(W,{})}):e.jsx(o,{size:"small",label:"Active",color:"success",icon:e.jsx(q,{})})})]},r))})]})}),e.jsxs(n,{variant:"caption",color:"textSecondary",sx:{mt:2,display:"block"},children:["Last updated: ",new Date(s.timestamp).toLocaleString()]})]}):e.jsx(h,{severity:"info",children:'Click "Start Complete Survey" to analyze menu structure'})]})})},we=({data:s})=>e.jsx(T,{children:e.jsxs(D,{children:[e.jsx(n,{variant:"h6",sx:{mb:2},children:"ðŸ‘¥ User Role & Access Matrix"}),e.jsx(h,{severity:"info",sx:{mb:2},children:"Maps user accounts to their roles and shows menu visibility. Highlights role conflicts and unused permissions."}),e.jsx(n,{variant:"body2",color:"textSecondary",children:"Role access matrix will be implemented here..."})]})}),Te=({data:s})=>e.jsx(T,{children:e.jsxs(D,{children:[e.jsx(n,{variant:"h6",sx:{mb:2},children:"ðŸ§ª Live Site Crawler"}),e.jsx(h,{severity:"info",sx:{mb:2},children:"Headless browser crawler that navigates through all site areas. Shows real-time console output and identifies issues."}),e.jsx(n,{variant:"body2",color:"textSecondary",children:"Live crawler console will be implemented here..."})]})}),De=({data:s})=>e.jsx(T,{children:e.jsxs(D,{children:[e.jsx(n,{variant:"h6",sx:{mb:2},children:"ðŸ§¬ Database Analysis"}),e.jsx(h,{severity:"info",sx:{mb:2},children:"Analyzes MariaDB schema, identifies duplicate tables, and shows database relationships."}),e.jsx(n,{variant:"body2",color:"textSecondary",children:"Database analysis will be implemented here..."})]})});export{qe as default};
//# sourceMappingURL=OMSiteSurvey-BZZNoacZ.js.map
