{"version":3,"file":"Gallery-D62uxHVb.js","sources":["../../node_modules/@tabler/icons-react/dist/esm/icons/IconArrowsExchange.mjs","../../src/features/devel-tools/system-documentation/gallery.config.ts","../../src/features/devel-tools/om-gallery/Gallery.tsx"],"sourcesContent":["/**\n * @license @tabler/icons-react v3.34.1 - MIT\n *\n * This source code is licensed under the MIT license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createReactComponent from '../createReactComponent.mjs';\n\nconst __iconNode = [[\"path\", { \"d\": \"M7 10h14l-4 -4\", \"key\": \"svg-0\" }], [\"path\", { \"d\": \"M17 14h-14l4 4\", \"key\": \"svg-1\" }]];\nconst IconArrowsExchange = createReactComponent(\"outline\", \"arrows-exchange\", \"ArrowsExchange\", __iconNode);\n\nexport { __iconNode, IconArrowsExchange as default };\n//# sourceMappingURL=IconArrowsExchange.mjs.map\n","/**\r\n * Gallery Component Configuration\r\n * \r\n * This file contains configuration for the Gallery component at /apps/gallery\r\n * \r\n * Backend API Endpoints Required:\r\n * - GET /api/gallery/images - List all images\r\n * - POST /api/gallery/upload - Upload new image\r\n * - POST /api/gallery/delete - Delete image\r\n * \r\n * File Storage:\r\n * - Production: /var/www/orthodoxmetrics/prod/front-end/public/images/\r\n * - Development: front-end/public/images/ (relative to project root)\r\n * \r\n * Allowed File Types: .png, .jpg, .jpeg, .gif, .webp, .svg\r\n * Max File Size: 10MB\r\n */\r\n\r\n/**\r\n * The six canonical image directories used by the Gallery feature.\r\n * These are the standard directories for organizing images across the application.\r\n * \r\n * IMPORTANT: This is the SINGLE SOURCE OF TRUTH for canonical directories.\r\n * All Gallery code should reference this constant, not define directories elsewhere.\r\n */\r\nexport const CANONICAL_IMAGE_DIRECTORIES = [\r\n  'logos',\r\n  'backgrounds',\r\n  'icons',\r\n  'ui',\r\n  'records',\r\n  'misc',\r\n] as const;\r\n\r\nexport type CanonicalImageDirectory = typeof CANONICAL_IMAGE_DIRECTORIES[number];\r\n\r\n/**\r\n * Base path for public images (served from front-end/public/images/)\r\n */\r\nexport const IMAGES_BASE_PATH = '/images';\r\n\r\n/**\r\n * Helper function to check if a directory name is one of the canonical directories\r\n */\r\nexport function isCanonicalDirectory(dirName: string): boolean {\r\n  return CANONICAL_IMAGE_DIRECTORIES.includes(dirName.toLowerCase() as CanonicalImageDirectory);\r\n}\r\n\r\n/**\r\n * Helper function to build an image URL from a directory and filename\r\n * @param directory - Directory name (e.g., 'logos', 'icons')\r\n * @param filename - Image filename (e.g., 'logo.png')\r\n * @returns Full URL path (e.g., '/images/logos/logo.png')\r\n */\r\nexport function buildImageUrl(directory: string, filename: string): string {\r\n  // Normalize directory (remove leading/trailing slashes)\r\n  const normalizedDir = directory.replace(/^\\/+|\\/+$/g, '');\r\n  return `${IMAGES_BASE_PATH}/${normalizedDir}/${filename}`;\r\n}\r\n\r\n/**\r\n * Helper function to extract directory from an image path\r\n * @param imagePath - Full image path (e.g., '/images/logos/logo.png' or 'logos/logo.png')\r\n * @returns Directory name (e.g., 'logos') or null if path is invalid\r\n */\r\nexport function extractDirectoryFromPath(imagePath: string): string | null {\r\n  // Remove leading /images/ if present\r\n  const normalized = imagePath.replace(/^\\/images\\//, '').replace(/^\\//, '');\r\n  const parts = normalized.split('/');\r\n  if (parts.length >= 2) {\r\n    return parts[0];\r\n  }\r\n  return null;\r\n}\r\n\r\nexport const galleryConfig = {\r\n  api: {\r\n    baseUrl: '/api/gallery',\r\n    endpoints: {\r\n      list: '/images',\r\n      upload: '/upload',\r\n      delete: '/delete',\r\n    },\r\n  },\r\n  storage: {\r\n    production: '/var/www/orthodoxmetrics/prod/front-end/public/images',\r\n    development: 'front-end/public/images', // Relative to backend root\r\n  },\r\n  allowedTypes: ['.png', '.jpg', '.jpeg', '.gif', '.webp', '.svg'],\r\n  maxFileSize: 10 * 1024 * 1024, // 10MB\r\n  publicPath: IMAGES_BASE_PATH, // Base URL path for accessing images\r\n  canonicalDirectories: CANONICAL_IMAGE_DIRECTORIES,\r\n  table: {\r\n    // MUI DataGrid configuration\r\n    pageSize: 20,\r\n    pageSizeOptions: [10, 20, 50, 100],\r\n    columns: {\r\n      imageName: { flex: 1, minWidth: 200 },\r\n      imageLocation: { flex: 2, minWidth: 250 },\r\n      imageCreated: { flex: 1, minWidth: 180 },\r\n      fileType: { width: 120 },\r\n      fileSize: { width: 120 },\r\n      actions: { width: 200 },\r\n    },\r\n  },\r\n} as const;\r\n\r\nexport type GalleryConfig = typeof galleryConfig;\r\n\r\n","import React, { useState, useEffect, useRef } from 'react';\r\nimport {\r\n  Box,\r\n  Container,\r\n  Typography,\r\n  IconButton,\r\n  Button,\r\n  Dialog,\r\n  DialogTitle,\r\n  DialogContent,\r\n  DialogActions,\r\n  TextField,\r\n  LinearProgress,\r\n  Alert,\r\n  Card,\r\n  CardMedia,\r\n  useTheme,\r\n  Paper,\r\n  Stack,\r\n  Chip,\r\n  FormControl,\r\n  InputLabel,\r\n  Select,\r\n  MenuItem,\r\n  Tooltip,\r\n  Checkbox,\r\n  FormControlLabel,\r\n  Collapse,\r\n  Divider,\r\n} from '@mui/material';\r\nimport {\r\n  IconArrowLeft,\r\n  IconArrowRight,\r\n  IconUpload,\r\n  IconX,\r\n  IconPhoto,\r\n  IconTrash,\r\n  IconDownload,\r\n  IconFolder,\r\n  IconFolderPlus,\r\n  IconEdit,\r\n  IconArrowsExchange,\r\n  IconSparkles,\r\n  IconCopy,\r\n  IconChevronDown,\r\n  IconChevronUp,\r\n} from '@tabler/icons-react';\r\nimport { styled } from '@mui/material/styles';\r\nimport { DataGrid, GridColDef, GridRowSelectionModel, GridRenderCellParams } from '@mui/x-data-grid';\r\nimport { OMLoading } from '@/components/common/OMLoading';\r\nimport { \r\n  CANONICAL_IMAGE_DIRECTORIES, \r\n  isCanonicalDirectory, \r\n  buildImageUrl, \r\n  extractDirectoryFromPath,\r\n  IMAGES_BASE_PATH \r\n} from '../system-documentation/gallery.config';\r\n\r\nconst GalleryContainer = styled(Container)(({ theme }) => ({\r\n  paddingTop: theme.spacing(4),\r\n  paddingBottom: theme.spacing(4),\r\n  minHeight: '100vh',\r\n}));\r\n\r\nconst ThumbnailGrid = styled(Box)(({ theme }) => ({\r\n  display: 'grid',\r\n  gridTemplateColumns: 'repeat(4, 1fr)',\r\n  gap: theme.spacing(2),\r\n  marginTop: theme.spacing(4),\r\n  marginBottom: theme.spacing(4),\r\n  [theme.breakpoints.down('md')]: {\r\n    gridTemplateColumns: 'repeat(4, 1fr)',\r\n  },\r\n  [theme.breakpoints.down('sm')]: {\r\n    gridTemplateColumns: 'repeat(2, 1fr)',\r\n    gap: theme.spacing(1),\r\n  },\r\n}));\r\n\r\nconst ImageCard = styled(Card)<{ isUsed?: boolean }>(({ theme, isUsed }) => ({\r\n  position: 'relative',\r\n  cursor: 'pointer',\r\n  transition: 'transform 0.2s ease, box-shadow 0.2s ease',\r\n  ...(isUsed && {\r\n    background: 'linear-gradient(90deg, rgba(200, 230, 201, 0.3) 0%, rgba(200, 230, 201, 0.1) 100%)',\r\n    border: `2px solid rgba(76, 175, 80, 0.5)`,\r\n  }),\r\n  '&:hover': {\r\n    transform: 'scale(1.05)',\r\n    boxShadow: theme.shadows[8],\r\n  },\r\n}));\r\n\r\nconst ImageThumbnail = styled(CardMedia)(({ theme }) => ({\r\n  width: '100%',\r\n  height: '150px',\r\n  objectFit: 'cover',\r\n  [theme.breakpoints.down('sm')]: {\r\n    height: '120px',\r\n  },\r\n}));\r\n\r\nconst CarouselContainer = styled(Box)(({ theme }) => ({\r\n  position: 'relative',\r\n  width: '100%',\r\n  maxWidth: '800px',\r\n  margin: '0 auto',\r\n  marginBottom: theme.spacing(4),\r\n}));\r\n\r\nconst CarouselButton = styled(IconButton)(({ theme }) => ({\r\n  position: 'absolute',\r\n  top: '50%',\r\n  transform: 'translateY(-50%)',\r\n  backgroundColor: theme.palette.mode === 'dark' ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.05)',\r\n  border: `2px solid ${theme.palette.mode === 'dark' ? '#C8A24B' : '#C8A24B'}`,\r\n  color: '#C8A24B',\r\n  width: 56,\r\n  height: 56,\r\n  zIndex: 10,\r\n  '&:hover': {\r\n    backgroundColor: theme.palette.mode === 'dark' ? 'rgba(200, 162, 75, 0.2)' : 'rgba(200, 162, 75, 0.1)',\r\n    borderColor: '#B8923A',\r\n  },\r\n  [theme.breakpoints.down('sm')]: {\r\n    width: 44,\r\n    height: 44,\r\n  },\r\n}));\r\n\r\nconst CarouselImageContainer = styled(Box)<{ isUsed?: boolean }>(({ theme, isUsed }) => ({\r\n  width: '100%',\r\n  height: '400px',\r\n  display: 'flex',\r\n  alignItems: 'center',\r\n  justifyContent: 'center',\r\n  backgroundColor: theme.palette.mode === 'dark' ? '#1a1a1a' : '#f5f5f5',\r\n  borderRadius: '8px',\r\n  overflow: 'hidden',\r\n  ...(isUsed && {\r\n    background: 'linear-gradient(90deg, rgba(200, 230, 201, 0.3) 0%, rgba(200, 230, 201, 0.1) 100%)',\r\n    border: `3px solid rgba(76, 175, 80, 0.6)`,\r\n  }),\r\n  [theme.breakpoints.down('md')]: {\r\n    height: '300px',\r\n  },\r\n  [theme.breakpoints.down('sm')]: {\r\n    height: '250px',\r\n  },\r\n}));\r\n\r\ninterface GalleryImage {\r\n  id?: string;\r\n  name: string;\r\n  path: string;\r\n  url: string;\r\n  created?: string;\r\n  modified?: string;\r\n  size?: number;\r\n  type?: string;\r\n  isUsed?: boolean; // Whether image is used in codebase (true=used, false=not_used, undefined=not_checked)\r\n  metadataError?: string; // Error message if file stats couldn't be read\r\n}\r\n\r\nconst Gallery: React.FC = () => {\r\n  const theme = useTheme();\r\n  const [images, setImages] = useState<GalleryImage[]>([]);\r\n  const [uploadDialogOpen, setUploadDialogOpen] = useState(false);\r\n  const [imageDialogOpen, setImageDialogOpen] = useState(false);\r\n  const [selectedImage, setSelectedImage] = useState<GalleryImage | null>(null);\r\n  const [uploading, setUploading] = useState(false);\r\n  const [uploadProgress, setUploadProgress] = useState(0);\r\n  const [uploadError, setUploadError] = useState<string | null>(null);\r\n  const [selectedFiles, setSelectedFiles] = useState<File[]>([]);\r\n  const [uploadStatus, setUploadStatus] = useState<{ [key: string]: { progress: number; status: 'pending' | 'uploading' | 'success' | 'error'; error?: string } }>({});\r\n  const [deleting, setDeleting] = useState(false);\r\n  const [selectedRows, setSelectedRows] = useState<GridRowSelectionModel>([]);\r\n  const [currentIndex, setCurrentIndex] = useState(0);\r\n  const [sortBy, setSortBy] = useState<'date' | 'name' | 'size' | 'type' | 'location'>('date');\r\n  const [sortOrder, setSortOrder] = useState<'asc' | 'desc'>('desc');\r\n  const [usageFilter, setUsageFilter] = useState<'all' | 'used' | 'unused' | 'not_checked'>('all');\r\n  const [checkingUsage, setCheckingUsage] = useState(false);\r\n  const [exportingUsedImages, setExportingUsedImages] = useState(false);\r\n  const [selectedDirectory, setSelectedDirectory] = useState<string>(''); // Default to root (empty = all images)\r\n  const [directoryTree, setDirectoryTree] = useState<any>({ directories: [], files: [] });\r\n  const [loadingTree, setLoadingTree] = useState(false);\r\n  const [moveDialogOpen, setMoveDialogOpen] = useState(false);\r\n  const [renameDialogOpen, setRenameDialogOpen] = useState(false);\r\n  const [itemToMove, setItemToMove] = useState<GalleryImage | null>(null);\r\n  const [newName, setNewName] = useState('');\r\n  const [targetDir, setTargetDir] = useState('review-required');\r\n  const [suggestions, setSuggestions] = useState<any[]>([]);\r\n  const [suggestionsDialogOpen, setSuggestionsDialogOpen] = useState(false);\r\n  const [suggestionStatuses, setSuggestionStatuses] = useState<Record<number, {\r\n    status: 'pending' | 'valid' | 'invalid' | 'applied' | 'failed';\r\n    message?: string;\r\n    code?: string;\r\n  }>>({});\r\n  const [showFullSummary, setShowFullSummary] = useState(false);\r\n  const [summaryExpanded, setSummaryExpanded] = useState(false);\r\n  const [validating, setValidating] = useState(false);\r\n  const [applying, setApplying] = useState(false);\r\n  const fileInputRef = useRef<HTMLInputElement>(null);\r\n  const hasAutoCheckedUsage = useRef(false); // Track if auto-check has been triggered\r\n  const lastCheckedDirectory = useRef<string>(''); // Track which directory we last checked\r\n  const lastImageCount = useRef<number>(0); // Track image count when we last checked\r\n\r\n  // Sort images function\r\n  const sortImages = (imagesToSort: GalleryImage[]): GalleryImage[] => {\r\n    const sorted = [...imagesToSort].sort((a, b) => {\r\n      let comparison = 0;\r\n      \r\n      switch (sortBy) {\r\n        case 'date':\r\n          // Use modified date (or created if modified not available)\r\n          const dateA = new Date(a.modified || a.created || 0).getTime();\r\n          const dateB = new Date(b.modified || b.created || 0).getTime();\r\n          comparison = dateA - dateB;\r\n          break;\r\n        case 'name':\r\n          comparison = a.name.localeCompare(b.name);\r\n          break;\r\n        case 'size':\r\n          comparison = (a.size || 0) - (b.size || 0);\r\n          break;\r\n        case 'type':\r\n          comparison = (a.type || '').localeCompare(b.type || '');\r\n          break;\r\n        case 'location':\r\n          comparison = (a.path || '').localeCompare(b.path || '');\r\n          break;\r\n        default:\r\n          comparison = 0;\r\n      }\r\n      \r\n      return sortOrder === 'asc' ? comparison : -comparison;\r\n    });\r\n    \r\n    return sorted;\r\n  };\r\n\r\n  // Single source of truth: activeImages combines directory selection, usage filter, and sorting\r\n  // This ensures grid, table, and carousel all use the same filtered and sorted list\r\n  const activeImages = React.useMemo(() => {\r\n    if (!images || images.length === 0) return [];\r\n    \r\n    // Apply usage filter\r\n    let filtered: GalleryImage[] = images;\r\n    if (usageFilter === 'used') {\r\n      filtered = images.filter(img => img && img.isUsed === true);\r\n    } else if (usageFilter === 'unused') {\r\n      filtered = images.filter(img => img && img.isUsed === false);\r\n    } else if (usageFilter === 'not_checked') {\r\n      filtered = images.filter(img => img && img.isUsed === undefined);\r\n    }\r\n    // 'all' case: filtered = images (already set)\r\n    \r\n    // Apply sorting\r\n    return sortImages(filtered);\r\n  }, [images, usageFilter, sortBy, sortOrder]);\r\n\r\n  // Reset carousel index when active images change\r\n  React.useEffect(() => {\r\n    if (activeImages.length > 0 && currentIndex >= activeImages.length) {\r\n      setCurrentIndex(0);\r\n    } else if (activeImages.length === 0) {\r\n      setCurrentIndex(0);\r\n    }\r\n  }, [activeImages.length, currentIndex]);\r\n\r\n  // Carousel navigation handlers - use activeImages instead of images\r\n  const handlePrevious = () => {\r\n    if (activeImages.length === 0) return;\r\n    setCurrentIndex((prev) => (prev === 0 ? activeImages.length - 1 : prev - 1));\r\n  };\r\n\r\n  const handleNext = () => {\r\n    if (activeImages.length === 0) return;\r\n    setCurrentIndex((prev) => (prev === activeImages.length - 1 ? 0 : prev + 1));\r\n  };\r\n\r\n  // Check image usage in codebase (with batching to handle all images)\r\n  const checkImageUsage = async (imagesToCheck: GalleryImage[], checkAll = false) => {\r\n    if (!imagesToCheck || imagesToCheck.length === 0) return;\r\n    \r\n    setCheckingUsage(true);\r\n    \r\n    try {\r\n      // Always check all images when explicitly requested\r\n      // Backend will handle batching internally\r\n      const imagesToProcess = imagesToCheck.filter(img => img != null);\r\n      \r\n      // Process in batches of 500 (backend limit) to avoid timeouts\r\n      const BATCH_SIZE = 500;\r\n      const batches: GalleryImage[][] = [];\r\n      for (let i = 0; i < imagesToProcess.length; i += BATCH_SIZE) {\r\n        batches.push(imagesToProcess.slice(i, i + BATCH_SIZE));\r\n      }\r\n      \r\n      let allUsage: { [key: string]: boolean } = {};\r\n      \r\n      // Process batches sequentially to avoid overwhelming the server\r\n      for (let batchIndex = 0; batchIndex < batches.length; batchIndex++) {\r\n        const batch = batches[batchIndex];\r\n        \r\n        const response = await fetch('/api/gallery/check-usage', {\r\n          method: 'POST',\r\n          headers: {\r\n            'Content-Type': 'application/json',\r\n          },\r\n          credentials: 'include',\r\n          body: JSON.stringify({\r\n            images: batch.map(img => ({\r\n              name: img.name || '',\r\n              path: img.path || '',\r\n            }))\r\n          })\r\n        });\r\n\r\n        if (response.ok) {\r\n          const data = await response.json();\r\n          if (data.success && data.usage) {\r\n            // Merge batch results\r\n            allUsage = { ...allUsage, ...data.usage };\r\n          }\r\n        } else {\r\n          const errorData = await response.json().catch(() => ({}));\r\n          console.error(`Usage check failed for batch ${batchIndex + 1}/${batches.length}:`, errorData);\r\n        }\r\n      }\r\n\r\n      // Update all images with usage information\r\n      setImages(prevImages => {\r\n        if (!prevImages || prevImages.length === 0) return prevImages;\r\n        const updated = prevImages.map(img => {\r\n          if (!img) return img;\r\n          // If the image name is in the usage map, use that value\r\n          // Otherwise, keep as undefined (not checked) if it wasn't in any batch\r\n          const usageValue = allUsage[img.name];\r\n          return {\r\n            ...img,\r\n            isUsed: usageValue !== undefined ? usageValue : img.isUsed // Preserve undefined if not checked\r\n          };\r\n        });\r\n        return sortImages(updated);\r\n      });\r\n    } catch (error: any) {\r\n      console.error('Error checking image usage:', error);\r\n      // Don't mark as unknown on error - preserve existing state\r\n    } finally {\r\n      setCheckingUsage(false);\r\n    }\r\n  };\r\n\r\n  // Re-sort images when sort criteria changes\r\n  useEffect(() => {\r\n    if (images.length > 0) {\r\n      const sorted = sortImages(images);\r\n      setImages(sorted);\r\n    }\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [sortBy, sortOrder]);\r\n\r\n  // Auto-check usage when filter changes for the first time (not 'all')\r\n  useEffect(() => {\r\n    // Only auto-check once, and only if:\r\n    // 1. Filter is not 'all' (user wants to see filtered results)\r\n    // 2. We haven't auto-checked yet\r\n    // 3. We have images loaded\r\n    // 4. We're not already checking\r\n    if (\r\n      !hasAutoCheckedUsage.current &&\r\n      usageFilter !== 'all' &&\r\n      images.length > 0 &&\r\n      !checkingUsage\r\n    ) {\r\n      // Check if there are any images with undefined usage status\r\n      const hasUncheckedImages = images.some(img => img.isUsed === undefined);\r\n      \r\n      if (hasUncheckedImages) {\r\n        hasAutoCheckedUsage.current = true;\r\n        console.log(`ðŸ”„ Auto-checking usage due to filter change to: ${usageFilter}`);\r\n        checkImageUsage(images, true);\r\n      }\r\n    }\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [usageFilter]);\r\n\r\n  // Reset auto-check flag when directory changes\r\n  useEffect(() => {\r\n    hasAutoCheckedUsage.current = false;\r\n    lastCheckedDirectory.current = '';\r\n    lastImageCount.current = 0;\r\n  }, [selectedDirectory]);\r\n\r\n  // Load directory tree on mount, then cleanup empty directories\r\n  useEffect(() => {\r\n    const initializeGallery = async () => {\r\n      await loadDirectoryTree();\r\n      // Clean up empty directories after loading tree\r\n      await cleanupEmptyDirectories();\r\n    };\r\n    initializeGallery();\r\n  }, []);\r\n\r\n  // Load images when directory changes\r\n  useEffect(() => {\r\n    loadImages();\r\n  }, [selectedDirectory]);\r\n\r\n  // Automatically check usage after images are loaded for a directory\r\n  // This effect runs when selectedDirectory changes, then waits for images to load\r\n  useEffect(() => {\r\n    // Only auto-check if a specific directory is selected (not root)\r\n    if (selectedDirectory === '') {\r\n      return;\r\n    }\r\n    \r\n    // Reset flags when directory changes\r\n    hasAutoCheckedUsage.current = false;\r\n    lastImageCount.current = 0;\r\n    \r\n    // Wait for images to load, then check usage\r\n    // Use a longer delay to ensure images are fully loaded\r\n    const checkTimer = setTimeout(() => {\r\n      // Only check if:\r\n      // 1. We have images loaded\r\n      // 2. We haven't already checked this directory (directory is different or never checked)\r\n      // 3. We're not already checking\r\n      // 4. Images have actually been loaded (count > 0)\r\n      const directoryNotChecked = selectedDirectory !== lastCheckedDirectory.current || lastCheckedDirectory.current === '';\r\n      \r\n      if (\r\n        images.length > 0 &&\r\n        selectedDirectory !== '' &&\r\n        directoryNotChecked &&\r\n        !checkingUsage &&\r\n        !hasAutoCheckedUsage.current\r\n      ) {\r\n        lastCheckedDirectory.current = selectedDirectory;\r\n        lastImageCount.current = images.length;\r\n        hasAutoCheckedUsage.current = true;\r\n        checkImageUsage(images, true);\r\n      }\r\n    }, 800); // Wait longer to ensure images are loaded after directory change\r\n    \r\n    return () => clearTimeout(checkTimer);\r\n  }, [selectedDirectory]); // Only trigger on directory change, NOT on images change\r\n\r\n  const loadDirectoryTree = async () => {\r\n    setLoadingTree(true);\r\n    try {\r\n      const urlParams = new URLSearchParams(window.location.search);\r\n      const debug = urlParams.get('debug') === '1' ? '&debug=1' : '';\r\n      const response = await fetch(`/api/gallery/tree?depth=3${debug}`, {\r\n        credentials: 'include',\r\n      });\r\n      if (response.ok) {\r\n        const data = await response.json();\r\n        console.log('ðŸ“ Directory tree loaded:', {\r\n          directories: data.directories?.length || 0,\r\n          files: data.files?.length || 0,\r\n          path: data.path\r\n        });\r\n        setDirectoryTree(data);\r\n        \r\n        // Log debug info if available\r\n        if (data.debug) {\r\n          console.log('ðŸ” [DEBUG] Directory tree debug info:', data.debug);\r\n          if (data.debug.resolvedImagesRoot) {\r\n            console.log(`ðŸ” [DEBUG] Images root: ${data.debug.resolvedImagesRoot}`);\r\n            console.log(`ðŸ” [DEBUG] Root exists: ${data.debug.rootExists}`);\r\n            console.log(`ðŸ” [DEBUG] Root readable: ${data.debug.rootCanRead}`);\r\n            if (data.debug.firstEntries && data.debug.firstEntries.length > 0) {\r\n              console.log(`ðŸ” [DEBUG] First entries:`, data.debug.firstEntries);\r\n            }\r\n          }\r\n        }\r\n      } else {\r\n        const errorData = await response.json().catch(() => ({}));\r\n        console.error('âŒ Error loading directory tree:', {\r\n          status: response.status,\r\n          error: errorData\r\n        });\r\n        // Don't wipe state - keep existing tree if available\r\n        // Just log the error\r\n      }\r\n    } catch (error) {\r\n      console.error('âŒ Error loading directory tree:', error);\r\n      // Don't wipe state - keep existing tree if available\r\n    } finally {\r\n      setLoadingTree(false);\r\n    }\r\n  };\r\n\r\n  const loadImages = async () => {\r\n    try {\r\n      // Root view (empty string) should load all images recursively\r\n      // Otherwise use selected directory (no default fallback - use exactly what's selected)\r\n      const path = selectedDirectory === '' ? '' : selectedDirectory;\r\n      const url = `/api/gallery/images?path=${encodeURIComponent(path)}&recursive=1`;\r\n      console.log('Loading images from:', url);\r\n      \r\n      const response = await fetch(url, {\r\n        credentials: 'include',\r\n      });\r\n      \r\n      if (response.ok) {\r\n        const data = await response.json();\r\n        console.log('ðŸ–¼ï¸ Images loaded:', {\r\n          count: data.count || 0,\r\n          path: data.path,\r\n          recursive: data.recursive\r\n        });\r\n        \r\n        // Log debug info if available\r\n        if (data.debug) {\r\n          console.log('ðŸ” [DEBUG] Images API debug info:', data.debug);\r\n          if (data.debug.resolvedImagesRoot) {\r\n            console.log(`ðŸ” [DEBUG] Images root: ${data.debug.resolvedImagesRoot}`);\r\n            console.log(`ðŸ” [DEBUG] Root exists: ${data.debug.rootExists}`);\r\n            console.log(`ðŸ” [DEBUG] Root readable: ${data.debug.rootCanRead}`);\r\n            if (data.debug.sampleImage) {\r\n              console.log(`ðŸ” [DEBUG] Sample image:`, data.debug.sampleImage);\r\n            }\r\n          }\r\n        }\r\n        \r\n        // Gallery API returns { success: true, count: number, images: [...] }\r\n        // Filter to only show image files (jpg, jpeg, png, gif, tiff, webp, svg)\r\n        const imageExtensions = ['.jpg', '.jpeg', '.png', '.gif', '.tiff', '.webp', '.svg'];\r\n        const imageFiles = (data.images || []).filter((file: any) => {\r\n          const fileName = file.name || file.path || '';\r\n          const ext = fileName.split('.').pop()?.toLowerCase() || '';\r\n          return imageExtensions.includes(`.${ext}`);\r\n        });\r\n        \r\n        // Debug: Log API response structure if needed\r\n        const urlParams = new URLSearchParams(window.location.search);\r\n        if (urlParams.get('debug') === '1' && imageFiles.length > 0) {\r\n          console.log('ðŸ” [DEBUG] Sample image from API:', imageFiles[0]);\r\n          console.log('ðŸ” [DEBUG] Sample image keys:', Object.keys(imageFiles[0]));\r\n        }\r\n        \r\n        // Transform the data to match GalleryImage interface\r\n        const transformedImages = imageFiles.map((file: any, index: number) => {\r\n          // Handle metadata - preserve actual values or error status from API\r\n          let fileSize: number | null = null;\r\n          let fileModified: string | null = null;\r\n          let fileCreated: string | null = null;\r\n          let metadataError: string | null = null;\r\n          \r\n          // Check if API returned error status\r\n          if (file.metadataStatus === 'error') {\r\n            metadataError = file.statError || 'Failed to read file metadata';\r\n            // Keep size/modified/created as null when there's an error\r\n          } else {\r\n            // Parse size as number - API should always return numeric or null\r\n            if (file.size !== undefined && file.size !== null && file.size !== '') {\r\n              fileSize = typeof file.size === 'number' ? file.size : parseInt(String(file.size), 10);\r\n              if (isNaN(fileSize) || fileSize < 0) {\r\n                fileSize = null;\r\n                metadataError = 'Invalid file size value';\r\n              }\r\n            }\r\n            \r\n            // Preserve date strings exactly as received - API should return ISO strings or null\r\n            fileModified = (file.modified && file.modified !== '') ? file.modified : null;\r\n            fileCreated = (file.created && file.created !== '') ? file.created : null;\r\n          }\r\n          \r\n          // Resolve image URL with proper fallback\r\n          // Priority: file.url > file.path > derive from path > fallback\r\n          let imageUrl = file.url;\r\n          if (!imageUrl && file.path) {\r\n            imageUrl = file.path.startsWith('/') ? file.path : `${IMAGES_BASE_PATH}/${file.path}`;\r\n          }\r\n          if (!imageUrl && file.name) {\r\n            // Try to extract directory from path if available\r\n            const directory = file.path ? extractDirectoryFromPath(file.path) : null;\r\n            if (directory) {\r\n              imageUrl = buildImageUrl(directory, file.name);\r\n            } else {\r\n              // Last resort: use first canonical directory (should rarely happen)\r\n              imageUrl = `${IMAGES_BASE_PATH}/${CANONICAL_IMAGE_DIRECTORIES[0]}/${file.name}`;\r\n            }\r\n          }\r\n          \r\n          return {\r\n            id: `img-${index}-${file.name}`,\r\n            name: file.name || 'Unknown',\r\n            path: file.path || file.url || file.name,\r\n            url: imageUrl || '/images/incode/placeholder.png',\r\n            created: fileCreated,\r\n            modified: fileModified,\r\n            size: fileSize,\r\n            type: file.type || file.name?.split('.').pop()?.toLowerCase() || 'unknown',\r\n            isUsed: undefined, // Will be checked separately\r\n            metadataError: metadataError || undefined, // Store error if present\r\n          };\r\n        });\r\n        \r\n        // Don't sort here - sorting will be applied in activeImages useMemo\r\n        // This ensures sorting is applied after filtering\r\n        setImages(transformedImages);\r\n        \r\n        // Reset carousel index when images change\r\n        setCurrentIndex(0);\r\n        \r\n        // Note: Usage status is not auto-checked on load\r\n        // Users must click \"Refresh Usage\" to check which images are used in the codebase\r\n        // This prevents slow page loads and timeouts for large image collections\r\n      } else {\r\n        // Log the actual error for debugging\r\n        const errorData = await response.json().catch(() => ({}));\r\n        console.error('Gallery API error:', {\r\n          status: response.status,\r\n          statusText: response.statusText,\r\n          error: errorData,\r\n          url: url\r\n        });\r\n        setImages([]);\r\n        \r\n        // Show user-friendly error message\r\n        if (response.status === 502) {\r\n          console.error('Backend server may be down or the gallery API endpoint is not available');\r\n        }\r\n      }\r\n    } catch (error: any) {\r\n      // Log the actual error for debugging\r\n      console.error('Gallery API request failed:', {\r\n        error: error.message,\r\n        stack: error.stack\r\n      });\r\n      setImages([]);\r\n    }\r\n  };\r\n\r\n  const handleImageClick = (image: GalleryImage) => {\r\n    setSelectedImage(image);\r\n    setImageDialogOpen(true);\r\n  };\r\n\r\n  const handleOpenInNewWindow = (image: GalleryImage) => {\r\n    const newWindow = window.open('', '_blank');\r\n    if (newWindow) {\r\n      newWindow.document.write(`\r\n        <!DOCTYPE html>\r\n        <html>\r\n          <head>\r\n            <title>${image.name}</title>\r\n            <style>\r\n              body {\r\n                margin: 0;\r\n                padding: 20px;\r\n                font-family: Arial, sans-serif;\r\n                background: #f5f5f5;\r\n              }\r\n              .container {\r\n                max-width: 1200px;\r\n                margin: 0 auto;\r\n                background: white;\r\n                padding: 20px;\r\n                border-radius: 8px;\r\n                box-shadow: 0 2px 8px rgba(0,0,0,0.1);\r\n              }\r\n              .image-info {\r\n                margin-bottom: 20px;\r\n                padding: 15px;\r\n                background: #f9f9f9;\r\n                border-radius: 4px;\r\n              }\r\n              .image-info h2 {\r\n                margin: 0 0 10px 0;\r\n                color: #333;\r\n              }\r\n              .image-info p {\r\n                margin: 5px 0;\r\n                color: #666;\r\n              }\r\n              .image-container {\r\n                text-align: center;\r\n                margin: 20px 0;\r\n              }\r\n              .image-container img {\r\n                max-width: 100%;\r\n                height: auto;\r\n                border-radius: 4px;\r\n                box-shadow: 0 2px 8px rgba(0,0,0,0.1);\r\n              }\r\n              .actions {\r\n                margin-top: 20px;\r\n                text-align: center;\r\n              }\r\n              .btn {\r\n                padding: 10px 20px;\r\n                margin: 0 10px;\r\n                border: none;\r\n                border-radius: 4px;\r\n                cursor: pointer;\r\n                font-size: 14px;\r\n              }\r\n              .btn-delete {\r\n                background: #d32f2f;\r\n                color: white;\r\n              }\r\n              .btn-delete:hover {\r\n                background: #b71c1c;\r\n              }\r\n              .btn-close {\r\n                background: #666;\r\n                color: white;\r\n              }\r\n              .btn-close:hover {\r\n                background: #444;\r\n              }\r\n            </style>\r\n          </head>\r\n          <body>\r\n            <div class=\"container\">\r\n              <div class=\"image-info\">\r\n                <h2>Image Information</h2>\r\n                <p><strong>Image Name:</strong> ${image.name}</p>\r\n                <p><strong>Image Path:</strong> ${image.path}</p>\r\n                <p><strong>Image Type:</strong> ${image.type || 'Unknown'}</p>\r\n                ${image.size ? `<p><strong>Image Size:</strong> ${(image.size / 1024).toFixed(2)} KB</p>` : ''}\r\n                ${image.created ? `<p><strong>Created:</strong> ${new Date(image.created).toLocaleString()}</p>` : ''}\r\n              </div>\r\n              <div class=\"image-container\">\r\n                <img src=\"${image.url}\" alt=\"${image.name}\" onerror=\"this.src='/images/incode/placeholder.png'\" />\r\n              </div>\r\n              <div class=\"actions\">\r\n                <button class=\"btn btn-delete\" onclick=\"deleteImage()\">Delete Image</button>\r\n                <button class=\"btn btn-close\" onclick=\"window.close()\">Close</button>\r\n              </div>\r\n            </div>\r\n            <script>\r\n              function deleteImage() {\r\n                if (confirm('Are you sure you want to delete this image?')) {\r\n                  const relativePath = '${image.path}'.replace(/^\\\\/images\\\\//, '');\r\n                  fetch('/api/gallery/file', {\r\n                    method: 'DELETE',\r\n                    headers: {\r\n                      'Content-Type': 'application/json',\r\n                    },\r\n                    credentials: 'include',\r\n                    body: JSON.stringify({ path: relativePath })\r\n                  })\r\n                  .then(response => response.json())\r\n                  .then(data => {\r\n                    if (data.success) {\r\n                      alert('Image deleted successfully');\r\n                      window.close();\r\n                      if (window.opener) {\r\n                        window.opener.location.reload();\r\n                      }\r\n                    } else {\r\n                      alert('Failed to delete image: ' + (data.message || 'Unknown error'));\r\n                    }\r\n                  })\r\n                  .catch(error => {\r\n                    console.error('Error:', error);\r\n                    alert('Failed to delete image');\r\n                  });\r\n                }\r\n              }\r\n            </script>\r\n          </body>\r\n        </html>\r\n      `);\r\n      newWindow.document.close();\r\n    }\r\n  };\r\n\r\n  const handleDeleteImage = async (image: GalleryImage) => {\r\n    if (!window.confirm(`Are you sure you want to delete \"${image.name}\"?`)) {\r\n      return;\r\n    }\r\n\r\n    setDeleting(true);\r\n    try {\r\n      // Extract relative path from /images/... path\r\n      const relativePath = image.path.replace(/^\\/images\\//, '');\r\n      console.log('ðŸ—‘ï¸ [Frontend] Single delete:', {\r\n        name: image.name,\r\n        originalPath: image.path,\r\n        relativePath: relativePath,\r\n        selectedDirectory: selectedDirectory\r\n      });\r\n      \r\n      const response = await fetch('/api/gallery/file', {\r\n        method: 'DELETE',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n        },\r\n        credentials: 'include',\r\n        body: JSON.stringify({ path: relativePath })\r\n      });\r\n\r\n      console.log('ðŸ—‘ï¸ [Frontend] Delete response status:', response.status, response.statusText);\r\n\r\n      if (response.ok) {\r\n        const result = await response.json().catch(() => ({}));\r\n        console.log('ðŸ—‘ï¸ [Frontend] Delete successful:', result);\r\n        await loadImages();\r\n        await loadDirectoryTree();\r\n        setImageDialogOpen(false);\r\n        setSelectedImage(null);\r\n      } else {\r\n        let errorMessage = 'Unknown error';\r\n        try {\r\n          const errorData = await response.json();\r\n          console.error('ðŸ—‘ï¸ [Frontend] Delete error response:', errorData);\r\n          errorMessage = errorData.error || errorData.message || `HTTP ${response.status}: ${response.statusText}`;\r\n        } catch (e) {\r\n          console.error('ðŸ—‘ï¸ [Frontend] Failed to parse error response:', e);\r\n          errorMessage = `HTTP ${response.status}: ${response.statusText}`;\r\n        }\r\n        alert(`Failed to delete image: ${errorMessage}`);\r\n      }\r\n    } catch (error: any) {\r\n      console.error('ðŸ—‘ï¸ [Frontend] Error deleting image:', error);\r\n      alert(`Failed to delete image: ${error.message || 'Network error'}`);\r\n    } finally {\r\n      setDeleting(false);\r\n    }\r\n  };\r\n\r\n  const handleMoveImage = async (image: GalleryImage, targetDir: string) => {\r\n    try {\r\n      const relativePath = image.path.replace(/^\\/images\\//, '');\r\n      const targetPath = targetDir ? `${targetDir}/${image.name}` : image.name;\r\n      \r\n      const response = await fetch('/api/gallery/move', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        credentials: 'include',\r\n        body: JSON.stringify({ from: relativePath, to: targetPath, overwrite: false })\r\n      });\r\n\r\n      if (response.ok) {\r\n        await loadImages();\r\n        await loadDirectoryTree();\r\n        setMoveDialogOpen(false);\r\n        setItemToMove(null);\r\n      } else {\r\n        const data = await response.json();\r\n        alert(data.error || 'Failed to move image');\r\n      }\r\n    } catch (error) {\r\n      console.error('Error moving image:', error);\r\n      alert('Failed to move image');\r\n    }\r\n  };\r\n\r\n  const handleRenameImage = async (image: GalleryImage, newName: string) => {\r\n    try {\r\n      const relativePath = image.path.replace(/^\\/images\\//, '');\r\n      const response = await fetch('/api/gallery/rename', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        credentials: 'include',\r\n        body: JSON.stringify({ path: relativePath, newName })\r\n      });\r\n\r\n      if (response.ok) {\r\n        await loadImages();\r\n        await loadDirectoryTree();\r\n        setRenameDialogOpen(false);\r\n        setItemToMove(null);\r\n        setNewName('');\r\n      } else {\r\n        const data = await response.json();\r\n        alert(data.error || 'Failed to rename image');\r\n      }\r\n    } catch (error) {\r\n      console.error('Error renaming image:', error);\r\n      alert('Failed to rename image');\r\n    }\r\n  };\r\n\r\n  const handleCreateDirectory = async (dirName: string) => {\r\n    if (!dirName || !dirName.trim()) {\r\n      alert('Directory name cannot be empty');\r\n      return;\r\n    }\r\n    \r\n    try {\r\n      const targetPath = selectedDirectory ? `${selectedDirectory}/${dirName.trim()}` : dirName.trim();\r\n      const response = await fetch('/api/gallery/mkdir', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        credentials: 'include',\r\n        body: JSON.stringify({ path: targetPath })\r\n      });\r\n\r\n      if (response.ok) {\r\n        await loadDirectoryTree();\r\n        // Show success message\r\n        const data = await response.json();\r\n        console.log('Directory created:', data);\r\n      } else {\r\n        const data = await response.json();\r\n        // Show detailed error message\r\n        const errorMsg = data.error || 'Failed to create directory';\r\n        const code = data.code ? ` (${data.code})` : '';\r\n        const pathInfo = data.path ? `\\nPath: ${data.path}` : '';\r\n        alert(`${errorMsg}${code}${pathInfo}`);\r\n      }\r\n    } catch (error: any) {\r\n      console.error('Error creating directory:', error);\r\n      alert(`Failed to create directory: ${error.message || 'Unknown error'}`);\r\n    }\r\n  };\r\n\r\n  const handleGetSuggestions = async () => {\r\n    try {\r\n      const response = await fetch('/api/gallery/suggest-destination', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        credentials: 'include',\r\n        body: JSON.stringify({ images: images.map(img => ({ path: img.path, name: img.name })) })\r\n      });\r\n\r\n      if (response.ok) {\r\n        const data = await response.json();\r\n        setSuggestions(data.suggestions || []);\r\n        setSuggestionStatuses({}); // Reset statuses\r\n        setSuggestionsDialogOpen(true);\r\n      } else {\r\n        const data = await response.json();\r\n        alert(data.error || 'Failed to get catalog suggestions');\r\n      }\r\n    } catch (error) {\r\n      console.error('Error getting suggestions:', error);\r\n      alert('Failed to get catalog suggestions');\r\n    }\r\n  };\r\n\r\n  const normalizePath = (pathStr: string): string => {\r\n    return pathStr.replace(/^\\/images\\//, '').replace(/^\\/+/, '');\r\n  };\r\n\r\n  const handleDryRun = async () => {\r\n    if (suggestions.length === 0) return;\r\n    \r\n    setValidating(true);\r\n    try {\r\n      // Convert suggestions to actions\r\n      const actions = suggestions.map((suggestion) => {\r\n        const relativePath = normalizePath(suggestion.path);\r\n        const targetPath = suggestion.suggestedDir \r\n          ? `${suggestion.suggestedDir}/${suggestion.suggestedName}`\r\n          : suggestion.suggestedName;\r\n        \r\n        return {\r\n          type: 'move',\r\n          from: relativePath,\r\n          to: targetPath\r\n        };\r\n      });\r\n\r\n      const response = await fetch('/api/gallery/validate-actions', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        credentials: 'include',\r\n        body: JSON.stringify({ actions })\r\n      });\r\n\r\n      if (response.ok) {\r\n        const data = await response.json();\r\n        const newStatuses: Record<number, any> = {};\r\n        \r\n        data.results.forEach((result: any, idx: number) => {\r\n          newStatuses[idx] = {\r\n            status: result.ok ? 'valid' : 'invalid',\r\n            message: result.message,\r\n            code: result.code\r\n          };\r\n        });\r\n        \r\n        setSuggestionStatuses(newStatuses);\r\n        setSummaryExpanded(true);\r\n      } else {\r\n        const data = await response.json();\r\n        alert(data.error || 'Failed to validate actions');\r\n      }\r\n    } catch (error) {\r\n      console.error('Error validating actions:', error);\r\n      alert('Failed to validate actions');\r\n    } finally {\r\n      setValidating(false);\r\n    }\r\n  };\r\n\r\n  const handleApplySingle = async (idx: number) => {\r\n    const suggestion = suggestions[idx];\r\n    if (!suggestion) return;\r\n\r\n    setApplying(true);\r\n    try {\r\n      const relativePath = normalizePath(suggestion.path);\r\n      const targetPath = suggestion.suggestedDir \r\n        ? `${suggestion.suggestedDir}/${suggestion.suggestedName}`\r\n        : suggestion.suggestedName;\r\n\r\n      const actions = [{\r\n        type: 'move',\r\n        from: relativePath,\r\n        to: targetPath\r\n      }];\r\n\r\n      const response = await fetch('/api/gallery/apply-actions', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        credentials: 'include',\r\n        body: JSON.stringify({ actions, continueOnError: false })\r\n      });\r\n\r\n      if (response.ok) {\r\n        const data = await response.json();\r\n        const result = data.results[0];\r\n        \r\n        setSuggestionStatuses(prev => ({\r\n          ...prev,\r\n          [idx]: {\r\n            status: result.ok ? 'applied' : 'failed',\r\n            message: result.message,\r\n            code: result.code\r\n          }\r\n        }));\r\n\r\n        if (result.ok) {\r\n          // Reload images and directory tree\r\n          await loadImages();\r\n          await loadDirectoryTree();\r\n        }\r\n      } else {\r\n        const data = await response.json();\r\n        setSuggestionStatuses(prev => ({\r\n          ...prev,\r\n          [idx]: {\r\n            status: 'failed',\r\n            message: data.error || 'Failed to apply action',\r\n            code: 'APPLY_ERROR'\r\n          }\r\n        }));\r\n      }\r\n    } catch (error) {\r\n      console.error('Error applying action:', error);\r\n      setSuggestionStatuses(prev => ({\r\n        ...prev,\r\n        [idx]: {\r\n          status: 'failed',\r\n          message: 'Failed to apply action',\r\n          code: 'APPLY_ERROR'\r\n        }\r\n      }));\r\n    } finally {\r\n      setApplying(false);\r\n    }\r\n  };\r\n\r\n  const handleApplyAll = async () => {\r\n    if (suggestions.length === 0) return;\r\n\r\n    // Check if any are invalid\r\n    const invalidCount = Object.values(suggestionStatuses).filter(\r\n      s => s.status === 'invalid'\r\n    ).length;\r\n    \r\n    if (invalidCount > 0) {\r\n      const proceed = confirm(\r\n        `${invalidCount} suggestion(s) are invalid. Do you want to continue anyway? ` +\r\n        'Only valid suggestions will be applied.'\r\n      );\r\n      if (!proceed) return;\r\n    }\r\n\r\n    setApplying(true);\r\n    try {\r\n      const actions = suggestions.map((suggestion) => {\r\n        const relativePath = normalizePath(suggestion.path);\r\n        const targetPath = suggestion.suggestedDir \r\n          ? `${suggestion.suggestedDir}/${suggestion.suggestedName}`\r\n          : suggestion.suggestedName;\r\n        \r\n        return {\r\n          type: 'move',\r\n          from: relativePath,\r\n          to: targetPath\r\n        };\r\n      });\r\n\r\n      const response = await fetch('/api/gallery/apply-actions', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        credentials: 'include',\r\n        body: JSON.stringify({ actions, continueOnError: true })\r\n      });\r\n\r\n      if (response.ok) {\r\n        const data = await response.json();\r\n        const newStatuses: Record<number, any> = {};\r\n        \r\n        data.results.forEach((result: any, idx: number) => {\r\n          newStatuses[idx] = {\r\n            status: result.ok ? 'applied' : 'failed',\r\n            message: result.message,\r\n            code: result.code\r\n          };\r\n        });\r\n        \r\n        setSuggestionStatuses(newStatuses);\r\n        setSummaryExpanded(true);\r\n\r\n        // Reload if any succeeded\r\n        if (data.summary.ok > 0) {\r\n          await loadImages();\r\n          await loadDirectoryTree();\r\n        }\r\n      } else {\r\n        const data = await response.json();\r\n        alert(data.error || 'Failed to apply actions');\r\n      }\r\n    } catch (error) {\r\n      console.error('Error applying actions:', error);\r\n      alert('Failed to apply actions');\r\n    } finally {\r\n      setApplying(false);\r\n    }\r\n  };\r\n\r\n  const handleCopySummary = () => {\r\n    const summary = {\r\n      total: suggestions.length,\r\n      statuses: Object.entries(suggestionStatuses).map(([idx, status]) => ({\r\n        index: parseInt(idx),\r\n        suggestion: suggestions[parseInt(idx)],\r\n        status: status.status,\r\n        message: status.message,\r\n        code: status.code\r\n      })),\r\n      summary: {\r\n        total: suggestions.length,\r\n        valid: Object.values(suggestionStatuses).filter(s => s.status === 'valid').length,\r\n        invalid: Object.values(suggestionStatuses).filter(s => s.status === 'invalid').length,\r\n        applied: Object.values(suggestionStatuses).filter(s => s.status === 'applied').length,\r\n        failed: Object.values(suggestionStatuses).filter(s => s.status === 'failed').length,\r\n        pending: Object.values(suggestionStatuses).filter(s => s.status === 'pending' || !s).length\r\n      }\r\n    };\r\n\r\n    const text = JSON.stringify(summary, null, 2);\r\n    navigator.clipboard.writeText(text).then(() => {\r\n      alert('Summary copied to clipboard');\r\n    }).catch(err => {\r\n      console.error('Failed to copy:', err);\r\n      alert('Failed to copy summary');\r\n    });\r\n  };\r\n\r\n  const getStatusChip = (idx: number) => {\r\n    const status = suggestionStatuses[idx];\r\n    if (!status || status.status === 'pending') {\r\n      return <Chip label=\"Pending\" size=\"small\" color=\"default\" />;\r\n    }\r\n    \r\n    const colorMap: Record<string, 'success' | 'error' | 'warning' | 'info'> = {\r\n      'valid': 'success',\r\n      'invalid': 'error',\r\n      'applied': 'success',\r\n      'failed': 'error'\r\n    };\r\n    \r\n    return (\r\n      <Chip \r\n        label={status.status.charAt(0).toUpperCase() + status.status.slice(1)} \r\n        size=\"small\" \r\n        color={colorMap[status.status] || 'default'}\r\n        title={status.message}\r\n      />\r\n    );\r\n  };\r\n\r\n  const handleFileSelect = (event: React.ChangeEvent<HTMLInputElement>) => {\r\n    const files = Array.from(event.target.files || []);\r\n    if (files.length === 0) return;\r\n\r\n    const validFiles: File[] = [];\r\n    const errors: string[] = [];\r\n\r\n    files.forEach((file) => {\r\n      // Allowed image file extensions\r\n      const allowedExtensions = ['.jpg', '.jpeg', '.tiff', '.gif', '.png'];\r\n      const fileExtension = '.' + file.name.split('.').pop()?.toLowerCase();\r\n      \r\n      if (!allowedExtensions.includes(fileExtension)) {\r\n        errors.push(`${file.name}: Invalid file type. Allowed types: ${allowedExtensions.join(', ')}`);\r\n        return;\r\n      }\r\n      if (file.size > 10 * 1024 * 1024) {\r\n        errors.push(`${file.name}: File size must be less than 10MB`);\r\n        return;\r\n      }\r\n      validFiles.push(file);\r\n    });\r\n\r\n    if (errors.length > 0) {\r\n      setUploadError(errors.join('\\n'));\r\n    } else {\r\n      setUploadError(null);\r\n    }\r\n\r\n    if (validFiles.length > 0) {\r\n      setSelectedFiles(prev => [...prev, ...validFiles]);\r\n    }\r\n  };\r\n\r\n  const uploadSingleFile = (file: File, targetDirectory: string = 'review-required'): Promise<void> => {\r\n    return new Promise((resolve, reject) => {\r\n      const formData = new FormData();\r\n      formData.append('image', file);\r\n      formData.append('targetDir', targetDirectory);\r\n      \r\n      const xhr = new XMLHttpRequest();\r\n      const fileKey = `${file.name}-${file.size}`;\r\n\r\n      // Initialize upload status\r\n      setUploadStatus(prev => ({\r\n        ...prev,\r\n        [fileKey]: { progress: 0, status: 'uploading' }\r\n      }));\r\n\r\n      xhr.upload.addEventListener('progress', (e) => {\r\n        if (e.lengthComputable) {\r\n          const percentComplete = (e.loaded / e.total) * 100;\r\n          setUploadStatus(prev => {\r\n            const updated = {\r\n              ...prev,\r\n              [fileKey]: { ...prev[fileKey], progress: percentComplete, status: 'uploading' as const }\r\n            };\r\n            // Calculate overall progress\r\n            const allStatuses = Object.values(updated);\r\n            const totalProgress = allStatuses.length > 0 \r\n              ? allStatuses.reduce((sum, s) => sum + s.progress, 0) / allStatuses.length \r\n              : 0;\r\n            setUploadProgress(totalProgress);\r\n            return updated;\r\n          });\r\n        }\r\n      });\r\n\r\n      xhr.addEventListener('load', () => {\r\n        if (xhr.status === 200) {\r\n          try {\r\n            const response = JSON.parse(xhr.responseText);\r\n            if (response.success) {\r\n              setUploadStatus(prev => ({\r\n                ...prev,\r\n                [fileKey]: { progress: 100, status: 'success' }\r\n              }));\r\n              resolve();\r\n            } else {\r\n              const errorMsg = response.error || response.message || 'Upload failed';\r\n              setUploadStatus(prev => ({\r\n                ...prev,\r\n                [fileKey]: { progress: 0, status: 'error', error: errorMsg }\r\n              }));\r\n              reject(new Error(errorMsg));\r\n            }\r\n          } catch (e) {\r\n            setUploadStatus(prev => ({\r\n              ...prev,\r\n              [fileKey]: { progress: 100, status: 'success' }\r\n            }));\r\n            resolve();\r\n          }\r\n        } else {\r\n          let errorMessage = 'Upload failed';\r\n          try {\r\n            const errorResponse = JSON.parse(xhr.responseText);\r\n            errorMessage = errorResponse.error || errorResponse.message || errorMessage;\r\n          } catch (e) {\r\n            if (xhr.status === 500) {\r\n              errorMessage = 'Internal server error. Please check server logs.';\r\n            } else if (xhr.status === 404) {\r\n              errorMessage = 'Upload endpoint not found. Backend needs to implement POST /api/gallery/upload';\r\n            } else {\r\n              errorMessage = `Upload failed with status ${xhr.status}`;\r\n            }\r\n          }\r\n          setUploadStatus(prev => ({\r\n            ...prev,\r\n            [fileKey]: { progress: 0, status: 'error', error: errorMessage }\r\n          }));\r\n          reject(new Error(errorMessage));\r\n        }\r\n      });\r\n\r\n      xhr.addEventListener('error', () => {\r\n        const errorMsg = 'Upload failed. Backend endpoint /api/gallery/upload may not be available.';\r\n        setUploadStatus(prev => ({\r\n          ...prev,\r\n          [fileKey]: { progress: 0, status: 'error', error: errorMsg }\r\n        }));\r\n        reject(new Error(errorMsg));\r\n      });\r\n\r\n      xhr.open('POST', '/api/gallery/upload');\r\n      xhr.withCredentials = true;\r\n      xhr.send(formData);\r\n    });\r\n  };\r\n\r\n  const handleUpload = async () => {\r\n    if (selectedFiles.length === 0) {\r\n      setUploadError('Please select at least one file');\r\n      return;\r\n    }\r\n\r\n    setUploading(true);\r\n    setUploadError(null);\r\n    setUploadProgress(0);\r\n    \r\n    // Initialize upload status for all files\r\n    const initialStatus: { [key: string]: { progress: number; status: 'pending' | 'uploading' | 'success' | 'error'; error?: string } } = {};\r\n    selectedFiles.forEach(file => {\r\n      const fileKey = `${file.name}-${file.size}`;\r\n      initialStatus[fileKey] = { progress: 0, status: 'pending' };\r\n    });\r\n    setUploadStatus(initialStatus);\r\n\r\n    try {\r\n      // Upload files sequentially to avoid overwhelming the server\r\n      const errors: string[] = [];\r\n      for (const file of selectedFiles) {\r\n        try {\r\n          // Always upload to review-required directory\r\n          await uploadSingleFile(file, 'review-required');\r\n        } catch (error: any) {\r\n          errors.push(`${file.name}: ${error.message || 'Upload failed'}`);\r\n        }\r\n      }\r\n\r\n      if (errors.length > 0) {\r\n        setUploadError(`Some files failed to upload:\\n${errors.join('\\n')}`);\r\n      } else {\r\n        // All files uploaded successfully\r\n        setUploadDialogOpen(false);\r\n        setSelectedFiles([]);\r\n        setUploadStatus({});\r\n        setUploadProgress(0);\r\n        if (fileInputRef.current) {\r\n          fileInputRef.current.value = '';\r\n        }\r\n        // Reload the page to show newly uploaded images\r\n        window.location.href = '/apps/gallery';\r\n      }\r\n    } catch (error: any) {\r\n      setUploadError(error.message || 'An error occurred during upload');\r\n    } finally {\r\n      setUploading(false);\r\n    }\r\n  };\r\n\r\n  const handleOpenUploadDialog = () => {\r\n    setUploadDialogOpen(true);\r\n    setSelectedFiles([]);\r\n    setUploadError(null);\r\n    setUploadProgress(0);\r\n    setUploadStatus({});\r\n  };\r\n\r\n  const handleCloseUploadDialog = () => {\r\n    if (!uploading) {\r\n      setUploadDialogOpen(false);\r\n      setSelectedFiles([]);\r\n      setUploadError(null);\r\n      setUploadProgress(0);\r\n      setUploadStatus({});\r\n      if (fileInputRef.current) {\r\n        fileInputRef.current.value = '';\r\n      }\r\n    }\r\n  };\r\n\r\n  const handleRemoveFile = (index: number) => {\r\n    setSelectedFiles(prev => prev.filter((_, i) => i !== index));\r\n  };\r\n\r\n  // Filter images based on usage filter (tri-state: used, not_used, not_checked)\r\n  // Note: This function is kept for backward compatibility but activeImages should be used instead\r\n  const getFilteredImages = (): GalleryImage[] => {\r\n    if (!images || images.length === 0) return [];\r\n    if (usageFilter === 'all') return images;\r\n    if (usageFilter === 'used') {\r\n      // Only show images that are explicitly marked as used (true)\r\n      return images.filter(img => img && img.isUsed === true);\r\n    }\r\n    if (usageFilter === 'unused') {\r\n      // Only show images that are explicitly marked as not used (false)\r\n      return images.filter(img => img && img.isUsed === false);\r\n    }\r\n    if (usageFilter === 'not_checked') {\r\n      // Only show images that haven't been checked yet (undefined)\r\n      return images.filter(img => img && img.isUsed === undefined);\r\n    }\r\n    return images;\r\n  };\r\n\r\n  // MUI DataGrid column definitions\r\n  const columns: GridColDef[] = [\r\n    {\r\n      field: 'name',\r\n      headerName: 'Image Name',\r\n      flex: 1,\r\n      minWidth: 200,\r\n      renderCell: (params: GridRenderCellParams) => {\r\n        if (!params || !params.row) {\r\n          return <Typography variant=\"body2\">Unknown</Typography>;\r\n        }\r\n        const image = params.row as GalleryImage;\r\n        if (!image) {\r\n          return <Typography variant=\"body2\">Unknown</Typography>;\r\n        }\r\n        return (\r\n          <Box sx={{ display: 'flex', alignItems: 'center', gap: 1, py: 1 }}>\r\n            <Box\r\n              component=\"img\"\r\n              src={image.url || '/images/incode/placeholder.png'}\r\n              alt={image.name || 'Unknown'}\r\n              sx={{\r\n                width: 40,\r\n                height: 40,\r\n                objectFit: 'cover',\r\n                imageOrientation: 'from-image', // Respect EXIF orientation\r\n                transform: 'none', // Let CSS handle rotation\r\n                borderRadius: 1,\r\n                cursor: 'pointer',\r\n              }}\r\n              onError={(e) => {\r\n                (e.target as HTMLImageElement).src = '/images/incode/placeholder.png';\r\n              }}\r\n              onClick={() => handleImageClick(image)}\r\n            />\r\n            <Typography\r\n              variant=\"body2\"\r\n              sx={{ cursor: 'pointer', color: 'primary.main' }}\r\n              onClick={() => handleImageClick(image)}\r\n            >\r\n              {params.value || 'Unknown'}\r\n            </Typography>\r\n          </Box>\r\n        );\r\n      },\r\n    },\r\n    {\r\n      field: 'path',\r\n      headerName: 'Image Location',\r\n      flex: 2,\r\n      minWidth: 250,\r\n    },\r\n    {\r\n      field: 'modified',\r\n      headerName: 'Date Modified',\r\n      flex: 1,\r\n      minWidth: 180,\r\n      valueGetter: (value: any, row: GalleryImage) => {\r\n        if (!row) return null;\r\n        // Return the actual date string, not empty string\r\n        const dateStr = row.modified || row.created;\r\n        return dateStr || null;\r\n      },\r\n      valueFormatter: (value: any, row?: any) => {\r\n        // Handle both direct value and params object from valueGetter\r\n        const dateValue = value?.value !== undefined ? value.value : value;\r\n        const imageRow = row?.row || row;\r\n        \r\n        // Check if there's a metadata error\r\n        if (imageRow && imageRow.metadataError) {\r\n          return 'Error';\r\n        }\r\n        \r\n        if (!dateValue || dateValue === '') {\r\n          return 'Unknown';\r\n        }\r\n        try {\r\n          const date = new Date(dateValue);\r\n          if (isNaN(date.getTime())) {\r\n            return 'Unknown';\r\n          }\r\n          return date.toLocaleString();\r\n        } catch (e) {\r\n          return 'Unknown';\r\n        }\r\n      },\r\n      renderCell: (params: GridRenderCellParams) => {\r\n        if (!params || !params.row) {\r\n          return <Typography variant=\"body2\">Unknown</Typography>;\r\n        }\r\n        const image = params.row as GalleryImage;\r\n        if (!image) {\r\n          return <Typography variant=\"body2\">Unknown</Typography>;\r\n        }\r\n        \r\n        // Show error with tooltip if metadata error exists\r\n        if (image.metadataError) {\r\n          return (\r\n            <Tooltip title={image.metadataError} arrow>\r\n              <Typography variant=\"body2\" color=\"error\">Error</Typography>\r\n            </Tooltip>\r\n          );\r\n        }\r\n        \r\n        const dateStr = image.modified || image.created;\r\n        if (!dateStr) {\r\n          return <Typography variant=\"body2\">Unknown</Typography>;\r\n        }\r\n        \r\n        try {\r\n          const date = new Date(dateStr);\r\n          if (isNaN(date.getTime())) {\r\n            return <Typography variant=\"body2\">Unknown</Typography>;\r\n          }\r\n          return <Typography variant=\"body2\">{date.toLocaleString()}</Typography>;\r\n        } catch (e) {\r\n          return <Typography variant=\"body2\">Unknown</Typography>;\r\n        }\r\n      },\r\n    },\r\n    {\r\n      field: 'isUsed',\r\n      headerName: 'Usage Status',\r\n      width: 130,\r\n      valueGetter: (value: any, row: GalleryImage) => {\r\n        if (!row || row.isUsed === undefined) return 'Unknown';\r\n        return row.isUsed ? 'Used' : 'Not Used';\r\n      },\r\n      renderCell: (params: GridRenderCellParams) => {\r\n        if (!params || !params.row) {\r\n          return <Chip label=\"Unknown\" size=\"small\" variant=\"outlined\" />;\r\n        }\r\n        const image = params.row as GalleryImage;\r\n        if (!image) {\r\n          return <Chip label=\"Unknown\" size=\"small\" variant=\"outlined\" />;\r\n        }\r\n        // Only show \"Checking...\" if explicitly undefined (check hasn't run yet)\r\n        // If false, it means the check completed and the image is not used\r\n        if (image.isUsed === undefined && checkingUsage) {\r\n          return <Chip label=\"Checking...\" size=\"small\" variant=\"outlined\" />;\r\n        }\r\n        // If undefined and not checking, treat as not checked yet\r\n        if (image.isUsed === undefined) {\r\n          return <Chip label=\"Not Checked\" size=\"small\" variant=\"outlined\" color=\"default\" />;\r\n        }\r\n        return (\r\n          <Chip\r\n            label={image.isUsed ? 'Used' : 'Not Used'}\r\n            size=\"small\"\r\n            sx={{\r\n              backgroundColor: image.isUsed ? 'rgba(76, 175, 80, 0.2)' : 'rgba(244, 67, 54, 0.2)',\r\n              color: image.isUsed ? 'success.main' : 'error.main',\r\n              fontWeight: 600,\r\n            }}\r\n          />\r\n        );\r\n      },\r\n    },\r\n    {\r\n      field: 'type',\r\n      headerName: 'File Type',\r\n      width: 120,\r\n    },\r\n    {\r\n      field: 'size',\r\n      headerName: 'File Size',\r\n      width: 120,\r\n      valueGetter: (value: any, row: GalleryImage) => {\r\n        if (!row) return null;\r\n        // Return the actual size value, preserving 0 if it's actually 0\r\n        const size = row.size;\r\n        return size !== undefined && size !== null ? size : null;\r\n      },\r\n      valueFormatter: (value: any, row?: any) => {\r\n        // Handle both direct value and params object from valueGetter\r\n        const sizeValue = value?.value !== undefined ? value.value : value;\r\n        if (sizeValue === undefined || sizeValue === null) {\r\n          return 'Unknown';\r\n        }\r\n        const numValue = typeof sizeValue === 'number' ? sizeValue : Number(sizeValue);\r\n        if (isNaN(numValue) || numValue < 0) {\r\n          return 'Unknown';\r\n        }\r\n        if (numValue === 0) return '0 KB';\r\n        const sizeKB = numValue / 1024;\r\n        if (sizeKB < 1024) {\r\n          return `${sizeKB.toFixed(2)} KB`;\r\n        }\r\n        return `${(sizeKB / 1024).toFixed(2)} MB`;\r\n      },\r\n    },\r\n    {\r\n      field: 'actions',\r\n      headerName: 'Actions',\r\n      width: 200,\r\n      sortable: false,\r\n      filterable: false,\r\n      renderCell: (params: GridRenderCellParams) => {\r\n        if (!params || !params.row) {\r\n          return null;\r\n        }\r\n        const image = params.row as GalleryImage;\r\n        if (!image) {\r\n          return null;\r\n        }\r\n        return (\r\n          <Stack direction=\"row\" spacing={1}>\r\n            <IconButton\r\n              size=\"small\"\r\n              onClick={() => handleImageClick(image)}\r\n              title=\"View\"\r\n            >\r\n              <IconPhoto size={18} />\r\n            </IconButton>\r\n            <IconButton\r\n              size=\"small\"\r\n              onClick={() => {\r\n                setItemToMove(image);\r\n                setNewName(image.name);\r\n                setRenameDialogOpen(true);\r\n              }}\r\n              title=\"Rename\"\r\n            >\r\n              <IconEdit size={18} />\r\n            </IconButton>\r\n            <IconButton\r\n              size=\"small\"\r\n              onClick={() => {\r\n                setItemToMove(image);\r\n                setTargetDir(selectedDirectory);\r\n                setMoveDialogOpen(true);\r\n              }}\r\n              title=\"Move\"\r\n            >\r\n              <IconArrowsExchange size={18} />\r\n            </IconButton>\r\n            <IconButton\r\n              size=\"small\"\r\n              color=\"error\"\r\n              onClick={() => handleDeleteImage(image)}\r\n              disabled={deleting}\r\n              title=\"Delete\"\r\n            >\r\n              <IconTrash size={18} />\r\n            </IconButton>\r\n          </Stack>\r\n        );\r\n      },\r\n    },\r\n  ];\r\n\r\n  const handleBulkDelete = async () => {\r\n    if (selectedRows.length === 0) {\r\n      alert('Please select at least one image to delete');\r\n      return;\r\n    }\r\n\r\n    if (!window.confirm(`Are you sure you want to delete ${selectedRows.length} image(s)?`)) {\r\n      return;\r\n    }\r\n\r\n    setDeleting(true);\r\n    try {\r\n      // Use activeImages to ensure we're deleting from the filtered view\r\n      const selectedImages = activeImages.filter(img => selectedRows.includes(img.id || img.path));\r\n      const deletePromises = selectedImages.map(async (image) => {\r\n        const relativePath = image.path.replace(/^\\/images\\//, '');\r\n        console.log('ðŸ—‘ï¸ [Frontend] Attempting to delete:', {\r\n          name: image.name,\r\n          originalPath: image.path,\r\n          relativePath: relativePath,\r\n          selectedDirectory: selectedDirectory\r\n        });\r\n        try {\r\n          const response = await fetch('/api/gallery/file', {\r\n            method: 'DELETE',\r\n            headers: {\r\n              'Content-Type': 'application/json',\r\n            },\r\n            credentials: 'include',\r\n            body: JSON.stringify({ path: relativePath })\r\n          });\r\n\r\n          if (!response.ok) {\r\n            let errorMessage = 'Unknown error';\r\n            try {\r\n              const errorData = await response.json();\r\n              errorMessage = errorData.error || errorData.message || `HTTP ${response.status}`;\r\n            } catch (e) {\r\n              errorMessage = `HTTP ${response.status}: ${response.statusText}`;\r\n            }\r\n            return { success: false, image: image.name, error: errorMessage, path: relativePath };\r\n          }\r\n\r\n          return { success: true, image: image.name, path: relativePath };\r\n        } catch (error: any) {\r\n          console.error(`Error deleting ${image.name}:`, error);\r\n          return { \r\n            success: false, \r\n            image: image.name, \r\n            error: error.message || 'Network error',\r\n            path: relativePath \r\n          };\r\n        }\r\n      });\r\n\r\n      const results = await Promise.all(deletePromises);\r\n      const successful = results.filter(r => r.success);\r\n      const failed = results.filter(r => !r.success);\r\n\r\n      if (successful.length > 0) {\r\n        await loadImages();\r\n        await loadDirectoryTree();\r\n        setSelectedRows([]);\r\n        \r\n        if (failed.length > 0) {\r\n          const failedDetails = failed.map(f => `  - ${f.image}: ${f.error}`).join('\\n');\r\n          alert(`Successfully deleted ${successful.length} image(s).\\n\\nFailed to delete ${failed.length} image(s):\\n${failedDetails}`);\r\n        } else {\r\n          alert(`Successfully deleted ${successful.length} image(s)`);\r\n        }\r\n      } else {\r\n        const failedDetails = failed.map(f => `  - ${f.image}: ${f.error}`).join('\\n');\r\n        alert(`Failed to delete ${failed.length} image(s):\\n\\n${failedDetails}`);\r\n      }\r\n    } catch (error: any) {\r\n      console.error('Error deleting images:', error);\r\n      alert(`An error occurred while deleting images: ${error.message || 'Unknown error'}`);\r\n    } finally {\r\n      setDeleting(false);\r\n    }\r\n  };\r\n\r\n  const handleExportCSV = () => {\r\n    if (images.length === 0) {\r\n      alert('No images to export');\r\n      return;\r\n    }\r\n\r\n    // Create CSV content\r\n    const headers = ['Name', 'Path', 'Created', 'Type', 'Size'];\r\n    const rows = images.map(img => [\r\n      img.name,\r\n      img.path,\r\n      img.created || 'Unknown',\r\n      img.type || 'Unknown',\r\n      img.size ? `${(img.size / 1024).toFixed(2)} KB` : 'Unknown'\r\n    ]);\r\n\r\n    const csvContent = [\r\n      headers.join(','),\r\n      ...rows.map(row => row.map(cell => `\"${String(cell).replace(/\"/g, '\"\"')}\"`).join(','))\r\n    ].join('\\n');\r\n\r\n    // Create and download file\r\n    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });\r\n    const link = document.createElement('a');\r\n    const url = URL.createObjectURL(blob);\r\n    link.setAttribute('href', url);\r\n    link.setAttribute('download', `gallery-images-${new Date().toISOString().split('T')[0]}.csv`);\r\n    link.style.visibility = 'hidden';\r\n    document.body.appendChild(link);\r\n    link.click();\r\n    document.body.removeChild(link);\r\n  };\r\n\r\n  const handleExportUsedImages = async () => {\r\n    try {\r\n      // Show loading state\r\n      setExportingUsedImages(true);\r\n      setUploadError(null);\r\n      \r\n      // Fetch used images list from API with pagination support\r\n      // Backend will handle batching internally, but we'll fetch all pages if needed\r\n      let allUsedImages: any[] = [];\r\n      let offset = 0;\r\n      const limit = 200; // Backend batch size\r\n      let hasMore = true;\r\n      let totalImages = 0;\r\n      let checkedImages = 0;\r\n      let limited = false;\r\n      \r\n      while (hasMore) {\r\n        const response = await fetch(`/api/gallery/used-images?format=json&offset=${offset}&limit=${limit}`, {\r\n          credentials: 'include',\r\n        });\r\n\r\n        if (!response.ok) {\r\n          const errorText = await response.text();\r\n          let errorMessage = 'Failed to export used images list';\r\n          try {\r\n            const data = JSON.parse(errorText);\r\n            errorMessage = data.error || data.message || errorMessage;\r\n          } catch (e) {\r\n            errorMessage = errorText || errorMessage;\r\n          }\r\n          alert(`Error: ${errorMessage}`);\r\n          setUploadError(errorMessage);\r\n          setExportingUsedImages(false);\r\n          return;\r\n        }\r\n        \r\n        const data = await response.json();\r\n        \r\n        if (data.success && data.used) {\r\n          allUsedImages = [...allUsedImages, ...data.used];\r\n          totalImages = data.total_images || totalImages;\r\n          checkedImages = data.checked_images || checkedImages;\r\n          limited = data.limited || limited;\r\n          \r\n          // Check if there are more pages\r\n          if (data.used.length < limit || offset + limit >= checkedImages) {\r\n            hasMore = false;\r\n          } else {\r\n            offset += limit;\r\n          }\r\n        } else {\r\n          hasMore = false;\r\n        }\r\n      }\r\n      \r\n      // Generate text output\r\n      let output = `# Images Actively Used in Production\\n\\n`;\r\n      output += `Generated: ${new Date().toISOString()}\\n`;\r\n      output += `Total Images: ${totalImages}\\n`;\r\n      output += `Checked Images: ${checkedImages}\\n`;\r\n      output += `Used Images: ${allUsedImages.length}\\n`;\r\n      if (limited) {\r\n        output += `Note: Scanning was limited due to performance constraints\\n`;\r\n      }\r\n      output += `\\n## Used Images (${allUsedImages.length})\\n\\n`;\r\n      \r\n      allUsedImages.forEach((img, index) => {\r\n        output += `${index + 1}. **${img.name}**\\n`;\r\n        output += `   - Path: ${img.path}\\n`;\r\n        output += `   - Size: ${img.size ? (img.size / 1024).toFixed(2) + ' KB' : 'Unknown'}\\n`;\r\n        output += `   - Type: ${img.type ? img.type.toUpperCase() : 'Unknown'}\\n`;\r\n        output += `   - Modified: ${img.modified ? new Date(img.modified).toLocaleString() : 'Unknown'}\\n`;\r\n        if (img.referencedIn && img.referencedIn.length > 0) {\r\n          output += `   - Referenced in:\\n`;\r\n          img.referencedIn.forEach((ref: string) => {\r\n            output += `     - ${ref}\\n`;\r\n          });\r\n        }\r\n        output += `\\n`;\r\n      });\r\n      \r\n      // Create and download file\r\n      const blob = new Blob([output], { type: 'text/plain;charset=utf-8;' });\r\n      const link = document.createElement('a');\r\n      const url = URL.createObjectURL(blob);\r\n      link.setAttribute('href', url);\r\n      link.setAttribute('download', `used-images-${new Date().toISOString().split('T')[0]}.txt`);\r\n      link.style.visibility = 'hidden';\r\n      document.body.appendChild(link);\r\n      link.click();\r\n      document.body.removeChild(link);\r\n      URL.revokeObjectURL(url);\r\n      \r\n      // Show success message with counts\r\n      alert(`Used images list exported successfully!\\nTotal: ${totalImages}, Checked: ${checkedImages}, Used: ${allUsedImages.length}${limited ? ' (limited)' : ''}`);\r\n    } catch (error: any) {\r\n      console.error('Error exporting used images:', error);\r\n      const errorMsg = error.message || 'Failed to export used images list. Please check the browser console for details.';\r\n      alert(`Error: ${errorMsg}`);\r\n      setUploadError(errorMsg);\r\n    } finally {\r\n      setExportingUsedImages(false);\r\n    }\r\n  };\r\n\r\n  // No longer needed - MUI DataGrid uses React components for cell rendering\r\n\r\n  // Get first 8 images for thumbnail display - use activeImages to respect filters\r\n  const thumbnailImages = activeImages.slice(0, 8);\r\n\r\n  // Use canonical directories from shared config (single source of truth)\r\n  const DEFAULT_DIRECTORIES = CANONICAL_IMAGE_DIRECTORIES;\r\n\r\n  // Check if directory is a canonical directory\r\n  const isDefaultDirectory = (dirName: string): boolean => {\r\n    return isCanonicalDirectory(dirName);\r\n  };\r\n\r\n  // Clean up empty directories\r\n  const cleanupEmptyDirectories = async () => {\r\n    try {\r\n      const response = await fetch('/api/gallery/cleanup-empty-dirs', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        credentials: 'include',\r\n      });\r\n\r\n      if (response.ok) {\r\n        const data = await response.json();\r\n        if (data.deleted && data.deleted.length > 0) {\r\n          console.log(`ðŸ—‘ï¸ Cleaned up ${data.deleted.length} empty directory(ies):`, data.deleted);\r\n          // Reload directory tree after cleanup\r\n          await loadDirectoryTree();\r\n        }\r\n      }\r\n    } catch (error) {\r\n      console.error('Error cleaning up empty directories:', error);\r\n      // Don't show error to user - this is a background operation\r\n    }\r\n  };\r\n\r\n  // Render directory tree recursively\r\n  const renderDirectoryTree = (dirs: any[], level: number = 0) => {\r\n    // Get existing directory names for comparison\r\n    const existingDirNames = new Set(dirs.map(d => d.name.toLowerCase()));\r\n    \r\n    // Ensure canonical directories are always shown, even if empty\r\n    const canonicalDirsToShow = CANONICAL_IMAGE_DIRECTORIES.map(dirName => {\r\n      const existing = dirs.find(d => d.name.toLowerCase() === dirName.toLowerCase());\r\n      if (existing) {\r\n        return existing;\r\n      }\r\n      // Return placeholder for missing canonical directory\r\n      return {\r\n        name: dirName,\r\n        path: dirName,\r\n        childrenCount: 0,\r\n        isEmpty: true, // Mark as empty so we can show it differently\r\n      };\r\n    });\r\n    \r\n    // Combine canonical directories (with placeholders) and other directories\r\n    const otherDirs = dirs.filter(d => !isCanonicalDirectory(d.name));\r\n    const allDirs = [...canonicalDirsToShow, ...otherDirs];\r\n    \r\n    return allDirs.map((dir) => {\r\n      const isDefault = isCanonicalDirectory(dir.name);\r\n      const isEmpty = dir.isEmpty === true;\r\n      \r\n      return (\r\n        <Box key={dir.path} sx={{ pl: level * 2 }}>\r\n          <Button\r\n            fullWidth\r\n            startIcon={<IconFolder size={16} />}\r\n            onClick={() => !isEmpty && setSelectedDirectory(dir.path)}\r\n            disabled={isEmpty}\r\n            sx={{\r\n              justifyContent: 'flex-start',\r\n              textTransform: 'none',\r\n              color: isEmpty \r\n                ? 'text.disabled' \r\n                : selectedDirectory === dir.path \r\n                  ? '#C8A24B' \r\n                  : (isDefault ? '#1976d2' : 'inherit'),\r\n              fontWeight: selectedDirectory === dir.path ? 'bold' : (isDefault ? '600' : 'normal'),\r\n              backgroundColor: isEmpty \r\n                ? 'rgba(0, 0, 0, 0.02)' \r\n                : isDefault && selectedDirectory !== dir.path \r\n                  ? 'rgba(25, 118, 210, 0.08)' \r\n                  : 'transparent',\r\n              border: isDefault ? '1px solid rgba(25, 118, 210, 0.2)' : 'none',\r\n              borderRadius: isDefault ? 1 : 0,\r\n              mb: isDefault ? 0.5 : 0,\r\n              opacity: isEmpty ? 0.6 : 1,\r\n              '&:hover': {\r\n                backgroundColor: isEmpty \r\n                  ? 'rgba(0, 0, 0, 0.02)' \r\n                  : isDefault \r\n                    ? 'rgba(25, 118, 210, 0.12)' \r\n                    : 'rgba(0, 0, 0, 0.04)',\r\n              },\r\n            }}\r\n          >\r\n            {dir.name} {isEmpty ? '(empty)' : `(${dir.childrenCount})`}\r\n            {isDefault && (\r\n              <Chip \r\n                label={isEmpty ? \"Empty\" : \"Default\"} \r\n                size=\"small\" \r\n                sx={{ \r\n                  ml: 1, \r\n                  height: 18, \r\n                  fontSize: '0.65rem',\r\n                  backgroundColor: isEmpty \r\n                    ? 'rgba(0, 0, 0, 0.05)' \r\n                    : 'rgba(25, 118, 210, 0.1)',\r\n                  color: isEmpty ? 'text.disabled' : '#1976d2',\r\n                }} \r\n              />\r\n            )}\r\n          </Button>\r\n        </Box>\r\n      );\r\n    });\r\n  };\r\n\r\n  return (\r\n    <Box sx={{ minHeight: '100vh', display: 'flex', flexDirection: 'row' }}>\r\n      {/* Directory Tree Sidebar */}\r\n      <Box sx={{ width: 250, minWidth: 250, p: 2, borderRight: 1, borderColor: 'divider', bgcolor: 'background.paper' }}>\r\n        <Typography variant=\"h6\" sx={{ mb: 2 }}>Directories</Typography>\r\n        <Button\r\n          fullWidth\r\n          startIcon={<IconFolder size={16} />}\r\n          onClick={() => setSelectedDirectory('')}\r\n          sx={{\r\n            justifyContent: 'flex-start',\r\n            textTransform: 'none',\r\n            mb: 1,\r\n            color: selectedDirectory === '' ? '#C8A24B' : 'inherit',\r\n            fontWeight: selectedDirectory === '' ? 'bold' : 'normal',\r\n          }}\r\n        >\r\n          Root (All Images)\r\n        </Button>\r\n        {loadingTree ? (\r\n          <OMLoading size=\"sm\" label=\"Loading directories\" />\r\n        ) : directoryTree.directories && directoryTree.directories.length > 0 ? (\r\n          renderDirectoryTree(directoryTree.directories)\r\n        ) : (\r\n          <Typography variant=\"body2\" color=\"text.secondary\" sx={{ mt: 1, p: 1 }}>\r\n            No directories found. Images may still be available in root.\r\n          </Typography>\r\n        )}\r\n        <Button\r\n          fullWidth\r\n          startIcon={<IconFolderPlus size={16} />}\r\n          onClick={() => {\r\n            const dirName = prompt('Enter directory name:');\r\n            if (dirName) handleCreateDirectory(dirName);\r\n          }}\r\n          sx={{ mt: 2, justifyContent: 'flex-start', textTransform: 'none' }}\r\n        >\r\n          New Folder\r\n        </Button>\r\n        <Button\r\n          fullWidth\r\n          startIcon={<IconSparkles size={16} />}\r\n          onClick={handleGetSuggestions}\r\n          sx={{ mt: 1, justifyContent: 'flex-start', textTransform: 'none' }}\r\n        >\r\n          Catalog Suggestions\r\n        </Button>\r\n      </Box>\r\n\r\n      {/* Main Content */}\r\n      <Box sx={{ flex: 1, display: 'flex', flexDirection: 'column' }}>\r\n      <GalleryContainer maxWidth=\"xl\">\r\n        <Box sx={{ textAlign: 'center', mb: 4 }}>\r\n          <Typography\r\n            variant=\"h2\"\r\n            component=\"h1\"\r\n            sx={{\r\n              fontWeight: 700,\r\n              mb: 2,\r\n              fontFamily: '\"Cormorant Garamond\", \"Palatino Linotype\", \"Book Antiqua\", Palatino, Georgia, serif',\r\n            }}\r\n          >\r\n            Image Gallery\r\n          </Typography>\r\n          <Typography variant=\"body1\" color=\"text.secondary\" sx={{ mb: 2 }}>\r\n            Browse images from <code>/public/images/**</code> (all directories)\r\n          </Typography>\r\n          {/* Usage Status Banner */}\r\n          {images.length > 0 && images.some(img => img.isUsed === undefined) && (\r\n            <Alert \r\n              severity=\"info\" \r\n              sx={{ mb: 3 }}\r\n              action={\r\n                <Button\r\n                  color=\"inherit\"\r\n                  size=\"small\"\r\n                  onClick={() => checkImageUsage(images, true)}\r\n                  disabled={checkingUsage}\r\n                >\r\n                  {checkingUsage ? 'Checking...' : 'Check Now'}\r\n                </Button>\r\n              }\r\n            >\r\n              Usage status not computed. Click &quot;Refresh Usage&quot; or &quot;Check Now&quot; to determine which images are used in the codebase.\r\n            </Alert>\r\n          )}\r\n          {/* Carousel Navigation Arrows */}\r\n          {activeImages.length > 0 && (\r\n            <Box sx={{ display: 'flex', alignItems: 'center', justifyContent: 'center', gap: 4, mb: 3 }}>\r\n              <CarouselButton\r\n                onClick={handlePrevious}\r\n                aria-label=\"Previous image\"\r\n                sx={{ position: 'relative', transform: 'none' }}\r\n              >\r\n                <IconArrowLeft size={28} />\r\n              </CarouselButton>\r\n              \r\n              <CarouselButton\r\n                onClick={handleNext}\r\n                aria-label=\"Next image\"\r\n                sx={{ position: 'relative', transform: 'none' }}\r\n              >\r\n                <IconArrowRight size={28} />\r\n              </CarouselButton>\r\n            </Box>\r\n          )}\r\n\r\n          <Stack direction=\"row\" spacing={2} justifyContent=\"center\" alignItems=\"center\" sx={{ mb: 3, flexWrap: 'wrap', gap: 2 }}>\r\n            <Button\r\n              variant=\"contained\"\r\n              startIcon={<IconUpload size={20} />}\r\n              onClick={handleOpenUploadDialog}\r\n              sx={{\r\n                backgroundColor: '#C8A24B',\r\n                color: '#1a1a1a',\r\n                '&:hover': {\r\n                  backgroundColor: '#B8923A',\r\n                },\r\n              }}\r\n            >\r\n              Upload Images\r\n            </Button>\r\n\r\n            {/* Refresh Usage Check */}\r\n            {images.length > 0 && (\r\n              <Button\r\n                variant=\"outlined\"\r\n                size=\"small\"\r\n                onClick={() => checkImageUsage(images, true)}\r\n                disabled={checkingUsage}\r\n                title={checkingUsage ? 'Checking image usage in codebase...' : 'Check all images for usage in codebase'}\r\n              >\r\n                {checkingUsage ? 'Checking...' : 'Refresh Usage'}\r\n              </Button>\r\n            )}\r\n          </Stack>\r\n        </Box>\r\n\r\n        {/* Carousel - Current Image Display */}\r\n        {activeImages.length > 0 && (\r\n          <CarouselContainer>\r\n            <CarouselButton\r\n              onClick={handlePrevious}\r\n              sx={{ left: { xs: -20, sm: -28 } }}\r\n              aria-label=\"Previous image\"\r\n              disabled={activeImages.length === 0}\r\n            >\r\n              <IconArrowLeft size={28} />\r\n            </CarouselButton>\r\n\r\n            <CarouselImageContainer\r\n              onClick={() => activeImages[currentIndex] && handleOpenInNewWindow(activeImages[currentIndex])}\r\n              sx={{ cursor: 'pointer' }}\r\n              isUsed={activeImages[currentIndex]?.isUsed === true}\r\n            >\r\n              {activeImages[currentIndex] && (\r\n                <Box\r\n                  component=\"img\"\r\n                  src={activeImages[currentIndex].url}\r\n                  alt={activeImages[currentIndex].name}\r\n                  sx={{\r\n                    maxWidth: '100%',\r\n                    maxHeight: '100%',\r\n                    objectFit: 'contain',\r\n                    imageOrientation: 'from-image', // Respect EXIF orientation\r\n                  }}\r\n                  onError={(e) => {\r\n                    (e.target as HTMLImageElement).src = '/images/incode/placeholder.png';\r\n                  }}\r\n                />\r\n              )}\r\n            </CarouselImageContainer>\r\n\r\n            <CarouselButton\r\n              onClick={handleNext}\r\n              sx={{ right: { xs: -20, sm: -28 } }}\r\n              aria-label=\"Next image\"\r\n              disabled={activeImages.length === 0}\r\n            >\r\n              <IconArrowRight size={28} />\r\n            </CarouselButton>\r\n\r\n            {/* Image info below carousel */}\r\n            <Box sx={{ textAlign: 'center', mt: 2 }}>\r\n              <Typography variant=\"subtitle1\" fontWeight={600}>\r\n                {activeImages[currentIndex]?.name}\r\n              </Typography>\r\n              <Typography variant=\"caption\" color=\"text.secondary\">\r\n                {activeImages.length > 0 ? `${currentIndex + 1} of ${activeImages.length}` : '0 of 0'}\r\n              </Typography>\r\n            </Box>\r\n          </CarouselContainer>\r\n        )}\r\n\r\n        {/* Thumbnail Grid - 2 rows of 4 images (8 total) */}\r\n        {activeImages.length > 0 && (\r\n          <Box>\r\n            <Typography variant=\"h5\" sx={{ mb: 2, fontWeight: 600 }}>\r\n              Recent Images\r\n            </Typography>\r\n            <ThumbnailGrid>\r\n              {thumbnailImages.map((image, index) => {\r\n                // Find index in activeImages to sync with carousel\r\n                const activeIndex = activeImages.findIndex(img => img.id === image.id || img.path === image.path);\r\n                return (\r\n                <ImageCard\r\n                  key={image.id || index}\r\n                  onClick={() => {\r\n                    if (activeIndex >= 0) {\r\n                      setCurrentIndex(activeIndex);\r\n                    }\r\n                    handleOpenInNewWindow(image);\r\n                  }}\r\n                  isUsed={image.isUsed === true}\r\n                >\r\n                  <ImageThumbnail\r\n                    component=\"img\"\r\n                    image={image.url}\r\n                    alt={image.name}\r\n                    onError={(e) => {\r\n                      (e.target as HTMLImageElement).src = '/images/incode/placeholder.png';\r\n                    }}\r\n                  />\r\n                </ImageCard>\r\n                );\r\n              })}\r\n            </ThumbnailGrid>\r\n          </Box>\r\n        )}\r\n\r\n        {/* AG Grid Table */}\r\n        <Box sx={{ mt: 4 }}>\r\n          <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', mb: 2 }}>\r\n            <Typography variant=\"h5\" sx={{ fontWeight: 600 }}>\r\n              All Images\r\n            </Typography>\r\n            <Stack direction=\"row\" spacing={2} alignItems=\"center\">\r\n              {/* Sort Controls */}\r\n              {images.length > 0 && (\r\n                <>\r\n                  <FormControl size=\"small\" sx={{ minWidth: 150 }}>\r\n                    <InputLabel>Sort By</InputLabel>\r\n                    <Select\r\n                      value={sortBy}\r\n                      label=\"Sort By\"\r\n                      onChange={(e) => setSortBy(e.target.value as 'date' | 'name' | 'size' | 'type' | 'location')}\r\n                    >\r\n                      <MenuItem value=\"date\">Date Modified</MenuItem>\r\n                      <MenuItem value=\"name\">Name</MenuItem>\r\n                      <MenuItem value=\"size\">Size</MenuItem>\r\n                      <MenuItem value=\"type\">Type</MenuItem>\r\n                      <MenuItem value=\"location\">Location</MenuItem>\r\n                    </Select>\r\n                  </FormControl>\r\n                  <IconButton\r\n                    onClick={() => setSortOrder(sortOrder === 'asc' ? 'desc' : 'asc')}\r\n                    title={`Sort ${sortOrder === 'asc' ? 'Descending' : 'Ascending'}`}\r\n                    size=\"small\"\r\n                  >\r\n                    {sortOrder === 'asc' ? 'â†‘' : 'â†“'}\r\n                  </IconButton>\r\n                </>\r\n              )}\r\n\r\n              {/* Usage Filter */}\r\n              {images.length > 0 && (\r\n                <FormControl size=\"small\" sx={{ minWidth: 150 }}>\r\n                  <InputLabel>Usage Filter</InputLabel>\r\n                    <Select\r\n                      value={usageFilter}\r\n                      label=\"Usage Filter\"\r\n                      onChange={(e) => setUsageFilter(e.target.value as 'all' | 'used' | 'unused' | 'not_checked')}\r\n                    >\r\n                    <MenuItem value=\"all\">All Images</MenuItem>\r\n                    <MenuItem value=\"used\">Used in Codebase</MenuItem>\r\n                    <MenuItem value=\"unused\">Not Used</MenuItem>\r\n                    <MenuItem value=\"not_checked\">Not Checked</MenuItem>\r\n                  </Select>\r\n                </FormControl>\r\n              )}\r\n\r\n              <Button\r\n                variant=\"outlined\"\r\n                color=\"error\"\r\n                startIcon={<IconTrash size={18} />}\r\n                onClick={handleBulkDelete}\r\n                disabled={deleting || selectedRows.length === 0}\r\n              >\r\n                Delete Selected ({selectedRows.length})\r\n              </Button>\r\n              <Button\r\n                variant=\"outlined\"\r\n                startIcon={<IconDownload size={18} />}\r\n                onClick={handleExportCSV}\r\n                disabled={images.length === 0}\r\n              >\r\n                Export CSV\r\n              </Button>\r\n              <Button\r\n                variant=\"outlined\"\r\n                color=\"success\"\r\n                startIcon={<IconDownload size={18} />}\r\n                onClick={handleExportUsedImages}\r\n                disabled={exportingUsedImages}\r\n              >\r\n                {exportingUsedImages ? 'Generating...' : 'Export Used Images List'}\r\n              </Button>\r\n            </Stack>\r\n          </Box>\r\n          <Paper sx={{ height: 600, width: '100%' }}>\r\n            <DataGrid\r\n              rows={activeImages}\r\n              columns={columns}\r\n              getRowId={(row) => row.id || row.path}\r\n              checkboxSelection\r\n              disableRowSelectionOnClick\r\n              rowSelectionModel={selectedRows}\r\n              onRowSelectionModelChange={(newSelection) => {\r\n                setSelectedRows(newSelection);\r\n              }}\r\n              pageSizeOptions={[10, 20, 50, 100]}\r\n              initialState={{\r\n                pagination: {\r\n                  paginationModel: { pageSize: 20 },\r\n                },\r\n              }}\r\n              getRowClassName={(params) => {\r\n                if (!params || !params.row) return '';\r\n                const image = params.row as GalleryImage;\r\n                if (!image) return '';\r\n                if (image.isUsed === true) {\r\n                  return 'gallery-row-used';\r\n                } else if (image.isUsed === false) {\r\n                  return 'gallery-row-unused';\r\n                }\r\n                return '';\r\n              }}\r\n              sx={{\r\n                '& .MuiDataGrid-cell:focus': {\r\n                  outline: 'none',\r\n                },\r\n                '& .gallery-row-used': {\r\n                  background: 'linear-gradient(90deg, rgba(200, 230, 201, 0.3) 0%, rgba(200, 230, 201, 0.1) 100%)',\r\n                  '&:hover': {\r\n                    backgroundColor: 'rgba(200, 230, 201, 0.4) !important',\r\n                  },\r\n                },\r\n                '& .gallery-row-unused': {\r\n                  background: 'linear-gradient(90deg, rgba(255, 205, 210, 0.3) 0%, rgba(255, 205, 210, 0.1) 100%)',\r\n                  '&:hover': {\r\n                    backgroundColor: 'rgba(255, 205, 210, 0.4) !important',\r\n                  },\r\n                },\r\n              }}\r\n            />\r\n          </Paper>\r\n        </Box>\r\n\r\n        {images.length === 0 && (\r\n          <Box\r\n            sx={{\r\n              textAlign: 'center',\r\n              py: 8,\r\n              border: `2px dashed ${theme.palette.divider}`,\r\n              borderRadius: 2,\r\n            }}\r\n          >\r\n            <IconPhoto size={64} style={{ opacity: 0.3, marginBottom: 16 }} />\r\n            <Typography variant=\"h6\" color=\"text.secondary\">\r\n              No images in gallery\r\n            </Typography>\r\n            <Typography variant=\"body2\" color=\"text.secondary\" sx={{ mt: 1 }}>\r\n              Upload your first image to get started\r\n            </Typography>\r\n          </Box>\r\n        )}\r\n      </GalleryContainer>\r\n      </Box>\r\n\r\n      {/* Move Dialog */}\r\n      <Dialog open={moveDialogOpen} onClose={() => setMoveDialogOpen(false)}>\r\n        <DialogTitle>Move Image</DialogTitle>\r\n        <DialogContent>\r\n          <TextField\r\n            fullWidth\r\n            label=\"Target Directory\"\r\n            value={targetDir}\r\n            onChange={(e) => setTargetDir(e.target.value)}\r\n            sx={{ mt: 1 }}\r\n          />\r\n        </DialogContent>\r\n        <DialogActions>\r\n          <Button onClick={() => setMoveDialogOpen(false)}>Cancel</Button>\r\n          <Button onClick={() => itemToMove && handleMoveImage(itemToMove, targetDir)}>Move</Button>\r\n        </DialogActions>\r\n      </Dialog>\r\n\r\n      {/* Rename Dialog */}\r\n      <Dialog open={renameDialogOpen} onClose={() => setRenameDialogOpen(false)}>\r\n        <DialogTitle>Rename Image</DialogTitle>\r\n        <DialogContent>\r\n          <TextField\r\n            fullWidth\r\n            label=\"New Name\"\r\n            value={newName}\r\n            onChange={(e) => setNewName(e.target.value)}\r\n            sx={{ mt: 1 }}\r\n          />\r\n        </DialogContent>\r\n        <DialogActions>\r\n          <Button onClick={() => setRenameDialogOpen(false)}>Cancel</Button>\r\n          <Button onClick={() => itemToMove && handleRenameImage(itemToMove, newName)}>Rename</Button>\r\n        </DialogActions>\r\n      </Dialog>\r\n\r\n      {/* Catalog Suggestions Dialog */}\r\n      <Dialog open={suggestionsDialogOpen} onClose={() => setSuggestionsDialogOpen(false)} maxWidth=\"md\" fullWidth>\r\n        <DialogTitle>\r\n          <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>\r\n            <Typography variant=\"h6\">Catalog Suggestions</Typography>\r\n            {Object.keys(suggestionStatuses).length > 0 && (\r\n              <Box sx={{ display: 'flex', gap: 1, alignItems: 'center' }}>\r\n                <Typography variant=\"caption\" color=\"text.secondary\">\r\n                  Total: {suggestions.length} | \r\n                  Valid: {Object.values(suggestionStatuses).filter(s => s.status === 'valid').length} | \r\n                  Invalid: {Object.values(suggestionStatuses).filter(s => s.status === 'invalid').length}\r\n                </Typography>\r\n              </Box>\r\n            )}\r\n          </Box>\r\n        </DialogTitle>\r\n        <DialogContent>\r\n          <Box sx={{ mb: 2, display: 'flex', gap: 1, flexWrap: 'wrap', alignItems: 'center' }}>\r\n            <Button\r\n              variant=\"outlined\"\r\n              onClick={handleDryRun}\r\n              disabled={suggestions.length === 0 || validating || applying}\r\n              startIcon={validating ? <LinearProgress sx={{ width: 16, height: 16 }} /> : null}\r\n            >\r\n              {validating ? 'Validating...' : 'Dry Run'}\r\n            </Button>\r\n            <Button\r\n              variant=\"contained\"\r\n              onClick={handleApplyAll}\r\n              disabled={suggestions.length === 0 || applying || validating}\r\n              startIcon={applying ? <LinearProgress sx={{ width: 16, height: 16 }} /> : null}\r\n            >\r\n              {applying ? 'Applying...' : 'Apply All'}\r\n            </Button>\r\n            <FormControlLabel\r\n              control={\r\n                <Checkbox\r\n                  checked={showFullSummary}\r\n                  onChange={(e) => setShowFullSummary(e.target.checked)}\r\n                />\r\n              }\r\n              label=\"Show full summary\"\r\n            />\r\n          </Box>\r\n\r\n          <Box sx={{ maxHeight: 400, overflow: 'auto' }}>\r\n            {suggestions.map((suggestion, idx) => {\r\n              const status = suggestionStatuses[idx];\r\n              const isPending = !status || status.status === 'pending';\r\n              const isValid = status?.status === 'valid';\r\n              const isInvalid = status?.status === 'invalid';\r\n              const isApplied = status?.status === 'applied';\r\n              const isFailed = status?.status === 'failed';\r\n\r\n              return (\r\n                <Box \r\n                  key={idx} \r\n                  sx={{ \r\n                    mb: 2, \r\n                    p: 2, \r\n                    border: 1, \r\n                    borderColor: isInvalid || isFailed ? 'error.main' : isValid || isApplied ? 'success.main' : 'divider',\r\n                    borderRadius: 1,\r\n                    backgroundColor: isValid || isApplied ? 'action.selected' : 'transparent'\r\n                  }}\r\n                >\r\n                  <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', mb: 1 }}>\r\n                    <Box sx={{ flex: 1 }}>\r\n                      <Typography variant=\"subtitle2\">{suggestion.path}</Typography>\r\n                      <Typography variant=\"body2\" color=\"text.secondary\">\r\n                        Suggested: {suggestion.suggestedDir}/{suggestion.suggestedName}\r\n                      </Typography>\r\n                      <Typography variant=\"caption\" color=\"text.secondary\">\r\n                        Confidence: {(suggestion.confidence * 100).toFixed(0)}%\r\n                      </Typography>\r\n                    </Box>\r\n                    <Box sx={{ ml: 2 }}>\r\n                      {getStatusChip(idx)}\r\n                    </Box>\r\n                  </Box>\r\n                  \r\n                  {status && status.message && (\r\n                    <Alert \r\n                      severity={isInvalid || isFailed ? 'error' : isValid || isApplied ? 'success' : 'info'}\r\n                      sx={{ mt: 1, mb: 1 }}\r\n                    >\r\n                      {status.message}\r\n                    </Alert>\r\n                  )}\r\n\r\n                  <Box sx={{ display: 'flex', gap: 1, mt: 1 }}>\r\n                    <Button\r\n                      size=\"small\"\r\n                      variant=\"outlined\"\r\n                      onClick={() => handleApplySingle(idx)}\r\n                      disabled={isApplied || applying || validating}\r\n                    >\r\n                      {isApplied ? 'Applied' : 'Apply'}\r\n                    </Button>\r\n                  </Box>\r\n                </Box>\r\n              );\r\n            })}\r\n          </Box>\r\n\r\n          {/* Summary Panel */}\r\n          {Object.keys(suggestionStatuses).length > 0 && (\r\n            <>\r\n              <Divider sx={{ my: 2 }} />\r\n              <Box>\r\n                <Box \r\n                  sx={{ \r\n                    display: 'flex', \r\n                    justifyContent: 'space-between', \r\n                    alignItems: 'center',\r\n                    cursor: 'pointer',\r\n                    p: 1,\r\n                    '&:hover': { backgroundColor: 'action.hover' }\r\n                  }}\r\n                  onClick={() => setSummaryExpanded(!summaryExpanded)}\r\n                >\r\n                  <Typography variant=\"subtitle2\">\r\n                    Summary: Succeeded: {Object.values(suggestionStatuses).filter(s => s.status === 'applied' || s.status === 'valid').length}, \r\n                    Failed: {Object.values(suggestionStatuses).filter(s => s.status === 'failed' || s.status === 'invalid').length}\r\n                  </Typography>\r\n                  <IconButton size=\"small\">\r\n                    {summaryExpanded ? <IconChevronUp size={20} /> : <IconChevronDown size={20} />}\r\n                  </IconButton>\r\n                </Box>\r\n                \r\n                <Collapse in={summaryExpanded}>\r\n                  <Box sx={{ mt: 1, maxHeight: 300, overflow: 'auto' }}>\r\n                    {(showFullSummary \r\n                      ? Object.entries(suggestionStatuses)\r\n                      : Object.entries(suggestionStatuses).filter(([_, s]) => s.status === 'invalid' || s.status === 'failed')\r\n                    ).map(([idxStr, status]) => {\r\n                      const idx = parseInt(idxStr);\r\n                      const suggestion = suggestions[idx];\r\n                      if (!suggestion) return null;\r\n\r\n                      return (\r\n                        <Box \r\n                          key={idx}\r\n                          sx={{ \r\n                            p: 1, \r\n                            mb: 1, \r\n                            border: 1, \r\n                            borderColor: 'divider', \r\n                            borderRadius: 1,\r\n                            backgroundColor: status.status === 'invalid' || status.status === 'failed' \r\n                              ? 'error.light' \r\n                              : 'success.light'\r\n                          }}\r\n                        >\r\n                          <Typography variant=\"body2\" fontWeight=\"bold\">\r\n                            {suggestion.path} â†’ {suggestion.suggestedDir}/{suggestion.suggestedName}\r\n                          </Typography>\r\n                          <Typography variant=\"caption\" color=\"text.secondary\">\r\n                            Status: {status.status} | Code: {status.code}\r\n                          </Typography>\r\n                          {status.message && (\r\n                            <Typography variant=\"caption\" display=\"block\" sx={{ mt: 0.5 }}>\r\n                              {status.message}\r\n                            </Typography>\r\n                          )}\r\n                        </Box>\r\n                      );\r\n                    })}\r\n                  </Box>\r\n                  \r\n                  <Box sx={{ mt: 1, display: 'flex', justifyContent: 'flex-end' }}>\r\n                    <Button\r\n                      size=\"small\"\r\n                      startIcon={<IconCopy size={16} />}\r\n                      onClick={handleCopySummary}\r\n                    >\r\n                      Copy Summary\r\n                    </Button>\r\n                  </Box>\r\n                </Collapse>\r\n              </Box>\r\n            </>\r\n          )}\r\n        </DialogContent>\r\n        <DialogActions>\r\n          <Button onClick={() => {\r\n            setSuggestionsDialogOpen(false);\r\n            setSuggestionStatuses({});\r\n            setShowFullSummary(false);\r\n            setSummaryExpanded(false);\r\n          }}>\r\n            Close\r\n          </Button>\r\n        </DialogActions>\r\n      </Dialog>\r\n\r\n      {/* Image Detail Dialog */}\r\n      <Dialog\r\n        open={imageDialogOpen}\r\n        onClose={() => setImageDialogOpen(false)}\r\n        maxWidth=\"md\"\r\n        fullWidth\r\n      >\r\n        <DialogTitle sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>\r\n          <Typography variant=\"h6\">{selectedImage?.name}</Typography>\r\n          <IconButton onClick={() => setImageDialogOpen(false)}>\r\n            <IconX />\r\n          </IconButton>\r\n        </DialogTitle>\r\n        <DialogContent>\r\n          {selectedImage && (\r\n            <Box>\r\n              <Box sx={{ mb: 3, textAlign: 'center' }}>\r\n                <img\r\n                  src={selectedImage.url}\r\n                  alt={selectedImage.name}\r\n                  style={{\r\n                    maxWidth: '100%',\r\n                    maxHeight: '400px',\r\n                    objectFit: 'contain',\r\n                    borderRadius: '8px',\r\n                  }}\r\n                  onError={(e) => {\r\n                    (e.target as HTMLImageElement).src = '/images/incode/placeholder.png';\r\n                  }}\r\n                />\r\n              </Box>\r\n              <Stack spacing={2}>\r\n                <Box>\r\n                  <Typography variant=\"subtitle2\" color=\"text.secondary\">\r\n                    Image Name\r\n                  </Typography>\r\n                  <Typography variant=\"body1\">{selectedImage.name}</Typography>\r\n                </Box>\r\n                <Box>\r\n                  <Typography variant=\"subtitle2\" color=\"text.secondary\">\r\n                    Image Path\r\n                  </Typography>\r\n                  <Typography variant=\"body1\" sx={{ wordBreak: 'break-all' }}>\r\n                    {selectedImage.path}\r\n                  </Typography>\r\n                </Box>\r\n                {selectedImage.created && (\r\n                  <Box>\r\n                    <Typography variant=\"subtitle2\" color=\"text.secondary\">\r\n                      Image Created\r\n                    </Typography>\r\n                    <Typography variant=\"body1\">\r\n                      {new Date(selectedImage.created).toLocaleString()}\r\n                    </Typography>\r\n                  </Box>\r\n                )}\r\n                {selectedImage.type && (\r\n                  <Box>\r\n                    <Typography variant=\"subtitle2\" color=\"text.secondary\">\r\n                      File Type\r\n                    </Typography>\r\n                    <Chip label={selectedImage.type.toUpperCase()} size=\"small\" />\r\n                  </Box>\r\n                )}\r\n                {selectedImage.size && (\r\n                  <Box>\r\n                    <Typography variant=\"subtitle2\" color=\"text.secondary\">\r\n                      File Size\r\n                    </Typography>\r\n                    <Typography variant=\"body1\">\r\n                      {(selectedImage.size / 1024).toFixed(2)} KB\r\n                    </Typography>\r\n                  </Box>\r\n                )}\r\n              </Stack>\r\n            </Box>\r\n          )}\r\n        </DialogContent>\r\n        <DialogActions>\r\n          <Button\r\n            onClick={() => selectedImage && handleOpenInNewWindow(selectedImage)}\r\n            variant=\"outlined\"\r\n          >\r\n            Open in New Window\r\n          </Button>\r\n          <Button\r\n            onClick={() => selectedImage && handleDeleteImage(selectedImage)}\r\n            variant=\"contained\"\r\n            color=\"error\"\r\n            startIcon={<IconTrash size={18} />}\r\n            disabled={deleting}\r\n          >\r\n            {deleting ? 'Deleting...' : 'Delete Image'}\r\n          </Button>\r\n          <Button onClick={() => setImageDialogOpen(false)}>\r\n            Close\r\n          </Button>\r\n        </DialogActions>\r\n      </Dialog>\r\n\r\n      {/* Upload Dialog */}\r\n      <Dialog\r\n        open={uploadDialogOpen}\r\n        onClose={handleCloseUploadDialog}\r\n        maxWidth=\"sm\"\r\n        fullWidth\r\n      >\r\n        <DialogTitle>\r\n          Upload Image to Gallery\r\n          <IconButton\r\n            aria-label=\"close\"\r\n            onClick={handleCloseUploadDialog}\r\n            sx={{\r\n              position: 'absolute',\r\n              right: 8,\r\n              top: 8,\r\n            }}\r\n          >\r\n            <IconX size={20} />\r\n          </IconButton>\r\n        </DialogTitle>\r\n        <DialogContent>\r\n          <Box sx={{ mt: 2 }}>\r\n            <input\r\n              ref={fileInputRef}\r\n              type=\"file\"\r\n              accept=\".jpg,.jpeg,.tiff,.gif,.png\"\r\n              onChange={handleFileSelect}\r\n              style={{ display: 'none' }}\r\n              id=\"image-upload-input\"\r\n              multiple\r\n            />\r\n            <label htmlFor=\"image-upload-input\">\r\n              <Button\r\n                variant=\"outlined\"\r\n                component=\"span\"\r\n                fullWidth\r\n                startIcon={<IconUpload size={20} />}\r\n                sx={{ mb: 2 }}\r\n              >\r\n                {selectedFiles.length > 0 ? `Select More Images (${selectedFiles.length} selected)` : 'Select Images'}\r\n              </Button>\r\n            </label>\r\n\r\n            <Typography variant=\"caption\" color=\"text.secondary\" display=\"block\" sx={{ mb: 2, textAlign: 'center' }}>\r\n              Allowed formats: .jpg, .jpeg, .tiff, .gif, .png (You can select multiple files)\r\n            </Typography>\r\n\r\n            {selectedFiles.length > 0 && (\r\n              <Box sx={{ mb: 2 }}>\r\n                <Typography variant=\"subtitle2\" sx={{ mb: 1, fontWeight: 600 }}>\r\n                  Selected Images ({selectedFiles.length}):\r\n                </Typography>\r\n                <Stack spacing={1}>\r\n                  {selectedFiles.map((file, index) => {\r\n                    const fileKey = `${file.name}-${file.size}`;\r\n                    const status = uploadStatus[fileKey];\r\n                    return (\r\n                      <Box\r\n                        key={index}\r\n                        sx={{\r\n                          p: 2,\r\n                          bgcolor: 'background.default',\r\n                          borderRadius: 1,\r\n                          border: '1px solid',\r\n                          borderColor: status?.status === 'error' ? 'error.main' : status?.status === 'success' ? 'success.main' : 'divider',\r\n                        }}\r\n                      >\r\n                        <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', mb: 1 }}>\r\n                          <Box sx={{ flex: 1 }}>\r\n                            <Typography variant=\"body2\" sx={{ fontWeight: 600, mb: 0.5 }}>\r\n                              {file.name}\r\n                            </Typography>\r\n                            <Typography variant=\"caption\" color=\"text.secondary\" display=\"block\">\r\n                              Size: {(file.size / 1024 / 1024).toFixed(2)} MB\r\n                            </Typography>\r\n                            {status && (\r\n                              <>\r\n                                {status.status === 'uploading' && (\r\n                                  <Box sx={{ mt: 1 }}>\r\n                                    <LinearProgress variant=\"determinate\" value={status.progress} size=\"small\" />\r\n                                    <Typography variant=\"caption\" color=\"text.secondary\">\r\n                                      Uploading... {Math.round(status.progress)}%\r\n                                    </Typography>\r\n                                  </Box>\r\n                                )}\r\n                                {status.status === 'success' && (\r\n                                  <Typography variant=\"caption\" color=\"success.main\" sx={{ mt: 0.5, display: 'block' }}>\r\n                                    âœ“ Uploaded successfully\r\n                                  </Typography>\r\n                                )}\r\n                                {status.status === 'error' && (\r\n                                  <Typography variant=\"caption\" color=\"error.main\" sx={{ mt: 0.5, display: 'block' }}>\r\n                                    âœ— {status.error || 'Upload failed'}\r\n                                  </Typography>\r\n                                )}\r\n                              </>\r\n                            )}\r\n                          </Box>\r\n                          {!uploading && (\r\n                            <IconButton\r\n                              size=\"small\"\r\n                              onClick={() => handleRemoveFile(index)}\r\n                              sx={{ ml: 1 }}\r\n                              color=\"error\"\r\n                            >\r\n                              <IconX size={18} />\r\n                            </IconButton>\r\n                          )}\r\n                        </Box>\r\n                      </Box>\r\n                    );\r\n                  })}\r\n                </Stack>\r\n              </Box>\r\n            )}\r\n\r\n            {uploading && selectedFiles.length > 0 && (\r\n              <Box sx={{ mt: 2 }}>\r\n                <Typography variant=\"body2\" color=\"text.secondary\" sx={{ mb: 1 }}>\r\n                  Overall Progress: {Math.round(uploadProgress)}%\r\n                </Typography>\r\n                <LinearProgress variant=\"determinate\" value={uploadProgress} />\r\n                <Typography variant=\"caption\" color=\"text.secondary\" sx={{ mt: 1, display: 'block' }}>\r\n                  Uploading {selectedFiles.length} image{selectedFiles.length > 1 ? 's' : ''}...\r\n                </Typography>\r\n              </Box>\r\n            )}\r\n\r\n            {uploadError && (\r\n              <Alert severity=\"error\" sx={{ mt: 2 }}>\r\n                {uploadError}\r\n              </Alert>\r\n            )}\r\n          </Box>\r\n        </DialogContent>\r\n        <DialogActions>\r\n          <Button onClick={handleCloseUploadDialog} disabled={uploading}>\r\n            Cancel\r\n          </Button>\r\n          <Button\r\n            onClick={handleUpload}\r\n            variant=\"contained\"\r\n            disabled={selectedFiles.length === 0 || uploading}\r\n            sx={{\r\n              backgroundColor: '#C8A24B',\r\n              color: '#1a1a1a',\r\n              '&:hover': {\r\n                backgroundColor: '#B8923A',\r\n              },\r\n            }}\r\n          >\r\n            {uploading ? `Uploading... (${Math.round(uploadProgress)}%)` : `Upload ${selectedFiles.length} Image${selectedFiles.length !== 1 ? 's' : ''}`}\r\n          </Button>\r\n        </DialogActions>\r\n      </Dialog>\r\n    </Box>\r\n  );\r\n};\r\n\r\nexport default Gallery;\r\n\r\n"],"names":["__iconNode","IconArrowsExchange","createReactComponent","CANONICAL_IMAGE_DIRECTORIES","IMAGES_BASE_PATH","isCanonicalDirectory","dirName","buildImageUrl","directory","filename","normalizedDir","extractDirectoryFromPath","imagePath","parts","GalleryContainer","styled","Container","theme","ThumbnailGrid","Box","ImageCard","Card","isUsed","__spreadProps","__spreadValues","ImageThumbnail","CardMedia","CarouselContainer","CarouselButton","IconButton","CarouselImageContainer","Gallery","useTheme","images","setImages","useState","uploadDialogOpen","setUploadDialogOpen","imageDialogOpen","setImageDialogOpen","selectedImage","setSelectedImage","uploading","setUploading","uploadProgress","setUploadProgress","uploadError","setUploadError","selectedFiles","setSelectedFiles","uploadStatus","setUploadStatus","deleting","setDeleting","selectedRows","setSelectedRows","currentIndex","setCurrentIndex","sortBy","setSortBy","sortOrder","setSortOrder","usageFilter","setUsageFilter","checkingUsage","setCheckingUsage","exportingUsedImages","setExportingUsedImages","selectedDirectory","setSelectedDirectory","directoryTree","setDirectoryTree","loadingTree","setLoadingTree","moveDialogOpen","setMoveDialogOpen","renameDialogOpen","setRenameDialogOpen","itemToMove","setItemToMove","newName","setNewName","targetDir","setTargetDir","suggestions","setSuggestions","suggestionsDialogOpen","setSuggestionsDialogOpen","suggestionStatuses","setSuggestionStatuses","showFullSummary","setShowFullSummary","summaryExpanded","setSummaryExpanded","validating","setValidating","applying","setApplying","fileInputRef","useRef","hasAutoCheckedUsage","lastCheckedDirectory","lastImageCount","sortImages","imagesToSort","a","b","comparison","dateA","dateB","activeImages","React","filtered","img","handlePrevious","prev","handleNext","checkImageUsage","imagesToCheck","checkAll","__async","imagesToProcess","BATCH_SIZE","batches","allUsage","batchIndex","batch","response","data","errorData","prevImages","updated","usageValue","error","useEffect","sorted","loadDirectoryTree","cleanupEmptyDirectories","loadImages","checkTimer","directoryNotChecked","debug","_a","_b","url","imageExtensions","imageFiles","file","ext","transformedImages","index","fileSize","fileModified","fileCreated","metadataError","imageUrl","handleImageClick","image","handleOpenInNewWindow","newWindow","handleDeleteImage","relativePath","result","errorMessage","e","handleMoveImage","targetPath","handleRenameImage","handleCreateDirectory","errorMsg","code","pathInfo","handleGetSuggestions","normalizePath","pathStr","handleDryRun","actions","suggestion","newStatuses","idx","handleApplySingle","handleApplyAll","invalidCount","handleCopySummary","summary","status","s","text","err","getStatusChip","Chip","colorMap","jsx","handleFileSelect","event","files","validFiles","errors","allowedExtensions","fileExtension","uploadSingleFile","targetDirectory","resolve","reject","formData","xhr","fileKey","percentComplete","allStatuses","totalProgress","sum","errorResponse","handleUpload","initialStatus","handleOpenUploadDialog","handleCloseUploadDialog","handleRemoveFile","_","i","columns","params","Typography","jsxs","value","row","dateValue","imageRow","date","Tooltip","dateStr","size","sizeValue","numValue","sizeKB","Stack","IconPhoto","IconEdit","IconTrash","handleBulkDelete","deletePromises","results","successful","r","failed","failedDetails","f","handleExportCSV","headers","rows","csvContent","cell","blob","link","handleExportUsedImages","allUsedImages","offset","limit","hasMore","totalImages","checkedImages","limited","errorText","output","ref","thumbnailImages","renderDirectoryTree","dirs","level","d","canonicalDirsToShow","existing","otherDirs","dir","isDefault","isEmpty","Button","IconFolder","OMLoading","IconFolderPlus","IconSparkles","Alert","IconArrowLeft","IconArrowRight","IconUpload","activeIndex","Fragment","FormControl","InputLabel","Select","MenuItem","IconDownload","Paper","DataGrid","newSelection","Dialog","DialogTitle","DialogContent","TextField","DialogActions","LinearProgress","FormControlLabel","Checkbox","isValid","isInvalid","isApplied","isFailed","Divider","IconChevronUp","IconChevronDown","Collapse","idxStr","IconCopy","IconX"],"mappings":"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","x_google_ignoreList":[0]}