var Yt=Object.defineProperty,Qt=Object.defineProperties;var Xt=Object.getOwnPropertyDescriptors;var At=Object.getOwnPropertySymbols;var Zt=Object.prototype.hasOwnProperty,es=Object.prototype.propertyIsEnumerable;var Ft=(r,a,n)=>a in r?Yt(r,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):r[a]=n,L=(r,a)=>{for(var n in a||(a={}))Zt.call(a,n)&&Ft(r,n,a[n]);if(At)for(var n of At(a))es.call(a,n)&&Ft(r,n,a[n]);return r},B=(r,a)=>Qt(r,Xt(a));var k=(r,a,n)=>new Promise((y,d)=>{var N=O=>{try{S(n.next(O))}catch(U){d(U)}},W=O=>{try{S(n.throw(O))}catch(U){d(U)}},S=O=>O.done?y(O.value):Promise.resolve(O.value).then(N,W);S((n=n.apply(r,a)).next())});import{a as De,j as e,k as Nt,$ as J,B as u,C as Be,d as o,U as jt,Q as ft,G as P,a0 as le,a1 as ce,a2 as de,f as M,O as R,F as ts,r as yt,D as Ge,R as be,e as w,b9 as Ht,J as ue,Y as he,K as me,a3 as pe,h as q,S as Je,cH as Ee,bd as ss,i as as,T as ae,I as re,aH as rt,p as Lt}from"./index-BDfVhljI.js";import{P as rs}from"./PageContainer-CRaXY1g0.js";import{B as ns}from"./Breadcrumb-BksUUxoN.js";import{r as h}from"./vendor-DgfDxsY7.js";import{S as Pt,C as is}from"./Send-T0POBJWK.js";import{C as os}from"./CloudUpload-zTcIYRxr.js";import{A as ls}from"./Autocomplete-DPOEa6DV.js";import{C as cs}from"./Cancel-nbrqRl5r.js";import{A as Vt,a as Ut,b as qt}from"./AccordionSummary-D4_s6jxW.js";import{E as Kt}from"./ExpandMore-Bcngkytz.js";import{T as nt}from"./Assignment-Cv8No_jQ.js";import{H as it}from"./History-B-mmrrSF.js";import{T as ds,a as ot}from"./Tabs-VYJhMi1b.js";import{B as lt}from"./Badge-DJp7X618.js";import{T as ct,a as dt,b as ut,c as _e,d as ht}from"./TableRow-CY_CMYLL.js";import{T as f}from"./TableCell-Cc2Re30I.js";import{A as Ot}from"./Avatar-TOicZKRH.js";import{C as Ue}from"./Computer-CuzTDBub.js";import{D as qe}from"./Delete-BzvjJ98g.js";import{D as mt}from"./Download-Dy8080P5.js";import{T as us}from"./TablePagination-C4Cw0OxC.js";import{I as Rt}from"./Info-mPVCfH-0.js";import{W as hs}from"./Warning-C63rUtT9.js";import{C as pt}from"./CheckCircle-BzDkpPsE.js";import{S as zt}from"./Schedule-BVPUy3BF.js";import{V as ms}from"./Visibility-DyzL3Bo2.js";import"./Helmet-DNWYwtrp.js";import"./index-BvdvJza9.js";import"./Breadcrumbs-neNWuVCu.js";import"./Link-UeZU0xE4.js";import"./usePreviousProps-BWumOsHT.js";import"./ListSubheader-CoVriMd8.js";import"./KeyboardArrowRight-n0bX-S0N.js";import"./LastPage-DImRq0Fq.js";import"./Toolbar-Dg6xCX72.js";const Mt=De(e.jsx("path",{d:"M16.5 6v11.5c0 2.21-1.79 4-4 4s-4-1.79-4-4V5c0-1.38 1.12-2.5 2.5-2.5s2.5 1.12 2.5 2.5v10.5c0 .55-.45 1-1 1s-1-.45-1-1V6H10v9.5c0 1.38 1.12 2.5 2.5 2.5s2.5-1.12 2.5-2.5V5c0-2.21-1.79-4-4-4S7 2.79 7 5v12.5c0 3.04 2.46 5.5 5.5 5.5s5.5-2.46 5.5-5.5V6z"})),Gt=De(e.jsx("path",{d:"M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2m0 4-8 5-8-5V6l8 5 8-5z"})),ps=De(e.jsx("path",{d:"M6 2c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm7 7V3.5L18.5 9z"})),Wt=De(e.jsx("path",{d:"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1M8 13h8v-2H8zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5"})),xt=De(e.jsx("path",{d:"M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5M12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5m0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"})),$t=De(e.jsx("path",{d:"M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8zm-3.06 16L7.4 14.46l1.41-1.41 2.12 2.12 4.24-4.24 1.41 1.41zM13 9V3.5L18.5 9z"})),oe={validateEmail:r=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(r),getTaskLogs:(r=50)=>k(void 0,null,function*(){try{const a=yield fetch(`/api/omai/task-logs?limit=${r}`,{credentials:"include"});if(!a.ok)throw new Error(`Failed to fetch task logs: ${a.statusText}`);return yield a.json()}catch(a){return console.error("Error fetching task logs:",a),{success:!1,error:a.message||"Failed to fetch task logs",data:{recent_links:[],recent_submissions:[],recent_logs:[]}}}}),getTaskHistory:r=>k(void 0,null,function*(){try{const a=new URLSearchParams;r.page&&a.append("page",r.page.toString()),r.limit&&a.append("limit",r.limit.toString()),r.email&&a.append("email",r.email),r.status&&a.append("status",r.status),r.type&&a.append("type",r.type),r.dateFrom&&a.append("dateFrom",r.dateFrom),r.dateTo&&a.append("dateTo",r.dateTo);const n=yield fetch(`/api/omai/task-history?${a.toString()}`,{credentials:"include"});if(!n.ok)throw new Error(`Failed to fetch task history: ${n.statusText}`);return yield n.json()}catch(a){return console.error("Error fetching task history:",a),{success:!1,error:a.message||"Failed to fetch task history",data:{submissions:[],total:0}}}}),generateTaskLink:(r,a)=>k(void 0,null,function*(){try{const n=yield fetch("/api/omai/task-link",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({email:r,expiresInMinutes:a.expiresInMinutes||1440,meta:{notes:a.notes||"",source:"admin-panel",purpose:"task-assignment"}})});if(!n.ok){const d=yield n.json().catch(()=>({}));throw new Error(d.error||`Failed to generate task link: ${n.statusText}`)}return yield n.json()}catch(n){return console.error("Error generating task link:",n),{success:!1,error:n.message||"Failed to generate task link"}}}),validateToken:r=>k(void 0,null,function*(){try{const a=yield fetch(`/api/omai/validate-token?t=${r}`,{credentials:"include"});if(!a.ok)throw new Error(`Failed to validate token: ${a.statusText}`);return yield a.json()}catch(a){return console.error("Error validating token:",a),{success:!1,valid:!1,error:a.message||"Failed to validate token"}}}),submitTask:(r,a)=>k(void 0,null,function*(){try{const n=yield fetch("/api/omai/submit-task",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({token:r,tasks:a})});if(!n.ok){const d=yield n.json().catch(()=>({}));throw new Error(d.error||`Failed to submit tasks: ${n.statusText}`)}return yield n.json()}catch(n){return console.error("Error submitting tasks:",n),{success:!1,error:n.message||"Failed to submit tasks"}}}),getPublicTokenStatistics:()=>k(void 0,null,function*(){try{const r=yield fetch("/api/omai/public-tokens",{credentials:"include"});if(!r.ok)throw new Error(`Failed to fetch public token statistics: ${r.statusText}`);return yield r.json()}catch(r){return console.error("Error fetching public token statistics:",r),{success:!1,error:r.message||"Failed to fetch public token statistics",data:{statistics:{total:0,active:0,expired:0,used:0,rateLimitEntries:0},active_tokens:[]}}}}),deletePublicToken:r=>k(void 0,null,function*(){try{const a=yield fetch(`/api/omai/public-token/${r}`,{method:"DELETE",credentials:"include"});if(!a.ok){const y=yield a.json().catch(()=>({}));throw new Error(y.error||`Failed to delete public token: ${a.statusText}`)}return yield a.json()}catch(a){return console.error("Error deleting public token:",a),{success:!1,error:a.message||"Failed to delete public token"}}}),deleteTaskLink:r=>k(void 0,null,function*(){try{const a=yield fetch(`/api/omai/task-link/${r}`,{method:"DELETE",credentials:"include"});if(!a.ok){const y=yield a.json().catch(()=>({}));throw new Error(y.error||`Failed to delete task link: ${a.statusText}`)}return yield a.json()}catch(a){return console.error("Error deleting task link:",a),{success:!1,error:a.message||"Failed to delete task link"}}}),deleteSubmission:r=>k(void 0,null,function*(){try{const a=yield fetch(`/api/omai/task-submission/${r}`,{method:"DELETE",credentials:"include"});if(!a.ok){const y=yield a.json().catch(()=>({}));throw new Error(y.error||`Failed to delete submission: ${a.statusText}`)}return yield a.json()}catch(a){return console.error("Error deleting submission:",a),{success:!1,error:a.message||"Failed to delete submission"}}}),deleteSubmissionsBatch:r=>k(void 0,null,function*(){try{const a=yield fetch("/api/omai/task-submissions/batch",{method:"DELETE",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({ids:r})});if(!a.ok){const y=yield a.json().catch(()=>({}));throw new Error(y.error||`Failed to delete submissions: ${a.statusText}`)}return yield a.json()}catch(a){return console.error("Error deleting submissions batch:",a),{success:!1,error:a.message||"Failed to delete submissions"}}}),createTask:r=>k(void 0,null,function*(){try{const a=yield fetch("/api/omai/tasks",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(r)});if(!a.ok){let y=`Failed to create task: ${a.statusText}`,d=null;if(a.status===404)y="Backend endpoint not found. The task creation API endpoint needs to be implemented on the server.";else try{const W=yield a.json();y=W.error||y,d=W.details||null,d&&d.sqlMessage&&(y+=` (${d.sqlMessage})`)}catch(W){}const N=new Error(y);throw N.details=d,N}return{success:!0,data:yield a.json()}}catch(a){throw console.error("Error creating task:",a),a}}),getTasks:r=>k(void 0,null,function*(){try{const a=new URLSearchParams;r!=null&&r.visibility&&a.append("visibility",r.visibility),r!=null&&r.status&&a.append("status",r.status.toString()),r!=null&&r.category&&a.append("category",r.category),r!=null&&r.type&&a.append("type",r.type),r!=null&&r.page&&a.append("page",r.page.toString()),r!=null&&r.limit&&a.append("limit",r.limit.toString());const n=yield fetch(`/api/omai/tasks?${a.toString()}`,{credentials:"include"});if(!n.ok)throw new Error(`Failed to fetch tasks: ${n.statusText}`);return yield n.json()}catch(a){return console.error("Error fetching tasks:",a),{success:!1,error:a.message||"Failed to fetch tasks",data:{tasks:[],total:0}}}}),getPublicTasks:r=>k(void 0,null,function*(){try{const a=new URLSearchParams;r!=null&&r.category&&a.append("category",r.category),r!=null&&r.status&&a.append("status",r.status.toString()),r!=null&&r.type&&a.append("type",r.type),r!=null&&r.page&&a.append("page",r.page.toString()),r!=null&&r.limit&&a.append("limit",r.limit.toString());const n=yield fetch(`/api/public/tasks?${a.toString()}`);if(!n.ok)throw new Error(`Failed to fetch public tasks: ${n.statusText}`);return yield n.json()}catch(a){return console.error("Error fetching public tasks:",a),{success:!1,error:a.message||"Failed to fetch public tasks",data:{tasks:[],total:0}}}}),getPublicTask:r=>k(void 0,null,function*(){try{const a=yield fetch(`/api/public/tasks/${r}`);if(!a.ok)throw new Error(`Failed to fetch task: ${a.statusText}`);return yield a.json()}catch(a){return console.error("Error fetching public task:",a),{success:!1,error:a.message||"Failed to fetch task"}}}),assignTask:r=>k(void 0,null,function*(){return console.warn("OMAI API assignTask is deprecated, use generateTaskLink instead"),{success:!1,message:"OMAI API assignTask is deprecated"}}),updateTask:(r,a)=>k(void 0,null,function*(){return console.warn("OMAI API updateTask is deprecated"),{success:!1,message:"OMAI API updateTask is deprecated"}})},xs=()=>{const{hasRole:r,isSuperAdmin:a}=Nt(),[n,y]=h.useState({provider:"Custom",smtp_host:"",smtp_port:587,smtp_secure:!1,smtp_user:"",smtp_pass:"",sender_name:"OMAI Task System",sender_email:""}),[d,N]=h.useState(!0),[W,S]=h.useState(!1),[O,U]=h.useState(!1),[I,D]=h.useState(null),[Y,K]=h.useState(null),[Ae,H]=h.useState(!1),[G,Q]=h.useState(""),ne=a()||r("admin"),X={GoDaddy:{smtp_host:"smtpout.secureserver.net",smtp_port:465,smtp_secure:!0},Outlook365:{smtp_host:"smtp-mail.outlook.com",smtp_port:587,smtp_secure:!1},Gmail:{smtp_host:"smtp.gmail.com",smtp_port:587,smtp_secure:!1},Yahoo:{smtp_host:"smtp.mail.yahoo.com",smtp_port:587,smtp_secure:!1},Custom:{smtp_host:"",smtp_port:587,smtp_secure:!1}};h.useEffect(()=>{ne&&Fe()},[ne]);const Fe=()=>k(void 0,null,function*(){try{D(null);const c=yield fetch("/api/settings/email",{credentials:"include"});if(c.status===404){N(!1);return}if(!c.ok)throw new Error("Failed to fetch email configuration");const b=yield c.json();b.success&&b.data&&y($=>L(L({},$),b.data))}catch(c){D(c.message||"Failed to load email configuration")}finally{N(!1)}}),Z=c=>{const b=X[c];b&&y($=>L(B(L({},$),{provider:c}),b))},A=()=>k(void 0,null,function*(){D(null),K(null),S(!0);try{if(!n.smtp_host||!n.smtp_user||!n.sender_email)throw new Error("Please fill in all required fields");if(!n.id&&!n.smtp_pass)throw new Error("Password is required for new email configurations");const c=L({},n);(!c.smtp_pass||c.smtp_pass.trim()==="")&&n.id&&delete c.smtp_pass;const b=yield fetch("/api/settings/email",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(c)}),$=yield b.json();if(!b.ok)throw new Error($.error||"Failed to save email configuration");if($.success)K("Email configuration saved successfully!"),y(te=>L(L({},te),$.data));else throw new Error($.error||"Failed to save configuration")}catch(c){D(c.message||"Failed to save email configuration")}finally{S(!1)}}),ee=()=>k(void 0,null,function*(){if(!G){D("Please enter a test email address");return}D(null),K(null),U(!0);try{const c=yield fetch("/api/settings/email/test",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({test_email:G})}),b=yield c.json();if(!c.ok)throw new Error(b.error||"Email test failed");if(b.success)K(`Test email sent successfully to ${G}!`),H(!1),Q("");else throw new Error(b.error||"Email test failed")}catch(c){D(c.message||"Failed to send test email")}finally{U(!1)}});return ne?d?e.jsxs(u,{display:"flex",justifyContent:"center",alignItems:"center",py:4,children:[e.jsx(Be,{}),e.jsx(o,{variant:"body1",sx:{ml:2},children:"Loading email configuration..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(jt,{children:e.jsxs(ft,{children:[e.jsxs(u,{display:"flex",alignItems:"center",mb:3,children:[e.jsx(Gt,{sx:{mr:2,color:"#8c249d"}}),e.jsxs(u,{children:[e.jsx(o,{variant:"h5",children:"Email Configuration"}),e.jsx(o,{variant:"body2",color:"text.secondary",children:"Configure SMTP settings for OMAI task assignment emails"})]})]}),I&&e.jsx(J,{severity:"error",sx:{mb:2},onClose:()=>D(null),children:I}),Y&&e.jsx(J,{severity:"success",sx:{mb:2},onClose:()=>K(null),children:Y}),e.jsxs(P,{container:!0,spacing:3,children:[e.jsx(P,{item:!0,xs:12,md:6,children:e.jsxs(le,{fullWidth:!0,children:[e.jsx(ce,{children:"Email Provider"}),e.jsx(de,{value:n.provider,label:"Email Provider",onChange:c=>Z(c.target.value),children:Object.keys(X).map(c=>e.jsx(M,{value:c,children:c},c))})]})}),e.jsx(P,{item:!0,xs:12,md:6,children:e.jsx(R,{fullWidth:!0,label:"SMTP Host",value:n.smtp_host,onChange:c=>y(b=>B(L({},b),{smtp_host:c.target.value})),placeholder:"smtp.example.com",required:!0})}),e.jsx(P,{item:!0,xs:12,md:6,children:e.jsx(R,{fullWidth:!0,label:"SMTP Port",type:"number",value:n.smtp_port,onChange:c=>y(b=>B(L({},b),{smtp_port:parseInt(c.target.value)||587})),required:!0})}),e.jsx(P,{item:!0,xs:12,md:6,children:e.jsx(ts,{control:e.jsx(yt,{checked:n.smtp_secure,onChange:c=>y(b=>B(L({},b),{smtp_secure:c.target.checked}))}),label:n.smtp_secure?"SSL (Port 465)":"STARTTLS (Port 587)"})}),e.jsxs(P,{item:!0,xs:12,children:[e.jsx(Ge,{sx:{my:2}}),e.jsx(o,{variant:"h6",gutterBottom:!0,children:"Authentication"})]}),e.jsx(P,{item:!0,xs:12,md:6,children:e.jsx(R,{fullWidth:!0,label:"SMTP Username",value:n.smtp_user,onChange:c=>y(b=>B(L({},b),{smtp_user:c.target.value})),placeholder:"your-email@example.com",required:!0})}),e.jsx(P,{item:!0,xs:12,md:6,children:e.jsx(R,{fullWidth:!0,label:"SMTP Password",type:"password",value:n.smtp_pass,onChange:c=>y(b=>B(L({},b),{smtp_pass:c.target.value})),placeholder:"Leave blank to keep existing password",helperText:"Only required when changing password. Leave blank to keep current encrypted password."})}),e.jsxs(P,{item:!0,xs:12,children:[e.jsx(Ge,{sx:{my:2}}),e.jsx(o,{variant:"h6",gutterBottom:!0,children:"Sender Information"})]}),e.jsx(P,{item:!0,xs:12,md:6,children:e.jsx(R,{fullWidth:!0,label:"Sender Name",value:n.sender_name,onChange:c=>y(b=>B(L({},b),{sender_name:c.target.value})),placeholder:"OMAI Task System",required:!0})}),e.jsx(P,{item:!0,xs:12,md:6,children:e.jsx(R,{fullWidth:!0,label:"Sender Email",type:"email",value:n.sender_email,onChange:c=>y(b=>B(L({},b),{sender_email:c.target.value})),placeholder:"noreply@yourdomain.com",required:!0})})]}),n.sender_name&&n.sender_email&&e.jsxs(be,{sx:{p:2,mt:3,bgcolor:"#f9f9f9"},children:[e.jsx(o,{variant:"subtitle2",gutterBottom:!0,children:"Email Preview:"}),e.jsxs(o,{variant:"body2",children:[e.jsx("strong",{children:"From:"}),' "',n.sender_name,'" <',n.sender_email,">"]}),e.jsxs(o,{variant:"body2",children:[e.jsx("strong",{children:"Server:"})," ",n.smtp_host,":",n.smtp_port," (",n.smtp_secure?"SSL":"STARTTLS",")"]})]}),e.jsxs(u,{display:"flex",gap:2,mt:3,children:[e.jsx(w,{variant:"contained",onClick:A,disabled:W,startIcon:W?e.jsx(Be,{size:20}):e.jsx(Ht,{}),sx:{bgcolor:"#8c249d"},children:W?"Saving...":"Save Configuration"}),e.jsx(w,{variant:"outlined",onClick:()=>H(!0),disabled:!n.smtp_host||!n.smtp_user,startIcon:e.jsx(Pt,{}),children:"Test Email"})]}),e.jsx(J,{severity:"info",sx:{mt:3},children:e.jsxs(o,{variant:"body2",children:[e.jsx("strong",{children:"Provider Setup Tips:"}),e.jsx("br",{}),"• ",e.jsx("strong",{children:"GoDaddy:"})," Use your cPanel email or workspace email with an app password • ",e.jsx("strong",{children:"Outlook 365:"})," Enable SMTP AUTH and use an app password if 2FA is enabled • ",e.jsx("strong",{children:"Gmail:"})," Use an app password instead of your regular password • ",e.jsx("strong",{children:"Custom:"})," Contact your email provider for SMTP settings"]})})]})}),e.jsxs(ue,{open:Ae,onClose:()=>H(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(he,{children:"Test Email Configuration"}),e.jsxs(me,{children:[e.jsx(o,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Send a test email to verify your SMTP configuration is working correctly."}),e.jsx(R,{fullWidth:!0,label:"Test Email Address",type:"email",value:G,onChange:c=>Q(c.target.value),placeholder:"test@example.com",sx:{mt:1}})]}),e.jsxs(pe,{children:[e.jsx(w,{onClick:()=>H(!1),children:"Cancel"}),e.jsx(w,{onClick:ee,variant:"contained",disabled:O||!G,startIcon:O?e.jsx(Be,{size:20}):e.jsx(Pt,{}),sx:{bgcolor:"#8c249d"},children:O?"Sending...":"Send Test Email"})]})]})]}):e.jsx(J,{severity:"warning",sx:{m:2},children:"You don't have permission to manage email settings."})},gs=["Ingestion & Digitization","Data Structuring & Accuracy","Workflow & User Experience","Platform & Infrastructure","Analytics & Intelligence"],js=[{value:"critical",label:"Critical",color:"error"},{value:"high",label:"High",color:"warning"},{value:"medium",label:"Medium",color:"info"},{value:"low",label:"Low",color:"default"}],fs=[{value:1,label:"Not Started"},{value:2,label:"Assigned"},{value:3,label:"In Progress"},{value:4,label:"In Review"},{value:5,label:"Blocked"},{value:6,label:"On Hold"},{value:7,label:"Task Completed"}],ys=[{value:"admin",label:"Admin Only"},{value:"public",label:"Public"}],bs=[{value:"documentation",label:"Documentation",description:"Descriptive overview of a feature/system (what it is, how it works at a high level)"},{value:"configuration",label:"Configuration",description:"Setup, env vars, flags, settings, install/runtime configuration"},{value:"reference",label:"Reference",description:"Authoritative, technical, exhaustive details (APIs, schemas, fields, rules, edge cases)"},{value:"guide",label:"Guide",description:"Step-by-step, task-oriented instructions (how to do X)"}],Jt=[{group:"OCR & Ingestion",tags:["ocr","google-vision","document-ai","handwriting","printed-text","language-filtering","bounding-box","anchors","layout-detection","entry-detection","confidence-threshold","preprocessing","image-quality","dpi"]},{group:"Data & Records",tags:["baptism","marriage","funeral","clergy","parish","records","schema","field-mapping","normalization","validation","duplicates","historical-data"]},{group:"Workflow & UI",tags:["fusion","inspection-panel","review-finalize","drafts","overlays","highlights","entry-editor","empty-state","autosave","modal","ux","ui"]},{group:"Platform & Backend",tags:["api","database","migrations","auth","roles","permissions","logging","error-handling","performance","security","backups","infrastructure"]},{group:"Analytics & Intelligence",tags:["analytics","reports","trends","dashboards","charts","metrics","omai","bigbook","search","summarization","insights"]},{group:"Documentation Meta",tags:["docs","reference","guide","configuration","legacy","task-history","public","admin-only"]},{group:"Status / Process",tags:["blocked","needs-review","needs-design","needs-backend","needs-frontend","high-risk","breaking-change","cleanup","tech-debt"]}],vs=Jt.flatMap(r=>r.tags),Ke=r=>r.trim().toLowerCase().replace(/[\s_]+/g,"-").replace(/[^a-z0-9-]/g,"").replace(/-+/g,"-").replace(/^-|-$/g,""),gt="om_tasks:create_task_draft:v1",Bt=2*1024*1024,ks=300,Ss=({open:r,onClose:a,onSave:n})=>{const y=()=>{try{const t=localStorage.getItem(gt);if(t){const i=JSON.parse(t);if(i&&typeof i=="object")return{title:i.title||"",category:i.category||"",importance:i.importance||"high",details:i.details||"",tags:Array.isArray(i.tags)?i.tags:[],attachments:Array.isArray(i.attachments)?i.attachments:[],status:i.status||1,type:i.type||"",visibility:i.visibility||"admin",assignedTo:i.assignedTo||"Nick Parsells",assignedBy:i.assignedBy||"system",notes:i.notes||"",remindMe:i.remindMe||!1,revisions:Array.isArray(i.revisions)?i.revisions:void 0}}}catch(t){console.warn("Failed to load draft:",t)}return{title:"",category:"",importance:"high",details:"",tags:[],attachments:[],status:1,type:"",visibility:"admin",assignedTo:"Nick Parsells",assignedBy:"system",notes:"",remindMe:!1,revisions:void 0}},[d,N]=h.useState(y),[W,S]=h.useState(""),[O,U]=h.useState(""),[I,D]=h.useState({}),[Y,K]=h.useState(!1),[Ae,H]=h.useState(!1),[G,Q]=h.useState(!1),[ne,X]=h.useState(!1),[Fe,Z]=h.useState(!1),[A,ee]=h.useState(null),[c,b]=h.useState([]),[$,te]=h.useState(null),xe=h.useRef(null),Se=h.useRef(null),Le=new Date,Pe=Le.toISOString(),ge=Le.toLocaleString("en-US",{month:"2-digit",day:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",hour12:!1}).replace(",",""),Ye=h.useCallback(t=>{xe.current&&clearTimeout(xe.current),xe.current=setTimeout(()=>{try{localStorage.setItem(gt,JSON.stringify(t)),Q(!0)}catch(i){console.warn("Failed to save draft:",i)}},ks)},[]),Oe=h.useCallback(()=>{try{localStorage.removeItem(gt),Q(!1)}catch(t){console.warn("Failed to clear draft:",t)}},[]);h.useEffect(()=>{if(r){const t=y();N(t),Q(Object.values(t).some(i=>Array.isArray(i)?i.length>0:typeof i=="string"?i.trim().length>0:typeof i=="number"?i!==1:typeof i=="boolean"?i!==!1:i!==""&&i!==null&&i!==void 0))}},[r]);const C=(t,i)=>{N(v=>{const m=B(L({},v),{[t]:i});if(t==="type"&&i){const E={documentation:"document-ai",configuration:"config-ai",reference:"reference-ai",guide:"guide-ai"}[i];E&&!m.tags.includes(E)&&(m.tags=[...m.tags,E])}return Ye(m),m}),I[t]&&D(v=>{const m=L({},v);return delete m[t],m})},Qe=t=>{const i=Ke(W);i&&!d.tags.includes(i)&&(C("tags",[...d.tags,i]),S(""))},Xe=t=>{const i=t.map(v=>Ke(v)).filter((v,m,p)=>v&&p.indexOf(v)===m);C("tags",i)},Ne=t=>{C("tags",d.tags.filter(i=>i!==t))},Re=()=>{O.trim()&&!d.attachments.includes(O.trim())&&(C("attachments",[...d.attachments,O.trim()]),U(""))},He=t=>{C("attachments",d.attachments.filter(i=>i!==t))},ze=()=>{const t={};return d.title.trim()||(t.title="Title is required"),d.category||(t.category="Category is required"),d.importance||(t.importance="Importance is required"),d.details.trim()||(t.details="Details are required"),d.tags.length===0&&(t.tags="At least one tag is required"),d.type||(t.type="Type is required"),D(t),Object.keys(t).length===0},Te=()=>{N({title:"",category:"",importance:"",details:"",tags:[],attachments:[],status:1,type:"",visibility:"admin",assignedTo:"",assignedBy:"",notes:"",remindMe:!1,revisions:void 0}),S(""),U(""),D({}),Oe()},Ze=()=>k(void 0,null,function*(){if(ze()){K(!0),D({});try{const t=B(L({},d),{date_created:Pe,date_completed:d.status===7?Pe:void 0}),i=yield n(t);if(i&&i.success===!1)throw new Error(i.error||"Failed to create task");Te(),a()}catch(t){console.error("Error saving task:",t),console.error("Error details:",t.details);let i=t.message||"Failed to create task. Please check your connection and try again.";t.details&&t.details.sqlMessage&&(i+=`

SQL Error: ${t.details.sqlMessage}`,t.details.code&&(i+=`
Error Code: ${t.details.code}`)),D({submit:i})}finally{K(!1)}}}),V=()=>{Y||(G?H(!0):(Te(),a()))},et=()=>{Te(),H(!1),a()},z=()=>{H(!1)},we=h.useRef(0),se=t=>{t.preventDefault(),t.stopPropagation(),we.current++,t.dataTransfer.items&&t.dataTransfer.items.length>0&&X(!0)},Ce=t=>{t.preventDefault(),t.stopPropagation(),we.current--,we.current===0&&X(!1)},Me=t=>{t.preventDefault(),t.stopPropagation(),t.dataTransfer.types.includes("Files")&&(t.dataTransfer.dropEffect="copy")},je=t=>k(void 0,null,function*(){t.preventDefault(),t.stopPropagation(),we.current=0,X(!1);const v=Array.from(t.dataTransfer.files).find(m=>m.name.endsWith(".md")||m.name.endsWith(".txt")||m.type==="text/markdown"||m.type==="text/plain");if(!v){D({submit:"Please drop a .md or .txt file"});return}if(v.size>Bt){D({submit:`File size exceeds ${Bt/1024/1024}MB limit`});return}try{const m=yield Ie(v),p=m.split(`
`),E=(g,T)=>{const F=g.trim();return F.toLowerCase().startsWith(T.toLowerCase()+":")?F.substring(T.length+1).trim():""},_={};if(p[0]){const g=E(p[0],"Title");g&&(_.title=g)}if(p[1]){const g=E(p[1],"Category");g&&(_.category=g)}if(p[2]){const g=E(p[2],"Importance");_.importance=g||"high"}else _.importance="high";if(p[3]){let T=E(p[3],"Details");for(let F=4;F<13&&F<p.length;F++){const ve=p[F].trim();if(ve.match(/^(Title|Category|Importance|Type|tags|Attachment|Status|Visibility|Date|Optional|Assigned):/i))break;ve&&(T+=(T?`
`:"")+ve)}T&&(_.details=T)}if(p[4]){const g=E(p[4],"Type");if(g){const T=g.toLowerCase();["documentation","configuration","reference","guide"].includes(T)&&(_.type=T)}}if(p[5]){const g=E(p[5],"tags");if(g){const T=g.split(",").map(F=>Ke(F.trim())).filter(F=>F);_.tags=T}}if(p[6]){const g=E(p[6],"Attachment Link");g&&(_.attachments=[g])}if(p[7]){const g=E(p[7],"Status");if(g){const T={"not started":1,assigned:2,"in progress":3,"in review":4,blocked:5,"on hold":6,"task completed":7,completed:7},F=g.toLowerCase();T[F]!==void 0&&(_.status=T[F])}}if(p[8]){const g=E(p[8],"Visibility");if(g){const T=g.toLowerCase();T.includes("admin")?_.visibility="admin":T.includes("public")&&(_.visibility="public")}}if(p[10]){const g=E(p[10],"Optional Fields: Assigned To");_.assignedTo=g||"Nick Parsells"}else _.assignedTo="Nick Parsells";if(p[11]){const g=E(p[11],"Assigned by");_.assignedBy=g||"system"}else _.assignedBy="system";if(p[12]){const g=p[12].trim();g&&!g.toLowerCase().startsWith("notes:")&&(_.notes=g)}Object.entries(_).forEach(([g,T])=>{if(T!=null&&T!==""){const F=d[g];(!F||Array.isArray(F)&&F.length===0)&&C(g,T)}});const ye=tt(m);ye.length===0?(te("No Title: markers found. Import expects Title: lines."),ee({name:v.name,content:m}),b([])):(te(null),ee({name:v.name,content:m}),b(ye)),Z(!0)}catch(m){D({submit:`Failed to read file: ${m.message}`})}}),Ie=t=>new Promise((i,v)=>{const m=new FileReader;m.onload=p=>{var E;i((E=p.target)==null?void 0:E.result)},m.onerror=()=>{v(new Error("Failed to read file"))},m.readAsText(t)}),tt=t=>{const i=t.split(`
`),v=[];let m=null,p=0,E=!1;for(let _=0;_<i.length;_++){const ye=i[_],g=ye.match(/^\s*Title:\s*(.+)\s*$/i);if(g){E=!0,m&&v.push({rev_index:p++,rev_number:m.rev_number,title:m.title,markdown:m.content.join(`
`)});const T=g[1].trim(),F=T.match(/rev\s*[-(]?\s*(\d+)\s*[)]?/i),ve=F?parseInt(F[1],10):null;m={title:T,content:[],rev_number:ve}}else m?m.content.push(ye):E||(m||(m={title:"OM-tasks creation and revisions",content:[],rev_number:null}),m.content.push(ye))}return m&&v.push({rev_index:p++,rev_number:m.rev_number,title:m.title,markdown:m.content.join(`
`)}),v},st=t=>t.rev_number!==null?`rev${t.rev_number}`:t.title||"intro",fe=t=>{if(A){if(t==="import_revisions")c.length>0&&(C("revisions",c),C("details",A.content));else if(t==="replace")if(d.details.trim())if(window.confirm("Replace existing Details content?"))C("details",A.content),C("revisions",void 0);else{Z(!1),ee(null),b([]),te(null);return}else C("details",A.content),C("revisions",void 0);else if(t==="append"){const i=d.details.trim()?`

---

`:"";C("details",d.details+i+A.content)}else if(t==="attach"){const i=`[Local: ${A.name}]`;d.attachments.includes(i)||C("attachments",[...d.attachments,i])}Z(!1),ee(null),b([]),te(null)}},Ve=()=>{Z(!1),ee(null),b([]),te(null)};h.useEffect(()=>()=>{xe.current&&clearTimeout(xe.current)},[]);const at=d.status===7;return e.jsxs(e.Fragment,{children:[e.jsxs(ue,{open:r,onClose:V,maxWidth:"md",fullWidth:!0,disableEscapeKeyDown:G,onBackdropClick:t=>{G&&(t.preventDefault(),V())},children:[e.jsx(he,{children:e.jsxs(u,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[e.jsx(o,{variant:"h6",children:"Create New Task"}),e.jsx(q,{label:d.visibility==="admin"?"Admin Only":"Public",color:d.visibility==="admin"?"default":"primary",size:"small"})]})}),e.jsxs(me,{children:[I.submit&&e.jsx(J,{severity:"error",sx:{mb:2},onClose:()=>D(t=>B(L({},t),{submit:""})),children:I.submit}),e.jsxs(Je,{spacing:3,sx:{mt:1},children:[e.jsx(R,{fullWidth:!0,label:"Title",value:d.title,onChange:t=>C("title",t.target.value),error:!!I.title,helperText:I.title,required:!0}),e.jsxs(le,{fullWidth:!0,required:!0,error:!!I.category,children:[e.jsx(ce,{children:"Category"}),e.jsx(de,{value:d.category,onChange:t=>C("category",t.target.value),label:"Category",children:gs.map(t=>e.jsx(M,{value:t,children:t},t))}),I.category&&e.jsx(Ee,{children:I.category})]}),e.jsxs(le,{fullWidth:!0,required:!0,error:!!I.importance,children:[e.jsx(ce,{children:"Importance"}),e.jsx(de,{value:d.importance,onChange:t=>C("importance",t.target.value),label:"Importance",children:js.map(t=>e.jsx(M,{value:t.value,children:t.label},t.value))}),I.importance&&e.jsx(Ee,{children:I.importance})]}),e.jsxs(u,{onDragEnter:se,onDragOver:Me,onDragLeave:Ce,onDrop:je,sx:{position:"relative",border:ne?"2px dashed #8c249d":"1px solid transparent",borderRadius:1,bgcolor:ne?"action.hover":"transparent",transition:"all 0.2s",minHeight:"400px"},children:[ne&&e.jsxs(u,{sx:{position:"absolute",top:0,left:0,right:0,bottom:0,zIndex:10,bgcolor:"rgba(140, 36, 157, 0.15)",borderRadius:1,display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column",gap:2,pointerEvents:"none"},children:[e.jsx(os,{sx:{fontSize:48,color:"#8c249d"}}),e.jsx(o,{variant:"h6",color:"primary",fontWeight:"bold",children:"Drop .md file to import"}),e.jsx(o,{variant:"body2",color:"text.secondary",children:"Release to add content to Details"})]}),e.jsx(R,{inputRef:Se,fullWidth:!0,label:"Details",multiline:!0,minRows:12,maxRows:30,value:d.details,onChange:t=>C("details",t.target.value),error:!!I.details,helperText:I.details||"Drag and drop .md or .txt files here to import",required:!0,sx:{"& .MuiInputBase-root":{minHeight:"400px"},"& textarea":{resize:"vertical",minHeight:"400px !important",fontFamily:"monospace",fontSize:"0.875rem",lineHeight:1.6}}})]}),e.jsxs(le,{fullWidth:!0,required:!0,error:!!I.type,children:[e.jsx(ce,{children:"Type"}),e.jsx(de,{value:d.type||"",onChange:t=>C("type",t.target.value),label:"Type",children:bs.map(t=>e.jsx(M,{value:t.value,children:e.jsxs(u,{children:[e.jsx(o,{variant:"body1",children:t.label}),e.jsx(o,{variant:"caption",color:"text.secondary",children:t.description})]})},t.value))}),I.type&&e.jsx(Ee,{children:I.type}),!I.type&&e.jsx(Ee,{children:"Category = domain (Ingestion, Workflow, etc.). Type = content nature (doc vs guide vs reference)."})]}),e.jsxs(u,{children:[e.jsxs(o,{variant:"body2",gutterBottom:!0,children:["Tags ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(u,{display:"flex",gap:1,flexWrap:"wrap",mb:2,children:d.tags.map(t=>e.jsx(q,{label:t,onDelete:()=>Ne(t),size:"small",color:"primary",variant:"outlined"},t))}),e.jsx(ls,{multiple:!0,freeSolo:!0,options:vs,value:d.tags,onChange:(t,i)=>{Xe(i),S("")},inputValue:W,onInputChange:(t,i,v)=>{S(v==="input"?i:"")},groupBy:t=>{const i=Jt.find(v=>v.tags.includes(t));return i?i.group:"Custom"},renderGroup:t=>e.jsxs(u,{children:[e.jsx(o,{variant:"caption",sx:{px:1.5,py:.5,fontWeight:"bold",color:"text.secondary",bgcolor:"grey.100",display:"block"},children:t.group}),t.children]},t.key),renderInput:t=>e.jsx(R,B(L({},t),{size:"small",placeholder:"Type or select tags (kebab-case enforced)",helperText:I.tags||`${d.tags.length} tag(s) selected. Tags are normalized to kebab-case.`,error:!!I.tags,onKeyPress:i=>{i.key==="Enter"&&W.trim()&&(i.preventDefault(),Qe())}})),renderOption:(t,i)=>h.createElement(u,B(L({component:"li"},t),{key:i}),i),getOptionLabel:t=>t,filterOptions:(t,i)=>{const v=t.filter(m=>m.toLowerCase().includes(i.inputValue.toLowerCase()));if(i.inputValue&&!v.includes(i.inputValue)){const m=Ke(i.inputValue);m&&!v.includes(m)&&v.push(m)}return v},sx:{mb:1}}),I.tags&&e.jsx(Ee,{error:!0,sx:{mt:.5},children:I.tags})]}),e.jsxs(u,{children:[e.jsx(o,{variant:"body2",gutterBottom:!0,children:"Attachments (Links to .md or other docs)"}),e.jsx(u,{display:"flex",gap:1,flexWrap:"wrap",mb:1,children:d.attachments.map((t,i)=>e.jsx(q,{label:t.length>30?`${t.substring(0,30)}...`:t,onDelete:()=>He(t),size:"small",icon:e.jsx(Mt,{})},i))}),e.jsxs(u,{display:"flex",gap:1,children:[e.jsx(R,{size:"small",fullWidth:!0,placeholder:"https://example.com/doc.md",value:O,onChange:t=>U(t.target.value),onKeyPress:t=>{t.key==="Enter"&&(t.preventDefault(),Re())}}),e.jsx(w,{size:"small",onClick:Re,disabled:!O.trim(),children:"Add"})]})]}),e.jsxs(le,{fullWidth:!0,required:!0,children:[e.jsx(ce,{children:"Status"}),e.jsx(de,{value:d.status,onChange:t=>C("status",t.target.value),label:"Status",children:fs.map(t=>e.jsx(M,{value:t.value,children:t.label},t.value))})]}),e.jsxs(le,{fullWidth:!0,required:!0,children:[e.jsx(ce,{children:"Visibility"}),e.jsx(de,{value:d.visibility,onChange:t=>C("visibility",t.target.value),label:"Visibility",children:ys.map(t=>e.jsx(M,{value:t.value,children:t.label},t.value))}),e.jsx(Ee,{children:d.visibility==="admin"?"Only admins and superadmins can view this task":"Anyone can view this task on public pages"})]}),e.jsx(Ge,{}),e.jsx(R,{fullWidth:!0,label:"Date Created",value:ge,disabled:!0,helperText:"Automatically set to current date and time"}),at&&e.jsx(R,{fullWidth:!0,label:"Date Completed",value:ge,disabled:!0,helperText:"Automatically set when task is marked as completed"}),e.jsx(Ge,{}),e.jsx(o,{variant:"subtitle2",color:"text.secondary",children:"Optional Fields"}),e.jsx(R,{fullWidth:!0,label:"Assigned To",value:d.assignedTo,onChange:t=>C("assignedTo",t.target.value),placeholder:"Email or username"}),e.jsx(R,{fullWidth:!0,label:"Assigned By",value:d.assignedBy,onChange:t=>C("assignedBy",t.target.value),placeholder:"Email or username"}),e.jsx(R,{fullWidth:!0,label:"Notes",multiline:!0,rows:3,value:d.notes,onChange:t=>C("notes",t.target.value),placeholder:"Additional notes or context"})]})]}),e.jsxs(pe,{children:[e.jsx(w,{onClick:V,disabled:Y,startIcon:e.jsx(cs,{}),children:"Cancel"}),e.jsx(w,{onClick:Ze,variant:"contained",disabled:Y||!d.type,startIcon:Y?null:e.jsx(Ht,{}),sx:{bgcolor:"#8c249d","&:hover":{bgcolor:"#6a1b9a"}},children:Y?"Creating...":"Create Task"})]})]}),e.jsxs(ue,{open:Ae,onClose:z,children:[e.jsx(he,{children:"Discard Draft?"}),e.jsx(me,{children:e.jsx(o,{children:"You have unsaved changes. Are you sure you want to discard them?"})}),e.jsxs(pe,{children:[e.jsx(w,{onClick:z,children:"Keep Editing"}),e.jsx(w,{onClick:et,color:"error",variant:"contained",children:"Discard"})]})]}),e.jsxs(ue,{open:Fe,onClose:Ve,maxWidth:"md",fullWidth:!0,children:[e.jsx(he,{children:e.jsxs(u,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(ps,{}),e.jsxs(o,{children:["Import ",A==null?void 0:A.name]})]})}),e.jsxs(me,{children:[$&&e.jsx(J,{severity:"error",sx:{mb:2},children:$}),c.length>0&&e.jsxs(u,{sx:{mb:3},children:[e.jsxs(o,{variant:"subtitle1",gutterBottom:!0,fontWeight:"bold",children:["Parsed Revisions (",c.length,")"]}),e.jsx(o,{variant:"caption",color:"text.secondary",gutterBottom:!0,display:"block",sx:{mb:2},children:"Revisions found in file order:"}),e.jsx(u,{sx:{maxHeight:"400px",overflowY:"auto"},children:c.map((t,i)=>e.jsxs(Vt,{defaultExpanded:!1,children:[e.jsx(Ut,{expandIcon:e.jsx(Kt,{}),children:e.jsxs(u,{sx:{display:"flex",alignItems:"center",gap:1,width:"100%"},children:[e.jsx(q,{label:st(t),size:"small",color:t.rev_number!==null?"primary":"default",sx:{minWidth:"60px"}}),e.jsx(o,{variant:"body2",color:"text.secondary",sx:{flex:1},children:t.title}),e.jsxs(o,{variant:"caption",color:"text.secondary",children:[t.markdown.split(`
`).length," lines"]})]})}),e.jsx(qt,{children:e.jsx(u,{component:"pre",sx:{whiteSpace:"pre-wrap",fontFamily:"monospace",fontSize:"0.75rem",bgcolor:"grey.50",p:2,borderRadius:1,maxHeight:"300px",overflow:"auto",border:"1px solid",borderColor:"divider"},children:t.markdown})})]},t.rev_index))})]}),e.jsx(o,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"Choose how to handle the dropped file:"}),e.jsxs(Je,{spacing:2,sx:{mt:2},children:[c.length>0&&e.jsxs(w,{variant:"contained",fullWidth:!0,onClick:()=>fe("import_revisions"),disabled:!A||c.length===0,sx:{bgcolor:"#8c249d","&:hover":{bgcolor:"#6a1b9a"}},children:["Import as Revisions (",c.length," sections)"]}),e.jsx(w,{variant:"outlined",fullWidth:!0,onClick:()=>fe("replace"),disabled:!A,children:"Replace Details"}),e.jsxs(w,{variant:c.length===0?"contained":"outlined",fullWidth:!0,onClick:()=>fe("append"),disabled:!A,sx:c.length===0?{bgcolor:"#8c249d","&:hover":{bgcolor:"#6a1b9a"}}:{},children:["Append to Details ",c.length===0&&"(Default)"]}),e.jsx(w,{variant:"outlined",fullWidth:!0,onClick:()=>fe("attach"),disabled:!A,startIcon:e.jsx(Mt,{}),children:"Attach as File Only"})]}),A&&e.jsxs(o,{variant:"caption",color:"text.secondary",sx:{mt:2,display:"block"},children:["File size: ",(A.content.length/1024).toFixed(2)," KB"]})]}),e.jsx(pe,{children:e.jsx(w,{onClick:Ve,children:"Cancel"})})]})]})},Ts=()=>{var bt,vt,kt,St,Tt,wt,Ct,It,Et,_t,Dt;const{hasRole:r,isSuperAdmin:a}=Nt(),[n,y]=h.useState(null),[d,N]=h.useState(!0),[W,S]=h.useState(null),[O,U]=h.useState(0),[I,D]=h.useState(!1),[Y,K]=h.useState(!1),[Ae,H]=h.useState(!1),[G,Q]=h.useState(!1),[ne,X]=h.useState(!1),[Fe,Z]=h.useState(!1),[A,ee]=h.useState(""),[c,b]=h.useState(""),[$,te]=h.useState("1440"),[xe,Se]=h.useState(!1),[Le,Pe]=h.useState(!1),[ge,Ye]=h.useState("link"),[Oe,C]=h.useState(null),[Qe,Xe]=h.useState([]),[Ne,Re]=h.useState(!1),[He,ze]=h.useState(0),[Te,Ze]=h.useState(25),[V,et]=h.useState({email:"",status:"",type:"",dateFrom:"",dateTo:""}),[z,we]=h.useState(null),[se,Ce]=h.useState(new Set),Me=a()||r("admin"),je=()=>k(void 0,null,function*(){var s,l;if(Me)try{S(null),N(!0);const x=yield oe.getTaskLogs(50);x.success?y(x.data):S(x.error||"Failed to load task assignment data")}catch(x){console.error("Error fetching task data:",x),S(x.message||((l=(s=x.response)==null?void 0:s.data)==null?void 0:l.error)||"Failed to load data")}finally{N(!1)}}),Ie=(...x)=>k(void 0,[...x],function*(s=V,l=He){Re(!0);try{const j=yield oe.getTaskHistory(L({page:l+1,limit:Te},s));j.success&&Xe(j.data.submissions||[])}catch(j){console.error("Failed to fetch history:",j)}finally{Re(!1)}});h.useEffect(()=>{je()},[Me]);const tt=()=>k(void 0,null,function*(){var s,l;if(!A||!oe.validateEmail(A)){S("Please enter a valid email address");return}Se(!0),S(null);try{const x=yield oe.generateTaskLink(A,{notes:c,expiresInMinutes:parseInt($)});x.success?(D(!1),ee(""),b(""),te("1440"),je(),t("Task link generated successfully","success")):S(x.error||"Failed to generate task link")}catch(x){S(((l=(s=x.response)==null?void 0:s.data)==null?void 0:l.error)||"Failed to generate link")}finally{Se(!1)}}),st=s=>k(void 0,null,function*(){var l,x;Se(!0),S(null);try{const j=yield oe.generateTaskLink(s,{notes:"Regenerated link",expiresInMinutes:parseInt($)});j.success?(je(),t("Task link regenerated successfully","success"),setTimeout(()=>{window.location.reload()},1e3)):S(j.error||"Failed to regenerate task link")}catch(j){S(((x=(l=j.response)==null?void 0:l.data)==null?void 0:x.error)||"Failed to regenerate link")}finally{Se(!1)}}),fe=(s,l)=>k(void 0,null,function*(){Ye(s),C(l),H(!0)}),Ve=()=>k(void 0,null,function*(){var s,l;if(Oe){Pe(!0),S(null);try{let x;switch(ge){case"link":x=yield oe.deleteTaskLink(Oe);break;case"submission":x=yield oe.deleteSubmission(Oe);break;case"batch":x=yield oe.deleteSubmissionsBatch(Array.from(se));break}x!=null&&x.success?(je(),Ce(new Set),t(`${ge} deleted successfully`,"success")):S(`Failed to delete ${ge}`)}catch(x){S(((l=(s=x.response)==null?void 0:s.data)==null?void 0:l.error)||`Failed to delete ${ge}`)}finally{Pe(!1),H(!1),C(null)}}}),at=(s,l)=>k(void 0,null,function*(){const j=`${window.location.origin}/assign-task?token=${s}`;try{yield navigator.clipboard.writeText(j),t(`Task link copied to clipboard for ${l}`,"success")}catch(ke){const ie=document.createElement("textarea");ie.value=j,document.body.appendChild(ie),ie.select(),document.execCommand("copy"),document.body.removeChild(ie),t(`Task link copied to clipboard for ${l}`)}}),t=(s,l)=>{S(null),S(null),console.log("✅",s)},i=s=>{we(s),Q(!0)},v=s=>{try{const l=JSON.parse(s.tasks_json),x=`task-submission-${s.id}-${s.email.replace("@","_at_")}.txt`,j=m(s,l),ke=new Blob([j],{type:"text/plain"}),ie=URL.createObjectURL(ke),$e=document.createElement("a");$e.href=ie,$e.download=x,document.body.appendChild($e),$e.click(),document.body.removeChild($e),URL.revokeObjectURL(ie),t(`Task submission downloaded as ${x}`,"success")}catch(l){S("Failed to download submission")}},m=(s,l)=>{const x=new Date(s.submitted_at).toLocaleString();let j=`OMAI Task Submission Report
`;return j+=`=====================================

`,j+=`Submission ID: ${s.id}
`,j+=`From Email: ${s.email}
`,j+=`Submitted: ${x}
`,j+=`IP Address: ${s.ip_address}
`,j+=`User Agent: ${s.user_agent||"Not provided"}
`,j+=`Submission Type: ${s.submission_type}
`,j+=`Total Tasks: ${l.length}
`,j+=`Status: ${s.status}
`,j+=`Sent to Nick: ${s.sent_to_nick?"Yes":"No"}
`,s.sent_at&&(j+=`Email Sent: ${new Date(s.sent_at).toLocaleString()}
`),j+=`
`,j+=`TASK DETAILS
`,j+=`=====================================

`,l.forEach((ke,ie)=>{j+=`Task ${ie+1}:
`,j+=`  Title: ${ke.title}
`,j+=`  Priority: ${ke.priority}
`,ke.description&&(j+=`  Description:
    ${ke.description.replace(/\n/g,`
    `)}
`),j+=`
`}),j+=`
Report generated: ${new Date().toLocaleString()}
`,j+=`© Orthodox Metrics AI System
`,j},p=s=>new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),E=s=>{switch(s){case"active":return"success";case"used":return"info";case"expired":return"warning";case"deleted":return"error";case"pending":return"warning";case"processed":return"info";case"completed":return"success";case"failed":return"error";default:return"default"}},_=s=>{switch(s){case"active":return e.jsx(Wt,{});case"used":return e.jsx(pt,{});case"expired":return e.jsx(zt,{});case"deleted":return e.jsx(qe,{});case"pending":return e.jsx(zt,{});case"processed":return e.jsx(Rt,{});case"completed":return e.jsx(pt,{});case"failed":return e.jsx(hs,{});default:return e.jsx(Rt,{})}},ye=s=>({TASK_LINK_GENERATED:e.jsx(Gt,{color:"primary"}),TASKS_SUBMITTED:e.jsx(pt,{color:"success"}),TOKEN_VALIDATED:e.jsx(ms,{color:"info"}),TASK_LINK_ERROR:e.jsx(nt,{color:"error"}),TASK_SUBMISSION_ERROR:e.jsx(nt,{color:"error"})})[s]||e.jsx(it,{}),g=s=>({TASK_LINK_GENERATED:"Link Generated",TASKS_SUBMITTED:"Tasks Submitted",TOKEN_VALIDATED:"Token Validated",TASK_LINK_ERROR:"Link Error",TASK_SUBMISSION_ERROR:"Submission Error"})[s]||s,T=s=>{try{const l=JSON.parse(s);return Array.isArray(l)?l:[]}catch(l){return[]}},F=(s,l)=>{ze(l),Ie(V,l)},ve=s=>{Ze(parseInt(s.target.value,10)),ze(0),Ie(V,0)},We=(s,l)=>{const x=B(L({},V),{[s]:l});et(x),ze(0),Ie(x,0)};return Me?d?e.jsx(jt,{sx:{minHeight:600},children:e.jsx(ft,{children:e.jsx(u,{display:"flex",justifyContent:"center",alignItems:"center",height:"100%",children:e.jsx(Be,{})})})}):e.jsxs(e.Fragment,{children:[e.jsx(jt,{sx:{minHeight:600},children:e.jsxs(ft,{sx:{p:0},children:[e.jsx(u,{sx:{p:3,borderBottom:1,borderColor:"divider",bgcolor:"#f8f9fa"},children:e.jsxs(u,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsxs(u,{display:"flex",alignItems:"center",children:[e.jsx(nt,{sx:{mr:2,color:"#8c249d",fontSize:32}}),e.jsxs(u,{children:[e.jsx(o,{variant:"h5",fontWeight:"bold",color:"#8c249d",children:"OMAI Task Assignment"}),e.jsx(o,{variant:"body2",color:"text.secondary",children:"Manage task links, submissions, and activity logs"})]})]}),e.jsxs(Je,{direction:"row",spacing:1,children:[e.jsx(w,{variant:"contained",startIcon:e.jsx(ss,{}),onClick:()=>D(!0),sx:{bgcolor:"#8c249d","&:hover":{bgcolor:"#6a1b9a"}},children:"Generate Link"}),e.jsx(w,{variant:"contained",startIcon:e.jsx($t,{}),onClick:()=>K(!0),sx:{bgcolor:"#8c249d","&:hover":{bgcolor:"#6a1b9a"}},children:"Create Task"}),e.jsx(w,{variant:"outlined",startIcon:e.jsx(it,{}),onClick:()=>X(!0),children:"Full History"}),e.jsx(w,{variant:"outlined",startIcon:e.jsx(as,{}),onClick:()=>Z(!0),children:"Settings"}),e.jsx(ae,{title:"Refresh Data",children:e.jsx(re,{onClick:je,color:"primary",children:e.jsx(rt,{})})})]})]})}),W&&e.jsx(J,{severity:"error",sx:{m:3},children:W}),e.jsxs(ds,{value:O,onChange:(s,l)=>U(l),sx:{borderBottom:1,borderColor:"divider",px:3},variant:"scrollable",scrollButtons:"auto",children:[e.jsx(ot,{label:e.jsxs(u,{display:"flex",alignItems:"center",children:[e.jsx(Wt,{sx:{mr:1}}),"Links",e.jsx(lt,{badgeContent:((bt=n==null?void 0:n.recent_links)==null?void 0:bt.length)||0,color:"primary",sx:{ml:1}})]})}),e.jsx(ot,{label:e.jsxs(u,{display:"flex",alignItems:"center",children:[e.jsx($t,{sx:{mr:1}}),"Submissions",e.jsx(lt,{badgeContent:((vt=n==null?void 0:n.recent_submissions)==null?void 0:vt.length)||0,color:"secondary",sx:{ml:1}})]})}),e.jsx(ot,{label:e.jsxs(u,{display:"flex",alignItems:"center",children:[e.jsx(it,{sx:{mr:1}}),"Activity",e.jsx(lt,{badgeContent:((kt=n==null?void 0:n.recent_logs)==null?void 0:kt.length)||0,color:"info",sx:{ml:1}})]})})]}),e.jsxs(u,{sx:{p:3,minHeight:400},children:[O===0&&e.jsxs(u,{children:[e.jsx(o,{variant:"h6",gutterBottom:!0,children:"Task Assignment Links"}),((St=n==null?void 0:n.recent_links)==null?void 0:St.length)===0?e.jsx(J,{severity:"info",children:"No task links generated yet. Generate your first link to get started."}):e.jsx(ct,{component:be,variant:"outlined",children:e.jsxs(dt,{children:[e.jsx(ut,{children:e.jsxs(_e,{children:[e.jsx(f,{children:"Email"}),e.jsx(f,{children:"Status"}),e.jsx(f,{children:"Created"}),e.jsx(f,{children:"IP Address"}),e.jsx(f,{children:"Notes"}),e.jsx(f,{children:"Actions"})]})}),e.jsx(ht,{children:(Tt=n==null?void 0:n.recent_links)==null?void 0:Tt.map(s=>e.jsxs(_e,{children:[e.jsx(f,{children:e.jsxs(u,{display:"flex",alignItems:"center",children:[e.jsx(Ot,{sx:{width:32,height:32,mr:2,bgcolor:"#8c249d"},children:s.email.charAt(0).toUpperCase()}),e.jsxs(u,{children:[e.jsx(o,{variant:"body2",fontWeight:"medium",children:s.email}),e.jsxs(o,{variant:"caption",color:"text.secondary",children:["Token: ",s.token?`${s.token.substring(0,8)}...`:"No token"]})]})]})}),e.jsx(f,{children:e.jsx(q,{icon:_(s.status||"active"),label:s.status||"active",color:E(s.status||"active"),size:"small"})}),e.jsxs(f,{children:[e.jsx(o,{variant:"body2",children:p(s.created_at)}),s.expires_at&&e.jsxs(o,{variant:"caption",color:"text.secondary",display:"block",children:["Expires: ",p(s.expires_at)]})]}),e.jsx(f,{children:s.ip_address?e.jsxs(u,{display:"flex",alignItems:"center",children:[e.jsx(Ue,{sx:{fontSize:16,mr:1,color:"text.secondary"}}),e.jsx(o,{variant:"body2",fontFamily:"monospace",children:s.ip_address})]}):e.jsx(o,{variant:"body2",color:"text.secondary",children:"Unknown"})}),e.jsx(f,{children:s.notes?e.jsx(o,{variant:"body2",noWrap:!0,children:s.notes}):e.jsx(o,{variant:"body2",color:"text.secondary",children:"No notes"})}),e.jsx(f,{children:e.jsxs(u,{display:"flex",gap:1,children:[s.status==="active"&&e.jsxs(e.Fragment,{children:[s.token&&e.jsx(ae,{title:"Copy Link",children:e.jsx(re,{size:"small",onClick:()=>at(s.token,s.email),children:e.jsx(is,{fontSize:"small"})})}),e.jsx(ae,{title:"Delete Link",children:e.jsx(re,{size:"small",color:"error",onClick:()=>fe("link",s.id),children:e.jsx(qe,{fontSize:"small"})})}),e.jsx(ae,{title:"Regenerate Link",children:e.jsx(re,{size:"small",color:"primary",onClick:()=>st(s.email),children:e.jsx(rt,{fontSize:"small"})})})]}),s.status==="used"&&e.jsx(ae,{title:"View Details",children:e.jsx(re,{size:"small",children:e.jsx(xt,{fontSize:"small"})})})]})})]},s.id))})]})})]}),O===1&&e.jsxs(u,{children:[e.jsxs(u,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:[e.jsx(o,{variant:"h6",children:"Task Submissions"}),se.size>0&&e.jsxs(w,{variant:"outlined",color:"error",startIcon:e.jsx(qe,{}),onClick:()=>fe("batch",null),children:["Delete Selected (",se.size,")"]})]}),((wt=n==null?void 0:n.recent_submissions)==null?void 0:wt.length)===0?e.jsx(J,{severity:"info",children:"No task submissions yet. Task submissions will appear here once users submit tasks."}):e.jsx(ct,{component:be,variant:"outlined",children:e.jsxs(dt,{children:[e.jsx(ut,{children:e.jsxs(_e,{children:[e.jsx(f,{padding:"checkbox",children:e.jsx(yt,{checked:se.size===((Ct=n==null?void 0:n.recent_submissions)==null?void 0:Ct.length),indeterminate:se.size>0&&se.size<(((It=n==null?void 0:n.recent_submissions)==null?void 0:It.length)||0),onChange:s=>{var l;s.target.checked?Ce(new Set(((l=n==null?void 0:n.recent_submissions)==null?void 0:l.map(x=>x.id))||[])):Ce(new Set)}})}),e.jsx(f,{children:"Email"}),e.jsx(f,{children:"Tasks"}),e.jsx(f,{children:"Submitted"}),e.jsx(f,{children:"IP Address"}),e.jsx(f,{children:"Status"}),e.jsx(f,{children:"Actions"})]})}),e.jsx(ht,{children:(Et=n==null?void 0:n.recent_submissions)==null?void 0:Et.map(s=>{const l=T(s.tasks_json);return e.jsxs(_e,{children:[e.jsx(f,{padding:"checkbox",children:e.jsx(yt,{checked:se.has(s.id),onChange:x=>{const j=new Set(se);x.target.checked?j.add(s.id):j.delete(s.id),Ce(j)}})}),e.jsx(f,{children:e.jsxs(u,{display:"flex",alignItems:"center",children:[e.jsx(Ot,{sx:{width:32,height:32,mr:2,bgcolor:"#8c249d"},children:s.email.charAt(0).toUpperCase()}),e.jsxs(u,{children:[e.jsx(o,{variant:"body2",fontWeight:"medium",children:s.email}),e.jsx(o,{variant:"caption",color:"text.secondary",children:s.submission_type})]})]})}),e.jsxs(f,{children:[e.jsxs(o,{variant:"body2",children:[l.length," task",l.length!==1?"s":""]}),e.jsxs(o,{variant:"caption",color:"text.secondary",children:[l.slice(0,2).map(x=>x.title).join(", "),l.length>2&&"..."]})]}),e.jsxs(f,{children:[e.jsx(o,{variant:"body2",children:p(s.submitted_at)}),s.sent_to_nick&&s.sent_at&&e.jsxs(o,{variant:"caption",color:"success.main",display:"block",children:["Sent: ",p(s.sent_at)]})]}),e.jsx(f,{children:e.jsxs(u,{display:"flex",alignItems:"center",children:[e.jsx(Ue,{sx:{fontSize:16,mr:1,color:"text.secondary"}}),e.jsx(o,{variant:"body2",fontFamily:"monospace",children:s.ip_address})]})}),e.jsx(f,{children:e.jsx(q,{icon:_(s.status),label:s.status,color:E(s.status),size:"small"})}),e.jsx(f,{children:e.jsxs(u,{display:"flex",gap:1,children:[e.jsx(ae,{title:"View Tasks",children:e.jsx(re,{size:"small",onClick:()=>i(s),children:e.jsx(xt,{fontSize:"small"})})}),e.jsx(ae,{title:"Download Report",children:e.jsx(re,{size:"small",onClick:()=>v(s),children:e.jsx(mt,{fontSize:"small"})})}),e.jsx(ae,{title:"Delete Submission",children:e.jsx(re,{size:"small",color:"error",onClick:()=>fe("submission",s.id),children:e.jsx(qe,{fontSize:"small"})})})]})})]},s.id)})})]})})]}),O===2&&e.jsxs(u,{children:[e.jsx(o,{variant:"h6",gutterBottom:!0,children:"Recent Activity"}),((_t=n==null?void 0:n.recent_logs)==null?void 0:_t.length)===0?e.jsx(J,{severity:"info",children:"No recent activity. Activity logs will appear here as users interact with the system."}):e.jsx(Lt,{children:(Dt=n==null?void 0:n.recent_logs)==null?void 0:Dt.map((s,l)=>e.jsx(be,{sx:{mb:2,p:2},variant:"outlined",children:e.jsxs(u,{display:"flex",alignItems:"flex-start",gap:2,children:[e.jsx(u,{sx:{mt:.5},children:ye(s.action)}),e.jsxs(u,{flex:1,children:[e.jsxs(u,{display:"flex",alignItems:"center",gap:1,mb:1,children:[e.jsx(o,{variant:"body2",fontWeight:"medium",children:g(s.action)}),s.email&&e.jsx(q,{label:s.email,size:"small",variant:"outlined"}),e.jsx(o,{variant:"caption",color:"text.secondary",children:p(s.timestamp)})]}),s.token&&e.jsx(u,{display:"flex",alignItems:"center",gap:1,mb:1,children:e.jsxs(o,{variant:"caption",color:"text.secondary",children:["Token: ",s.token.substring(0,8),"..."]})}),s.data&&e.jsxs(Vt,{variant:"outlined",sx:{mt:1},children:[e.jsx(Ut,{expandIcon:e.jsx(Kt,{}),children:e.jsx(o,{variant:"caption",children:"View Details"})}),e.jsx(qt,{children:e.jsx("pre",{style:{fontSize:"12px",overflow:"auto"},children:JSON.stringify(s.data,null,2)})})]})]})]})},l))})]})]})]})}),e.jsxs(ue,{open:I,onClose:()=>D(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(he,{children:"Generate Task Assignment Link"}),e.jsxs(me,{children:[e.jsx(o,{variant:"body2",color:"text.secondary",sx:{mb:3},children:"Enter an email address to generate a secure task assignment link. The recipient will receive an email with instructions to assign tasks to Nick."}),e.jsxs(Je,{spacing:3,children:[e.jsx(R,{fullWidth:!0,label:"Email Address",type:"email",value:A,onChange:s=>ee(s.target.value),placeholder:"user@example.com",required:!0}),e.jsx(R,{fullWidth:!0,label:"Notes (Optional)",multiline:!0,rows:2,value:c,onChange:s=>b(s.target.value),placeholder:"Add any notes about this task assignment..."}),e.jsxs(le,{fullWidth:!0,children:[e.jsx(ce,{children:"Expiration Time"}),e.jsxs(de,{value:$,onChange:s=>te(s.target.value),label:"Expiration Time",children:[e.jsx(M,{value:"60",children:"1 hour"}),e.jsx(M,{value:"1440",children:"24 hours"}),e.jsx(M,{value:"10080",children:"1 week"}),e.jsx(M,{value:"43200",children:"1 month"})]})]})]})]}),e.jsxs(pe,{children:[e.jsx(w,{onClick:()=>D(!1),children:"Cancel"}),e.jsx(w,{onClick:tt,variant:"contained",disabled:xe||!A,sx:{bgcolor:"#8c249d","&:hover":{bgcolor:"#6a1b9a"}},children:xe?"Generating...":"Generate Link"})]})]}),e.jsxs(ue,{open:Ae,onClose:()=>H(!1),children:[e.jsx(he,{children:"Confirm Deletion"}),e.jsx(me,{children:e.jsxs(o,{children:["Are you sure you want to delete this ",ge,"? This action cannot be undone."]})}),e.jsxs(pe,{children:[e.jsx(w,{onClick:()=>H(!1),children:"Cancel"}),e.jsx(w,{onClick:Ve,color:"error",variant:"contained",disabled:Le,children:Le?"Deleting...":"Delete"})]})]}),e.jsxs(ue,{open:G,onClose:()=>Q(!1),maxWidth:"md",fullWidth:!0,children:[e.jsxs(he,{children:["Task Submission Details",z&&e.jsxs(o,{variant:"subtitle2",color:"text.secondary",children:["Submission #",z.id," from ",z.email]})]}),e.jsx(me,{children:z&&e.jsxs(u,{children:[e.jsx(be,{sx:{p:3,mb:3,bgcolor:"#f9f9f9"},children:e.jsxs(P,{container:!0,spacing:3,children:[e.jsx(P,{item:!0,xs:12,sm:6,children:e.jsxs(o,{variant:"body2",children:[e.jsx("strong",{children:"Submitted:"})," ",p(z.submitted_at)]})}),e.jsx(P,{item:!0,xs:12,sm:6,children:e.jsxs(o,{variant:"body2",children:[e.jsx("strong",{children:"Status:"}),e.jsx(q,{label:z.status,color:E(z.status),size:"small",sx:{ml:1}})]})}),e.jsx(P,{item:!0,xs:12,sm:6,children:e.jsxs(o,{variant:"body2",children:[e.jsx("strong",{children:"IP Address:"}),e.jsxs(u,{display:"flex",alignItems:"center",sx:{ml:1},children:[e.jsx(Ue,{sx:{fontSize:16,mr:.5,color:"text.secondary"}}),e.jsx(o,{variant:"body2",fontFamily:"monospace",children:z.ip_address})]})]})}),e.jsx(P,{item:!0,xs:12,sm:6,children:e.jsxs(o,{variant:"body2",children:[e.jsx("strong",{children:"Type:"}),e.jsx(q,{label:z.submission_type,size:"small",variant:"outlined",sx:{ml:1}})]})}),z.sent_to_nick&&z.sent_at&&e.jsx(P,{item:!0,xs:12,children:e.jsxs(o,{variant:"body2",children:[e.jsx("strong",{children:"Email Sent:"})," ",p(z.sent_at)]})})]})}),e.jsx(o,{variant:"h6",gutterBottom:!0,children:"Submitted Tasks"}),(()=>{try{const s=JSON.parse(z.tasks_json);return e.jsx(Lt,{children:s.map((l,x)=>e.jsxs(be,{sx:{mb:2,p:3},variant:"outlined",children:[e.jsxs(u,{display:"flex",alignItems:"center",mb:2,children:[e.jsxs(o,{variant:"h6",component:"span",children:["Task ",x+1]}),e.jsx(q,{label:l.priority,color:l.priority==="high"?"error":l.priority==="medium"?"warning":"default",size:"small",sx:{ml:2}})]}),e.jsx(o,{variant:"body1",fontWeight:"medium",gutterBottom:!0,children:l.title}),l.description&&e.jsx(o,{variant:"body2",color:"text.secondary",sx:{whiteSpace:"pre-wrap"},children:l.description})]},x))})}catch(s){return e.jsxs(J,{severity:"error",children:["Failed to parse task data: ",z.tasks_json]})}})()]})}),e.jsxs(pe,{children:[e.jsx(w,{onClick:()=>Q(!1),children:"Close"}),z&&e.jsx(w,{onClick:()=>v(z),variant:"contained",startIcon:e.jsx(mt,{}),sx:{bgcolor:"#8c249d"},children:"Download Report"})]})]}),e.jsxs(ue,{open:ne,onClose:()=>X(!1),maxWidth:"xl",fullWidth:!0,children:[e.jsx(he,{children:e.jsxs(u,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[e.jsx(o,{variant:"h6",children:"Task Assignment History"}),e.jsx(w,{variant:"outlined",startIcon:e.jsx(rt,{}),onClick:()=>Ie(),disabled:Ne,children:"Refresh"})]})}),e.jsxs(me,{children:[e.jsx(be,{sx:{p:2,mb:3},variant:"outlined",children:e.jsxs(P,{container:!0,spacing:2,alignItems:"center",children:[e.jsx(P,{item:!0,xs:12,sm:3,children:e.jsx(R,{fullWidth:!0,size:"small",label:"Email",value:V.email,onChange:s=>We("email",s.target.value),placeholder:"Filter by email..."})}),e.jsx(P,{item:!0,xs:12,sm:2,children:e.jsxs(le,{fullWidth:!0,size:"small",children:[e.jsx(ce,{children:"Status"}),e.jsxs(de,{value:V.status,onChange:s=>We("status",s.target.value),label:"Status",children:[e.jsx(M,{value:"",children:"All"}),e.jsx(M,{value:"pending",children:"Pending"}),e.jsx(M,{value:"processed",children:"Processed"}),e.jsx(M,{value:"completed",children:"Completed"}),e.jsx(M,{value:"failed",children:"Failed"})]})]})}),e.jsx(P,{item:!0,xs:12,sm:2,children:e.jsxs(le,{fullWidth:!0,size:"small",children:[e.jsx(ce,{children:"Type"}),e.jsxs(de,{value:V.type,onChange:s=>We("type",s.target.value),label:"Type",children:[e.jsx(M,{value:"",children:"All"}),e.jsx(M,{value:"email_link",children:"Email Link"}),e.jsx(M,{value:"public_token",children:"Public Token"}),e.jsx(M,{value:"internal",children:"Internal"})]})]})}),e.jsx(P,{item:!0,xs:12,sm:2,children:e.jsx(R,{fullWidth:!0,size:"small",type:"date",label:"From Date",value:V.dateFrom,onChange:s=>We("dateFrom",s.target.value),InputLabelProps:{shrink:!0}})}),e.jsx(P,{item:!0,xs:12,sm:2,children:e.jsx(R,{fullWidth:!0,size:"small",type:"date",label:"To Date",value:V.dateTo,onChange:s=>We("dateTo",s.target.value),InputLabelProps:{shrink:!0}})})]})}),Ne?e.jsx(u,{display:"flex",justifyContent:"center",p:4,children:e.jsx(Be,{})}):e.jsxs(ct,{component:be,variant:"outlined",children:[e.jsxs(dt,{children:[e.jsx(ut,{children:e.jsxs(_e,{children:[e.jsx(f,{children:"Email"}),e.jsx(f,{children:"Tasks"}),e.jsx(f,{children:"Submitted"}),e.jsx(f,{children:"IP Address"}),e.jsx(f,{children:"Status"}),e.jsx(f,{children:"Type"}),e.jsx(f,{children:"Actions"})]})}),e.jsx(ht,{children:Qe.map(s=>{const l=T(s.tasks_json);return e.jsxs(_e,{children:[e.jsx(f,{children:s.email}),e.jsxs(f,{children:[l.length," tasks"]}),e.jsx(f,{children:p(s.submitted_at)}),e.jsx(f,{children:e.jsxs(u,{display:"flex",alignItems:"center",children:[e.jsx(Ue,{sx:{fontSize:16,mr:1,color:"text.secondary"}}),e.jsx(o,{variant:"body2",fontFamily:"monospace",children:s.ip_address})]})}),e.jsx(f,{children:e.jsx(q,{label:s.status,color:E(s.status),size:"small"})}),e.jsx(f,{children:e.jsx(q,{label:s.submission_type,size:"small",variant:"outlined"})}),e.jsx(f,{children:e.jsxs(u,{display:"flex",gap:1,children:[e.jsx(ae,{title:"View Details",children:e.jsx(re,{size:"small",children:e.jsx(xt,{fontSize:"small"})})}),e.jsx(ae,{title:"Download",children:e.jsx(re,{size:"small",children:e.jsx(mt,{fontSize:"small"})})})]})})]},s.id)})})]}),e.jsx(us,{rowsPerPageOptions:[10,25,50,100],component:"div",count:-1,rowsPerPage:Te,page:He,onPageChange:F,onRowsPerPageChange:ve})]})]}),e.jsx(pe,{children:e.jsx(w,{onClick:()=>X(!1),children:"Close"})})]}),e.jsxs(ue,{open:Fe,onClose:()=>Z(!1),maxWidth:"md",fullWidth:!0,children:[e.jsx(he,{children:"Email Settings"}),e.jsx(me,{children:e.jsx(xs,{})}),e.jsx(pe,{children:e.jsx(w,{onClick:()=>Z(!1),children:"Close"})})]}),e.jsx(Ss,{open:Y,onClose:()=>K(!1),onSave:s=>k(void 0,null,function*(){try{const l=yield oe.createTask(s);if(l&&l.success===!1)throw new Error(l.error||"Failed to create task");yield je(),t("Task created successfully","success")}catch(l){throw l}})})]}):null},oa=()=>{const r=[{to:"/",title:"Home"},{to:"/devel-tools",title:"Developer Tools"},{title:"OM Tasks"}];return e.jsxs(rs,{title:"OMAI Task Assignment",description:"Manage OMAI task links, submissions, and activity logs",children:[e.jsx(ns,{title:"OMAI Task Assignment",items:r}),e.jsx(u,{p:3,children:e.jsx(u,{sx:{minHeight:"80vh"},children:e.jsx(Ts,{})})})]})};export{oa as default};
//# sourceMappingURL=OMTasksPage-Bf95SpIm.js.map
