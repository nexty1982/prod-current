var G=Object.defineProperty,U=Object.defineProperties;var z=Object.getOwnPropertyDescriptors;var D=Object.getOwnPropertySymbols;var A=Object.prototype.hasOwnProperty,H=Object.prototype.propertyIsEnumerable;var F=(a,s,r)=>s in a?G(a,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[s]=r,w=(a,s)=>{for(var r in s||(s={}))A.call(s,r)&&F(a,r,s[r]);if(D)for(var r of D(s))H.call(s,r)&&F(a,r,s[r]);return a},S=(a,s)=>U(a,z(s));var P=(a,s,r)=>new Promise((p,i)=>{var l=o=>{try{g(r.next(o))}catch(x){i(x)}},v=o=>{try{g(r.throw(o))}catch(x){i(x)}},g=o=>o.done?p(o.value):Promise.resolve(o.value).then(l,v);g((r=r.apply(a,s)).next())});import{aJ as J,b4 as O,l as X,k as K,j as e,B as N,C as Q,U as V,d as y,a0 as k,G as n,P as u,D as B,S as Y,e as M,H as Z}from"./index-Dgvcv9SG.js";import{r as f}from"./vendor-Dkfty7_r.js";import{I as ee}from"./IconCheck-WLZZX55y.js";const ne=()=>{var E;const{id:a}=J(),[s]=O(),r=X(),{user:p}=K(),i=!!a,l=s.get("church_id")||((E=p==null?void 0:p.church_id)==null?void 0:E.toString())||"",[v,g]=f.useState(i),[o,x]=f.useState(!1),[I,h]=f.useState(null),[T,C]=f.useState(!1),[c,R]=f.useState({groom_first_name:"",groom_last_name:"",bride_first_name:"",bride_last_name:"",marriage_date:"",clergy:"",witnesses:"",marriage_place:"",notes:""});f.useEffect(()=>{i&&a&&l&&P(void 0,null,function*(){try{g(!0),h(null);const m=new URLSearchParams({church_id:l}),_=yield fetch(`/api/marriage-records/${a}?${m.toString()}`,{credentials:"include",headers:{"Content-Type":"application/json"}});if(!_.ok)throw new Error("Failed to load record");const j=yield _.json();if(j.success&&j.record){const t=j.record;R({groom_first_name:t.groom_first_name||"",groom_last_name:t.groom_last_name||"",bride_first_name:t.bride_first_name||"",bride_last_name:t.bride_last_name||"",marriage_date:t.marriage_date||"",clergy:t.clergy||"",witnesses:t.witnesses||"",marriage_place:t.marriage_place||"",notes:t.notes||""})}}catch(m){h(m.message||"Failed to load record")}finally{g(!1)}})},[i,a,l]);const d=b=>m=>{R(_=>S(w({},_),{[b]:m.target.value})),h(null),C(!1)},$=b=>P(void 0,null,function*(){if(b.preventDefault(),!l){h("Church ID is required");return}x(!0),h(null),C(!1);try{const m=i?`/api/marriage-records/${a}`:"/api/marriage-records",_=i?"PUT":"POST",j=new URLSearchParams({church_id:l}),t=yield fetch(`${m}?${j.toString()}`,{method:_,credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(S(w({},c),{church_id:parseInt(l)}))});if(!t.ok){const q=yield t.json().catch(()=>({}));throw new Error(q.error||"Failed to save record")}const W=yield t.json();if(W.success)C(!0),setTimeout(()=>{r(`/apps/records/marriage?church_id=${l}`)},1500);else throw new Error(W.error||"Failed to save record")}catch(m){h(m.message||"Failed to save record")}finally{x(!1)}}),L=()=>{r(`/apps/records/marriage?church_id=${l}`)};return v?e.jsx(N,{sx:{p:3,display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px"},children:e.jsx(Q,{})}):e.jsx(N,{sx:{p:3},children:e.jsxs(V,{sx:{p:3},children:[e.jsx(y,{variant:"h4",gutterBottom:!0,children:i?"Edit Marriage Record":"New Marriage Record"}),I&&e.jsx(k,{severity:"error",sx:{mb:2},onClose:()=>h(null),children:I}),T&&e.jsxs(k,{severity:"success",sx:{mb:2},children:["Record ",i?"updated":"created"," successfully. Redirecting..."]}),e.jsxs("form",{onSubmit:$,children:[e.jsx(y,{variant:"h6",sx:{mt:2,mb:1},children:"Groom Information"}),e.jsxs(n,{container:!0,spacing:2,children:[e.jsx(n,{item:!0,xs:12,sm:6,children:e.jsx(u,{fullWidth:!0,label:"Groom First Name",value:c.groom_first_name,onChange:d("groom_first_name"),required:!0,margin:"normal"})}),e.jsx(n,{item:!0,xs:12,sm:6,children:e.jsx(u,{fullWidth:!0,label:"Groom Last Name",value:c.groom_last_name,onChange:d("groom_last_name"),required:!0,margin:"normal"})})]}),e.jsx(B,{sx:{my:3}}),e.jsx(y,{variant:"h6",sx:{mt:2,mb:1},children:"Bride Information"}),e.jsxs(n,{container:!0,spacing:2,children:[e.jsx(n,{item:!0,xs:12,sm:6,children:e.jsx(u,{fullWidth:!0,label:"Bride First Name",value:c.bride_first_name,onChange:d("bride_first_name"),required:!0,margin:"normal"})}),e.jsx(n,{item:!0,xs:12,sm:6,children:e.jsx(u,{fullWidth:!0,label:"Bride Last Name",value:c.bride_last_name,onChange:d("bride_last_name"),required:!0,margin:"normal"})})]}),e.jsx(B,{sx:{my:3}}),e.jsx(y,{variant:"h6",sx:{mt:2,mb:1},children:"Marriage Details"}),e.jsxs(n,{container:!0,spacing:2,children:[e.jsx(n,{item:!0,xs:12,sm:6,children:e.jsx(u,{fullWidth:!0,label:"Marriage Date",type:"date",value:c.marriage_date,onChange:d("marriage_date"),InputLabelProps:{shrink:!0},margin:"normal"})}),e.jsx(n,{item:!0,xs:12,sm:6,children:e.jsx(u,{fullWidth:!0,label:"Marriage Place",value:c.marriage_place,onChange:d("marriage_place"),margin:"normal"})}),e.jsx(n,{item:!0,xs:12,sm:6,children:e.jsx(u,{fullWidth:!0,label:"Clergy",value:c.clergy,onChange:d("clergy"),margin:"normal"})}),e.jsx(n,{item:!0,xs:12,sm:6,children:e.jsx(u,{fullWidth:!0,label:"Witnesses",value:c.witnesses,onChange:d("witnesses"),margin:"normal",multiline:!0,rows:2})}),e.jsx(n,{item:!0,xs:12,children:e.jsx(u,{fullWidth:!0,label:"Notes",value:c.notes,onChange:d("notes"),margin:"normal",multiline:!0,rows:4})})]}),e.jsxs(Y,{direction:"row",spacing:2,sx:{mt:3},children:[e.jsx(M,{type:"submit",variant:"contained",startIcon:e.jsx(ee,{size:18}),disabled:o,children:o?"Saving...":i?"Update Record":"Create Record"}),e.jsx(M,{type:"button",variant:"outlined",startIcon:e.jsx(Z,{size:18}),onClick:L,disabled:o,children:"Cancel"})]})]})]})})};export{ne as default};
//# sourceMappingURL=MarriageRecordEntryPage-C3lPE1xP.js.map
