var we=Object.defineProperty,Re=Object.defineProperties;var Be=Object.getOwnPropertyDescriptors;var de=Object.getOwnPropertySymbols;var Ie=Object.prototype.hasOwnProperty,Pe=Object.prototype.propertyIsEnumerable;var he=(h,p,t)=>p in h?we(h,p,{enumerable:!0,configurable:!0,writable:!0,value:t}):h[p]=t,r=(h,p)=>{for(var t in p||(p={}))Ie.call(p,t)&&he(h,t,p[t]);if(de)for(var t of de(p))Pe.call(p,t)&&he(h,t,p[t]);return h},l=(h,p)=>Re(h,Be(p));var S=(h,p,t)=>new Promise((y,j)=>{var s=f=>{try{w(t.next(f))}catch(F){j(F)}},u=f=>{try{w(t.throw(f))}catch(F){j(F)}},w=f=>f.done?y(f.value):Promise.resolve(f.value).then(s,u);w((t=t.apply(h,p)).next())});import{a as Le,j as e,b4 as Ve,l as Fe,B as m,C as ue,d,a0 as E,U as Oe,e as x,b2 as z,F as g,aI as R,s as A,$ as D,V as Ee,R as $e}from"./index-Dgvcv9SG.js";import{r as k}from"./vendor-Dkfty7_r.js";import{S as Me,a as We,b as ze}from"./Stepper-Dpq6p3x6.js";import{C as Ae}from"./CheckCircle-s3MrOaSs.js";import{S as De}from"./StepContent-BShKK8Wg.js";import{R as Ue,a as $}from"./RadioGroup-BV2fzvZ4.js";import{S as Ne}from"./Slider-C0NlYhsa.js";const _e=Le(e.jsx("path",{d:"m12 4-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8z"})),me=["Church Context & Permissions","OCR Settings","Storage & Uploads","Vision Integration","Mapping Baseline","Ready to Launch"];function Ze(){const[h]=Ve(),p=Fe(),t=parseInt(h.get("church_id")||"46"),[y,j]=k.useState(0),[s,u]=k.useState({}),[w,f]=k.useState(0),[F,U]=k.useState(!1),[xe,ge]=k.useState(!0),[je,N]=k.useState(!1),[c,fe]=k.useState(null),[_,M]=k.useState(null);k.useEffect(()=>{Ce(),B()},[t]);const Ce=()=>S(this,null,function*(){try{const i=yield fetch(`/api/church/${t}/ocr/setup-state`);if(i.ok){const a=yield i.json();u(a.state||{}),f(a.percentComplete||0),U(a.isComplete||!1),a.percentComplete>=100?j(5):a.percentComplete>=80?j(4):a.percentComplete>=60?j(3):a.percentComplete>=40?j(2):a.percentComplete>=20&&j(1)}}catch(i){M(`Failed to load setup state: ${i.message}`)}finally{ge(!1)}}),B=()=>S(this,null,function*(){try{const i=yield fetch(`/api/church/${t}/ocr/setup-validate`,{method:"POST"});if(i.ok){const a=yield i.json();fe(a)}}catch(i){console.error("Validation failed:",i)}}),I=(i,a)=>S(this,null,function*(){N(!0);try{const C=r(r({},s),i),v=Math.max(w,a),b=v>=100;if((yield fetch(`/api/church/${t}/ocr/setup-state`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({state:C,percentComplete:v,isComplete:b})})).ok)u(C),f(v),U(b),yield B();else throw new Error("Failed to save state")}catch(C){M(`Failed to save: ${C.message}`)}finally{N(!1)}}),P=()=>{y<me.length-1&&j(y+1)},O=()=>{y>0&&j(y-1)},ye=()=>S(this,null,function*(){yield I({step1:{churchId:t,permissionsVerified:!0}},20),P()}),ve=()=>S(this,null,function*(){var a,C,v,b;const i={language:((a=s.step2)==null?void 0:a.language)||"eng",defaultLanguage:((C=s.step2)==null?void 0:C.defaultLanguage)||"en",recordTypes:((v=s.step2)==null?void 0:v.recordTypes)||["baptism"],confidenceThreshold:((b=s.step2)==null?void 0:b.confidenceThreshold)||75};yield I({step2:i},40),P()}),Se=()=>S(this,null,function*(){yield B(),yield I({step3:{storagePath:`/var/www/orthodoxmetrics/data/church/${t}/ocr_uploads`,storageWritable:(c==null?void 0:c.checklist.storageReady.passed)||!1}},60),P()}),ke=()=>S(this,null,function*(){yield B(),yield I({step4:{visionConfigured:(c==null?void 0:c.checklist.visionReady.passed)||!1}},80),P()}),be=()=>S(this,null,function*(){yield I({step5:{mappingTemplates:{baptism:!0,marriage:!0,funeral:!0}}},100),P()}),Te=i=>{var a,C,v,b,W,G,H,J,Y,q,K,Q,X,Z,ee,se,te,ae,re,ne,ce,ie,oe,le,pe;switch(i){case 0:return e.jsxs(m,{sx:{p:2},children:[e.jsx(d,{variant:"body1",gutterBottom:!0,children:"Verify church context and permissions for OCR setup."}),e.jsx(Ee,{sx:{mt:2},children:e.jsxs($e,{children:[e.jsx(d,{variant:"h6",children:"Church Information"}),e.jsxs(d,{children:["Church ID: ",t]}),e.jsx(z,{sx:{mt:2},children:e.jsx(g,{control:e.jsx(R,{checked:((a=s.step1)==null?void 0:a.permissionsVerified)||!1,onChange:o=>{u(l(r({},s),{step1:{churchId:t,permissionsVerified:o.target.checked}}))}}),label:"I have permission to configure OCR for this church"})})]})}),e.jsx(x,{variant:"contained",onClick:ye,disabled:!((C=s.step1)!=null&&C.permissionsVerified),sx:{mt:2},children:"Continue"})]});case 1:return e.jsxs(m,{sx:{p:2},children:[e.jsx(d,{variant:"body1",gutterBottom:!0,children:"Configure OCR language settings and record types."}),e.jsxs(A,{fullWidth:!0,sx:{mt:2},children:[e.jsx(D,{children:"Default Language"}),e.jsxs(Ue,{value:((v=s.step2)==null?void 0:v.defaultLanguage)||"en",onChange:o=>{u(l(r({},s),{step2:l(r({},s.step2),{defaultLanguage:o.target.value,language:o.target.value==="en"?"eng":o.target.value})}))},children:[e.jsx(g,{value:"en",control:e.jsx($,{}),label:"English"}),e.jsx(g,{value:"el",control:e.jsx($,{}),label:"Greek"}),e.jsx(g,{value:"ru",control:e.jsx($,{}),label:"Russian"}),e.jsx(g,{value:"ar",control:e.jsx($,{}),label:"Arabic"})]})]}),e.jsxs(A,{fullWidth:!0,sx:{mt:2},children:[e.jsx(D,{children:"Record Types Enabled"}),e.jsxs(z,{children:[e.jsx(g,{control:e.jsx(R,{checked:((W=(b=s.step2)==null?void 0:b.recordTypes)==null?void 0:W.includes("baptism"))||!1,onChange:o=>{var T;const n=((T=s.step2)==null?void 0:T.recordTypes)||[],L=o.target.checked?[...n,"baptism"]:n.filter(V=>V!=="baptism");u(l(r({},s),{step2:l(r({},s.step2),{recordTypes:L})}))}}),label:"Baptism"}),e.jsx(g,{control:e.jsx(R,{checked:((H=(G=s.step2)==null?void 0:G.recordTypes)==null?void 0:H.includes("marriage"))||!1,onChange:o=>{var T;const n=((T=s.step2)==null?void 0:T.recordTypes)||[],L=o.target.checked?[...n,"marriage"]:n.filter(V=>V!=="marriage");u(l(r({},s),{step2:l(r({},s.step2),{recordTypes:L})}))}}),label:"Marriage"}),e.jsx(g,{control:e.jsx(R,{checked:((Y=(J=s.step2)==null?void 0:J.recordTypes)==null?void 0:Y.includes("funeral"))||!1,onChange:o=>{var T;const n=((T=s.step2)==null?void 0:T.recordTypes)||[],L=o.target.checked?[...n,"funeral"]:n.filter(V=>V!=="funeral");u(l(r({},s),{step2:l(r({},s.step2),{recordTypes:L})}))}}),label:"Funeral"})]})]}),e.jsxs(A,{fullWidth:!0,sx:{mt:2},children:[e.jsxs(D,{children:["Confidence Threshold: ",((q=s.step2)==null?void 0:q.confidenceThreshold)||75,"%"]}),e.jsx(Ne,{value:((K=s.step2)==null?void 0:K.confidenceThreshold)||75,onChange:(o,n)=>{u(l(r({},s),{step2:l(r({},s.step2),{confidenceThreshold:n})}))},min:50,max:100,step:5,marks:!0})]}),e.jsxs(m,{sx:{mt:2,display:"flex",gap:1},children:[e.jsx(x,{onClick:O,children:"Back"}),e.jsx(x,{variant:"contained",onClick:ve,disabled:(((X=(Q=s.step2)==null?void 0:Q.recordTypes)==null?void 0:X.length)||0)===0,children:"Save & Continue"})]})]});case 2:return e.jsxs(m,{sx:{p:2},children:[e.jsx(d,{variant:"body1",gutterBottom:!0,children:"Verify storage paths and upload readiness."}),c&&e.jsx(E,{severity:c.checklist.storageReady.passed?"success":"warning",sx:{mt:2},children:c.checklist.storageReady.message}),e.jsx(x,{variant:"outlined",onClick:B,sx:{mt:2},children:"Re-check Storage"}),e.jsxs(m,{sx:{mt:2,display:"flex",gap:1},children:[e.jsx(x,{onClick:O,children:"Back"}),e.jsx(x,{variant:"contained",onClick:Se,disabled:!(c!=null&&c.checklist.storageReady.passed),children:"Continue"})]})]});case 3:return e.jsxs(m,{sx:{p:2},children:[e.jsx(d,{variant:"body1",gutterBottom:!0,children:"Verify Vision API credentials are configured."}),c&&e.jsx(E,{severity:c.checklist.visionReady.passed?"success":"error",sx:{mt:2},children:c.checklist.visionReady.message}),e.jsx(d,{variant:"body2",sx:{mt:2},children:"Note: Credentials are configured server-side. This step only verifies they exist."}),e.jsxs(m,{sx:{mt:2,display:"flex",gap:1},children:[e.jsx(x,{onClick:O,children:"Back"}),e.jsx(x,{variant:"contained",onClick:ke,disabled:!(c!=null&&c.checklist.visionReady.passed),children:"Continue"})]})]});case 4:return e.jsxs(m,{sx:{p:2},children:[e.jsx(d,{variant:"body1",gutterBottom:!0,children:"Create or select mapping templates for record types."}),e.jsxs(z,{sx:{mt:2},children:[e.jsx(g,{control:e.jsx(R,{checked:((ee=(Z=s.step5)==null?void 0:Z.mappingTemplates)==null?void 0:ee.baptism)||!1,onChange:o=>{var n;u(l(r({},s),{step5:{mappingTemplates:l(r({},(n=s.step5)==null?void 0:n.mappingTemplates),{baptism:o.target.checked})}}))}}),label:"Baptism Mapping Template"}),e.jsx(g,{control:e.jsx(R,{checked:((te=(se=s.step5)==null?void 0:se.mappingTemplates)==null?void 0:te.marriage)||!1,onChange:o=>{var n;u(l(r({},s),{step5:{mappingTemplates:l(r({},(n=s.step5)==null?void 0:n.mappingTemplates),{marriage:o.target.checked})}}))}}),label:"Marriage Mapping Template"}),e.jsx(g,{control:e.jsx(R,{checked:((re=(ae=s.step5)==null?void 0:ae.mappingTemplates)==null?void 0:re.funeral)||!1,onChange:o=>{var n;u(l(r({},s),{step5:{mappingTemplates:l(r({},(n=s.step5)==null?void 0:n.mappingTemplates),{funeral:o.target.checked})}}))}}),label:"Funeral Mapping Template"})]}),e.jsxs(m,{sx:{mt:2,display:"flex",gap:1},children:[e.jsx(x,{onClick:O,children:"Back"}),e.jsx(x,{variant:"contained",onClick:be,disabled:!((ce=(ne=s.step5)==null?void 0:ne.mappingTemplates)!=null&&ce.baptism)&&!((oe=(ie=s.step5)==null?void 0:ie.mappingTemplates)!=null&&oe.marriage)&&!((pe=(le=s.step5)==null?void 0:le.mappingTemplates)!=null&&pe.funeral),children:"Complete Setup"})]})]});case 5:return e.jsxs(m,{sx:{p:2},children:[e.jsx(E,{severity:"success",sx:{mb:2},children:"Setup Complete! You're ready to use Enhanced OCR Uploader."}),e.jsx(d,{variant:"h6",gutterBottom:!0,children:"Summary"}),e.jsxs(d,{children:["Church ID: ",t]}),e.jsxs(d,{children:["Progress: ",w,"%"]}),e.jsx(x,{variant:"contained",size:"large",onClick:()=>p(`/devel/enhanced-ocr-uploader?church_id=${t}`),sx:{mt:2},startIcon:e.jsx(_e,{}),children:"Launch Enhanced OCR Uploader"})]});default:return null}};return xe?e.jsx(m,{sx:{display:"flex",justifyContent:"center",p:4},children:e.jsx(ue,{})}):e.jsxs(m,{sx:{maxWidth:900,mx:"auto",p:3},children:[e.jsx(d,{variant:"h4",gutterBottom:!0,children:"OCR Setup Wizard"}),e.jsxs(d,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:["Church ID: ",t," â€¢ Progress: ",w,"%"]}),_&&e.jsx(E,{severity:"error",sx:{mb:2},onClose:()=>M(null),children:_}),e.jsx(Oe,{sx:{p:3,mt:2},children:e.jsx(Me,{activeStep:y,orientation:"vertical",children:me.map((i,a)=>e.jsxs(We,{children:[e.jsx(ze,{optional:a===y?e.jsx(d,{variant:"caption",children:"Current step"}):a<y?e.jsx(Ae,{color:"success",fontSize:"small"}):null,children:i}),e.jsx(De,{children:Te(a)})]},i))})}),je&&e.jsxs(m,{sx:{display:"flex",alignItems:"center",gap:1,mt:2},children:[e.jsx(ue,{size:20}),e.jsx(d,{variant:"body2",children:"Saving..."})]})]})}export{Ze as default};
//# sourceMappingURL=OcrSetupWizardPage-BWStA7An.js.map
