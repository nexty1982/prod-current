var Yt=Object.defineProperty,Kt=Object.defineProperties;var er=Object.getOwnPropertyDescriptors;var Me=Object.getOwnPropertySymbols;var ht=Object.prototype.hasOwnProperty,xt=Object.prototype.propertyIsEnumerable;var Je=(a,s,t)=>s in a?Yt(a,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[s]=t,Y=(a,s)=>{for(var t in s||(s={}))ht.call(s,t)&&Je(a,t,s[t]);if(Me)for(var t of Me(s))xt.call(s,t)&&Je(a,t,s[t]);return a},de=(a,s)=>Kt(a,er(s));var pt=(a,s)=>{var t={};for(var r in a)ht.call(a,r)&&s.indexOf(r)<0&&(t[r]=a[r]);if(a!=null&&Me)for(var r of Me(a))s.indexOf(r)<0&&xt.call(a,r)&&(t[r]=a[r]);return t};var mt=(a,s,t)=>Je(a,typeof s!="symbol"?s+"":s,t);var A=(a,s,t)=>new Promise((r,i)=>{var o=h=>{try{d(t.next(h))}catch(v){i(v)}},l=h=>{try{d(t.throw(h))}catch(v){i(v)}},d=h=>h.done?r(h.value):Promise.resolve(h.value).then(o,l);d((t=t.apply(a,s)).next())});import{m as be,j as e,U as K,B as n,d as u,e as U,aR as I,P as Ie,s as sr,a1 as tr,t as rr,f as ar,h as Q,cx as W,K as jt,Z as vt,O as wt,a0 as ve,cC as Ge,p as kt,D as Ze,a2 as St,C as ke,T as we,I as Ae,n as or,q as nr}from"./index-Dgvcv9SG.js";import{r as c,b as lr}from"./vendor-Dkfty7_r.js";import{c as H}from"./createLucideIcon-77RUDsVg.js";import{C as es,A as ir}from"./chevron-down-B1BCteWm.js";import{C as cr}from"./chevron-right-QEpTS8nG.js";import{b as ie,C as ye,a as Se,X as dr}from"./x-CAU9Su3h.js";import{B as hr}from"./ButtonGroup-CWOthUvO.js";import{R as Pe,S as xr}from"./settings-BC7tVIde.js";import{T as pr,a as Qe}from"./Tabs-DvDGzSBw.js";import{L as ss}from"./ListItem-mECUil91.js";import{T as mr,a as ur,b as gr,c as ut,d as yr}from"./TableRow-GBYhOGTG.js";import{T as se}from"./TableCell-jHKItVVU.js";import{T as fr}from"./TablePagination-GuzffQrc.js";import{L as gt}from"./ListItemText-HVc0yZD9.js";import"./getValidReactChildren-DyXwATAm.js";import"./KeyboardArrowRight-iVZ9lhbl.js";import"./listItemButtonClasses-BdhSRkE2.js";import"./LastPage-BXUC_f7y.js";import"./Toolbar-DfqyUE-7.js";/**
 * @license lucide-react v0.534.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const br=[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]],Pt=H("archive",br);/**
 * @license lucide-react v0.534.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jr=[["path",{d:"m3 16 4 4 4-4",key:"1co6wj"}],["path",{d:"M7 20V4",key:"1yoxec"}],["path",{d:"M11 4h10",key:"1w87gc"}],["path",{d:"M11 8h7",key:"djye34"}],["path",{d:"M11 12h4",key:"q8tih4"}]],vr=H("arrow-down-wide-narrow",jr);/**
 * @license lucide-react v0.534.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wr=[["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}],["path",{d:"M11 12h4",key:"q8tih4"}],["path",{d:"M11 16h7",key:"uosisv"}],["path",{d:"M11 20h10",key:"jvxblo"}]],kr=H("arrow-up-narrow-wide",wr);/**
 * @license lucide-react v0.534.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sr=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],_e=H("calendar",Sr);/**
 * @license lucide-react v0.534.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pr=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],$e=H("check",Pr);/**
 * @license lucide-react v0.534.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nr=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Nt=H("clock",Nr);/**
 * @license lucide-react v0.534.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cr=[["path",{d:"m16 18 6-6-6-6",key:"eg8j8"}],["path",{d:"m8 6-6 6 6 6",key:"ppft3o"}]],Tr=H("code",Cr);/**
 * @license lucide-react v0.534.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ir=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],Rr=H("copy",Ir);/**
 * @license lucide-react v0.534.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Er=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],Mr=H("download",Er);/**
 * @license lucide-react v0.534.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $r=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],Ct=H("external-link",$r);/**
 * @license lucide-react v0.534.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zr=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],Tt=H("eye",zr);/**
 * @license lucide-react v0.534.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fr=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"m9 15 2 2 4-4",key:"1grp1n"}]],Ar=H("file-check",Fr);/**
 * @license lucide-react v0.534.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _r=[["path",{d:"M10 12.5 8 15l2 2.5",key:"1tg20x"}],["path",{d:"m14 12.5 2 2.5-2 2.5",key:"yinavb"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7z",key:"1mlx9k"}]],me=H("file-code",_r);/**
 * @license lucide-react v0.534.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lr=[["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M4.268 21a2 2 0 0 0 1.727 1H18a2 2 0 0 0 2-2V7l-5-5H6a2 2 0 0 0-2 2v3",key:"ms7g94"}],["path",{d:"m9 18-1.5-1.5",key:"1j6qii"}],["circle",{cx:"5",cy:"14",r:"3",key:"ufru5t"}]],ze=H("file-search",Lr);/**
 * @license lucide-react v0.534.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wr=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],It=H("file-text",Wr);/**
 * @license lucide-react v0.534.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hr=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"m14.5 12.5-5 5",key:"b62r18"}],["path",{d:"m9.5 12.5 5 5",key:"1rk7el"}]],Dr=H("file-x",Hr);/**
 * @license lucide-react v0.534.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Or=[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]],Br=H("folder-open",Or);/**
 * @license lucide-react v0.534.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ur=[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]],qr=H("folder",Ur);/**
 * @license lucide-react v0.534.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vr=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],Jr=H("funnel",Vr);/**
 * @license lucide-react v0.534.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gr=[["line",{x1:"6",x2:"6",y1:"3",y2:"15",key:"17qcm7"}],["circle",{cx:"18",cy:"6",r:"3",key:"1h7g24"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["path",{d:"M18 9a9 9 0 0 1-9 9",key:"n2h4wq"}]],Rt=H("git-branch",Gr);/**
 * @license lucide-react v0.534.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zr=[["circle",{cx:"18",cy:"18",r:"3",key:"1xkwt0"}],["circle",{cx:"6",cy:"6",r:"3",key:"1lh9wr"}],["path",{d:"M13 6h3a2 2 0 0 1 2 2v7",key:"1yeb86"}],["path",{d:"M11 18H8a2 2 0 0 1-2-2V9",key:"19pyzm"}]],yt=H("git-compare",Zr);/**
 * @license lucide-react v0.534.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qr=[["line",{x1:"22",x2:"2",y1:"12",y2:"12",key:"1y58io"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}],["line",{x1:"6",x2:"6.01",y1:"16",y2:"16",key:"sgf278"}],["line",{x1:"10",x2:"10.01",y1:"16",y2:"16",key:"1l4acy"}]],Xr=H("hard-drive",Qr);/**
 * @license lucide-react v0.534.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yr=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]],ts=H("history",Yr);/**
 * @license lucide-react v0.534.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kr=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],ea=H("loader-circle",Kr);/**
 * @license lucide-react v0.534.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sa=[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]],as=H("package",sa);/**
 * @license lucide-react v0.534.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ta=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],ra=H("rotate-ccw",ta);/**
 * @license lucide-react v0.534.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aa=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],oa=H("search",aa);/**
 * @license lucide-react v0.534.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const na=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],fe=H("triangle-alert",na);/**
 * @license lucide-react v0.534.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const la=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],ia=H("user",la);/**
 * @license lucide-react v0.534.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ca=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],da=H("users",ca);/**
 * @license lucide-react v0.534.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ha=[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]],Xe=H("zap",ha),rs=a=>{const s=a.split("/");return s[s.length-1]||"/"},xa=a=>{const s=rs(a),t=s.lastIndexOf(".");return t>=0?s.slice(t):""},pa=a=>{if(!a)return null;switch(a){case"missing_in_prod":return e.jsx(Dr,{className:"w-4 h-4 text-purple-500",title:"Missing in production"});case"modified_since_backup":return e.jsx(fe,{className:"w-4 h-4 text-orange-500",title:"Modified since backup"});case"new_file":return e.jsx(Ar,{className:"w-4 h-4 text-green-500",title:"New file (not in backup)"});case"unchanged":return e.jsx(ie,{className:"w-4 h-4 text-gray-400",title:"Unchanged since backup"});default:return null}},ma=a=>{switch(a){case"green":return e.jsx(ie,{className:"w-4 h-4 text-green-500"});case"orange":return e.jsx(fe,{className:"w-4 h-4 text-orange-500"});case"yellow":return e.jsx(Nt,{className:"w-4 h-4 text-yellow-500"});case"red":return e.jsx(ye,{className:"w-4 h-4 text-red-500"});default:return e.jsx(me,{className:"w-4 h-4 text-gray-400"})}},ua=a=>{switch(xa(a).toLowerCase()){case"tsx":case"ts":return e.jsx(me,{className:"w-4 h-4 text-blue-500"});case"jsx":case"js":return e.jsx(me,{className:"w-4 h-4 text-yellow-500"});case"css":case"scss":return e.jsx(me,{className:"w-4 h-4 text-purple-500"});case"json":return e.jsx(me,{className:"w-4 h-4 text-green-500"});default:return e.jsx(me,{className:"w-4 h-4 text-gray-400"})}},Et=c.memo(({item:a,level:s,onToggleExpanded:t,onNodeAction:r,showBadges:i=!0,isDark:o=!1})=>{const[l,d]=c.useState(!1),h=a.expanded,v=a.children&&a.children.length>0,$=a.type==="dir",f={marginLeft:`${s*16}px`},m=(()=>{switch(a.classification){case"green":return o?"#4ade80":"#15803d";case"orange":return o?"#fb923c":"#c2410c";case"yellow":return o?"#facc15":"#a16207";case"red":return o?"#f87171":"#b91c1c";default:return o?"#d1d5db":"#374151"}})(),k=(b,j)=>{b.stopPropagation(),r(j,a),d(!1)},P=()=>{var C,q;if(!i)return null;const b=[],j=F=>{const X={purple:{bg:o?"rgba(147, 51, 234, 0.25)":"#f3e8ff",text:o?"#d8b4fe":"#7e22ce",border:o?"#7c3aed":"#c4b5fd"},orange:{bg:o?"rgba(234, 88, 12, 0.25)":"#ffedd5",text:o?"#fdba74":"#c2410c",border:o?"#ea580c":"#fdba74"},green:{bg:o?"rgba(34, 197, 94, 0.25)":"#dcfce7",text:o?"#86efac":"#15803d",border:o?"#22c55e":"#86efac"},yellow:{bg:o?"rgba(234, 179, 8, 0.25)":"#fef9c3",text:o?"#fde047":"#a16207",border:o?"#eab308":"#fde047"},red:{bg:o?"rgba(239, 68, 68, 0.25)":"#fee2e2",text:o?"#fca5a5":"#b91c1c",border:o?"#ef4444":"#fca5a5"},blue:{bg:o?"rgba(59, 130, 246, 0.25)":"#dbeafe",text:o?"#93c5fd":"#1e40af"},gray:{bg:o?"#374151":"#f3f4f6",text:o?"#9ca3af":"#4b5563",border:o?"#4b5563":"#d1d5db"}};return X[F]||X.gray};if(a.recoveryStatus){const F={missing_in_prod:"MISSING",modified_since_backup:"MODIFIED",new_file:"NEW",unchanged:"UNCHANGED"},M=j({missing_in_prod:"purple",modified_since_backup:"orange",new_file:"green",unchanged:"gray"}[a.recoveryStatus]);b.push(e.jsx("span",{className:"text-xs px-2 py-1 rounded-full font-medium",style:{backgroundColor:M.bg,color:M.text,border:M.border?`1px solid ${M.border}`:"none"},children:F[a.recoveryStatus]},"recovery"))}const N=j(a.classification==="green"?"green":a.classification==="orange"?"orange":a.classification==="yellow"?"yellow":"red");if(b.push(e.jsx("span",{className:"text-xs px-2 py-1 rounded-full font-medium",style:{backgroundColor:N.bg,color:N.text},children:a.classification.toUpperCase()},"classification")),a.type==="file"){const F=j("blue");b.push(e.jsxs("span",{className:"text-xs px-2 py-1 rounded-full font-medium",style:{backgroundColor:F.bg,color:F.text},children:["Score: ",a.usage.score]},"score"))}if((C=a.similarity)!=null&&C.duplicates.length||(q=a.similarity)!=null&&q.nearMatches.length){const F=j("red");b.push(e.jsxs("span",{className:"text-xs px-2 py-1 rounded-full font-medium flex items-center gap-1",style:{backgroundColor:F.bg,color:F.text},children:[e.jsx(Rt,{className:"w-3 h-3"}),"Dupes"]},"duplicates"))}if(a.featurePathMatch){const F=j("green");b.push(e.jsx("span",{className:"text-xs px-2 py-1 rounded-full font-medium",style:{backgroundColor:F.bg,color:F.text},children:"Feature"},"feature"))}return e.jsx("div",{className:"flex gap-1 flex-wrap",children:b})};return e.jsxs("div",{className:"flex items-center gap-2 py-2 px-3 cursor-pointer group",style:de(Y({},f),{color:m,backgroundColor:"transparent",transition:"background-color 0.15s"}),onMouseEnter:b=>{d(!0),b.currentTarget.style.backgroundColor=o?"rgba(55, 65, 81, 0.5)":"#f9fafb"},onMouseLeave:b=>{d(!1),b.currentTarget.style.backgroundColor="transparent"},children:[v&&e.jsx("button",{onClick:b=>{b.stopPropagation(),t(a.path)},className:"flex items-center justify-center w-4 h-4 rounded transition-colors",style:{color:o?"#9ca3af":"#6b7280"},onMouseEnter:b=>{b.currentTarget.style.backgroundColor=o?"#4b5563":"#e5e7eb"},onMouseLeave:b=>{b.currentTarget.style.backgroundColor="transparent"},children:h?e.jsx(es,{className:"w-3 h-3"}):e.jsx(cr,{className:"w-3 h-3"})}),!v&&e.jsx("div",{className:"w-4 h-4"}),e.jsx("div",{className:"flex items-center",children:$?e.jsx(qr,{className:"w-4 h-4 text-blue-500"}):ua(a.path)}),a.recoveryStatus&&e.jsx("div",{className:"flex items-center",children:pa(a.recoveryStatus)}),e.jsx("div",{className:"flex items-center",children:ma(a.classification)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-medium truncate",style:{color:m},children:a.type==="dir"?rs(a.path):rs(a.relPath)}),a.type==="file"&&e.jsx("div",{className:"text-xs truncate",style:{color:o?"#9ca3af":"#6b7280"},children:a.relPath})]}),l&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:b=>k(b,"copy"),className:"p-1 rounded",style:{color:o?"#d1d5db":"#4b5563"},onMouseEnter:b=>b.currentTarget.style.backgroundColor=o?"#4b5563":"#e5e7eb",onMouseLeave:b=>b.currentTarget.style.backgroundColor="transparent",title:"Copy relative path",children:e.jsx(Rr,{className:"w-4 h-4"})}),a.type==="file"&&e.jsx("button",{onClick:b=>k(b,"open"),className:"p-1 rounded",style:{color:o?"#d1d5db":"#4b5563"},onMouseEnter:b=>b.currentTarget.style.backgroundColor=o?"#4b5563":"#e5e7eb",onMouseLeave:b=>b.currentTarget.style.backgroundColor="transparent",title:"Open in editor",children:e.jsx(Ct,{className:"w-4 h-4"})}),a.recoveryStatus==="missing_in_prod"&&a.type==="file"&&e.jsx("button",{onClick:b=>k(b,"restore"),className:"p-1 rounded",style:{color:o?"#c084fc":"#9333ea"},onMouseEnter:b=>b.currentTarget.style.backgroundColor=o?"rgba(147, 51, 234, 0.3)":"#e9d5ff",onMouseLeave:b=>b.currentTarget.style.backgroundColor="transparent",title:"Restore from backup",children:e.jsx(ra,{className:"w-4 h-4"})}),e.jsx("button",{onClick:b=>k(b,"reasons"),className:"p-1 rounded",style:{color:o?"#d1d5db":"#4b5563"},onMouseEnter:b=>b.currentTarget.style.backgroundColor=o?"#4b5563":"#e5e7eb",onMouseLeave:b=>b.currentTarget.style.backgroundColor="transparent",title:"View classification reasons",children:e.jsx(Tt,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"flex-shrink-0 mr-2",children:P()})]})}),Mt=c.memo(({treeItems:a,expandedPaths:s,onToggleExpanded:t,onNodeAction:r,className:i="",isDark:o})=>{const l=be(),d=o!==void 0?o:l.palette.mode==="dark",[h,v]=c.useState([]),$=(f,y=0)=>{const m=[];return f.forEach(k=>{const P=de(Y({},k),{level:y});m.push(P),k.children&&k.children.length>0&&k.expanded&&m.push(...$(k.children,y+1))}),m};return c.useEffect(()=>{const f=$(a);v(f)},[a,s]),a.length===0?e.jsx("div",{className:"flex items-center justify-center h-64 rounded-lg",style:{backgroundColor:d?"#1f2937":"#ffffff",border:`1px solid ${d?"#374151":"#e5e7eb"}`,color:d?"#9ca3af":"#6b7280"},children:e.jsxs("div",{className:"text-center",children:[e.jsx(me,{className:"w-8 h-8 mx-auto mb-2",style:{color:d?"#6b7280":"#9ca3af"}}),e.jsx("p",{children:"No files found matching current filters"})]})}):e.jsxs("div",{className:`rounded-lg ${i}`,style:{backgroundColor:d?"#1f2937":"#ffffff",border:`1px solid ${d?"#374151":"#e5e7eb"}`},children:[e.jsx("div",{className:"p-4",style:{backgroundColor:d?"rgba(55, 65, 81, 0.5)":"#f9fafb",borderBottom:`1px solid ${d?"#374151":"#e5e7eb"}`},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"font-medium",style:{color:d?"#f3f4f6":"#111827"},children:["File Tree (",h.length," items)"]}),e.jsxs("div",{className:"text-sm",style:{color:d?"#9ca3af":"#6b7280"},children:[a.length," root items"]})]})}),e.jsx("div",{className:"overflow-auto",style:{maxHeight:"600px",backgroundColor:d?"#1f2937":"#ffffff"},children:h.map((f,y)=>e.jsx(Et,{item:f,level:f.level||0,onToggleExpanded:t,onNodeAction:r,isDark:d},`${f.path}-${y}`))})]})});Mt.displayName="Tree";Et.displayName="TreeNode";const ga=({scanData:a,filterState:s,onFilterChange:t,className:r=""})=>{const i=be(),o=i.palette.mode==="dark";if(!a)return null;const l=[{key:"green",label:"Production Ready",icon:ie,description:"Likely in production and actively used",color:"green",count:a.summary.likelyInProd},{key:"orange",label:"High Risk",icon:fe,description:"May be used by multiple feature areas",color:"orange",count:a.summary.highRisk},{key:"yellow",label:"In Development",icon:Nt,description:"Development files or low usage, recent edits",color:"yellow",count:a.summary.inDevelopment},{key:"red",label:"Legacy/Duplicate",icon:ye,description:"Duplicates, legacy patterns, or old files",color:"red",count:a.summary.legacyOrDupes}],d=f=>{const y=s.classifications.includes(f)?s.classifications.filter(m=>m!==f):[...s.classifications,f];t({classifications:y})},h=()=>{t({classifications:["green","orange","yellow","red"]})},v=()=>{t({classifications:[]})},$=f=>{const m={green:{main:i.palette.success.main,light:i.palette.success.light,dark:i.palette.success.dark},orange:{main:i.palette.warning.main,light:i.palette.warning.light,dark:i.palette.warning.dark},yellow:{main:i.palette.warning.main,light:i.palette.warning.light,dark:i.palette.warning.dark},red:{main:i.palette.error.main,light:i.palette.error.light,dark:i.palette.error.dark}}[f]||{main:i.palette.grey[500],light:i.palette.grey[100],dark:i.palette.grey[700]};return{bgcolor:I(m.main,o?.15:.12),color:o?m.light:m.dark,borderColor:I(m.main,o?.5:.4),iconColor:o?m.light:m.main}};return e.jsxs(K,{elevation:0,sx:{bgcolor:"background.paper",border:1,borderColor:"divider",borderRadius:1},className:r,children:[e.jsx(n,{sx:{p:2,borderBottom:1,borderColor:"divider"},children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsx(u,{variant:"subtitle1",fontWeight:600,children:"Classification Legend"}),e.jsxs(hr,{size:"small",variant:"outlined",children:[e.jsx(U,{onClick:h,color:"info",sx:{textTransform:"none",fontSize:"0.75rem"},children:"All"}),e.jsx(U,{onClick:v,color:"inherit",sx:{textTransform:"none",fontSize:"0.75rem"},children:"None"})]})]})}),e.jsx(n,{sx:{p:2,display:"flex",flexDirection:"column",gap:1.5},children:l.map(f=>{const y=$(f.color),m=f.icon,k=s.classifications.includes(f.key);return e.jsx(n,{onClick:()=>d(f.key),sx:{p:1.5,borderRadius:1,border:2,cursor:"pointer",transition:"all 0.2s",bgcolor:k?y.bgcolor:"action.hover",borderColor:k?y.borderColor:"divider","&:hover":{bgcolor:k?y.bgcolor:"action.selected"}},children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[e.jsx(n,{sx:{display:"flex",alignItems:"center",justifyContent:"center",width:24,height:24,borderRadius:.5,bgcolor:k?y.bgcolor:"action.selected"},children:e.jsx(m,{className:"w-4 h-4",style:{color:k?y.iconColor:i.palette.text.disabled}})}),e.jsxs(n,{sx:{flex:1},children:[e.jsx(u,{variant:"body2",fontWeight:500,color:k?y.color:"text.primary",children:f.label}),e.jsx(u,{variant:"caption",color:k?y.color:"text.secondary",children:f.description})]}),e.jsx(u,{variant:"body2",fontWeight:500,color:k?y.color:"text.secondary",children:f.count})]})},f.key)})}),e.jsx(n,{sx:{p:2,borderTop:1,borderColor:"divider",bgcolor:"action.hover"},children:e.jsxs(n,{sx:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:2,textAlign:"center"},children:[e.jsxs(n,{children:[e.jsx(u,{variant:"h5",fontWeight:700,children:a.summary.totalFiles}),e.jsx(u,{variant:"body2",color:"text.secondary",children:"Total Files"})]}),e.jsxs(n,{children:[e.jsx(u,{variant:"h5",fontWeight:700,children:a.summary.totalDirs}),e.jsx(u,{variant:"body2",color:"text.secondary",children:"Directories"})]}),e.jsx(n,{sx:{gridColumn:"span 2",mt:1},children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:2,justifyContent:"center"},children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(Rt,{className:"w-4 h-4"}),e.jsxs(u,{variant:"body2",color:"text.secondary",children:[a.summary.duplicates," duplicates"]})]}),e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(_e,{className:"w-4 h-4"}),e.jsxs(u,{variant:"body2",color:"text.secondary",children:["Last scan: ",new Date(a.generatedAt).toLocaleTimeString()]})]})]})})]})})]})},ya=({searchQuery:a,onSearchChange:s,sortOptions:t,currentSort:r,onSortChange:i,filterState:o,onFilterChange:l,isLoading:d,onRefresh:h,onAnalyze:v,filteredCount:$,totalCount:f,compareWithBackup:y=!1,onToggleRecoveryMode:m,className:k=""})=>{var oe,xe,Ne,ne,ce,pe;const P=be(),[b,j]=c.useState(!1),[N,C]=c.useState(!1),[q,F]=c.useState(!1),X=[{label:"All Files",value:""},{label:"TypeScript",value:".ts"},{label:"TSX Components",value:".tsx"},{label:"JavaScript",value:".js"},{label:"JSX Components",value:".jsx"},{label:"CSS/SCSS",value:".css"},{label:"JSON",value:".json"},{label:"Configuration",value:[".json",".yaml",".yml",".toml"]}],M=[{label:"All Time",value:0},{label:"Last 24 Hours",value:1},{label:"Last 7 Days",value:7},{label:"Last 30 Days",value:30},{label:"Last 90 Days",value:90}],T=w=>{l({fileType:Array.isArray(w)?w[0]:w}),C(!1)},G=w=>{i(w),F(!1)},te=w=>{l({modifiedDays:w})},re=()=>{l({classifications:["green","orange","yellow","red"],searchQuery:"",fileType:"",modifiedDays:0,showDuplicates:!1})},he=o.searchQuery.trim()!==""||o.fileType!==""||o.modifiedDays>0||o.showDuplicates||o.classifications.length<4;return e.jsxs(K,{elevation:0,sx:{bgcolor:"background.paper",border:1,borderColor:"divider",borderRadius:1},className:k,children:[e.jsxs(n,{sx:{p:2},children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsxs(n,{sx:{flex:1,position:"relative"},children:[e.jsx(oa,{style:{position:"absolute",left:12,top:"50%",transform:"translateY(-50%)",color:P.palette.text.disabled,width:16,height:16,zIndex:1}}),e.jsx(Ie,{fullWidth:!0,placeholder:"Search files by name or path...",value:a,onChange:w=>s(w.target.value),size:"small",sx:{"& .MuiOutlinedInput-root":{pl:5}}})]}),e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsxs(n,{sx:{position:"relative"},children:[e.jsx(U,{variant:"outlined",color:"inherit",onClick:()=>F(!q),endIcon:e.jsx(es,{className:"w-4 h-4"}),startIcon:r.key==="score"?e.jsx(Xe,{className:"w-4 h-4"}):r.key==="name"?e.jsx(ze,{className:"w-4 h-4"}):r.key==="mtime"?e.jsx(_e,{className:"w-4 h-4"}):e.jsx(Se,{className:"w-4 h-4"}),sx:{textTransform:"none"},children:r.label}),q&&e.jsx(K,{elevation:8,sx:{position:"absolute",right:0,top:"100%",mt:.5,width:256,bgcolor:"background.paper",border:1,borderColor:"divider",borderRadius:1,zIndex:1300,p:1},children:t.map(w=>e.jsx(U,{onClick:()=>G(w),fullWidth:!0,startIcon:w.key==="score"?e.jsx(Xe,{className:"w-4 h-4"}):w.key==="name"?e.jsx(ze,{className:"w-4 h-4"}):w.key==="mtime"?e.jsx(_e,{className:"w-4 h-4"}):e.jsx(Se,{className:"w-4 h-4"}),endIcon:w.direction==="asc"?e.jsx(kr,{className:"w-4 h-4"}):e.jsx(vr,{className:"w-4 h-4"}),sx:{textTransform:"none",justifyContent:"flex-start",px:1.5,py:1,color:r.key===w.key&&r.direction===w.direction?"primary.main":"text.primary",bgcolor:r.key===w.key&&r.direction===w.direction?I(P.palette.primary.main,.1):"transparent","&:hover":{bgcolor:"action.hover"}},children:w.label},`${w.key}-${w.direction}`))})]}),e.jsxs(n,{sx:{position:"relative"},children:[e.jsx(U,{variant:"outlined",color:"inherit",onClick:()=>C(!N),endIcon:e.jsx(es,{className:"w-4 h-4"}),startIcon:e.jsx(ze,{className:"w-4 h-4"}),sx:{textTransform:"none"},children:o.fileType||"All Types"}),N&&e.jsx(K,{elevation:8,sx:{position:"absolute",right:0,top:"100%",mt:.5,width:192,bgcolor:"background.paper",border:1,borderColor:"divider",borderRadius:1,zIndex:1300,p:1},children:X.map(w=>e.jsx(U,{onClick:()=>T(w.value),fullWidth:!0,sx:{textTransform:"none",justifyContent:"flex-start",px:1.5,py:1,color:(Array.isArray(w.value)?w.value.includes(o.fileType):o.fileType===w.value)?"primary.main":"text.primary",bgcolor:(Array.isArray(w.value)?w.value.includes(o.fileType):o.fileType===w.value)?I(P.palette.primary.main,.1):"transparent","&:hover":{bgcolor:"action.hover"}},children:w.label},w.label))})]}),e.jsx(U,{variant:he?"contained":"outlined",color:he?"primary":"inherit",onClick:()=>j(!b),startIcon:e.jsx(Jr,{className:"w-4 h-4"}),sx:{textTransform:"none"},children:"Filters"}),he&&e.jsx(U,{variant:"text",onClick:re,sx:{textTransform:"none",color:"text.secondary","&:hover":{color:"text.primary"}},children:"Clear"}),e.jsx(U,{variant:"outlined",color:"inherit",onClick:h,disabled:d,startIcon:e.jsx(Pe,{className:`w-4 h-4 ${d?"animate-spin":""}`}),sx:{textTransform:"none"},children:"Refresh"}),m&&e.jsx(U,{variant:y?"contained":"outlined",color:y?"secondary":"inherit",onClick:m,disabled:d,startIcon:e.jsx(Pt,{className:"w-4 h-4"}),sx:{textTransform:"none"},title:"Compare with September 2025 backup (Gap Analysis)",children:"Recovery Mode"}),e.jsx(U,{variant:"contained",color:"primary",onClick:v,disabled:d,startIcon:e.jsx(Xe,{className:"w-4 h-4"}),sx:{textTransform:"none"},children:"Analyze"})]})]}),e.jsxs(n,{sx:{mt:2,display:"flex",alignItems:"center",justifyContent:"space-between",fontSize:"0.875rem",color:"text.secondary"},children:[e.jsxs(n,{children:["Showing ",$.toLocaleString()," of ",f.toLocaleString()," files",he&&" (filtered)"]}),d&&e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Pe,{className:"w-4 h-4 animate-spin"}),e.jsx("span",{children:"Analyzing codebase..."})]})]})]}),b&&e.jsx(n,{sx:{borderTop:1,borderColor:"divider",p:2,bgcolor:"action.hover"},children:e.jsxs(n,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",md:"repeat(3, 1fr)"},gap:2},children:[e.jsxs(sr,{fullWidth:!0,children:[e.jsx(tr,{children:"Modified Within"}),e.jsx(rr,{value:o.modifiedDays,onChange:w=>te(Number(w.target.value)),label:"Modified Within",children:M.map(w=>e.jsx(ar,{value:w.value,children:w.label},w.value))})]}),e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx("input",{type:"checkbox",id:"showDuplicates",checked:o.showDuplicates,onChange:w=>l({showDuplicates:w.target.checked}),style:{width:16,height:16,accentColor:P.palette.primary.main,cursor:"pointer"}}),e.jsx("label",{htmlFor:"showDuplicates",style:{fontSize:"0.875rem",fontWeight:500,color:P.palette.text.primary,cursor:"pointer"},children:"Show duplicates only"})]}),y&&e.jsx(e.Fragment,{children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx("input",{type:"checkbox",id:"showMissingOnly",checked:o.showMissingOnly||!1,onChange:w=>l({showMissingOnly:w.target.checked}),style:{width:16,height:16,accentColor:P.palette.secondary.main,cursor:"pointer"}}),e.jsx("label",{htmlFor:"showMissingOnly",style:{fontSize:"0.875rem",fontWeight:500,color:P.palette.text.primary,cursor:"pointer"},children:"Show missing files only"})]})}),e.jsxs(n,{children:[e.jsx(n,{sx:{fontSize:"0.875rem",fontWeight:500,color:"text.primary",mb:.5},children:"Quick Filters"}),e.jsxs(n,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:[e.jsx(Q,{label:"Duplicates",onClick:()=>o.showDuplicates?null:l({showDuplicates:!0}),color:o.showDuplicates?"error":"default",size:"small",sx:{bgcolor:o.showDuplicates?I(P.palette.error.main,.1):void 0,color:o.showDuplicates?"error.main":void 0}}),e.jsx(Q,{label:"Recent (7d)",onClick:()=>l({modifiedDays:o.modifiedDays===7?0:7}),color:o.modifiedDays===7?"primary":"default",size:"small",sx:{bgcolor:o.modifiedDays===7?I(P.palette.primary.main,.1):void 0,color:o.modifiedDays===7?"primary.main":void 0}}),e.jsx(Q,{label:"Legacy Only",onClick:()=>l({classifications:["red"]}),color:"error",size:"small",sx:{bgcolor:I(P.palette.error.main,.1),color:"error.main"}}),y&&e.jsxs(e.Fragment,{children:[e.jsx(Q,{label:"Missing",onClick:()=>l({recoveryStatus:["missing_in_prod"],showMissingOnly:!0}),color:o.showMissingOnly?"secondary":"default",size:"small",sx:{bgcolor:o.showMissingOnly?I(P.palette.secondary.main,.1):void 0,color:o.showMissingOnly?"secondary.main":void 0}}),e.jsx(Q,{label:"Modified",onClick:()=>l({recoveryStatus:["modified_since_backup"]}),color:(oe=o.recoveryStatus)!=null&&oe.includes("modified_since_backup")?"warning":"default",size:"small",sx:{bgcolor:(xe=o.recoveryStatus)!=null&&xe.includes("modified_since_backup")?I(P.palette.warning.main,.1):void 0,color:(Ne=o.recoveryStatus)!=null&&Ne.includes("modified_since_backup")?"warning.main":void 0}}),e.jsx(Q,{label:"New Files",onClick:()=>l({recoveryStatus:["new_file"]}),color:(ne=o.recoveryStatus)!=null&&ne.includes("new_file")?"success":"default",size:"small",sx:{bgcolor:(ce=o.recoveryStatus)!=null&&ce.includes("new_file")?I(P.palette.success.main,.1):void 0,color:(pe=o.recoveryStatus)!=null&&pe.includes("new_file")?"success.main":void 0}})]})]})]})]})})]})},$t=a=>{const s=a.split("/");return s[s.length-1]||"/"},fa=({fileAnalysis:a,integrationPoints:s,onClose:t})=>{if(!a)return null;const{file:r,imports:i,endpoints:o}=a,l=i.every(h=>h.resolved),d=o.every(h=>h.existsInServer);return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 dark:bg-opacity-70 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 p-6 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:"Requirement Preview"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:r.relPath})]}),e.jsx("button",{onClick:t,className:"text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded",children:e.jsx(dr,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/50 p-4 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100 mb-2",children:"File Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Status:"}),e.jsx("span",{className:`ml-2 font-medium ${r.status==="missing_in_target"?"text-purple-600":"text-orange-600"}`,children:r.status==="missing_in_target"?"Missing in Target":"Modified in Target"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Size:"}),e.jsxs("span",{className:"ml-2 font-medium text-gray-900 dark:text-gray-100",children:[(r.size/1024).toFixed(2)," KB"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Source Path:"}),e.jsx("span",{className:"ml-2 font-mono text-xs text-gray-900 dark:text-gray-100",children:r.sourcePath})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Target Path:"}),e.jsx("span",{className:"ml-2 font-mono text-xs text-gray-900 dark:text-gray-100",children:r.targetPath||"N/A"})]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 flex items-center gap-2",children:[e.jsx(Tr,{className:"w-5 h-5"}),"Import Dependencies"]}),l?e.jsxs("span",{className:"flex items-center gap-1 text-green-600 dark:text-green-400",children:[e.jsx(ie,{className:"w-4 h-4"}),"All Resolved"]}):e.jsxs("span",{className:"flex items-center gap-1 text-orange-600 dark:text-orange-400",children:[e.jsx(Se,{className:"w-4 h-4"}),"Some Unresolved"]})]}),i.length===0?e.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-sm",children:"No imports found"}):e.jsx("div",{className:"space-y-2",children:i.map((h,v)=>e.jsx("div",{className:`p-3 rounded-lg border ${h.resolved?"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800":"bg-orange-50 dark:bg-orange-900/20 border-orange-200 dark:border-orange-800"}`,children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[h.resolved?e.jsx(ie,{className:"w-4 h-4 text-green-600 dark:text-green-400"}):e.jsx(ye,{className:"w-4 h-4 text-orange-600 dark:text-orange-400"}),e.jsx("code",{className:"text-sm font-mono text-gray-900 dark:text-gray-100",children:h.importPath})]}),h.resolved&&h.resolvedPath&&e.jsxs("p",{className:"text-xs text-gray-600 dark:text-gray-400 mt-1 ml-6",children:["â†’ ",h.resolvedPath]}),!h.resolved&&h.error&&e.jsxs("p",{className:"text-xs text-red-600 dark:text-red-400 mt-1 ml-6",children:["Error: ",h.error]})]})})},v))})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 flex items-center gap-2",children:[e.jsx(Ct,{className:"w-5 h-5"}),"API Endpoints"]}),o.length>0&&e.jsx("span",{className:`flex items-center gap-1 ${d?"text-green-600 dark:text-green-400":"text-orange-600 dark:text-orange-400"}`,children:d?e.jsxs(e.Fragment,{children:[e.jsx(ie,{className:"w-4 h-4"}),"All Verified"]}):e.jsxs(e.Fragment,{children:[e.jsx(Se,{className:"w-4 h-4"}),"Some Missing"]})})]}),o.length===0?e.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-sm",children:"No endpoints referenced in documentation"}):e.jsx("div",{className:"space-y-2",children:o.map((h,v)=>e.jsx("div",{className:`p-3 rounded-lg border ${h.existsInServer?"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800":"bg-orange-50 dark:bg-orange-900/20 border-orange-200 dark:border-orange-800"}`,children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[h.existsInServer?e.jsx(ie,{className:"w-4 h-4 text-green-600 dark:text-green-400"}):e.jsx(ye,{className:"w-4 h-4 text-orange-600 dark:text-orange-400"}),e.jsxs("span",{className:"font-mono text-sm font-semibold text-gray-900 dark:text-gray-100",children:[h.method," ",h.path]})]}),h.existsInServer&&h.routeFile&&e.jsxs("p",{className:"text-xs text-gray-600 dark:text-gray-400 mt-1 ml-6",children:["Found in: ",h.routeFile]}),!h.existsInServer&&e.jsx("p",{className:"text-xs text-orange-600 dark:text-orange-400 mt-1 ml-6",children:"Not found in server routes"}),h.foundInDocs.length>0&&e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1 ml-6",children:["Referenced in: ",h.foundInDocs.join(", ")]})]})})},v))})]}),(s.menuItems||s.router)&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-3 flex items-center gap-2",children:[e.jsx(me,{className:"w-5 h-5"}),"Integration Points"]}),e.jsxs("div",{className:"space-y-4",children:[s.menuItems&&e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"font-semibold text-blue-900 dark:text-blue-300",children:"MenuItems.ts"}),e.jsxs("span",{className:"text-xs text-blue-600 dark:text-blue-400",children:["Line ",s.menuItems.lineNumber]})]}),e.jsx("pre",{className:"text-xs bg-white dark:bg-gray-900 p-3 rounded border border-blue-100 dark:border-blue-800 overflow-x-auto text-gray-900 dark:text-gray-100",children:e.jsx("code",{children:s.menuItems.codeBlock})})]}),s.router&&e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"font-semibold text-blue-900 dark:text-blue-300",children:"Router.tsx"}),e.jsxs("span",{className:"text-xs text-blue-600 dark:text-blue-400",children:["Line ",s.router.lineNumber]})]}),e.jsx("pre",{className:"text-xs bg-white dark:bg-gray-900 p-3 rounded border border-blue-100 dark:border-blue-800 overflow-x-auto text-gray-900 dark:text-gray-100",children:e.jsx("code",{children:s.router.codeBlock})})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-3",children:"Projected Integration Code"}),e.jsxs("div",{className:"space-y-4",children:[s.router&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Router.tsx Addition"}),e.jsx("pre",{className:"text-xs bg-gray-900 dark:bg-gray-950 text-green-400 dark:text-green-300 p-4 rounded overflow-x-auto",children:e.jsx("code",{children:`// Add to Router.tsx (around line ${s.router.lineNumber})
{
  path: '/apps/${r.relPath.replace(/\.(tsx?|jsx?)$/,"").replace(/\\//g,"/")}',
  element: <${ba(r.relPath)} />,
}`})})]}),s.menuItems&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-700 dark:text-gray-300 mb-2",children:"MenuItems.ts Addition"}),e.jsx("pre",{className:"text-xs bg-gray-900 dark:bg-gray-950 text-green-400 dark:text-green-300 p-4 rounded overflow-x-auto",children:e.jsx("code",{children:`// Add to MenuItems array (around line ${s.menuItems.lineNumber})
{
  label: '${ja(r.relPath)}',
  path: '/apps/${r.relPath.replace(/\.(tsx?|jsx?)$/,"").replace(/\\//g,"/")}',
  icon: 'FileCode', // Update with appropriate icon
}`})})]})]})]})]}),e.jsx("div",{className:"sticky bottom-0 bg-gray-50 dark:bg-gray-700/50 border-t border-gray-200 dark:border-gray-700 px-6 py-4 flex justify-end",children:e.jsx("button",{onClick:t,className:"px-4 py-2 bg-gray-200 dark:bg-gray-600 text-gray-800 dark:text-gray-200 rounded hover:bg-gray-300 dark:hover:bg-gray-500 transition-colors",children:"Close"})})]})})};function ba(a){return $t(a).replace(/\.(tsx?|jsx?)$/,"")}function ja(a){return $t(a).replace(/\.(tsx?|jsx?)$/,"").replace(/([A-Z])/g," $1").trim()}function zt(a){const{imports:s,endpoints:t}=a,r=s.every(l=>l.resolved),i=s.filter(l=>{var d;return!l.resolved&&!((d=l.error)!=null&&d.includes("node_modules"))});return t.filter(l=>!l.existsInServer).length>0?"server_blocker":!r&&i.length>0?"missing_deps":r&&t.every(l=>l.existsInServer||t.length===0)?"ready":"unknown"}const ft=({fileAnalysis:a,bundleSize:s,className:t=""})=>{const r=zt(a),o={ready:{icon:ie,label:"Ready",color:"text-green-600",bgColor:"bg-green-50",borderColor:"border-green-200",description:"All dependencies resolved and endpoints verified"},missing_deps:{icon:fe,label:"Missing Deps",color:"text-yellow-600",bgColor:"bg-yellow-50",borderColor:"border-yellow-200",description:"Some imports missing (may exist in backup bundle)"},server_blocker:{icon:ye,label:"Server Blocker",color:"text-red-600",bgColor:"bg-red-50",borderColor:"border-red-200",description:"Required API endpoints not found in server"},unknown:{icon:fe,label:"Unknown",color:"text-gray-600 dark:text-gray-400",bgColor:"bg-gray-50 dark:bg-gray-700/50",borderColor:"border-gray-200 dark:border-gray-700",description:"Status cannot be determined"}}[r],l=o.icon;return e.jsxs("div",{className:`inline-flex items-center gap-2 px-3 py-1.5 rounded-lg border ${o.bgColor} ${o.borderColor} ${t}`,title:o.description,children:[e.jsx(l,{className:`w-4 h-4 ${o.color}`}),e.jsx("span",{className:`text-sm font-medium ${o.color}`,children:o.label}),s&&s>1&&e.jsxs("div",{className:"flex items-center gap-1 ml-1",children:[e.jsx(as,{className:"w-3 h-3 text-gray-500 dark:text-gray-400"}),e.jsx("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:s})]})]})},Re={sourcePath:"/var/www/orthodoxmetrics/prod/refactor-src/",destinationPath:"/var/www/orthodoxmetrics/prod/front-end/src/",backupPath:"/var/www/orthodoxmetrics/backup"},Ye="refactor-console-paths";class va{constructor(){mt(this,"baseUrl","/api/refactor-console")}getSavedPaths(){try{const s=localStorage.getItem(Ye);if(s){const t=JSON.parse(s);return{sourcePath:t.sourcePath||Re.sourcePath,destinationPath:t.destinationPath||Re.destinationPath,backupPath:t.backupPath||Re.backupPath}}}catch(s){console.warn("Failed to parse saved path config:",s)}return Y({},Re)}savePaths(s){try{const t=this.getSavedPaths(),r=Y(Y({},t),s);localStorage.setItem(Ye,JSON.stringify(r)),console.log("[RefactorConsole] Paths saved:",r)}catch(t){console.error("Failed to save path config:",t)}}clearSavedPaths(){localStorage.removeItem(Ye),console.log("[RefactorConsole] Paths reset to defaults")}getDefaultPaths(){return A(this,null,function*(){try{const s=yield fetch(`${this.baseUrl}/config/paths`,{method:"GET",headers:{"Content-Type":"application/json"},credentials:"include"});if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);return yield s.json()}catch(s){throw console.error("Failed to get default paths:",s),s}})}validatePaths(s){return A(this,null,function*(){try{const t=yield fetch(`${this.baseUrl}/config/validate-paths`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(s)});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);return yield t.json()}catch(t){throw console.error("Failed to validate paths:",t),t}})}fetchSnapshots(s="local",t){return A(this,null,function*(){try{const r=new URLSearchParams;r.append("sourceType",s),t&&r.append("sourcePath",t);const i=yield fetch(`${this.baseUrl}/snapshots?${r}`,{method:"GET",headers:{"Content-Type":"application/json"},credentials:"include"});if(!i.ok){const l=yield this.safeParseResponse(i);throw new Error(l.message||`HTTP error! status: ${i.status}`)}return yield this.safeParseResponse(i)}catch(r){throw console.error("Failed to fetch snapshots:",r),new Error(r instanceof Error?r.message:"Failed to fetch snapshots")}})}scan(s=!1,t=!1,r,i,o){return A(this,null,function*(){try{const l=new URLSearchParams;s&&l.append("rebuild","1"),t&&l.append("compareWithBackup","1");const d=r||this.getSavedPaths(),h=i||d.sourceType||"local",v=o||d.snapshotId;l.append("sourceType",h),v&&l.append("snapshotId",v),d.sourcePath&&l.append("sourcePath",d.sourcePath),d.destinationPath&&l.append("destinationPath",d.destinationPath),d.backupPath&&l.append("backupPath",d.backupPath);const $=yield fetch(`${this.baseUrl}/scan?${l}`,{method:"GET",headers:{"Content-Type":"application/json"},credentials:"include"});if(!$.ok){const y=yield this.safeParseResponse($);throw new Error(y.message||`HTTP error! status: ${$.status}`)}return yield this.safeParseResponse($)}catch(l){throw console.error("Failed to fetch refactor scan:",l),new Error(l instanceof Error?l.message:"Failed to fetch scan data")}})}previewRestore(s,t,r,i){return A(this,null,function*(){try{const o=t||this.getSavedPaths(),l=r||o.sourceType||"local",d=i||o.snapshotId,h=yield fetch(`${this.baseUrl}/preview-restore`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({relPath:s,sourcePath:o.sourcePath||o.backupPath,destinationPath:o.destinationPath,sourceType:l,snapshotId:d})});if(!h.ok){const $=yield this.safeParseResponse(h);throw new Error($.message||`HTTP error! status: ${h.status}`)}return yield this.safeParseResponse(h)}catch(o){throw console.error("Failed to preview restore:",o),new Error(o instanceof Error?o.message:"Failed to preview restore")}})}restore(s,t,r,i){return A(this,null,function*(){try{const o=t||this.getSavedPaths(),l=r||o.sourceType||"local",d=i||o.snapshotId,h=yield fetch(`${this.baseUrl}/restore`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({relPath:s,sourcePath:o.sourcePath||o.backupPath,destinationPath:o.destinationPath,sourceType:l,snapshotId:d})});if(!h.ok){const $=yield this.safeParseResponse(h);throw new Error($.message||`HTTP error! status: ${h.status}`)}return yield this.safeParseResponse(h)}catch(o){throw console.error("Failed to restore file:",o),new Error(o instanceof Error?o.message:"Failed to restore file")}})}safeParseResponse(s){return A(this,null,function*(){const t=s.headers.get("content-type")||"";if(t.includes("application/json"))try{return yield s.json()}catch(r){const i=yield s.text();throw new Error(`Invalid JSON response: ${i.substring(0,200)}`)}else{const r=yield s.text();throw new Error(`Non-JSON response (${t}): ${r.substring(0,500)}`)}})}startPhase1Analysis(){return A(this,null,function*(){try{const s=yield fetch(`${this.baseUrl}/phase1/start`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include"});if(!s.ok){const r=yield this.safeParseResponse(s);throw new Error(r.message||`HTTP error! status: ${s.status}`)}return yield this.safeParseResponse(s)}catch(s){throw console.error("Failed to start Phase 1 analysis:",s),new Error(s instanceof Error?s.message:"Failed to start Phase 1 analysis")}})}getPhase1JobStatus(s){return A(this,null,function*(){try{const t=yield fetch(`${this.baseUrl}/jobs/${s}`,{method:"GET",headers:{"Content-Type":"application/json"},credentials:"include"});if(!t.ok){const i=yield this.safeParseResponse(t);throw new Error(i.message||`HTTP error! status: ${t.status}`)}return yield this.safeParseResponse(t)}catch(t){throw console.error(`Failed to get Phase 1 job ${s} status:`,t),new Error(t instanceof Error?t.message:"Failed to get Phase 1 job status")}})}getPhase1JobResult(s){return A(this,null,function*(){try{const t=yield fetch(`${this.baseUrl}/jobs/${s}/result`,{method:"GET",headers:{"Content-Type":"application/json"},credentials:"include"});if(t.status===409){const i=yield this.safeParseResponse(t);throw new Error(`Job not ready: ${i.status} (${i.progress}%)`)}if(!t.ok){const i=yield this.safeParseResponse(t);throw new Error(i.message||`HTTP error! status: ${t.status}`)}return yield this.safeParseResponse(t)}catch(t){throw console.error(`Failed to get Phase 1 job ${s} result:`,t),new Error(t instanceof Error?t.message:"Failed to get Phase 1 job result")}})}restoreBundle(s){return A(this,null,function*(){try{const t=yield fetch(`${this.baseUrl}/restore-bundle`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(s)});if(!t.ok){const i=yield t.json();throw new Error(i.message||`HTTP error! status: ${t.status}`)}return yield t.json()}catch(t){throw console.error("Failed to restore bundle:",t),new Error(t instanceof Error?t.message:"Failed to restore bundle")}})}healthCheck(){return A(this,null,function*(){try{const s=yield fetch(`${this.baseUrl}/health`,{method:"GET",headers:{"Content-Type":"application/json"},credentials:"include"});if(!s.ok)throw new Error(`Health check failed: ${s.status} ${s.statusText}`);const t=yield s.json();return de(Y({},t),{status:t.ok?"ok":"error"})}catch(s){throw console.error("Health check error:",s),new Error(s instanceof Error?s.message:"Health check failed")}})}checkCacheStatus(){return A(this,null,function*(){try{const s=yield fetch(`${this.baseUrl}/scan`,{method:"HEAD",credentials:"include"}),t=s.status===200?0:-1;return{exists:s.status===200,age:t}}catch(s){return{exists:!1,age:-1}}})}getRestoreHistory(s=50,t=0){return A(this,null,function*(){try{const r=new URLSearchParams;r.append("limit",s.toString()),r.append("offset",t.toString());const i=yield fetch(`${this.baseUrl}/restore-history?${r}`,{method:"GET",headers:{"Content-Type":"application/json"},credentials:"include"});if(!i.ok){const l=yield this.safeParseResponse(i);throw new Error(l.message||`HTTP error! status: ${i.status}`)}return yield this.safeParseResponse(i)}catch(r){throw console.error("Failed to get restore history:",r),new Error(r instanceof Error?r.message:"Failed to get restore history")}})}getFileRestoreHistory(s){return A(this,null,function*(){try{const t=yield fetch(`${this.baseUrl}/restore-history/file/${s}`,{method:"GET",headers:{"Content-Type":"application/json"},credentials:"include"});if(!t.ok){const i=yield this.safeParseResponse(t);throw new Error(i.message||`HTTP error! status: ${t.status}`)}return yield this.safeParseResponse(t)}catch(t){throw console.error("Failed to get file restore history:",t),new Error(t instanceof Error?t.message:"Failed to get file restore history")}})}getRestoreHistoryStats(){return A(this,null,function*(){try{const s=yield fetch(`${this.baseUrl}/restore-history/stats`,{method:"GET",headers:{"Content-Type":"application/json"},credentials:"include"});if(!s.ok){const r=yield this.safeParseResponse(s);throw new Error(r.message||`HTTP error! status: ${s.status}`)}return yield this.safeParseResponse(s)}catch(s){throw console.error("Failed to get restore history stats:",s),new Error(s instanceof Error?s.message:"Failed to get restore history stats")}})}exportRestoreHistory(s=1e3){return A(this,null,function*(){try{const t=new URLSearchParams;t.append("limit",s.toString());const r=`${this.baseUrl}/restore-history/export?${t}`;window.open(r,"_blank")}catch(t){throw console.error("Failed to export restore history:",t),new Error(t instanceof Error?t.message:"Failed to export restore history")}})}}const J=new va,wa=({bundle:a,onRestoreComplete:s})=>{const[t,r]=c.useState(!1),[i,o]=c.useState(!1),l=zt({file:a.rootFile,imports:a.missingImports,endpoints:a.requiredEndpoints}),d=l==="ready"||l==="missing_deps",h=()=>A(void 0,null,function*(){if(!d){W.error("Cannot restore bundle: dependencies or endpoints missing");return}r(!0);try{const $=`/apps/${a.rootFile.relPath.replace(/\.(tsx?|jsx?)$/,"").replace(/^src\//,"").replace(/\//g,"/")}`,f=a.rootFile.relPath.split("/").pop().replace(/\.(tsx?|jsx?)$/,"").replace(/([A-Z])/g," $1").trim(),y=yield J.restoreBundle({bundleFiles:a.files.map(m=>m.relPath),routePath:$,menuLabel:f,menuIcon:"FileCode"});y.success?(W.success(`Successfully restored ${y.restoredFiles.length} files`),s&&s()):W.error(y.message||"Restoration failed")}catch(v){W.error(`Failed to restore bundle: ${v instanceof Error?v.message:"Unknown error"}`)}finally{r(!1),o(!1)}});return d?i?e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e.jsx(Se,{className:"w-5 h-5 text-yellow-600"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"text-sm font-medium text-yellow-900",children:["Restore ",a.files.length," files?"]}),e.jsx("p",{className:"text-xs text-yellow-700 mt-1",children:"This will copy files from backup and update Router.tsx and MenuItems.ts"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>o(!1),className:"px-3 py-1 text-sm bg-gray-200 dark:bg-gray-600 text-gray-800 dark:text-gray-200 rounded hover:bg-gray-300 dark:hover:bg-gray-500",children:"Cancel"}),e.jsx("button",{onClick:h,disabled:t,className:"px-3 py-1 text-sm bg-green-600 text-white rounded hover:bg-green-700 disabled:opacity-50 flex items-center gap-2",children:t?e.jsxs(e.Fragment,{children:[e.jsx(ea,{className:"w-4 h-4 animate-spin"}),"Restoring..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ie,{className:"w-4 h-4"}),"Confirm"]})})]})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ft,{fileAnalysis:{file:a.rootFile,imports:a.missingImports,endpoints:a.requiredEndpoints,integrationPoints:[]},bundleSize:a.files.length}),e.jsxs("button",{onClick:()=>o(!0),disabled:t||!d,className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:[e.jsx(as,{className:"w-4 h-4"}),e.jsx("span",{children:"Restore Bundle"})]})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ft,{fileAnalysis:{file:a.rootFile,imports:a.missingImports,endpoints:a.requiredEndpoints,integrationPoints:[]},bundleSize:a.files.length}),e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:l==="server_blocker"?"Required endpoints missing in server":"Cannot restore"})]})};function Ke(a){const o=a,{children:s,value:t,index:r}=o,i=pt(o,["children","value","index"]);return e.jsx("div",de(Y({role:"tabpanel",hidden:t!==r,id:`diff-tabpanel-${r}`,"aria-labelledby":`diff-tab-${r}`},i),{children:t===r&&e.jsx(n,{sx:{pt:2},children:s})}))}const ka=({open:a,onClose:s,onConfirmRestore:t,preview:r,dependencies:i,isRestoring:o=!1})=>{const l=be(),[d,h]=c.useState(0),v=c.useMemo(()=>{if(!r)return{source:[],target:[],unified:[]};const m=r.sourceContent.split(`
`),k=r.targetContent?r.targetContent.split(`
`):[],P=Math.max(m.length,k.length),b=[];for(let j=0;j<P;j++){const N=m[j]||"",C=k[j]||"";let q="unchanged";j>=k.length&&j<m.length?q="add":j>=m.length&&j<k.length?q="remove":N!==C&&(q="add"),b.push({type:q,sourceNum:j<m.length?j+1:null,targetNum:j<k.length?j+1:null,sourceLine:N,targetLine:C})}return{source:m,target:k,unified:b}},[r]),$=(m,k)=>{h(k)};if(!r||!i)return null;const f=i.missingCount>0,y=!r.targetExists;return e.jsxs(jt,{open:a,onClose:s,maxWidth:"xl",fullWidth:!0,PaperProps:{sx:{height:"90vh",bgcolor:"background.paper"}},children:[e.jsxs(vt,{children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(yt,{className:"w-5 h-5"}),e.jsx(u,{variant:"h6",children:"Preview Restore"})]}),e.jsxs(n,{sx:{display:"flex",gap:1},children:[y&&e.jsx(Q,{label:"New File",color:"success",size:"small"}),r.diffStats.identical&&!y&&e.jsx(Q,{label:"Identical",color:"info",size:"small"}),f&&e.jsx(Q,{label:`${i.missingCount} Missing Dep${i.missingCount>1?"s":""}`,color:"warning",size:"small",icon:e.jsx(fe,{className:"w-3 h-3"})})]})]}),e.jsx(u,{variant:"body2",sx:{color:"text.secondary",mt:.5,fontFamily:"monospace"},children:r.relPath})]}),e.jsxs(wt,{dividers:!0,children:[f&&e.jsxs(ve,{severity:"warning",sx:{mb:2},children:[e.jsx(Ge,{children:"Missing Dependencies Detected"}),"This file imports ",i.missingCount," component(s) that don't exist in the target directory. Restoring this file may cause runtime errors."]}),e.jsx(n,{sx:{borderBottom:1,borderColor:"divider"},children:e.jsxs(pr,{value:d,onChange:$,children:[e.jsx(Qe,{label:"Side-by-Side Diff",icon:e.jsx(yt,{className:"w-4 h-4"}),iconPosition:"start"}),e.jsx(Qe,{label:"Dependencies",icon:e.jsx(as,{className:"w-4 h-4"}),iconPosition:"start"}),e.jsx(Qe,{label:"File Info",icon:e.jsx(It,{className:"w-4 h-4"}),iconPosition:"start"})]})}),e.jsx(Ke,{value:d,index:0,children:e.jsxs(n,{sx:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:2,height:"60vh",overflow:"auto"},children:[e.jsxs(n,{sx:{border:1,borderColor:"divider",borderRadius:1,overflow:"hidden"},children:[e.jsxs(n,{sx:{bgcolor:I(l.palette.success.main,.1),p:1,borderBottom:1,borderColor:"divider"},children:[e.jsx(u,{variant:"subtitle2",sx:{fontWeight:600},children:"Source (Snapshot)"}),e.jsxs(u,{variant:"caption",sx:{color:"text.secondary"},children:[r.sourceSize," bytes â€¢ ",v.source.length," lines"]})]}),e.jsx(n,{sx:{fontFamily:"monospace",fontSize:"0.8rem",p:1,bgcolor:"background.default",maxHeight:"100%",overflow:"auto"},children:v.source.map((m,k)=>{const P=v.unified[k],b=(P==null?void 0:P.type)==="add";return e.jsxs(n,{sx:{display:"flex",bgcolor:b?I(l.palette.success.main,.1):"transparent","&:hover":{bgcolor:I(l.palette.primary.main,.05)}},children:[e.jsx(n,{sx:{width:40,color:"text.secondary",textAlign:"right",pr:1,flexShrink:0,userSelect:"none",borderRight:1,borderColor:"divider"},children:k+1}),e.jsx(n,{sx:{flex:1,pl:1,whiteSpace:"pre",overflowX:"auto"},children:m||" "})]},k)})})]}),e.jsxs(n,{sx:{border:1,borderColor:"divider",borderRadius:1,overflow:"hidden"},children:[e.jsxs(n,{sx:{bgcolor:y?I(l.palette.info.main,.1):I(l.palette.error.main,.1),p:1,borderBottom:1,borderColor:"divider"},children:[e.jsx(u,{variant:"subtitle2",sx:{fontWeight:600},children:"Target (Current)"}),e.jsx(u,{variant:"caption",sx:{color:"text.secondary"},children:y?"File does not exist":`${r.targetSize} bytes â€¢ ${v.target.length} lines`})]}),e.jsx(n,{sx:{fontFamily:"monospace",fontSize:"0.8rem",p:1,bgcolor:"background.default",maxHeight:"100%",overflow:"auto"},children:y?e.jsx(n,{sx:{p:2,textAlign:"center",color:"text.secondary"},children:e.jsx(u,{variant:"body2",children:"File will be created"})}):v.target.map((m,k)=>{const P=v.unified[k],b=(P==null?void 0:P.type)==="add";return e.jsxs(n,{sx:{display:"flex",bgcolor:b?I(l.palette.error.main,.1):"transparent","&:hover":{bgcolor:I(l.palette.primary.main,.05)}},children:[e.jsx(n,{sx:{width:40,color:"text.secondary",textAlign:"right",pr:1,flexShrink:0,userSelect:"none",borderRight:1,borderColor:"divider"},children:k+1}),e.jsx(n,{sx:{flex:1,pl:1,whiteSpace:"pre",overflowX:"auto"},children:m||" "})]},k)})})]})]})}),e.jsx(Ke,{value:d,index:1,children:e.jsx(n,{sx:{maxHeight:"60vh",overflow:"auto"},children:i.hasImports?e.jsxs(n,{children:[e.jsxs(u,{variant:"subtitle1",sx:{mb:2},children:["Found ",i.totalImports," import",i.totalImports!==1?"s":""]}),i.missingCount>0&&e.jsxs(ve,{severity:"warning",sx:{mb:2},children:[e.jsxs(Ge,{children:["âš ï¸ ",i.missingCount," Missing Dependencies"]}),"The following imports could not be resolved in the target directory:"]}),e.jsx(kt,{children:i.imports.map((m,k)=>e.jsxs(lr.Fragment,{children:[e.jsx(ss,{children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",width:"100%",gap:2},children:[m.exists?e.jsx(ie,{className:"w-5 h-5",style:{color:l.palette.success.main}}):e.jsx(ye,{className:"w-5 h-5",style:{color:l.palette.error.main}}),e.jsxs(n,{sx:{flex:1},children:[e.jsx(u,{variant:"body2",sx:{fontFamily:"monospace",color:m.exists?"text.primary":"error.main"},children:m.importPath}),m.resolvedPath&&e.jsxs(u,{variant:"caption",sx:{color:"text.secondary"},children:["Line ",m.lineNumber," â†’ ",m.resolvedPath]}),!m.exists&&!m.resolvedPath&&m.importType!=="package"&&e.jsxs(u,{variant:"caption",sx:{color:"error.main"},children:["Line ",m.lineNumber," â†’ Not found in target"]})]}),e.jsx(Q,{label:m.importType,size:"small",variant:"outlined",color:m.importType==="package"?"default":"primary"})]})}),k<i.imports.length-1&&e.jsx(Ze,{})]},k))})]}):e.jsxs(ve,{severity:"info",children:[e.jsx(Ge,{children:"No Dependencies"}),"This file does not import any other files."]})})}),e.jsx(Ke,{value:d,index:2,children:e.jsxs(n,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsxs(n,{children:[e.jsx(u,{variant:"subtitle2",sx:{fontWeight:600,mb:1},children:"Source File (Snapshot)"}),e.jsxs(n,{sx:{display:"grid",gridTemplateColumns:"auto 1fr",gap:1,fontSize:"0.875rem"},children:[e.jsx(u,{variant:"body2",sx:{color:"text.secondary"},children:"Path:"}),e.jsx(u,{variant:"body2",sx:{fontFamily:"monospace"},children:r.sourcePath}),e.jsx(u,{variant:"body2",sx:{color:"text.secondary"},children:"Size:"}),e.jsxs(u,{variant:"body2",children:[r.sourceSize," bytes"]}),e.jsx(u,{variant:"body2",sx:{color:"text.secondary"},children:"Lines:"}),e.jsx(u,{variant:"body2",children:v.source.length}),e.jsx(u,{variant:"body2",sx:{color:"text.secondary"},children:"Modified:"}),e.jsx(u,{variant:"body2",children:new Date(r.sourceModified).toLocaleString()})]})]}),e.jsx(Ze,{}),e.jsxs(n,{children:[e.jsx(u,{variant:"subtitle2",sx:{fontWeight:600,mb:1},children:"Target File (Current)"}),y?e.jsx(ve,{severity:"info",children:"File does not exist in target directory - it will be created"}):e.jsxs(n,{sx:{display:"grid",gridTemplateColumns:"auto 1fr",gap:1,fontSize:"0.875rem"},children:[e.jsx(u,{variant:"body2",sx:{color:"text.secondary"},children:"Path:"}),e.jsx(u,{variant:"body2",sx:{fontFamily:"monospace"},children:r.targetPath}),e.jsx(u,{variant:"body2",sx:{color:"text.secondary"},children:"Size:"}),e.jsxs(u,{variant:"body2",children:[r.targetSize," bytes"]}),e.jsx(u,{variant:"body2",sx:{color:"text.secondary"},children:"Lines:"}),e.jsx(u,{variant:"body2",children:v.target.length}),e.jsx(u,{variant:"body2",sx:{color:"text.secondary"},children:"Modified:"}),e.jsx(u,{variant:"body2",children:r.targetModified?new Date(r.targetModified).toLocaleString():"N/A"})]})]}),e.jsx(Ze,{}),e.jsxs(n,{children:[e.jsx(u,{variant:"subtitle2",sx:{fontWeight:600,mb:1},children:"Restore Impact"}),e.jsx(n,{sx:{display:"flex",flexDirection:"column",gap:1},children:e.jsxs(ve,{severity:y?"info":r.diffStats.identical?"success":"warning",children:[y&&"New file will be created",!y&&r.diffStats.identical&&"Files are identical - no changes needed",!y&&!r.diffStats.identical&&e.jsxs(e.Fragment,{children:[r.diffStats.linesAdded>0?`${r.diffStats.linesAdded} lines will be added`:"",r.diffStats.linesAdded<0?`${Math.abs(r.diffStats.linesAdded)} lines will be removed`:"",r.diffStats.linesAdded===0?"Same number of lines, but content differs":""]})]})})]})]})})]}),e.jsxs(St,{sx:{p:2,gap:1},children:[e.jsx(U,{onClick:s,disabled:o,children:"Cancel"}),e.jsx(U,{variant:"contained",color:f?"warning":"primary",onClick:t,disabled:o,startIcon:o?e.jsx(ke,{size:16}):null,children:o?"Restoring...":f?"Restore Anyway":"Confirm Restore"})]})]})},Sa=({open:a,onClose:s})=>{const t=be(),[r,i]=c.useState([]),[o,l]=c.useState(null),[d,h]=c.useState(!1),[v,$]=c.useState(null),[f,y]=c.useState(0),[m,k]=c.useState(25),[P,b]=c.useState(0);c.useEffect(()=>{a&&(j(),N())},[a,f,m]);const j=()=>A(void 0,null,function*(){h(!0),$(null);try{const T=yield J.getRestoreHistory(m,f*m);i(T.entries),b(T.total)}catch(T){console.error("Failed to load restore history:",T),$(T instanceof Error?T.message:"Failed to load history")}finally{h(!1)}}),N=()=>A(void 0,null,function*(){try{const T=yield J.getRestoreHistoryStats();l(T.stats)}catch(T){console.error("Failed to load stats:",T)}}),C=()=>A(void 0,null,function*(){try{yield J.exportRestoreHistory(1e3)}catch(T){console.error("Failed to export history:",T)}}),q=(T,G)=>{y(G)},F=T=>{k(parseInt(T.target.value,10)),y(0)},X=T=>new Date(T).toLocaleString(),M=T=>{if(T===0)return"0 B";const G=1024,te=["B","KB","MB","GB"],re=Math.floor(Math.log(T)/Math.log(G));return`${parseFloat((T/Math.pow(G,re)).toFixed(2))} ${te[re]}`};return e.jsxs(jt,{open:a,onClose:s,maxWidth:"xl",fullWidth:!0,PaperProps:{sx:{height:"90vh",bgcolor:"background.paper"}},children:[e.jsx(vt,{children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ts,{className:"w-5 h-5"}),e.jsx(u,{variant:"h6",children:"Restore History"})]}),e.jsxs(n,{sx:{display:"flex",gap:1,alignItems:"center"},children:[e.jsx(we,{title:"Export to CSV",children:e.jsx(Ae,{size:"small",onClick:C,children:e.jsx(Mr,{className:"w-4 h-4"})})}),e.jsx(we,{title:"Refresh",children:e.jsx(Ae,{size:"small",onClick:()=>{j(),N()},children:e.jsx(Pe,{className:"w-4 h-4"})})})]})]})}),e.jsxs(wt,{dividers:!0,children:[o&&e.jsxs(n,{sx:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(150px, 1fr))",gap:2,mb:3},children:[e.jsxs(K,{elevation:0,sx:{p:2,bgcolor:I(t.palette.primary.main,.1),border:1,borderColor:"divider"},children:[e.jsx(u,{variant:"caption",sx:{color:"text.secondary"},children:"Total Restores"}),e.jsx(u,{variant:"h6",sx:{fontWeight:600},children:o.totalRestores})]}),e.jsxs(K,{elevation:0,sx:{p:2,bgcolor:I(t.palette.success.main,.1),border:1,borderColor:"divider"},children:[e.jsx(u,{variant:"caption",sx:{color:"text.secondary"},children:"Successful"}),e.jsx(u,{variant:"h6",sx:{fontWeight:600,color:"success.main"},children:o.successfulRestores})]}),e.jsxs(K,{elevation:0,sx:{p:2,bgcolor:I(t.palette.error.main,.1),border:1,borderColor:"divider"},children:[e.jsx(u,{variant:"caption",sx:{color:"text.secondary"},children:"Failed"}),e.jsx(u,{variant:"h6",sx:{fontWeight:600,color:"error.main"},children:o.failedRestores})]}),e.jsxs(K,{elevation:0,sx:{p:2,bgcolor:I(t.palette.info.main,.1),border:1,borderColor:"divider"},children:[e.jsx(u,{variant:"caption",sx:{color:"text.secondary"},children:"Unique Files"}),e.jsx(u,{variant:"h6",sx:{fontWeight:600},children:o.uniqueFiles})]}),e.jsxs(K,{elevation:0,sx:{p:2,bgcolor:I(t.palette.secondary.main,.1),border:1,borderColor:"divider"},children:[e.jsx(u,{variant:"caption",sx:{color:"text.secondary"},children:"Users"}),e.jsx(u,{variant:"h6",sx:{fontWeight:600},children:o.uniqueUsers})]})]}),v&&e.jsx(ve,{severity:"error",sx:{mb:2},onClose:()=>$(null),children:v}),d&&e.jsx(n,{sx:{display:"flex",justifyContent:"center",p:4},children:e.jsx(ke,{})}),!d&&r.length>0&&e.jsx(mr,{component:K,variant:"outlined",children:e.jsxs(ur,{size:"small",children:[e.jsx(gr,{children:e.jsxs(ut,{sx:{bgcolor:"action.hover"},children:[e.jsx(se,{children:"Status"}),e.jsx(se,{children:"Timestamp"}),e.jsx(se,{children:"User"}),e.jsx(se,{children:"File Path"}),e.jsx(se,{children:"Source"}),e.jsx(se,{children:"Snapshot"}),e.jsx(se,{align:"right",children:"Size"})]})}),e.jsx(yr,{children:r.map(T=>e.jsxs(ut,{hover:!0,sx:{"&:hover":{bgcolor:I(t.palette.primary.main,.05)}},children:[e.jsx(se,{children:T.success?e.jsx(we,{title:"Success",children:e.jsx(ie,{className:"w-4 h-4",style:{color:t.palette.success.main}})}):e.jsx(we,{title:T.error||"Failed",children:e.jsx(ye,{className:"w-4 h-4",style:{color:t.palette.error.main}})})}),e.jsx(se,{children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(_e,{className:"w-3 h-3",style:{color:t.palette.text.secondary}}),e.jsx(u,{variant:"caption",children:X(T.timestamp)})]})}),e.jsx(se,{children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(ia,{className:"w-3 h-3",style:{color:t.palette.text.secondary}}),e.jsx(u,{variant:"caption",children:T.user||T.userEmail||"anonymous"})]})}),e.jsx(se,{children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(It,{className:"w-3 h-3",style:{color:t.palette.text.secondary}}),e.jsx(u,{variant:"caption",sx:{fontFamily:"monospace",maxWidth:300,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},title:T.relPath,children:T.relPath})]})}),e.jsx(se,{children:e.jsx(Q,{label:T.sourceType,size:"small",color:T.sourceType==="remote"?"secondary":"default",sx:{height:20,fontSize:"0.65rem"}})}),e.jsx(se,{children:T.snapshotId?e.jsx(Q,{label:T.snapshotId,size:"small",color:"primary",sx:{height:20,fontSize:"0.65rem"}}):e.jsx(u,{variant:"caption",sx:{color:"text.secondary"},children:"â€”"})}),e.jsx(se,{align:"right",children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:.5,justifyContent:"flex-end"},children:[e.jsx(Xr,{className:"w-3 h-3",style:{color:t.palette.text.secondary}}),e.jsx(u,{variant:"caption",children:M(T.fileSize)})]})})]},T.id))})]})}),!d&&r.length===0&&e.jsxs(n,{sx:{textAlign:"center",py:6},children:[e.jsx(ts,{className:"w-12 h-12 mx-auto mb-2",style:{color:t.palette.text.secondary,opacity:.5}}),e.jsx(u,{variant:"body1",sx:{color:"text.secondary"},children:"No restore history yet"}),e.jsx(u,{variant:"body2",sx:{color:"text.secondary",mt:1},children:"Restore operations will be logged here for audit purposes"})]}),!d&&r.length>0&&e.jsx(fr,{rowsPerPageOptions:[10,25,50,100],component:"div",count:P,rowsPerPage:m,page:f,onPageChange:q,onRowsPerPageChange:F})]}),e.jsx(St,{sx:{p:2},children:e.jsx(U,{onClick:s,children:"Close"})})]})};function Fe(a){const s=a.toLowerCase();return s.includes("/pages/")||s.includes("/page/")?"page":s.includes("/components/")||s.includes("/component/")?"component":s.includes("/hooks/")||s.includes("/hook/")||s.includes("use")&&a.endsWith(".ts")?"hook":s.includes("/services/")||s.includes("/service/")||s.includes("/api/")?"service":"other"}function Pa(a,s,t){if(!a.startsWith(".")&&!a.startsWith("/")&&!a.startsWith("@/"))return null;if(a.startsWith("@/")){const l=a.replace("@/","");for(const[d]of t)if(d.includes(l))return d;return null}const r=s.substring(0,s.lastIndexOf("/")),i=a.startsWith("/")?a.substring(1):`${r}/${a}`.replace(/\/\.\//g,"/").replace(/\/[^/]+\/\.\.\//g,"/");if(t.has(i))return i;const o=[".ts",".tsx",".js",".jsx"];for(const l of o)if(t.has(i+l))return i+l;for(const l of o){const d=`${i}/index${l}`;if(t.has(d))return d}return null}function bt(a,s,t){const r={rootFile:a,files:[a],components:[],hooks:[],services:[],pages:[],allImportsResolved:!0,missingImports:[],requiredEndpoints:[],status:"unknown"},i=new Set([a.relPath]),o=[a.relPath];for(;o.length>0;){const h=o.shift(),v=t.get(h);if(v){r.requiredEndpoints.push(...v.endpoints);for(const $ of v.imports)if($.resolved){if($.resolvedPath&&s.has($.resolvedPath)){const f=$.resolvedPath;if(!i.has(f)){const y=s.get(f);r.files.push(y),i.add(f),o.push(f);const m=Fe(f);m==="component"?r.components.push(y):m==="hook"?r.hooks.push(y):m==="service"?r.services.push(y):m==="page"&&r.pages.push(y)}}}else{r.allImportsResolved=!1;const f=Pa($.importPath,h,s);if(f&&s.has(f)){if(!i.has(f)){const y=s.get(f);r.files.push(y),i.add(f),o.push(f);const m=Fe(f);m==="component"?r.components.push(y):m==="hook"?r.hooks.push(y):m==="service"?r.services.push(y):m==="page"&&r.pages.push(y)}}else r.missingImports.push($)}}}const l=Fe(a.relPath);return l==="page"?r.pages.push(a):l==="component"?r.components.push(a):l==="hook"?r.hooks.push(a):l==="service"&&r.services.push(a),r.requiredEndpoints.filter(h=>!h.existsInServer).length>0?r.status="server_blocker":!r.allImportsResolved&&r.missingImports.length>0?r.status="missing_deps":r.allImportsResolved&&(r.status="ready"),r}function Na(a,s){const t=new Map,r=new Map,i=new Map;a.forEach(l=>{r.set(l.relPath,l)}),s.forEach(l=>{i.set(l.file.relPath,l)});const o=new Set;return a.forEach(l=>{if(o.has(l.relPath))return;const d=Fe(l.relPath);if(d==="page"||d==="other"&&!l.relPath.includes("/components/")&&!l.relPath.includes("/hooks/")&&!l.relPath.includes("/services/")){const h=bt(l,r,i);t.set(l.relPath,h),h.files.forEach(v=>o.add(v.relPath))}}),a.forEach(l=>{if(!o.has(l.relPath)){const d=bt(l,r,i);t.set(l.relPath,d)}}),t}const Ca=()=>{const[a,s]=c.useState(null),[t,r]=c.useState(!1),[i,o]=c.useState(null),[l,d]=c.useState(null),[h,v]=c.useState("idle"),[$,f]=c.useState(0),[y,m]=c.useState(""),[k,P]=c.useState(null),[b,j]=c.useState(null),N=c.useRef(null),[C,q]=c.useState({classifications:["green","orange","yellow","red"],searchQuery:"",fileType:"",modifiedDays:0,showDuplicates:!1,recoveryStatus:void 0,showMissingOnly:!1}),[F,X]=c.useState(!1),[M,T]=c.useState({key:"score",direction:"desc",label:"Usage Score (High to Low)"}),[G,te]=c.useState(new Set),re=c.useCallback((R=!1,S=!1,E,D)=>A(void 0,null,function*(){r(!0),o(null);try{const B=yield J.scan(R,S,void 0,E,D);s(B);const _=new Set;B.nodes&&B.nodes.filter(z=>z.type==="dir").slice(0,5).forEach(z=>_.add(z.path)),te(_)}catch(B){o(B instanceof Error?B.message:"Failed to load scan data"),console.error("Scan error:",B)}finally{r(!1)}}),[]),he=c.useCallback(()=>re(!0),[re]),oe=c.useMemo(()=>{if(!(a!=null&&a.nodes))return[];let R=a.nodes;if(R=R.filter(S=>C.classifications.includes(S.classification)),C.searchQuery.trim()){const S=C.searchQuery.toLowerCase();R=R.filter(E=>E.relPath.toLowerCase().includes(S)||E.reasons.some(D=>D.toLowerCase().includes(S)))}if(C.fileType&&(R=R.filter(S=>S.type==="file"&&S.relPath.toLowerCase().endsWith(C.fileType.toLowerCase()))),C.modifiedDays>0){const S=Date.now()-C.modifiedDays*24*60*60*1e3;R=R.filter(E=>E.mtimeMs>=S)}return C.showDuplicates&&(R=R.filter(S=>{var E,D;return((E=S.similarity)==null?void 0:E.duplicates.length)||((D=S.similarity)==null?void 0:D.nearMatches.length)})),C.recoveryStatus&&C.recoveryStatus.length>0&&(R=R.filter(S=>S.recoveryStatus&&C.recoveryStatus.includes(S.recoveryStatus))),C.showMissingOnly&&(R=R.filter(S=>S.recoveryStatus==="missing_in_prod")),R.sort((S,E)=>{let D=0;switch(M.key){case"score":D=S.usage.score-E.usage.score;break;case"name":D=S.relPath.localeCompare(E.relPath);break;case"mtime":D=S.mtimeMs-E.mtimeMs;break;case"classification":const B={red:0,orange:1,yellow:2,green:3};D=B[S.classification]-B[E.classification];break;case"recoveryStatus":const _={missing_in_prod:0,modified_since_backup:1,new_file:2,unchanged:3},z=S.recoveryStatus||"unchanged",ue=E.recoveryStatus||"unchanged";D=(_[z]||3)-(_[ue]||3);break;default:D=0}return M.direction==="desc"?-D:D}),R},[a==null?void 0:a.nodes,C,M]),xe=c.useMemo(()=>{if(!oe.length)return[];const R=new Map,S=[];return oe.forEach(E=>{const D=de(Y({},E),{children:[],expanded:G.has(E.path),visible:!0,parentPath:void 0});R.set(E.path,D)}),oe.forEach(E=>{const D=R.get(E.path),B=E.path.split("/");let _="";for(let z=B.length-1;z>0;z--){_=B.slice(0,z).join("/");const ue=R.get(_+"/");if(ue){ue.children.push(D),D.parentPath=_;break}_=B.slice(0,z).join("/");const ge=R.get(_);if(ge&&ge.type==="dir"){ge.children.push(D),D.parentPath=_;break}}D.parentPath||S.push(D)}),S},[oe,G]),Ne=c.useCallback(R=>{te(S=>{const E=new Set(S);return E.has(R)?E.delete(R):E.add(R),E})},[]),ne=c.useCallback(()=>{var S;const R=((S=a==null?void 0:a.nodes)==null?void 0:S.filter(E=>E.type==="dir").map(E=>E.path))||[];te(new Set(R))},[a==null?void 0:a.nodes]),ce=c.useCallback(()=>{te(new Set)},[]);c.useEffect(()=>{re(!1,F)},[re,F]),c.useEffect(()=>()=>{N.current&&clearInterval(N.current)},[]);const pe=c.useCallback(()=>A(void 0,null,function*(){N.current&&(clearInterval(N.current),N.current=null),v("starting"),f(0),m("Starting analysis..."),P(null),d(null),j(null);try{const S=(yield J.startPhase1Analysis()).jobId;if(!S)throw new Error("No jobId returned from server");j(S),v("running"),console.log(`[useRefactorScan] Phase 1 job started: ${S}`);let E=0;const D=600;N.current=setInterval(()=>A(void 0,null,function*(){var B;if(E++,E>D){N.current&&(clearInterval(N.current),N.current=null),v("error"),P("Polling timeout: Analysis took too long"),j(null),console.error("[useRefactorScan] Polling timeout");return}try{const _=yield J.getPhase1JobStatus(S);if(!_||typeof _!="object"){console.warn("[useRefactorScan] Invalid status response, continuing...");return}if(f((B=_.progress)!=null?B:0),m(_.currentStep||"Processing..."),_.status==="done"){if(_.progress!==void 0&&_.progress<100){console.log(`[useRefactorScan] Status 'done' but progress ${_.progress}%, waiting...`);return}try{N.current&&(clearInterval(N.current),N.current=null);const z=yield J.getPhase1JobResult(S);if(z&&typeof z=="object"&&z.summary)f(100),m("Complete"),v("done"),d(z),j(null),console.log(`[useRefactorScan] Phase 1 complete: ${z.summary.missingInTarget} restorable files`);else throw new Error("Invalid result structure")}catch(z){if(z instanceof Error&&z.message.includes("not ready")){console.log("[useRefactorScan] Result not ready, continuing...");return}N.current&&(clearInterval(N.current),N.current=null),v("error"),P(z instanceof Error?z.message:"Failed to fetch result"),j(null),console.error("[useRefactorScan] Error fetching result:",z)}}else _.status==="error"&&(N.current&&(clearInterval(N.current),N.current=null),v("error"),P(_.error||"Unknown error"),j(null),console.error("[useRefactorScan] Job error:",_.error))}catch(_){console.error(`[useRefactorScan] Poll error (attempt ${E}):`,_)}}),2e3)}catch(R){v("error"),P(R instanceof Error?R.message:"Failed to start analysis"),j(null),console.error("[useRefactorScan] Failed to start Phase 1:",R)}}),[]),w=c.useMemo(()=>!l||!l.restorableFiles||!l.files?new Map:Na(l.restorableFiles,l.files),[l]),Ce=c.useCallback(R=>w.get(R)||null,[w]);return{scanData:a,isLoading:t,error:i,filterState:C,setFilterState:q,sortOption:M,setSortOption:T,treeItems:xe,expandedPaths:G,setExpandedPaths:te,loadScanData:re,refreshScan:he,toggleExpanded:Ne,expandAll:ne,collapseAll:ce,filteredCount:oe.length,visibleNodes:oe,compareWithBackup:F,setCompareWithBackup:X,phase1Report:l,phase1Status:h,phase1Progress:$,phase1CurrentStep:y,phase1Error:k,startPhase1Analysis:pe,bundles:w,calculateBundle:Ce}},Ta="frjames@ssppoc.org",Ia=({refreshInterval:a=1e4,trackedEmail:s=Ta})=>{var b;const t=be(),[r,i]=c.useState(null),[o,l]=c.useState(!0),[d,h]=c.useState(null),[v,$]=c.useState(null),f=(b=r==null?void 0:r.recentSessions)==null?void 0:b.find(j=>{var N;return((N=j.email)==null?void 0:N.toLowerCase())===s.toLowerCase()}),y=!!f,m=c.useCallback(()=>A(void 0,null,function*(){try{const j=yield fetch("/api/admin/session-stats",{credentials:"include"});if(!j.ok)throw new Error(`HTTP ${j.status}`);const N=yield j.json();N.success?(i(N.stats),h(null)):h(N.error||"Failed to fetch stats")}catch(j){h(j instanceof Error?j.message:"Network error")}finally{l(!1),$(new Date)}}),[]);c.useEffect(()=>{m();const j=setInterval(m,a);return()=>clearInterval(j)},[m,a]);const k=r?Math.min(r.totalSessions/Math.max(r.uniqueUsers,1)*100,100):0,P=r!=null&&r.isHealthy?t.palette.success.main:t.palette.warning.main;return o&&!r?e.jsx(K,{sx:{p:2,display:"flex",alignItems:"center",justifyContent:"center",minHeight:200},children:e.jsx(ke,{size:40})}):d&&!r?e.jsx(K,{sx:{p:2,bgcolor:I(t.palette.error.main,.1)},children:e.jsxs(u,{color:"error",children:["Session Pulse Error: ",d]})}):e.jsxs(K,{sx:{p:2,mb:2,background:`linear-gradient(135deg, ${I(t.palette.primary.main,.05)} 0%, ${I(t.palette.background.paper,1)} 100%)`,border:`1px solid ${I(t.palette.divider,.1)}`},children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2},children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ir,{size:20,color:t.palette.primary.main}),e.jsx(u,{variant:"h6",fontWeight:600,children:"Session Pulse"})]}),e.jsx(we,{title:`Last refresh: ${(v==null?void 0:v.toLocaleTimeString())||"Never"}`,children:e.jsx(Ae,{size:"small",onClick:m,disabled:o,children:e.jsx(Pe,{size:16,className:o?"animate-spin":""})})})]}),e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:2,mb:2,p:1.5,borderRadius:1,bgcolor:y?I(t.palette.success.main,.1):I(t.palette.grey[500],.1),border:`1px solid ${y?I(t.palette.success.main,.3):I(t.palette.grey[500],.2)}`},children:[e.jsx(n,{sx:{width:12,height:12,borderRadius:"50%",bgcolor:y?"success.main":"grey.500",boxShadow:y?`0 0 8px ${t.palette.success.main}`:"none",animation:y?"pulse 2s infinite":"none"}}),e.jsxs(n,{sx:{flex:1},children:[e.jsx(u,{variant:"body2",fontWeight:600,children:"Fr. James Session Tracker"}),e.jsx(u,{variant:"caption",color:"text.secondary",children:y?`Online â€¢ Role: ${(f==null?void 0:f.role)||"unknown"} â€¢ Session: ${f==null?void 0:f.sessionId}`:`${s} is currently offline`})]}),e.jsx(Q,{label:y?"ONLINE":"OFFLINE",size:"small",color:y?"success":"default",sx:{fontWeight:600}})]}),e.jsxs(n,{sx:{display:"flex",gap:3,flexWrap:"wrap"},children:[e.jsxs(n,{sx:{display:"flex",flexDirection:"column",alignItems:"center",minWidth:120},children:[e.jsxs(n,{sx:{position:"relative",display:"inline-flex"},children:[e.jsx(ke,{variant:"determinate",value:100,size:80,thickness:4,sx:{color:I(t.palette.grey[500],.2)}}),e.jsx(ke,{variant:"determinate",value:k,size:80,thickness:4,sx:{color:P,position:"absolute",left:0}}),e.jsx(n,{sx:{top:0,left:0,bottom:0,right:0,position:"absolute",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(u,{variant:"h5",fontWeight:700,color:P,children:(r==null?void 0:r.totalSessions)||0})})]}),e.jsx(u,{variant:"caption",color:"text.secondary",sx:{mt:1},children:"Active Sessions"})]}),e.jsxs(n,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minWidth:120},children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[e.jsx(da,{size:18}),e.jsx(u,{variant:"h6",children:(r==null?void 0:r.uniqueUsers)||0})]}),e.jsx(Q,{icon:r!=null&&r.isHealthy?e.jsx(ie,{size:14}):e.jsx(fe,{size:14}),label:r!=null&&r.isHealthy?"Healthy":"Check",size:"small",color:r!=null&&r.isHealthy?"success":"warning",sx:{fontWeight:500}}),e.jsx(u,{variant:"caption",color:"text.secondary",sx:{mt:.5,textAlign:"center"},children:(r==null?void 0:r.healthMessage)||"Loading..."})]}),e.jsxs(n,{sx:{flex:1,minWidth:250},children:[e.jsx(u,{variant:"subtitle2",color:"text.secondary",sx:{mb:1},children:"Recent Sessions"}),e.jsx(kt,{dense:!0,sx:{bgcolor:I(t.palette.background.default,.5),borderRadius:1,maxHeight:150,overflow:"auto"},children:r!=null&&r.recentSessions&&r.recentSessions.length>0?r.recentSessions.map((j,N)=>{var q;const C=((q=j.email)==null?void 0:q.toLowerCase())===s.toLowerCase();return e.jsx(ss,{sx:{py:.5,bgcolor:C?I(t.palette.success.main,.15):"transparent",borderLeft:C?`3px solid ${t.palette.success.main}`:"none",pl:C?1:2},children:e.jsx(gt,{primary:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[C&&e.jsx(n,{sx:{width:8,height:8,borderRadius:"50%",bgcolor:"success.main",animation:"pulse 2s infinite"}}),e.jsx(u,{variant:"body2",fontFamily:"monospace",fontSize:11,fontWeight:C?600:400,children:j.sessionId}),j.role&&e.jsx(Q,{label:j.role,size:"small",sx:{height:18,fontSize:10},color:j.role==="super_admin"?"error":j.role==="priest"?"primary":"default"})]}),secondary:e.jsxs(u,{variant:"caption",fontSize:10,fontWeight:C?600:400,color:C?"success.main":"text.secondary",children:[j.email||"Anonymous"," ",C&&"â˜… Tracked"]})})},j.fullSessionId||N)}):e.jsx(ss,{children:e.jsx(gt,{primary:"No active sessions",primaryTypographyProps:{color:"text.secondary",fontSize:12}})})})]})]})]})},Xa=()=>{var gs,ys,fs,bs,js,vs,ws,ks,Ss,Ps,Ns,Cs,Ts,Is,Rs,Es,Ms,$s,zs,Fs,As,_s,Ls,Ws,Hs,Ds,Os,Bs,Us,qs,Vs;const{activeMode:a}=c.useContext(or),s=be();c.useEffect(()=>{},[a,s.palette.mode]);const{scanData:t,isLoading:r,error:i,filterState:o,setFilterState:l,sortOption:d,setSortOption:h,treeItems:v,expandedPaths:$,loadScanData:f,refreshScan:y,toggleExpanded:m,filteredCount:k,compareWithBackup:P,setCompareWithBackup:b,phase1Report:j,bundles:N}=Ca(),[C,q]=c.useState(null),[F,X]=c.useState("idle"),[M,T]=c.useState(j),[G,te]=c.useState(0),[re,he]=c.useState(""),[oe,xe]=c.useState(null),[Ne,ne]=c.useState(null),[ce,pe]=c.useState("checking"),[w,Ce]=c.useState(null),[R,S]=c.useState(null),[E,D]=c.useState(!1),[B,_]=c.useState(()=>J.getSavedPaths()),[z,ue]=c.useState({}),[ge,os]=c.useState(!1),[ae,Le]=c.useState("local"),[le,We]=c.useState(null),[Ee,ns]=c.useState([]),[ls,is]=c.useState(!1),[He,cs]=c.useState(null),[Ft,De]=c.useState(!1),[je,Oe]=c.useState(null),[Ra,ds]=c.useState(!1),[At,hs]=c.useState(!1),[Be,Ue]=c.useState(null),[_t,xs]=c.useState(!1),ps=c.useCallback(x=>A(void 0,null,function*(){os(!0);try{const p=yield J.validatePaths(x);return ue({sourcePath:p.validations.sourcePath,destinationPath:p.validations.destinationPath,backupPath:p.validations.backupPath}),p.ok}catch(p){return console.error("Path validation error:",p),W.error("Failed to validate paths"),!1}finally{os(!1)}}),[]),Lt=c.useCallback(()=>A(void 0,null,function*(){(yield ps(B))?(J.savePaths(B),W.success("Path configuration saved"),D(!1)):W.warning("Some paths are invalid. Please check the validation messages.")}),[B,ps]),Wt=c.useCallback(()=>{_(Y({},Re)),ue({}),J.clearSavedPaths(),W.info("Paths reset to defaults")},[]);c.useEffect(()=>{j&&T(j)},[j]),c.useEffect(()=>{A(void 0,null,function*(){try{pe("checking"),Ce(null);const p=yield J.healthCheck();p.ok||p.status==="ok"?pe("ok"):(pe("error"),Ce(p.message||"Unknown error"))}catch(p){pe("error"),Ce(p instanceof Error?p.message:"Connection failed"),console.error("Health check failed:",p),p instanceof Error&&p.message.includes("TypeError")&&(console.warn("[RefactorConsole] Health check failed with TypeError. Server may need rebuild."),W.error("API connection error detected. Server may need rebuild.",{autoClose:5e3}))}})},[]),c.useEffect(()=>{const x=J.getSavedPaths();x.sourceType&&Le(x.sourceType),x.snapshotId&&We(x.snapshotId)},[]),c.useEffect(()=>{A(void 0,null,function*(){is(!0),cs(null);try{const p=yield J.fetchSnapshots(ae);ns(p.snapshots),p.defaultSnapshot&&!le&&(We(p.defaultSnapshot.id),W.info(`Auto-selected most recent snapshot: ${p.defaultSnapshot.label}`))}catch(p){console.error("Failed to load snapshots:",p),cs(p instanceof Error?p.message:"Failed to load snapshots"),ns([]),ae==="remote"&&p instanceof Error&&p.message.includes("mount")&&W.warning("Remote Samba share is not mounted. Please ensure /mnt/refactor-remote is accessible.")}finally{is(!1)}})},[ae]);const Ht=[{key:"score",direction:"desc",label:"Usage Score (High to Low)"},{key:"score",direction:"asc",label:"Usage Score (Low to High)"},{key:"name",direction:"asc",label:"File Name (A-Z)"},{key:"name",direction:"desc",label:"File Name (Z-A)"},{key:"mtime",direction:"desc",label:"Recently Modified"},{key:"mtime",direction:"asc",label:"Oldest Modified"},{key:"classification",direction:"asc",label:"Classification Priority"},...P?[{key:"recoveryStatus",direction:"asc",label:"Recovery Status (Missing First)"},{key:"recoveryStatus",direction:"desc",label:"Recovery Status (New First)"}]:[]],Dt=x=>{l(p=>de(Y({},p),{searchQuery:x}))},ms=x=>{l(p=>Y(Y({},p),x))},Ot=x=>{h(x)},qe=()=>A(void 0,null,function*(){try{const x=de(Y({},B),{sourceType:ae,snapshotId:le||void 0});J.savePaths(x),yield f(!0,P,ae,le||void 0),W.success("Scan data refreshed")}catch(x){W.error("Failed to refresh scan data")}}),Bt=()=>{b(!P),W.info(`Recovery Mode ${P?"disabled":"enabled"}`)},Ut=()=>A(void 0,null,function*(){try{yield y(),W.success("Codebase analysis completed")}catch(x){W.error("Failed to analyze codebase")}}),us=()=>A(void 0,null,function*(){R&&(clearInterval(R),S(null)),X("starting"),te(0),he("Starting analysis..."),xe(null),T(null),ne(null);try{const p=(yield J.startPhase1Analysis()).jobId;if(!p)throw new Error("No jobId returned from server");ne(p),X("running"),W.info("Phase 1 analysis started in background");let L=0;const V=600,ee=setInterval(()=>A(void 0,null,function*(){var Te,Js,Gs,Zs,Qs,Xs,Ys,Ks,et,st,tt,rt,at,ot,nt,lt,it,ct,dt;if(L++,L>V){clearInterval(ee),S(null),X("error"),xe("Polling timeout: Analysis took too long"),ne(null),W.error("Phase 1 analysis timed out"),console.error("[Phase1] Polling timeout after",V,"attempts");return}try{const Z=yield J.getPhase1JobStatus(p);if(!Z||typeof Z!="object"){console.warn("[Phase1] Invalid status response format, continuing to poll...");return}if(te((Te=Z.progress)!=null?Te:0),he(Z.currentStep||"Processing..."),Z.status==="done"){if(Z.progress!==void 0&&Z.progress<100){console.log(`[Phase1] Status is 'done' but progress is ${Z.progress}%, continuing to poll...`);return}try{clearInterval(ee),S(null);const O=yield J.getPhase1JobResult(p);if(!O||typeof O!="object")throw new Error("Invalid result format: result is not an object");const Ve={generatedAt:O.generatedAt||new Date().toISOString(),sourcePath:O.sourcePath||"",targetPath:O.targetPath||"",summary:{totalFilesInSource:(Gs=(Js=O.summary)==null?void 0:Js.totalFilesInSource)!=null?Gs:0,missingInTarget:(Qs=(Zs=O.summary)==null?void 0:Zs.missingInTarget)!=null?Qs:0,modifiedInTarget:(Ys=(Xs=O.summary)==null?void 0:Xs.modifiedInTarget)!=null?Ys:0,identical:(et=(Ks=O.summary)==null?void 0:Ks.identical)!=null?et:0,existsOnlyInTarget:(tt=(st=O.summary)==null?void 0:st.existsOnlyInTarget)!=null?tt:0},restorableFiles:Array.isArray(O.restorableFiles)?O.restorableFiles:[],modifiedFiles:Array.isArray(O.modifiedFiles)?O.modifiedFiles:[],documentation:{endpointsFound:(at=(rt=O.documentation)==null?void 0:rt.endpointsFound)!=null?at:0,endpointsVerified:(nt=(ot=O.documentation)==null?void 0:ot.endpointsVerified)!=null?nt:0,endpointsMissing:(it=(lt=O.documentation)==null?void 0:lt.endpointsMissing)!=null?it:0},files:Array.isArray(O.files)?O.files:[],integrationPoints:{menuItems:((ct=O.integrationPoints)==null?void 0:ct.menuItems)||null,router:((dt=O.integrationPoints)==null?void 0:dt.router)||null}};if(!Ve.summary)throw new Error("Result validation failed: summary is missing");te(100),he("Complete"),X("done"),T(Ve),ne(null),W.success(`Phase 1 analysis complete: ${Ve.summary.missingInTarget} restorable files found`)}catch(O){if(O instanceof Error&&O.message.includes("not ready")){console.log("[Phase1] Result not ready yet, continuing to poll...");return}clearInterval(ee),S(null),X("error"),xe(O instanceof Error?O.message:"Failed to fetch results"),ne(null),W.error(`Failed to fetch Phase 1 results: ${O instanceof Error?O.message:"Unknown error"}`),console.error("Phase 1 result fetch error:",O)}}else Z.status==="error"&&(clearInterval(ee),S(null),X("error"),xe(Z.error||"Unknown error"),ne(null),W.error(`Phase 1 analysis failed: ${Z.error||"Unknown error"}`),console.error("Phase 1 error:",Z.error))}catch(Z){console.error(`[Phase1] Error polling status (attempt ${L}):`,Z),Z instanceof Error&&!Z.message.includes("not ready")&&!Z.message.includes("Failed to fetch")&&console.warn("[Phase1] Non-transient error during polling, will retry:",Z.message)}}),2e3);S(ee)}catch(x){X("error"),xe(x instanceof Error?x.message:"Failed to start Phase 1 analysis"),ne(null),W.error(x instanceof Error?x.message:"Failed to start Phase 1 analysis"),console.error("Phase 1 start error:",x)}});c.useEffect(()=>()=>{R&&clearInterval(R)},[R]);const qt=x=>{var p;if(F!=="done"||!M||!M.summary){W.warning("Phase 1 analysis must be completed before viewing requirements");return}q({type:"requirementPreview",data:{fileAnalysis:x,integrationPoints:(p=M.integrationPoints)!=null?p:{menuItems:null,router:null}}})},Vt=(x,p)=>A(void 0,null,function*(){var L,V,ee,Te;switch(x){case"copy":navigator.clipboard.writeText(p.relPath),W.success("Path copied to clipboard");break;case"open":W.info(`Would open ${p.relPath} in editor`);break;case"restore":p.recoveryStatus==="missing_in_prod"&&p.backupPath&&Gt(p.relPath);break;case"reasons":q({type:"reasons",data:{node:p,reasons:p.reasons,classification:p.classification,usage:p.usage}});break;case"duplicates":((L=p.similarity)!=null&&L.duplicates.length||(V=p.similarity)!=null&&V.nearMatches.length)&&q({type:"replicates",data:{node:p,duplicates:((ee=p.similarity)==null?void 0:ee.duplicates)||[],nearMatches:((Te=p.similarity)==null?void 0:Te.nearMatches)||[]}});break;default:console.log("Unknown action:",x)}}),Jt=x=>{m(x)},Gt=x=>A(void 0,null,function*(){ds(!0),Ue(x);try{const p=yield J.previewRestore(x,void 0,ae,le||void 0);Oe(p),De(!0)}catch(p){console.error("Preview failed:",p),W.error(`Failed to preview file: ${p instanceof Error?p.message:"Unknown error"}`)}finally{ds(!1)}}),Zt=()=>A(void 0,null,function*(){if(Be){hs(!0);try{yield J.restore(Be,void 0,ae,le||void 0),W.success(`File restored: ${Be}`),De(!1),Oe(null),Ue(null),yield f(!0,P,ae,le||void 0)}catch(x){console.error("Restore failed:",x),W.error(`Failed to restore file: ${x instanceof Error?x.message:"Unknown error"}`)}finally{hs(!1)}}}),Qt=()=>{De(!1),Oe(null),Ue(null)},Xt=({onClose:x})=>{if(!C||C.type==="requirementPreview")return null;const{type:p,data:L}=C;return e.jsx(n,{sx:{position:"fixed",inset:0,bgcolor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1300},children:e.jsxs(K,{elevation:8,sx:{bgcolor:"background.paper",borderRadius:1,maxWidth:"42rem",width:"100%",mx:2,maxHeight:"80vh",overflow:"auto"},children:[e.jsxs(n,{sx:{p:3},children:[e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx("h2",{style:{fontSize:"1.25rem",fontWeight:600,color:s.palette.text.primary},children:p==="reasons"?"Classification Details":"Duplicate Analysis"}),e.jsx("button",{onClick:x,style:{background:"none",border:"none",color:s.palette.text.secondary,cursor:"pointer",fontSize:"1.5rem",lineHeight:1,padding:0,width:24,height:24},onMouseEnter:V=>{V.currentTarget.style.color=s.palette.text.primary},onMouseLeave:V=>{V.currentTarget.style.color=s.palette.text.secondary},children:"Ã—"})]}),p==="reasons"&&e.jsxs(n,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsxs("div",{children:[e.jsx("h3",{style:{fontWeight:500,color:s.palette.text.primary,marginBottom:"0.5rem"},children:"File Information"}),e.jsxs(n,{sx:{bgcolor:s.palette.mode==="dark"?"rgba(255,255,255,0.05)":s.palette.grey[50],p:1.5,borderRadius:1},children:[e.jsx("p",{style:{fontSize:"0.875rem",fontFamily:"monospace",color:s.palette.text.primary},children:L.node.relPath}),e.jsxs("p",{style:{fontSize:"0.875rem",color:s.palette.text.secondary,marginTop:"0.25rem"},children:["Classification: ",e.jsx("span",{style:{fontWeight:500},children:L.classification})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{style:{fontWeight:500,color:s.palette.text.primary,marginBottom:"0.5rem"},children:"Usage Statistics"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs(n,{sx:{bgcolor:I(s.palette.info.main,.1),p:1.5,borderRadius:1},children:[e.jsx("p",{style:{fontSize:"0.875rem",color:s.palette.info.main},children:"Import References"}),e.jsx("p",{style:{fontSize:"1.125rem",fontWeight:600,color:s.palette.info.main},children:L.usage.importRefs})]}),e.jsxs(n,{sx:{bgcolor:I(s.palette.success.main,.1),p:1.5,borderRadius:1},children:[e.jsx("p",{style:{fontSize:"0.875rem",color:s.palette.success.main},children:"Server References"}),e.jsx("p",{style:{fontSize:"1.125rem",fontWeight:600,color:s.palette.success.main},children:L.usage.serverRefs})]}),e.jsxs(n,{sx:{bgcolor:I(s.palette.secondary.main,.1),p:1.5,borderRadius:1},children:[e.jsx("p",{style:{fontSize:"0.875rem",color:s.palette.secondary.main},children:"Route References"}),e.jsx("p",{style:{fontSize:"1.125rem",fontWeight:600,color:s.palette.secondary.main},children:L.usage.routeRefs})]}),e.jsxs(n,{sx:{bgcolor:I(s.palette.warning.main,.1),p:1.5,borderRadius:1},children:[e.jsx("p",{style:{fontSize:"0.875rem",color:s.palette.warning.main},children:"Usage Score"}),e.jsx("p",{style:{fontSize:"1.125rem",fontWeight:600,color:s.palette.warning.main},children:L.usage.score})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{style:{fontWeight:500,color:s.palette.text.primary,marginBottom:"0.5rem"},children:"Classification Reasons"}),e.jsx("ul",{className:"space-y-1",children:L.reasons.map((V,ee)=>e.jsxs("li",{className:"flex items-start gap-2 text-sm",style:{color:s.palette.text.primary},children:[e.jsx("span",{style:{color:s.palette.info.main,marginTop:"0.125rem"},children:"â€¢"}),e.jsx("span",{children:V})]},ee))})]})]}),p==="duplicates"&&e.jsxs(n,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsxs("div",{children:[e.jsx("h3",{style:{fontWeight:500,color:s.palette.text.primary,marginBottom:"0.5rem"},children:"Duplicate Analysis"}),e.jsx(n,{sx:{bgcolor:s.palette.mode==="dark"?"rgba(255,255,255,0.05)":s.palette.grey[50],p:1.5,borderRadius:1},children:e.jsx("p",{style:{fontSize:"0.875rem",fontFamily:"monospace",color:s.palette.text.primary},children:L.node.relPath})})]}),L.duplicates.length>0&&e.jsxs("div",{children:[e.jsx("h3",{style:{fontWeight:500,color:s.palette.text.primary,marginBottom:"0.5rem"},children:"Exact Duplicates"}),e.jsx("ul",{className:"space-y-1",children:L.duplicates.map((V,ee)=>e.jsxs("li",{className:"flex items-start gap-2 text-sm",style:{color:s.palette.text.primary},children:[e.jsx("span",{style:{color:s.palette.error.main,marginTop:"0.125rem"},children:"â€¢"}),e.jsx("span",{className:"font-mono",children:V})]},ee))})]}),L.nearMatches.length>0&&e.jsxs("div",{children:[e.jsx("h3",{style:{fontWeight:500,color:s.palette.text.primary,marginBottom:"0.5rem"},children:"Near Matches"}),e.jsx("ul",{className:"space-y-2",children:L.nearMatches.map((V,ee)=>e.jsx("li",{children:e.jsxs(n,{sx:{bgcolor:s.palette.mode==="dark"?s.palette.warning.dark+"20":s.palette.warning.light,p:1.5,borderRadius:1,display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[e.jsx("span",{className:"font-mono text-sm",style:{color:s.palette.text.primary},children:V.target}),e.jsxs(n,{sx:{fontSize:"0.75rem",bgcolor:s.palette.mode==="dark"?s.palette.warning.dark+"40":s.palette.warning.main,color:s.palette.mode==="dark"?s.palette.warning.light:s.palette.warning.contrastText,px:1,py:.5,borderRadius:.5},children:[Math.round(V.similarity*100),"% similar"]})]})},ee))})]})]})]}),e.jsx(n,{sx:{px:3,py:2,borderTop:1,borderColor:"divider",bgcolor:"action.hover"},children:e.jsx(U,{variant:"outlined",onClick:x,sx:{textTransform:"none"},children:"Close"})})]})})};return e.jsxs(n,{sx:{minHeight:"100vh",bgcolor:"background.default",color:"text.primary"},className:"min-h-screen",children:[e.jsx(n,{sx:{bgcolor:"background.paper",borderBottom:1,borderColor:"divider"},className:"border-b",children:e.jsx(n,{sx:{px:3,py:2},children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(n,{children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[e.jsx("h1",{className:"text-2xl font-bold",style:{color:s.palette.text.primary},children:"Refactor Console"}),!1,e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[ce==="checking"&&e.jsx(n,{sx:{width:12,height:12,borderRadius:"50%",bgcolor:"warning.main",animation:"pulse 2s infinite"},title:"Checking connection..."}),ce==="ok"&&e.jsx(n,{sx:{width:12,height:12,borderRadius:"50%",bgcolor:"success.main"},title:"API connection healthy"}),ce==="error"&&e.jsx(n,{sx:{width:12,height:12,borderRadius:"50%",bgcolor:"error.main",cursor:"help"},title:w||"API connection failed"})]})]}),e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1,mt:.5,flexWrap:"wrap"},children:[e.jsx("p",{style:{color:s.palette.text.secondary,margin:0},children:"Analyze your codebase for duplicates, usage patterns, and refactoring opportunities"}),e.jsx(we,{title:"Configure source and destination paths",children:e.jsx(Ae,{size:"small",onClick:()=>D(!E),sx:{color:E?s.palette.primary.main:s.palette.text.secondary,bgcolor:E?I(s.palette.primary.main,.1):"transparent"},children:e.jsx(xr,{className:"w-4 h-4"})})}),e.jsxs(n,{sx:{display:"flex",gap:.5,ml:1},children:[e.jsx(Q,{label:ae==="local"?"Local":"Remote",size:"small",color:ae==="remote"?"secondary":"default",sx:{height:20,fontSize:"0.7rem"}}),le&&e.jsx(Q,{label:`ðŸ“… ${le}`,size:"small",color:"primary",sx:{height:20,fontSize:"0.7rem"}})]})]}),ce==="error"&&w&&e.jsxs("p",{style:{fontSize:"0.75rem",marginTop:"0.25rem",color:s.palette.error.main},children:["âš ï¸ ",w]})]}),e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:2},children:[t&&e.jsxs(n,{sx:{textAlign:"right"},children:[e.jsx("div",{style:{fontSize:"0.875rem",color:s.palette.text.secondary},children:"Last scan"}),e.jsx("div",{style:{fontSize:"0.875rem",fontWeight:500,color:s.palette.text.primary},children:new Date(t.generatedAt).toLocaleString()})]}),e.jsxs(n,{sx:{display:"flex",gap:1},children:[e.jsx(U,{variant:"outlined",onClick:()=>xs(!0),startIcon:e.jsx(ts,{className:"w-4 h-4"}),sx:{textTransform:"none"},title:"View restore history",children:"History"}),e.jsxs(n,{sx:{display:"flex",flexDirection:"column",alignItems:"flex-end",gap:.5},children:[e.jsx(U,{variant:"contained",color:"primary",onClick:us,disabled:F==="running"||F==="starting"||ce!=="ok",startIcon:e.jsx(Pt,{className:`w-4 h-4 ${F==="running"||F==="starting"?"animate-spin":""}`}),sx:{textTransform:"none"},title:ce!=="ok"?"Please wait for API health check to complete":F==="running"||F==="starting"?"Phase 1 analysis in progress":"Phase 1: Discovery & Gap Analysis",children:"Phase 1 Analysis"}),(F==="running"||F==="starting")&&e.jsxs(n,{sx:{fontSize:"0.75rem",color:"text.secondary",width:"100%"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{children:re||"Processing..."}),e.jsxs("span",{children:[G,"%"]})]}),e.jsx(n,{sx:{width:"100%",bgcolor:"action.hover",borderRadius:"9999px",height:6},children:e.jsx(n,{sx:{bgcolor:s.palette.secondary.main,height:6,borderRadius:"9999px",transition:"width 0.3s"},style:{width:`${G}%`}})})]}),F==="error"&&oe&&e.jsxs(n,{sx:{fontSize:"0.75rem",color:"error.main",width:"100%"},children:["Error: ",oe]})]})]}),e.jsx(U,{variant:"contained",color:"primary",onClick:qe,disabled:r,startIcon:e.jsx(Pe,{className:`w-4 h-4 ${r?"animate-spin":""}`}),sx:{textTransform:"none",fontWeight:500,px:2,py:1},children:"Refresh"})]})]})})}),e.jsx(n,{sx:{px:3,pt:2},children:e.jsx(Ia,{refreshInterval:1e4})}),e.jsx(nr,{in:E,children:e.jsxs(K,{elevation:0,sx:{mx:3,mt:2,p:2,bgcolor:I(s.palette.primary.main,.05),border:1,borderColor:I(s.palette.primary.main,.2),borderRadius:1},children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2},children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Br,{className:"w-5 h-5",style:{color:s.palette.primary.main}}),e.jsx("h3",{style:{fontWeight:600,color:s.palette.text.primary,margin:0},children:"Path Configuration"}),e.jsx(Q,{label:"Persisted in localStorage",size:"small",sx:{fontSize:"0.7rem",height:20}})]}),e.jsxs(n,{sx:{display:"flex",gap:1},children:[e.jsx(U,{variant:"outlined",size:"small",onClick:Wt,sx:{textTransform:"none"},children:"Reset to Defaults"}),e.jsx(U,{variant:"contained",size:"small",onClick:Lt,disabled:ge,startIcon:ge?e.jsx(ke,{size:14}):e.jsx($e,{className:"w-4 h-4"}),sx:{textTransform:"none"},children:ge?"Validating...":"Save & Validate"})]})]}),e.jsxs(n,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",md:"repeat(2, 1fr)"},gap:2,mb:2},children:[e.jsxs(n,{children:[e.jsx("label",{style:{display:"block",fontSize:"0.875rem",fontWeight:500,color:s.palette.text.primary,marginBottom:"0.5rem"},children:"Source Type"}),e.jsxs(n,{sx:{display:"flex",gap:1},children:[e.jsx(U,{variant:ae==="local"?"contained":"outlined",size:"small",onClick:()=>Le("local"),sx:{flex:1,textTransform:"none"},children:"Local File System"}),e.jsx(U,{variant:ae==="remote"?"contained":"outlined",size:"small",onClick:()=>Le("remote"),sx:{flex:1,textTransform:"none"},color:"secondary",children:"Remote Samba"})]}),e.jsx(n,{sx:{fontSize:"0.75rem",color:"text.secondary",mt:.5},children:ae==="local"?"Using local production files":"Using remote Samba mount (192.168.1.221)"})]}),e.jsxs(n,{children:[e.jsx("label",{style:{display:"block",fontSize:"0.875rem",fontWeight:500,color:s.palette.text.primary,marginBottom:"0.5rem"},children:"Snapshot (MM-YYYY)"}),e.jsxs(Ie,{select:!0,fullWidth:!0,size:"small",value:le||"",onChange:x=>We(x.target.value||null),disabled:ls||Ee.length===0,helperText:ls?"Loading snapshots...":He?`Error: ${He}`:Ee.length===0?"No snapshots available":le?`Selected: ${((gs=Ee.find(x=>x.id===le))==null?void 0:gs.label)||le}`:"Select a snapshot to scan",error:!!He,SelectProps:{displayEmpty:!0},children:[e.jsx("option",{value:"",children:"Current / Latest"}),Ee.map(x=>e.jsxs("option",{value:x.id,children:[x.label," (",x.id,")"]},x.id))]})]})]}),e.jsxs(n,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",md:"repeat(3, 1fr)"},gap:2},children:[e.jsx(n,{children:e.jsx(Ie,{fullWidth:!0,size:"small",label:"Source Directory",placeholder:"/var/www/orthodoxmetrics/prod/refactor-src/",value:B.sourcePath,onChange:x=>_(p=>de(Y({},p),{sourcePath:x.target.value})),helperText:((ys=z.sourcePath)==null?void 0:ys.error)||((fs=z.sourcePath)!=null&&fs.isValid?z.sourcePath.exists?"âœ“ Valid & exists":"âš  Valid but does not exist":"Directory containing files to restore from"),error:((bs=z.sourcePath)==null?void 0:bs.isValid)===!1,InputProps:{sx:{fontFamily:"monospace",fontSize:"0.85rem"},endAdornment:((js=z.sourcePath)==null?void 0:js.isValid)&&e.jsx($e,{className:"w-4 h-4",style:{color:s.palette.success.main}})}})}),e.jsx(n,{children:e.jsx(Ie,{fullWidth:!0,size:"small",label:"Destination Directory",placeholder:"/var/www/orthodoxmetrics/prod/front-end/src/",value:B.destinationPath,onChange:x=>_(p=>de(Y({},p),{destinationPath:x.target.value})),helperText:((vs=z.destinationPath)==null?void 0:vs.error)||((ws=z.destinationPath)!=null&&ws.isValid?z.destinationPath.exists?"âœ“ Valid & exists":"âš  Valid but does not exist":"Directory where files will be restored to"),error:((ks=z.destinationPath)==null?void 0:ks.isValid)===!1,InputProps:{sx:{fontFamily:"monospace",fontSize:"0.85rem"},endAdornment:((Ss=z.destinationPath)==null?void 0:Ss.isValid)&&e.jsx($e,{className:"w-4 h-4",style:{color:s.palette.success.main}})}})}),e.jsx(n,{children:e.jsx(Ie,{fullWidth:!0,size:"small",label:"Backup Directory (for Gap Analysis)",placeholder:"/var/www/orthodoxmetrics/backup",value:B.backupPath||"",onChange:x=>_(p=>de(Y({},p),{backupPath:x.target.value})),helperText:((Ps=z.backupPath)==null?void 0:Ps.error)||((Ns=z.backupPath)!=null&&Ns.isValid?z.backupPath.exists?"âœ“ Valid & exists":"âš  Valid but does not exist":"September 2025 backup location for recovery"),error:((Cs=z.backupPath)==null?void 0:Cs.isValid)===!1,InputProps:{sx:{fontFamily:"monospace",fontSize:"0.85rem"},endAdornment:((Ts=z.backupPath)==null?void 0:Ts.isValid)&&e.jsx($e,{className:"w-4 h-4",style:{color:s.palette.success.main}})}})})]}),e.jsx(n,{sx:{mt:2,p:1.5,bgcolor:"background.paper",borderRadius:1,border:1,borderColor:"divider"},children:e.jsxs("p",{style:{fontSize:"0.75rem",color:s.palette.text.secondary,margin:0},children:[e.jsx("strong",{children:"Security:"})," All paths must be within ",e.jsx("code",{style:{backgroundColor:I(s.palette.primary.main,.1),padding:"0 4px",borderRadius:2},children:"/var/www/orthodoxmetrics/"}),". Path traversal and shell injection are blocked."]})})]})}),e.jsxs(n,{sx:{px:3,py:3},children:[i&&e.jsxs(n,{sx:{mb:3,bgcolor:I(s.palette.error.main,.1),border:1,borderColor:s.palette.error.main,borderRadius:1,p:2},children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Se,{style:{width:20,height:20,color:s.palette.error.main}}),e.jsx("h3",{style:{fontWeight:500,color:s.palette.error.main},children:"Error Loading Data"})]}),e.jsx("p",{style:{color:s.palette.error.main,marginTop:"0.25rem"},children:i}),e.jsx(U,{variant:"contained",color:"error",onClick:qe,sx:{mt:1.5,textTransform:"none"},children:"Try Again"})]}),r&&!t&&e.jsx(n,{sx:{display:"flex",alignItems:"center",justifyContent:"center",minHeight:400},children:e.jsxs(n,{sx:{textAlign:"center"},children:[e.jsx(Pe,{className:"w-8 h-8 animate-spin mx-auto mb-4",style:{color:s.palette.primary.main}}),e.jsx("h3",{style:{fontWeight:500,color:s.palette.text.primary,marginBottom:"0.5rem"},children:"Analyzing Codebase"}),e.jsx("p",{style:{color:s.palette.text.secondary},children:"This may take a few moments..."})]})}),t&&e.jsxs(n,{sx:{display:"flex",flexDirection:"column",gap:3},children:[e.jsx(ya,{searchQuery:o.searchQuery,onSearchChange:Dt,sortOptions:Ht,currentSort:d,onSortChange:Ot,filterState:o,onFilterChange:ms,isLoading:r,onRefresh:qe,onAnalyze:Ut,filteredCount:k,totalCount:t.summary.totalFiles+t.summary.totalDirs,compareWithBackup:P,onToggleRecoveryMode:Bt}),e.jsx(K,{elevation:0,sx:{bgcolor:"background.paper",border:1,borderColor:"divider",p:2},className:"rounded-lg",children:F==="done"&&M&&M.summary&&G===100?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{style:{fontSize:"1.5rem",fontWeight:700,color:s.palette.mode==="dark"?s.palette.secondary.light:s.palette.secondary.main},children:(Rs=(Is=M.summary)==null?void 0:Is.missingInTarget)!=null?Rs:0}),e.jsx("div",{className:"text-sm",style:{color:s.palette.text.secondary},children:"Restorable Files"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{style:{fontSize:"1.5rem",fontWeight:700,color:s.palette.mode==="dark"?s.palette.warning.light:s.palette.warning.main},children:(Ms=(Es=M.summary)==null?void 0:Es.modifiedInTarget)!=null?Ms:0}),e.jsx("div",{className:"text-sm",style:{color:s.palette.text.secondary},children:"Modified (Protected)"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{style:{fontSize:"1.5rem",fontWeight:700,color:s.palette.mode==="dark"?s.palette.success.light:s.palette.success.main},children:(zs=($s=M.summary)==null?void 0:$s.identical)!=null?zs:0}),e.jsx("div",{className:"text-sm",style:{color:s.palette.text.secondary},children:"Identical"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{style:{fontSize:"1.5rem",fontWeight:700,color:s.palette.mode==="dark"?s.palette.info.light:s.palette.info.main},children:(As=(Fs=M.documentation)==null?void 0:Fs.endpointsVerified)!=null?As:0}),e.jsx("div",{className:"text-sm",style:{color:s.palette.text.secondary},children:"Endpoints Verified"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{style:{fontSize:"1.5rem",fontWeight:700,color:s.palette.mode==="dark"?s.palette.error.light:s.palette.error.main},children:(Ls=(_s=M.documentation)==null?void 0:_s.endpointsMissing)!=null?Ls:0}),e.jsx("div",{className:"text-sm",style:{color:s.palette.text.secondary},children:"Endpoints Missing"})]})]}),((Hs=(Ws=M.documentation)==null?void 0:Ws.endpointsFound)!=null?Hs:0)>0&&e.jsxs("div",{className:"text-center text-sm",style:{color:s.palette.text.secondary},children:["Found ",(Os=(Ds=M.documentation)==null?void 0:Ds.endpointsFound)!=null?Os:0," endpoints in documentation"]})]}):F==="running"||F==="starting"?e.jsx(n,{sx:{textAlign:"center",py:4},children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2",style:{borderColor:s.palette.secondary.main}}),e.jsx("div",{className:"text-lg font-medium",style:{color:s.palette.text.primary},children:re||"Processing..."}),e.jsxs("div",{className:"w-full max-w-md",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm",style:{color:s.palette.text.secondary},children:"Progress"}),e.jsxs("span",{className:"text-sm font-medium",style:{color:s.palette.text.primary},children:[G,"%"]})]}),e.jsx(n,{sx:{width:"100%",bgcolor:"action.hover",borderRadius:"9999px",height:8},children:e.jsx(n,{sx:{bgcolor:s.palette.secondary.main,height:8,borderRadius:"9999px",transition:"width 0.3s"},style:{width:`${G}%`}})})]})]})}):t!=null&&t.gapAnalysisEnabled?e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{style:{fontSize:"1.5rem",fontWeight:700,color:s.palette.mode==="dark"?s.palette.secondary.light:s.palette.secondary.main},children:t.summary.missingInProd||0}),e.jsx("div",{className:"text-sm",style:{color:s.palette.text.secondary},children:"Missing in Prod"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{style:{fontSize:"1.5rem",fontWeight:700,color:s.palette.mode==="dark"?s.palette.warning.light:s.palette.warning.main},children:t.summary.modifiedSinceBackup||0}),e.jsx("div",{className:"text-sm",style:{color:s.palette.text.secondary},children:"Modified"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{style:{fontSize:"1.5rem",fontWeight:700,color:s.palette.mode==="dark"?s.palette.success.light:s.palette.success.main},children:t.summary.newFiles||0}),e.jsx("div",{className:"text-sm",style:{color:s.palette.text.secondary},children:"New Files"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{style:{fontSize:"1.5rem",fontWeight:700,color:s.palette.mode==="dark"?s.palette.success.light:s.palette.success.main},children:t.summary.likelyInProd}),e.jsx("div",{className:"text-sm",style:{color:s.palette.text.secondary},children:"Production Ready"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{style:{fontSize:"1.5rem",fontWeight:700,color:s.palette.mode==="dark"?s.palette.error.light:s.palette.error.main},children:t.summary.legacyOrDupes}),e.jsx("div",{className:"text-sm",style:{color:s.palette.text.secondary},children:"Legacy/Duplicates"})]})]}):e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{style:{fontSize:"1.5rem",fontWeight:700,color:s.palette.mode==="dark"?s.palette.success.light:s.palette.success.main},children:t.summary.likelyInProd}),e.jsx("div",{className:"text-sm",style:{color:s.palette.text.secondary},children:"Production Ready"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{style:{fontSize:"1.5rem",fontWeight:700,color:s.palette.mode==="dark"?s.palette.warning.light:s.palette.warning.main},children:t.summary.highRisk}),e.jsx("div",{className:"text-sm",style:{color:s.palette.text.secondary},children:"High Risk"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{style:{fontSize:"1.5rem",fontWeight:700,color:s.palette.mode==="dark"?s.palette.warning.light:s.palette.warning.main},children:t.summary.inDevelopment}),e.jsx("div",{className:"text-sm",style:{color:s.palette.text.secondary},children:"In Development"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{style:{fontSize:"1.5rem",fontWeight:700,color:s.palette.mode==="dark"?s.palette.error.light:s.palette.error.main},children:t.summary.legacyOrDupes}),e.jsx("div",{className:"text-sm",style:{color:s.palette.text.secondary},children:"Legacy/Duplicates"})]})]})}),F==="done"&&G===100&&M&&M.summary&&Array.isArray(M.restorableFiles)&&M.restorableFiles.length>0&&e.jsxs(K,{elevation:0,sx:{bgcolor:"background.paper",border:1,borderColor:"divider",p:2},className:"rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold flex items-center gap-2",style:{color:s.palette.text.primary},children:[e.jsx(ze,{className:"w-5 h-5",style:{color:s.palette.secondary.main}}),"Restorable Bundles (",N.size>0?N.size:(Us=(Bs=M.restorableFiles)==null?void 0:Bs.length)!=null?Us:0," ",N.size>0?"bundles":"files",")"]}),e.jsx(U,{variant:"contained",color:"secondary",onClick:()=>{if(F!=="done"||!M||!M.summary){W.warning("Phase 1 analysis must be completed before exporting");return}try{const x=JSON.stringify(M,null,2),p=new Blob([x],{type:"application/json"}),L=URL.createObjectURL(p),V=document.createElement("a");V.href=L,V.download=`phase1-report-${new Date().toISOString().split("T")[0]}.json`,V.click(),URL.revokeObjectURL(L),W.success("Report exported successfully")}catch(x){console.error("Export error:",x),W.error("Failed to export report")}},sx:{textTransform:"none"},children:"Export JSON Report"})]}),N.size>0?e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:Array.from(N.values()).map((x,p)=>e.jsxs(n,{sx:{p:2,bgcolor:s.palette.mode==="dark"?s.palette.secondary.dark+"20":s.palette.secondary.light,border:1,borderColor:s.palette.mode==="dark"?s.palette.secondary.dark:s.palette.secondary.main,borderRadius:1},children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-mono text-sm font-semibold mb-1",style:{color:s.palette.text.primary},children:x.rootFile.relPath}),e.jsxs("div",{className:"text-xs space-y-1",style:{color:s.palette.text.secondary},children:[e.jsxs("div",{children:[x.files.length," files â€¢ ",x.components.length," components â€¢ ",x.hooks.length," hooks â€¢ ",x.services.length," services"]}),x.requiredEndpoints.length>0&&e.jsxs("div",{children:[x.requiredEndpoints.filter(L=>L.existsInServer).length," / ",x.requiredEndpoints.length," endpoints verified"]})]})]}),e.jsx("button",{onClick:()=>{var L,V;return qt({file:x.rootFile,imports:x.missingImports,endpoints:x.requiredEndpoints,integrationPoints:(L=M.integrationPoints)!=null&&L.menuItems||(V=M.integrationPoints)!=null&&V.router?[M.integrationPoints.menuItems,M.integrationPoints.router].filter(Boolean):[]})},style:{padding:"0.5rem",color:s.palette.secondary.main,background:"none",border:"none",cursor:"pointer",borderRadius:"0.25rem"},onMouseEnter:L=>{L.currentTarget.style.backgroundColor=s.palette.mode==="dark"?s.palette.secondary.dark+"30":s.palette.secondary.light},onMouseLeave:L=>{L.currentTarget.style.backgroundColor="transparent"},title:"View requirements",children:e.jsx(Tt,{className:"w-4 h-4"})})]}),e.jsx(wa,{bundle:x,onRestoreComplete:()=>{us(),y()}})]},p))}):e.jsxs(n,{sx:{textAlign:"center",py:4,color:"text.secondary"},children:[e.jsx("p",{children:"No bundles calculated yet. Bundles are created for page files."}),e.jsxs("p",{style:{fontSize:"0.875rem",marginTop:"0.5rem"},children:["Individual files: ",(Vs=(qs=M.restorableFiles)==null?void 0:qs.length)!=null?Vs:0]})]})]}),e.jsxs(n,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",lg:"repeat(4, 1fr)"},gap:3},children:[e.jsx(n,{sx:{gridColumn:{lg:"span 1"}},children:e.jsx(ga,{scanData:t,filterState:o,onFilterChange:ms})}),e.jsx(n,{sx:{gridColumn:{lg:"span 3"}},children:e.jsx(Mt,{treeItems:v,expandedPaths:$,onToggleExpanded:Jt,onNodeAction:Vt,isDark:a==="dark"})})]})]})]}),e.jsx(Xt,{onClose:()=>q(null)}),(C==null?void 0:C.type)==="requirementPreview"&&e.jsx(fa,{fileAnalysis:C.data.fileAnalysis,integrationPoints:C.data.integrationPoints,onClose:()=>q(null)}),e.jsx(ka,{open:Ft,onClose:Qt,onConfirmRestore:Zt,preview:(je==null?void 0:je.preview)||null,dependencies:(je==null?void 0:je.dependencies)||null,isRestoring:At}),e.jsx(Sa,{open:_t,onClose:()=>xs(!1)})]})};export{Xa as default};
//# sourceMappingURL=RefactorConsole-BgHudXwP.js.map
