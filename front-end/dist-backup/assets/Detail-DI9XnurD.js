var m=(h,I,u)=>new Promise((P,C)=>{var _=o=>{try{n(u.next(o))}catch(f){C(f)}},w=o=>{try{n(u.throw(o))}catch(f){C(f)}},n=o=>o.done?P(o.value):Promise.resolve(o.value).then(_,w);n((u=u.apply(h,I)).next())});import{c as W,aJ as Z,l as ee,j as e,B as t,C as ne,a0 as re,S as T,e as G,aK as ie,d as i,T as D,I as S,M as te,f as j,D as v,V as E,R as k,h as se,U as ae}from"./index-Dgvcv9SG.js";import{B as oe}from"./Breadcrumb-pN-bEM50.js";import{P as le}from"./PageContainer-CE1CdJ_Q.js";import{u as ce,I as de}from"./index-D29NsYg0.js";import{r as p}from"./vendor-Dkfty7_r.js";import{LANGUAGE_LABELS as xe}from"./invoicePDFGenerator-kdHD_CX2.js";import{I as he}from"./IconEdit-D5JDMEqw.js";import{I as ue}from"./IconChevronDown-f9fpkikX.js";import{I as me}from"./IconDownload-CXb9O49-.js";import{L as g}from"./ListItemIcon-BQ94Lp15.js";import{L as y}from"./ListItemText-HVc0yZD9.js";import{I as je}from"./IconLanguage-DZortVnq.js";import{I as pe}from"./IconMail-BIq2zd8G.js";import{f as B}from"./index-3N2x77cv.js";import{p as U}from"./index-BJCbXUy8.js";import{T as ge,a as ye,b as fe,c as O,d as ve}from"./TableRow-GBYhOGTG.js";import{T as a}from"./TableCell-jHKItVVU.js";import{B as be}from"./BlankCard-BkWD9FHm.js";import"./Breadcrumbs-CsbCfS7M.js";import"./Link-CZmOux0z.js";import"./Helmet-B7mFktpd.js";import"./index-Ch3W3BYh.js";import"./typeof-QjJsDpFa.js";import"./index-Dtz6yYVN.js";/**
 * @license @tabler/icons-react v3.36.1 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ie=[["path",{d:"M7 15h-3a1 1 0 0 1 -1 -1v-8a1 1 0 0 1 1 -1h12a1 1 0 0 1 1 1v3",key:"svg-0"}],["path",{d:"M7 10a1 1 0 0 1 1 -1h12a1 1 0 0 1 1 1v8a1 1 0 0 1 -1 1h-12a1 1 0 0 1 -1 -1l0 -8",key:"svg-1"}],["path",{d:"M12 14a2 2 0 1 0 4 0a2 2 0 0 0 -4 0",key:"svg-2"}]],Ce=W("outline","cash","Cash",Ie);/**
 * @license @tabler/icons-react v3.36.1 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const De=[["path",{d:"M14 3v4a1 1 0 0 0 1 1h4",key:"svg-0"}],["path",{d:"M5 12v-7a2 2 0 0 1 2 -2h7l5 5v4",key:"svg-1"}],["path",{d:"M5 18h1.5a1.5 1.5 0 0 0 0 -3h-1.5v6",key:"svg-2"}],["path",{d:"M17 18h2",key:"svg-3"}],["path",{d:"M20 15h-3v6",key:"svg-4"}],["path",{d:"M11 15v6h1a2 2 0 0 0 2 -2v-2a2 2 0 0 0 -2 -2h-1",key:"svg-5"}]],b=W("outline","file-type-pdf","FileTypePdf",De),ke=()=>{const{id:h}=Z(),I=ee(),{getInvoiceById:u,markInvoiceAsPaid:P,generateInvoicePDF:C,downloadClientSidePDF:_,sendInvoiceEmail:w}=ce(),[n,o]=p.useState(null),[f,L]=p.useState(!0),[N,F]=p.useState(null),[l,c]=p.useState(null),[A,M]=p.useState(null);p.useEffect(()=>{h&&R()},[h]);const R=()=>m(void 0,null,function*(){try{L(!0),F(null),console.log("Fetching invoice with ID:",h);const r=yield u(Number(h));if(console.log("Invoice data received:",r),!r){F("Invoice not found");return}o(r)}catch(r){console.error("Error fetching invoice:",r),F("Failed to load invoice: "+(r instanceof Error?r.message:"Unknown error"))}finally{L(!1)}}),J=()=>m(void 0,null,function*(){if(n)try{c("mark-paid"),yield P(n.id),yield R()}catch(r){console.error("Error marking invoice as paid:",r)}finally{c(null)}}),H=()=>m(void 0,null,function*(){if(n)try{c("generate-pdf"),console.log("Generating server-side PDF for invoice:",n.id);const r=yield C(n.id);if(r){const s=window.URL.createObjectURL(r),x=document.createElement("a");x.href=s,x.download=`invoice-${n.invoice_number}.pdf`,document.body.appendChild(x),x.click(),window.URL.revokeObjectURL(s),document.body.removeChild(x),console.log("Server-side PDF download completed")}else console.log("No PDF blob returned, falling back to client-side generation"),yield d()}catch(r){console.error("Error generating PDF:",r),console.log("Server-side PDF failed, falling back to client-side generation"),yield d()}finally{c(null)}}),d=r=>m(void 0,null,function*(){if(n)try{c("generate-client-pdf"),console.log("Generating client-side PDF for language:",r||n.language),yield _(n,{language:r||n.language,includeWatermark:n.status==="draft"}),console.log("PDF generation completed successfully")}catch(s){console.error("Error generating client-side PDF:",s),alert("Failed to generate PDF: "+(s instanceof Error?s.message:"Unknown error"))}finally{c(null),M(null)}}),q=r=>{M(r.currentTarget)},K=()=>{M(null)},Q=()=>m(void 0,null,function*(){if(!n)return;const r=prompt("Enter email address:");if(r)try{c("send-email"),yield w(n.id,r),alert("Invoice sent successfully!")}catch(s){console.error("Error sending email:",s),alert("Failed to send email")}finally{c(null)}}),V=r=>{switch(r){case"paid":return"success";case"pending":return"warning";case"overdue":return"error";case"draft":return"default";case"cancelled":return"error";default:return"default"}},X=r=>r.charAt(0).toUpperCase()+r.slice(1);return f?e.jsx(t,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:e.jsx(ne,{})}):N||!n?e.jsx(t,{children:e.jsx(re,{severity:"error",children:N||"Invoice not found"})}):e.jsxs(t,{children:[e.jsxs(T,{direction:"row",justifyContent:"space-between",alignItems:"center",mb:3,children:[e.jsxs(t,{children:[e.jsx(G,{startIcon:e.jsx(ie,{}),onClick:()=>I("/apps/invoice/list"),sx:{mb:1},children:"Back to Invoices"}),e.jsxs(i,{variant:"h4",children:["Invoice ",n.invoice_number]})]}),e.jsxs(T,{direction:"row",spacing:1,children:[e.jsx(D,{title:"Edit Invoice",children:e.jsx(S,{color:"primary",onClick:()=>I(`/apps/invoice/edit/${n.id}`),children:e.jsx(he,{})})}),e.jsx(D,{title:"Download PDF",children:e.jsx(G,{variant:"outlined",startIcon:e.jsx(me,{}),endIcon:e.jsx(ue,{}),onClick:q,disabled:l==null?void 0:l.includes("pdf"),size:"small",children:l!=null&&l.includes("pdf")?"Generating...":"PDF"})}),e.jsxs(te,{anchorEl:A,open:!!A,onClose:K,children:[e.jsxs(j,{onClick:H,children:[e.jsx(g,{children:e.jsx(b,{size:"20"})}),e.jsx(y,{primary:"Server PDF (Official)"})]}),e.jsx(v,{}),e.jsxs(j,{onClick:()=>d(),children:[e.jsx(g,{children:e.jsx(je,{size:"20"})}),e.jsx(y,{primary:`${xe[n.language]||"Default"} Template`,secondary:"Uses language-specific template"})]}),e.jsxs(j,{onClick:()=>d("en"),children:[e.jsx(g,{children:e.jsx(b,{size:"20"})}),e.jsx(y,{primary:"English Template"})]}),e.jsxs(j,{onClick:()=>d("ru"),children:[e.jsx(g,{children:e.jsx(b,{size:"20"})}),e.jsx(y,{primary:"Russian Template"})]}),e.jsxs(j,{onClick:()=>d("ro"),children:[e.jsx(g,{children:e.jsx(b,{size:"20"})}),e.jsx(y,{primary:"Romanian Template"})]}),e.jsxs(j,{onClick:()=>d("gr"),children:[e.jsx(g,{children:e.jsx(b,{size:"20"})}),e.jsx(y,{primary:"Greek Template"})]})]}),e.jsx(D,{title:"Send Email",children:e.jsx(S,{color:"primary",onClick:Q,disabled:l==="send-email",children:e.jsx(pe,{})})}),n.status!=="paid"&&e.jsx(D,{title:"Mark as Paid",children:e.jsx(S,{color:"success",onClick:J,disabled:l==="mark-paid",children:e.jsx(Ce,{})})})]})]}),e.jsxs(t,{sx:{display:"flex",gap:3,mb:3,flexDirection:{xs:"column",md:"row"}},children:[e.jsx(t,{sx:{flex:2},children:e.jsx(E,{children:e.jsxs(k,{children:[e.jsx(i,{variant:"h6",gutterBottom:!0,children:"Invoice Information"}),e.jsx(v,{sx:{mb:2}}),e.jsxs(t,{sx:{display:"grid",gap:2,gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))"},children:[e.jsxs(t,{children:[e.jsx(i,{variant:"body2",color:"text.secondary",children:"Invoice Number"}),e.jsx(i,{variant:"body1",fontWeight:"bold",children:n.invoice_number})]}),e.jsxs(t,{children:[e.jsx(i,{variant:"body2",color:"text.secondary",children:"Status"}),e.jsx(se,{label:X(n.status),color:V(n.status),size:"small"})]}),e.jsxs(t,{children:[e.jsx(i,{variant:"body2",color:"text.secondary",children:"Issue Date"}),e.jsx(i,{variant:"body1",children:B(U(n.issue_date),"MMM dd, yyyy")})]}),e.jsxs(t,{children:[e.jsx(i,{variant:"body2",color:"text.secondary",children:"Due Date"}),e.jsx(i,{variant:"body1",children:B(U(n.due_date),"MMM dd, yyyy")})]}),e.jsxs(t,{children:[e.jsx(i,{variant:"body2",color:"text.secondary",children:"Currency"}),e.jsx(i,{variant:"body1",children:n.currency})]}),e.jsxs(t,{children:[e.jsx(i,{variant:"body2",color:"text.secondary",children:"Language"}),e.jsx(i,{variant:"body1",children:n.language.toUpperCase()})]}),n.paid_at&&e.jsxs(t,{children:[e.jsx(i,{variant:"body2",color:"text.secondary",children:"Paid Date"}),e.jsx(i,{variant:"body1",children:B(U(n.paid_at),"MMM dd, yyyy")})]})]}),n.internal_notes&&e.jsxs(t,{sx:{mt:2},children:[e.jsx(i,{variant:"body2",color:"text.secondary",children:"Internal Notes"}),e.jsx(i,{variant:"body1",children:n.internal_notes})]})]})})}),e.jsx(t,{sx:{flex:1},children:e.jsx(E,{children:e.jsxs(k,{children:[e.jsx(i,{variant:"h6",gutterBottom:!0,children:"Totals"}),e.jsx(v,{sx:{mb:2}}),e.jsxs(T,{spacing:2,children:[e.jsxs(t,{display:"flex",justifyContent:"space-between",children:[e.jsx(i,{children:"Subtotal:"}),e.jsxs(i,{fontWeight:"bold",children:["$",(n.total_amount-(n.tax_amount||0)).toFixed(2)]})]}),n.tax_amount&&n.tax_amount>0&&e.jsxs(t,{display:"flex",justifyContent:"space-between",children:[e.jsx(i,{children:"Tax:"}),e.jsxs(i,{fontWeight:"bold",children:["$",n.tax_amount.toFixed(2)]})]}),e.jsx(v,{}),e.jsxs(t,{display:"flex",justifyContent:"space-between",children:[e.jsx(i,{variant:"h6",children:"Total:"}),e.jsxs(i,{variant:"h6",fontWeight:"bold",children:["$",n.total_amount.toFixed(2)]})]})]})]})})})]}),e.jsx(E,{children:e.jsxs(k,{children:[e.jsx(i,{variant:"h6",gutterBottom:!0,children:"Invoice Items"}),e.jsx(v,{sx:{mb:2}}),e.jsx(ge,{component:ae,variant:"outlined",children:e.jsxs(ye,{children:[e.jsx(fe,{children:e.jsxs(O,{children:[e.jsx(a,{children:"Item"}),e.jsx(a,{children:"Description"}),e.jsx(a,{align:"right",children:"Quantity"}),e.jsx(a,{align:"right",children:"Unit Price"}),e.jsx(a,{align:"right",children:"Total"})]})}),e.jsx(ve,{children:n.items&&n.items.map((r,s)=>{var $,z;const x=typeof r.name_multilang=="string"?JSON.parse(r.name_multilang)[n.language]||JSON.parse(r.name_multilang).en||"Unnamed Item":(($=r.name_multilang)==null?void 0:$[n.language])||"Unnamed Item",Y=typeof r.description_multilang=="string"?JSON.parse(r.description_multilang)[n.language]||JSON.parse(r.description_multilang).en||"":((z=r.description_multilang)==null?void 0:z[n.language])||"";return e.jsxs(O,{children:[e.jsxs(a,{children:[e.jsx(i,{variant:"body1",fontWeight:"medium",children:x}),r.item_code&&e.jsxs(i,{variant:"body2",color:"text.secondary",children:["Code: ",r.item_code]})]}),e.jsx(a,{children:e.jsx(i,{variant:"body2",children:Y})}),e.jsx(a,{align:"right",children:e.jsxs(i,{variant:"body2",children:[r.quantity," ",r.unit_type]})}),e.jsx(a,{align:"right",children:e.jsxs(i,{variant:"body2",children:["$",r.unit_price.toFixed(2)]})}),e.jsx(a,{align:"right",children:e.jsxs(i,{variant:"body1",fontWeight:"medium",children:["$",r.line_total.toFixed(2)]})})]},s)})})]})})]})})]})},Pe=()=>e.jsx(ke,{}),_e=[{to:"/",title:"Home"},{title:"Invoice Details"}],Ze=()=>e.jsx(de,{children:e.jsxs(le,{title:"Invoice Detail",description:"this is Invoice Detail",children:[e.jsx(oe,{title:"Invoice Detail",items:_e}),e.jsx(be,{children:e.jsx(k,{children:e.jsx(Pe,{})})})]})});export{Ze as default};
//# sourceMappingURL=Detail-DI9XnurD.js.map
