{"version":3,"file":"axiosInstance-ybWCckox.js","sources":["../../src/shared/lib/axiosInstance.ts"],"sourcesContent":["/**\n * Shared Axios Instance for OrthodMetrics API\n * Provides unified error handling, baseURL, and interceptors\n */\n\nimport axios, { AxiosInstance, AxiosRequestConfig, AxiosResponse } from 'axios';\nimport { API_CONFIG } from '@/config/api.config';\n\n// ===== API CLIENT CONFIGURATION =====\n// Use centralized configuration\nconst API_BASE_URL = API_CONFIG.BASE_URL;\nconst API_TIMEOUT = API_CONFIG.TIMEOUT;\n\nclass ApiClient {\n  private instance: AxiosInstance;\n\n  constructor() {\n    console.log(`üîß Initializing API Client with baseURL: \"${API_BASE_URL}\"`);\n    console.log(`üåê Environment: DEV=${import.meta.env.DEV}, PROD=${import.meta.env.PROD}`);\n\n    this.instance = axios.create({\n      baseURL: API_BASE_URL,\n      timeout: API_TIMEOUT,\n      withCredentials: true, // Session-based authentication\n      headers: {\n        'Content-Type': 'application/json',\n      },\n    });\n\n    this.setupInterceptors();\n  }\n\n  private setupInterceptors(): void {\n    // Request interceptor\n    this.instance.interceptors.request.use(\n      (config) => {\n        // Add /api prefix if not already present\n        if (config.url && !config.url.startsWith('http') && !config.url.startsWith('/api')) {\n          config.url = `/api${config.url}`;\n        }\n\n        const fullUrl = config.baseURL ? `${config.baseURL}${config.url}` : config.url;\n        console.log(`üåê API Request: ${config.method?.toUpperCase()} ${fullUrl}`);\n        console.log(`üîß BaseURL: \"${config.baseURL || 'none'}\", URL: \"${config.url}\"`);\n        return config;\n      },\n      (error) => {\n        console.error('‚ùå Request Error:', error);\n        return Promise.reject(error);\n      }\n    );\n\n    // Response interceptor\n    this.instance.interceptors.response.use(\n      (response: AxiosResponse) => {\n        console.log(`‚úÖ API Response: ${response.status} ${response.config.url}`);\n        return response;\n      },\n      (error) => {\n        console.error('‚ùå Response Error:', error.response?.status, error.response?.data);\n\n        // Handle specific error cases\n        if (error.response?.status === 401) {\n          // Only redirect if not already on homepage to prevent infinite loops\n          if (!window.location.pathname.includes('/frontend-pages/homepage')) {\n            localStorage.removeItem('auth_user');\n            window.location.href = '/frontend-pages/homepage';\n          }\n        }\n\n        // Create enhanced error object with HTTP details preserved\n        const enhancedError = new Error(error.response?.data?.message || error.message || 'Request failed');\n        (enhancedError as any).status = error.response?.status;\n        (enhancedError as any).code = error.code;\n        (enhancedError as any).isNetworkError = !error.response;\n        (enhancedError as any).originalError = error;\n\n        throw enhancedError;\n      }\n    );\n  }\n\n  // ===== CORE HTTP METHODS =====\n  async request<T>(config: AxiosRequestConfig): Promise<T> {\n    try {\n      const response = await this.instance.request<T>(config);\n      return response.data;\n    } catch (error) {\n      throw error;\n    }\n  }\n\n  async get<T>(url: string, config?: AxiosRequestConfig): Promise<T> {\n    return this.request<T>({ ...config, method: 'GET', url });\n  }\n\n  async post<T>(url: string, data?: any, config?: AxiosRequestConfig): Promise<T> {\n    return this.request<T>({ ...config, method: 'POST', url, data });\n  }\n\n  async put<T>(url: string, data?: any, config?: AxiosRequestConfig): Promise<T> {\n    return this.request<T>({ ...config, method: 'PUT', url, data });\n  }\n\n  async patch<T>(url: string, data?: any, config?: AxiosRequestConfig): Promise<T> {\n    return this.request<T>({ ...config, method: 'PATCH', url, data });\n  }\n\n  async delete<T>(url: string, config?: AxiosRequestConfig): Promise<T> {\n    return this.request<T>({ ...config, method: 'DELETE', url });\n  }\n\n  // ===== FILE UPLOAD METHOD =====\n  async uploadFile<T>(\n    url: string,\n    file: File,\n    additionalData?: Record<string, any>,\n    onProgress?: (progress: number) => void\n  ): Promise<T> {\n    const formData = new FormData();\n    formData.append('file', file);\n\n    if (additionalData) {\n      Object.entries(additionalData).forEach(([key, value]) => {\n        formData.append(key, value);\n      });\n    }\n\n    return this.request<T>({\n      method: 'POST',\n      url,\n      data: formData,\n      headers: {\n        'Content-Type': 'multipart/form-data',\n      },\n      onUploadProgress: (progressEvent) => {\n        if (onProgress && progressEvent.total) {\n          const progress = Math.round((progressEvent.loaded * 100) / progressEvent.total);\n          onProgress(progress);\n        }\n      },\n    });\n  }\n\n  // ===== UTILITY METHODS =====\n  buildQueryString(params?: Record<string, any>): string {\n    if (!params) return '';\n\n    const searchParams = new URLSearchParams();\n    Object.entries(params).forEach(([key, value]) => {\n      if (value !== undefined && value !== null) {\n        searchParams.append(key, String(value));\n      }\n    });\n\n    const queryString = searchParams.toString();\n    return queryString ? `?${queryString}` : '';\n  }\n}\n\n// Create and export the shared API client instance\nexport const apiClient = new ApiClient();\nexport const axiosInstance = apiClient; // Alias for backward compatibility\n\nexport default apiClient; "],"names":["API_BASE_URL","API_CONFIG","API_TIMEOUT","ApiClient","__publicField","axios","config","fullUrl","_a","error","response","_b","_c","enhancedError","_e","_d","_f","__async","url","__spreadProps","__spreadValues","data","file","additionalData","onProgress","formData","key","value","progressEvent","progress","params","searchParams","queryString","apiClient"],"mappings":"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"}