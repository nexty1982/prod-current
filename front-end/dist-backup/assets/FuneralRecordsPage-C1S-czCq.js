var N=(a,b,y)=>new Promise((j,_)=>{var o=i=>{try{g(y.next(i))}catch(C){_(C)}},T=i=>{try{g(y.throw(i))}catch(C){_(C)}},g=i=>i.done?j(i.value):Promise.resolve(i.value).then(o,T);g((y=y.apply(a,b)).next())});import{k as ne,b4 as oe,l as ce,j as e,B as H,C as G,U as $,S as E,h as B,P as le,T as w,I as v,aH as ie,e as p,a0 as he,d as de}from"./index-Dgvcv9SG.js";import{r as c}from"./vendor-Dkfty7_r.js";import{f as M}from"./formatDate-DhH_eSW_.js";import{T as ue,a as F}from"./Tabs-DvDGzSBw.js";import{I as xe}from"./InputAdornment-fA5QdII4.js";import{I as me}from"./IconSearch-Yybor66O.js";import{I as fe}from"./IconReport-AEK9iizH.js";import{T as pe,a as je,b as ge,c as k,d as be}from"./TableRow-GBYhOGTG.js";import{T as r}from"./TableCell-jHKItVVU.js";import{I as ye}from"./IconEye-DalVfBSb.js";import{I as _e}from"./IconEdit-D5JDMEqw.js";import{I as Ce}from"./IconTrash-C3ez3ykA.js";import{T as Se}from"./TablePagination-GuzffQrc.js";import"./KeyboardArrowRight-iVZ9lhbl.js";import"./LastPage-BXUC_f7y.js";import"./Toolbar-DfqyUE-7.js";const Ue=()=>{const{user:a}=ne(),[b,y]=oe(),j=ce(),_=b.get("church_id"),[o,T]=c.useState(_?parseInt(_):(a==null?void 0:a.church_id)||null),[g,i]=c.useState([]),[C,S]=c.useState(!0),[L,l]=c.useState(null),[z,I]=c.useState(0),[D,Q]=c.useState(10),[W,q]=c.useState(0),[R,A]=c.useState(""),[h,O]=c.useState("death_date"),[x,U]=c.useState("desc");c.useEffect(()=>{const s=b.get("church_id");if(s){const t=parseInt(s);isNaN(t)||T(t)}else a!=null&&a.church_id&&T(a.church_id)},[b,a==null?void 0:a.church_id]),c.useEffect(()=>{a&&N(void 0,null,function*(){var m,d;let t=o;if(!t&&((a==null?void 0:a.role)==="super_admin"||(a==null?void 0:a.role)==="admin"))try{const n=yield fetch("/api/my/churches",{credentials:"include",headers:{"Content-Type":"application/json"}});if(n.ok){const u=yield n.json(),f=((m=u.data)==null?void 0:m.churches)||u.churches||[];if(f.length>0){if(t=f[0].id,!_){T(t),y({church_id:t.toString()},{replace:!0});return}}else{(a==null?void 0:a.role)==="super_admin"?l("No churches found in the system. Please create a church first."):l("No church available. Please ensure you have access to at least one church."),S(!1);return}}else{(a==null?void 0:a.role)==="super_admin"?l("Unable to load churches. Please try again or select a church manually."):l("No church available. Please ensure you have access to at least one church."),S(!1);return}}catch(n){console.error("Error fetching churches:",n),(a==null?void 0:a.role)==="super_admin"?l("Unable to load churches. Please try again or select a church manually."):l("No church available. Please ensure you have access to at least one church."),S(!1);return}if(!t){(a==null?void 0:a.role)!=="super_admin"?l("No church available. Please ensure you have access to at least one church."):l("Select a church to view records. Use the church_id query parameter or ensure churches are available."),S(!1);return}try{S(!0),l(null);const n=new URLSearchParams({page:(z+1).toString(),limit:D.toString()});R.trim()&&n.append("search",R.trim());const u=yield fetch(`/api/funeral-records?${n.toString()}`,{credentials:"include",headers:{"Content-Type":"application/json"}});if(!u.ok)throw new Error(`Failed to load records: ${u.status} ${u.statusText}`);const f=yield u.json();i(f.records||[]),q(((d=f.pagination)==null?void 0:d.total)||f.totalRecords||0)}catch(n){console.error("Error fetching funeral records:",n),l(n.message||"Failed to load funeral records")}finally{S(!1)}})},[a,o,z,D,R]);const J=(s,t)=>{I(t)},K=s=>{Q(parseInt(s.target.value,10)),I(0)},X=s=>{A(s.target.value),I(0)},Y=(s,t)=>{const d=["baptism","marriage","funeral"][t],n=new URLSearchParams(b);n.set("church_id",(o==null?void 0:o.toString())||""),j(`/apps/records/${d}?${n.toString()}`)},P=s=>{h===s?U(x==="asc"?"desc":"asc"):(O(s),U("asc"))},Z=s=>{j(`/apps/records/funeral/${s}?church_id=${o}`)},ee=s=>{j(`/apps/records/funeral/edit/${s}?church_id=${o}`)},se=s=>N(void 0,null,function*(){confirm("Are you sure you want to delete this record?")&&console.log("Delete record:",s)}),ae=()=>{I(0),A(""),window.location.reload()},V=[...g].sort((s,t)=>{const m=s[h]||"",d=t[h]||"";return x==="asc"?m>d?1:-1:m<d?1:-1});return C&&g.length===0?e.jsx(H,{sx:{p:3,display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px"},children:e.jsx(G,{})}):e.jsxs(H,{sx:{p:3},children:[e.jsx($,{sx:{mb:2},children:e.jsxs(ue,{value:2,onChange:Y,sx:{borderBottom:1,borderColor:"divider"},children:[e.jsx(F,{label:"Baptism Records"}),e.jsx(F,{label:"Marriage Records"}),e.jsx(F,{label:"Funeral Records"})]})}),e.jsxs(E,{direction:"row",spacing:2,sx:{mb:2},children:[e.jsx(B,{label:`Total: ${W}`,color:"primary",variant:"outlined"}),e.jsx(B,{label:`Showing: ${g.length}`,color:"default",variant:"outlined"}),o&&e.jsx(B,{label:`Church ID: ${o}`,color:"secondary",variant:"outlined"})]}),e.jsx($,{sx:{p:2,mb:2},children:e.jsxs(E,{direction:"row",spacing:2,alignItems:"center",children:[e.jsx(le,{placeholder:"Search records...",value:R,onChange:X,size:"small",sx:{flexGrow:1},InputProps:{startAdornment:e.jsx(xe,{position:"start",children:e.jsx(me,{size:20})})}}),e.jsx(w,{title:"Refresh",children:e.jsx(v,{onClick:ae,children:e.jsx(ie,{})})}),e.jsx(p,{variant:"contained",onClick:()=>j(`/apps/records/funeral/new?church_id=${o}`),children:"New Record"}),e.jsx(p,{variant:"outlined",startIcon:e.jsx(fe,{size:18}),onClick:()=>j(`/apps/interactive-reports/create?recordType=funeral&churchId=${o}`),sx:{ml:1},children:"Generate Report"})]})}),L&&e.jsx(he,{severity:"error",sx:{mb:2},onClose:()=>l(null),children:L}),e.jsxs($,{sx:{p:3},children:[e.jsx(pe,{children:e.jsxs(je,{children:[e.jsx(ge,{children:e.jsxs(k,{children:[e.jsx(r,{children:e.jsxs(p,{size:"small",onClick:()=>P("id"),sx:{textTransform:"none",fontWeight:"bold"},children:["ID ",h==="id"&&(x==="asc"?"↑":"↓")]})}),e.jsx(r,{children:e.jsxs(p,{size:"small",onClick:()=>P("name"),sx:{textTransform:"none",fontWeight:"bold"},children:["Name ",h==="name"&&(x==="asc"?"↑":"↓")]})}),e.jsx(r,{children:e.jsxs(p,{size:"small",onClick:()=>P("death_date"),sx:{textTransform:"none",fontWeight:"bold"},children:["Death Date ",h==="death_date"&&(x==="asc"?"↑":"↓")]})}),e.jsx(r,{children:e.jsxs(p,{size:"small",onClick:()=>P("burial_date"),sx:{textTransform:"none",fontWeight:"bold"},children:["Burial Date ",h==="burial_date"&&(x==="asc"?"↑":"↓")]})}),e.jsx(r,{children:e.jsxs(p,{size:"small",onClick:()=>P("clergy"),sx:{textTransform:"none",fontWeight:"bold"},children:["Clergy ",h==="clergy"&&(x==="asc"?"↑":"↓")]})}),e.jsx(r,{children:e.jsxs(p,{size:"small",onClick:()=>P("burial_location"),sx:{textTransform:"none",fontWeight:"bold"},children:["Burial Location ",h==="burial_location"&&(x==="asc"?"↑":"↓")]})}),e.jsx(r,{align:"center",sx:{fontWeight:"bold"},children:"Actions"})]})}),e.jsx(be,{children:C?e.jsx(k,{children:e.jsx(r,{colSpan:7,align:"center",children:e.jsx(G,{size:24})})}):V.length===0?e.jsx(k,{children:e.jsx(r,{colSpan:7,align:"center",children:e.jsx(de,{color:"text.secondary",children:R?"No records found matching your search":"No records found"})})}):V.map(s=>{const t=s.deceased_first||s.firstName||s.name||s.first_name||"",m=s.deceased_middle||"",d=s.deceased_last||s.lastName||s.lastname||s.last_name||"",n=s.deceased_full||[t,m,d].filter(Boolean).join(" ").trim()||"-",u=M(s.death_date||s.deathDate)||"-",f=M(s.funeral_date||s.burial_date||s.burialDate)||"-",te=s.officiant_name||s.priest||s.clergy||"-",re=s.burial_place||s.burialLocation||s.burial_location||"-";return e.jsxs(k,{hover:!0,children:[e.jsx(r,{children:s.id}),e.jsx(r,{children:n}),e.jsx(r,{children:u}),e.jsx(r,{children:f}),e.jsx(r,{children:te}),e.jsx(r,{children:re}),e.jsx(r,{align:"center",children:e.jsxs(E,{direction:"row",spacing:1,justifyContent:"center",children:[e.jsx(w,{title:"View",children:e.jsx(v,{size:"small",onClick:()=>Z(s.id),children:e.jsx(ye,{size:18})})}),e.jsx(w,{title:"Edit",children:e.jsx(v,{size:"small",onClick:()=>ee(s.id),children:e.jsx(_e,{size:18})})}),e.jsx(w,{title:"Delete",children:e.jsx(v,{size:"small",color:"error",onClick:()=>se(s.id),children:e.jsx(Ce,{size:18})})})]})})]},s.id)})})]})}),e.jsx(Se,{component:"div",count:W,page:z,onPageChange:J,rowsPerPage:D,onRowsPerPageChange:K,rowsPerPageOptions:[10,25,50,100]})]})]})};export{Ue as default};
//# sourceMappingURL=FuneralRecordsPage-C1S-czCq.js.map
