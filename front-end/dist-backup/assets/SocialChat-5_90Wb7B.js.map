{"version":3,"file":"SocialChat-5_90Wb7B.js","sources":["../../src/features/social/chat/SocialChat.tsx"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\r\nimport {\r\n  Box,\r\n  Card,\r\n  CardContent,\r\n  Typography,\r\n  Avatar,\r\n  TextField,\r\n  IconButton,\r\n  Stack,\r\n  List,\r\n  ListItem,\r\n  ListItemAvatar,\r\n  ListItemText,\r\n  ListItemButton,\r\n  Divider,\r\n  Badge,\r\n  Paper,\r\n  Menu,\r\n  MenuItem,\r\n  Alert,\r\n  CircularProgress,\r\n  Skeleton,\r\n  Chip,\r\n  Tooltip,\r\n  Dialog,\r\n  DialogTitle,\r\n  DialogContent,\r\n  DialogActions,\r\n  Button,\r\n} from '@mui/material';\r\nimport {\r\n  IconSend,\r\n  IconMoodSmile,\r\n  IconPaperclip,\r\n  IconDots,\r\n  IconEdit,\r\n  IconTrash,\r\n  IconReply,\r\n  IconCheck,\r\n  IconX,\r\n  IconSearch,\r\n  IconPlus,\r\n  IconMessage,\r\n  IconUsers,\r\n} from '@tabler/icons-react';\r\nimport { useNavigate, useLocation } from 'react-router-dom';\r\nimport { useAuth } from '../../../context/AuthContext';\r\nimport PageContainer from '../../../components/container/PageContainer';\r\nimport Breadcrumb from '../../../layouts/full/shared/breadcrumb/Breadcrumb';\r\nimport { format, isToday, isYesterday, formatDistanceToNow } from 'date-fns';\r\nimport { socialAPI } from '../../../api/social.api';\r\n\r\ninterface Conversation {\r\n  id: number;\r\n  type: 'direct' | 'group';\r\n  name?: string;\r\n  avatar_url?: string;\r\n  last_activity: string;\r\n  last_message_content?: string;\r\n  last_message_time?: string;\r\n  last_message_sender_id?: number;\r\n  last_message_sender_name?: string;\r\n  last_read_at?: string;\r\n  unread_count: number;\r\n  other_participant?: {\r\n    id: number;\r\n    first_name: string;\r\n    last_name: string;\r\n    display_name?: string;\r\n    profile_image_url?: string;\r\n    is_online: boolean;\r\n    last_seen: string;\r\n  };\r\n}\r\n\r\ninterface Message {\r\n  id: number;\r\n  conversation_id: number;\r\n  sender_id: number;\r\n  content: string;\r\n  message_type: 'text' | 'image' | 'file';\r\n  reply_to_id?: number;\r\n  reactions?: Record<string, number>;\r\n  is_edited: boolean;\r\n  is_deleted: boolean;\r\n  created_at: string;\r\n  updated_at?: string;\r\n  sender: {\r\n    id: number;\r\n    first_name: string;\r\n    last_name: string;\r\n    display_name?: string;\r\n    profile_image_url?: string;\r\n  };\r\n  reply_to?: Message;\r\n}\r\n\r\nconst REACTION_EMOJIS = {\r\n  like: 'ðŸ‘',\r\n  love: 'â¤ï¸',\r\n  laugh: 'ðŸ˜‚',\r\n  wow: 'ðŸ˜²',\r\n  sad: 'ðŸ˜¢',\r\n  angry: 'ðŸ˜ ',\r\n  pray: 'ðŸ™',\r\n  amen: 'âœï¸'\r\n};\r\n\r\nconst SocialChat: React.FC = () => {\r\n  const { user } = useAuth();\r\n  const navigate = useNavigate();\r\n  const location = useLocation();\r\n  \r\n  const [conversations, setConversations] = useState<Conversation[]>([]);\r\n  const [selectedConversation, setSelectedConversation] = useState<Conversation | null>(null);\r\n  const [messages, setMessages] = useState<Message[]>([]);\r\n  const [messageText, setMessageText] = useState('');\r\n  const [loading, setLoading] = useState(false);\r\n  const [sendingMessage, setSendingMessage] = useState(false);\r\n  const [error, setError] = useState<string | null>(null);\r\n  \r\n  // Message actions\r\n  const [editingMessage, setEditingMessage] = useState<number | null>(null);\r\n  const [editText, setEditText] = useState('');\r\n  const [reactionMenuAnchor, setReactionMenuAnchor] = useState<{\r\n    element: HTMLElement;\r\n    messageId: number;\r\n  } | null>(null);\r\n  const [searchQuery, setSearchQuery] = useState('');\r\n\r\n  // Refs\r\n  const messagesEndRef = useRef<HTMLDivElement>(null);\r\n  const messageInputRef = useRef<HTMLInputElement>(null);\r\n\r\n  const BCrumb = [\r\n    { to: '/', title: 'Home' },\r\n    { title: 'Social' },\r\n    { title: 'Chat' },\r\n  ];\r\n\r\n  useEffect(() => {\r\n    fetchConversations();\r\n    \r\n    // Handle conversation ID from navigation state (from FriendsList)\r\n    const conversationId = location.state?.conversationId;\r\n    if (conversationId) {\r\n      selectConversationById(conversationId);\r\n    }\r\n  }, [location.state]);\r\n\r\n  useEffect(() => {\r\n    if (selectedConversation) {\r\n      fetchMessages();\r\n      markConversationAsRead();\r\n    }\r\n  }, [selectedConversation]);\r\n\r\n  useEffect(() => {\r\n    scrollToBottom();\r\n  }, [messages]);\r\n\r\n  const fetchConversations = async () => {\r\n    try {\r\n      setLoading(true);\r\n      setError(null);\r\n      \r\n      const response = await socialAPI.chat.getConversations();\r\n      setConversations(response.conversations || []);\r\n    } catch (err: any) {\r\n      console.error('Error fetching conversations:', err);\r\n      setError(err.response?.data?.message || 'Failed to load conversations');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const fetchMessages = async () => {\r\n    if (!selectedConversation) return;\r\n\r\n    try {\r\n      const response = await socialAPI.chat.getMessages(selectedConversation.id);\r\n      setMessages(response.messages || []);\r\n    } catch (err: any) {\r\n      console.error('Error fetching messages:', err);\r\n      setError(err.response?.data?.message || 'Failed to load messages');\r\n    }\r\n  };\r\n\r\n  const selectConversationById = async (conversationId: number) => {\r\n    const conversation = conversations.find(c => c.id === conversationId);\r\n    if (conversation) {\r\n      setSelectedConversation(conversation);\r\n    } else {\r\n      // Fetch conversation details if not in list\r\n      try {\r\n        const response = await socialAPI.chat.getConversation(conversationId);\r\n        const conv = response.conversation;\r\n        setSelectedConversation(conv);\r\n        setConversations(prev => [conv, ...prev.filter(c => c.id !== conversationId)]);\r\n      } catch (err) {\r\n        console.error('Error fetching conversation:', err);\r\n      }\r\n    }\r\n  };\r\n\r\n  const markConversationAsRead = async () => {\r\n    if (!selectedConversation) return;\r\n\r\n    try {\r\n      await socialAPI.chat.markAsRead(selectedConversation.id);\r\n      \r\n      // Update local state\r\n      setConversations(prev => prev.map(conv => \r\n        conv.id === selectedConversation.id \r\n          ? { ...conv, unread_count: 0, last_read_at: new Date().toISOString() }\r\n          : conv\r\n      ));\r\n    } catch (err) {\r\n      console.error('Error marking conversation as read:', err);\r\n    }\r\n  };\r\n\r\n  const sendMessage = async () => {\r\n    if (!selectedConversation || !messageText.trim()) return;\r\n\r\n    try {\r\n      setSendingMessage(true);\r\n      \r\n      const response = await socialAPI.chat.sendMessage(selectedConversation.id, {\r\n        content: messageText.trim(),\r\n        message_type: 'text'\r\n      });\r\n\r\n      const newMessage = response.message;\r\n      setMessages(prev => [...prev, newMessage]);\r\n      setMessageText('');\r\n      \r\n      // Update conversation list\r\n      setConversations(prev => prev.map(conv => \r\n        conv.id === selectedConversation.id \r\n          ? { \r\n              ...conv, \r\n              last_message_content: messageText.trim(),\r\n              last_message_time: new Date().toISOString(),\r\n              last_message_sender_id: user?.id,\r\n              last_activity: new Date().toISOString()\r\n            }\r\n          : conv\r\n      ));\r\n    } catch (err: any) {\r\n      console.error('Error sending message:', err);\r\n      setError(err.response?.data?.message || 'Failed to send message');\r\n    } finally {\r\n      setSendingMessage(false);\r\n    }\r\n  };\r\n\r\n  const editMessage = async (messageId: number, newContent: string) => {\r\n    try {\r\n      await socialAPI.chat.editMessage(messageId, {\r\n        content: newContent\r\n      });\r\n\r\n      setMessages(prev => prev.map(msg => \r\n        msg.id === messageId \r\n          ? { ...msg, content: newContent, is_edited: true }\r\n          : msg\r\n      ));\r\n      \r\n      setEditingMessage(null);\r\n      setEditText('');\r\n    } catch (err: any) {\r\n      console.error('Error editing message:', err);\r\n      setError(err.response?.data?.message || 'Failed to edit message');\r\n    }\r\n  };\r\n\r\n  const deleteMessage = async (messageId: number) => {\r\n    try {\r\n      await socialAPI.chat.deleteMessage(messageId);\r\n      \r\n      setMessages(prev => prev.map(msg => \r\n        msg.id === messageId \r\n          ? { ...msg, content: 'This message was deleted', is_deleted: true }\r\n          : msg\r\n      ));\r\n    } catch (err: any) {\r\n      console.error('Error deleting message:', err);\r\n      setError(err.response?.data?.message || 'Failed to delete message');\r\n    }\r\n  };\r\n\r\n  const reactToMessage = async (messageId: number, reactionType: string) => {\r\n    try {\r\n      await socialAPI.chat.reactToMessage(messageId, {\r\n        reaction_type: reactionType\r\n      });\r\n\r\n      // Update local state (simplified - in real app you'd track user reactions)\r\n      setMessages(prev => prev.map(msg => \r\n        msg.id === messageId \r\n          ? { \r\n              ...msg, \r\n              reactions: { \r\n                ...msg.reactions, \r\n                [reactionType]: (msg.reactions?.[reactionType] || 0) + 1 \r\n              }\r\n            }\r\n          : msg\r\n      ));\r\n      \r\n      setReactionMenuAnchor(null);\r\n    } catch (err: any) {\r\n      console.error('Error reacting to message:', err);\r\n      setError(err.response?.data?.message || 'Failed to react to message');\r\n    }\r\n  };\r\n\r\n  const scrollToBottom = () => {\r\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\r\n  };\r\n\r\n  const getConversationDisplayName = (conversation: Conversation) => {\r\n    if (conversation.type === 'group') {\r\n      return conversation.name || 'Group Chat';\r\n    }\r\n    \r\n    if (conversation.other_participant) {\r\n      const participant = conversation.other_participant;\r\n      return participant.display_name || `${participant.first_name} ${participant.last_name}`;\r\n    }\r\n    \r\n    return 'Direct Chat';\r\n  };\r\n\r\n  const getConversationAvatar = (conversation: Conversation) => {\r\n    if (conversation.type === 'group') {\r\n      return conversation.avatar_url;\r\n    }\r\n    \r\n    return conversation.other_participant?.profile_image_url;\r\n  };\r\n\r\n  const getMessageTime = (timestamp: string) => {\r\n    const date = new Date(timestamp);\r\n    \r\n    if (isToday(date)) {\r\n      return format(date, 'HH:mm');\r\n    } else if (isYesterday(date)) {\r\n      return `Yesterday ${format(date, 'HH:mm')}`;\r\n    } else {\r\n      return format(date, 'MMM dd HH:mm');\r\n    }\r\n  };\r\n\r\n  const getLastActivityTime = (timestamp: string) => {\r\n    const date = new Date(timestamp);\r\n    \r\n    if (isToday(date)) {\r\n      return format(date, 'HH:mm');\r\n    } else if (isYesterday(date)) {\r\n      return 'Yesterday';\r\n    } else {\r\n      return format(date, 'MMM dd');\r\n    }\r\n  };\r\n\r\n  const handleKeyPress = (e: React.KeyboardEvent) => {\r\n    if (e.key === 'Enter' && !e.shiftKey) {\r\n      e.preventDefault();\r\n      sendMessage();\r\n    }\r\n  };\r\n\r\n  const filteredConversations = conversations.filter(conv =>\r\n    searchQuery === '' || \r\n    getConversationDisplayName(conv).toLowerCase().includes(searchQuery.toLowerCase())\r\n  );\r\n\r\n  return (\r\n    <PageContainer title=\"Chat\" description=\"Chat with friends\">\r\n      <Breadcrumb title=\"Chat\" items={BCrumb} />\r\n      \r\n      <Card sx={{ height: 'calc(100vh - 200px)', display: 'flex' }}>\r\n        {/* Conversations Sidebar */}\r\n        <Box sx={{ width: 320, borderRight: 1, borderColor: 'divider', display: 'flex', flexDirection: 'column' }}>\r\n          {/* Search Header */}\r\n          <Box sx={{ p: 2, borderBottom: 1, borderColor: 'divider' }}>\r\n            <TextField\r\n              fullWidth\r\n              size=\"small\"\r\n              placeholder=\"Search conversations...\"\r\n              value={searchQuery}\r\n              onChange={(e) => setSearchQuery(e.target.value)}\r\n              InputProps={{\r\n                startAdornment: <IconSearch size={18} style={{ marginRight: 8 }} />,\r\n              }}\r\n            />\r\n          </Box>\r\n\r\n          {/* Conversations List */}\r\n          <Box sx={{ flexGrow: 1, overflow: 'auto' }}>\r\n            {loading ? (\r\n              <List>\r\n                {[...Array(5)].map((_, index) => (\r\n                  <ListItem key={index}>\r\n                    <ListItemAvatar>\r\n                      <Skeleton variant=\"circular\" width={40} height={40} />\r\n                    </ListItemAvatar>\r\n                    <ListItemText\r\n                      primary={<Skeleton variant=\"text\" width=\"60%\" />}\r\n                      secondary={<Skeleton variant=\"text\" width=\"80%\" />}\r\n                    />\r\n                  </ListItem>\r\n                ))}\r\n              </List>\r\n            ) : filteredConversations.length === 0 ? (\r\n              <Box sx={{ p: 4, textAlign: 'center' }}>\r\n                <IconMessage size={48} color=\"lightgray\" />\r\n                <Typography variant=\"body2\" color=\"text.secondary\" mt={2}>\r\n                  {searchQuery ? 'No conversations found' : 'No conversations yet'}\r\n                </Typography>\r\n                {!searchQuery && (\r\n                  <Button\r\n                    variant=\"outlined\"\r\n                    size=\"small\"\r\n                    startIcon={<IconUsers size={16} />}\r\n                    onClick={() => navigate('/social/friends')}\r\n                    sx={{ mt: 2 }}\r\n                  >\r\n                    Find Friends\r\n                  </Button>\r\n                )}\r\n              </Box>\r\n            ) : (\r\n              <List sx={{ p: 0 }}>\r\n                {filteredConversations.map((conversation) => (\r\n                  <ListItemButton\r\n                    key={conversation.id}\r\n                    selected={selectedConversation?.id === conversation.id}\r\n                    onClick={() => setSelectedConversation(conversation)}\r\n                    sx={{ py: 2, px: 2 }}\r\n                  >\r\n                    <ListItemAvatar>\r\n                      <Badge\r\n                        overlap=\"circular\"\r\n                        anchorOrigin={{ vertical: 'bottom', horizontal: 'right' }}\r\n                        badgeContent={\r\n                          conversation.other_participant?.is_online && (\r\n                            <Box\r\n                              sx={{\r\n                                width: 12,\r\n                                height: 12,\r\n                                borderRadius: '50%',\r\n                                bgcolor: 'success.main',\r\n                                border: '2px solid white',\r\n                              }}\r\n                            />\r\n                          )\r\n                        }\r\n                      >\r\n                        <Avatar\r\n                          src={getConversationAvatar(conversation)}\r\n                          sx={{ width: 48, height: 48 }}\r\n                        >\r\n                          {getConversationDisplayName(conversation)[0]}\r\n                        </Avatar>\r\n                      </Badge>\r\n                    </ListItemAvatar>\r\n                    <ListItemText\r\n                      primary={\r\n                        <Box display=\"flex\" justifyContent=\"space-between\" alignItems=\"center\">\r\n                          <Typography variant=\"subtitle2\" noWrap>\r\n                            {getConversationDisplayName(conversation)}\r\n                          </Typography>\r\n                          <Typography variant=\"caption\" color=\"text.secondary\">\r\n                            {conversation.last_message_time && getLastActivityTime(conversation.last_message_time)}\r\n                          </Typography>\r\n                        </Box>\r\n                      }\r\n                      secondary={\r\n                        <Box display=\"flex\" justifyContent=\"space-between\" alignItems=\"center\">\r\n                          <Typography variant=\"body2\" color=\"text.secondary\" noWrap sx={{ flexGrow: 1 }}>\r\n                            {conversation.last_message_content || 'No messages yet'}\r\n                          </Typography>\r\n                          {conversation.unread_count > 0 && (\r\n                            <Chip\r\n                              label={conversation.unread_count}\r\n                              size=\"small\"\r\n                              color=\"primary\"\r\n                              sx={{ ml: 1, minWidth: 20, height: 20, fontSize: '0.75rem' }}\r\n                            />\r\n                          )}\r\n                        </Box>\r\n                      }\r\n                    />\r\n                  </ListItemButton>\r\n                ))}\r\n              </List>\r\n            )}\r\n          </Box>\r\n        </Box>\r\n\r\n        {/* Chat Area */}\r\n        <Box sx={{ flexGrow: 1, display: 'flex', flexDirection: 'column' }}>\r\n          {selectedConversation ? (\r\n            <>\r\n              {/* Chat Header */}\r\n              <Box sx={{ p: 2, borderBottom: 1, borderColor: 'divider' }}>\r\n                <Stack direction=\"row\" spacing={2} alignItems=\"center\">\r\n                  <Avatar\r\n                    src={getConversationAvatar(selectedConversation)}\r\n                    sx={{ width: 40, height: 40 }}\r\n                  >\r\n                    {getConversationDisplayName(selectedConversation)[0]}\r\n                  </Avatar>\r\n                  <Box flexGrow={1}>\r\n                    <Typography variant=\"h6\">\r\n                      {getConversationDisplayName(selectedConversation)}\r\n                    </Typography>\r\n                    {selectedConversation.other_participant && (\r\n                      <Typography variant=\"caption\" color=\"text.secondary\">\r\n                        {selectedConversation.other_participant.is_online \r\n                          ? 'Online' \r\n                          : `Last seen ${formatDistanceToNow(new Date(selectedConversation.other_participant.last_seen))} ago`\r\n                        }\r\n                      </Typography>\r\n                    )}\r\n                  </Box>\r\n                  <IconButton>\r\n                    <IconDots size={20} />\r\n                  </IconButton>\r\n                </Stack>\r\n              </Box>\r\n\r\n              {/* Messages Area */}\r\n              <Box sx={{ flexGrow: 1, overflow: 'auto', p: 2 }}>\r\n                <Stack spacing={2}>\r\n                  {messages.map((message) => (\r\n                    <Box\r\n                      key={message.id}\r\n                      sx={{\r\n                        display: 'flex',\r\n                        justifyContent: message.sender_id === user?.id ? 'flex-end' : 'flex-start',\r\n                      }}\r\n                    >\r\n                      <Box sx={{ maxWidth: '70%' }}>\r\n                        {message.sender_id !== user?.id && (\r\n                          <Stack direction=\"row\" spacing={1} alignItems=\"center\" mb={0.5}>\r\n                            <Avatar\r\n                              src={message.sender.profile_image_url}\r\n                              sx={{ width: 24, height: 24 }}\r\n                            >\r\n                              {message.sender.first_name[0]}\r\n                            </Avatar>\r\n                            <Typography variant=\"caption\" color=\"text.secondary\">\r\n                              {message.sender.display_name || `${message.sender.first_name} ${message.sender.last_name}`}\r\n                            </Typography>\r\n                          </Stack>\r\n                        )}\r\n                        \r\n                        <Paper\r\n                          sx={{\r\n                            p: 1.5,\r\n                            bgcolor: message.sender_id === user?.id ? 'primary.main' : 'grey.100',\r\n                            color: message.sender_id === user?.id ? 'primary.contrastText' : 'text.primary',\r\n                            position: 'relative',\r\n                          }}\r\n                        >\r\n                          {editingMessage === message.id ? (\r\n                            <Stack spacing={1}>\r\n                              <TextField\r\n                                fullWidth\r\n                                multiline\r\n                                value={editText}\r\n                                onChange={(e) => setEditText(e.target.value)}\r\n                                size=\"small\"\r\n                              />\r\n                              <Stack direction=\"row\" spacing={1} justifyContent=\"flex-end\">\r\n                                <Button\r\n                                  size=\"small\"\r\n                                  onClick={() => {\r\n                                    setEditingMessage(null);\r\n                                    setEditText('');\r\n                                  }}\r\n                                >\r\n                                  Cancel\r\n                                </Button>\r\n                                <Button\r\n                                  size=\"small\"\r\n                                  variant=\"contained\"\r\n                                  onClick={() => editMessage(message.id, editText)}\r\n                                >\r\n                                  Save\r\n                                </Button>\r\n                              </Stack>\r\n                            </Stack>\r\n                          ) : (\r\n                            <>\r\n                              <Typography variant=\"body2\">\r\n                                {message.is_deleted ? (\r\n                                  <em style={{ opacity: 0.7 }}>This message was deleted</em>\r\n                                ) : (\r\n                                  message.content\r\n                                )}\r\n                                {message.is_edited && !message.is_deleted && (\r\n                                  <Typography component=\"span\" variant=\"caption\" sx={{ ml: 1, opacity: 0.7 }}>\r\n                                    (edited)\r\n                                  </Typography>\r\n                                )}\r\n                              </Typography>\r\n                              \r\n                              <Stack direction=\"row\" justifyContent=\"space-between\" alignItems=\"center\" mt={0.5}>\r\n                                <Typography variant=\"caption\" sx={{ opacity: 0.7 }}>\r\n                                  {getMessageTime(message.created_at)}\r\n                                </Typography>\r\n                                \r\n                                {message.sender_id === user?.id && !message.is_deleted && (\r\n                                  <Stack direction=\"row\" spacing={0.5}>\r\n                                    <IconButton\r\n                                      size=\"small\"\r\n                                      onClick={() => {\r\n                                        setEditingMessage(message.id);\r\n                                        setEditText(message.content);\r\n                                      }}\r\n                                    >\r\n                                      <IconEdit size={14} />\r\n                                    </IconButton>\r\n                                    <IconButton\r\n                                      size=\"small\"\r\n                                      onClick={() => deleteMessage(message.id)}\r\n                                    >\r\n                                      <IconTrash size={14} />\r\n                                    </IconButton>\r\n                                  </Stack>\r\n                                )}\r\n                              </Stack>\r\n\r\n                              {/* Reactions */}\r\n                              {message.reactions && Object.keys(message.reactions).length > 0 && (\r\n                                <Stack direction=\"row\" spacing={0.5} mt={1}>\r\n                                  {Object.entries(message.reactions).map(([type, count]) => (\r\n                                    <Chip\r\n                                      key={type}\r\n                                      label={`${REACTION_EMOJIS[type as keyof typeof REACTION_EMOJIS]} ${count}`}\r\n                                      size=\"small\"\r\n                                      variant=\"outlined\"\r\n                                    />\r\n                                  ))}\r\n                                </Stack>\r\n                              )}\r\n                            </>\r\n                          )}\r\n\r\n                          {/* Message Actions Menu */}\r\n                          {!message.is_deleted && (\r\n                            <IconButton\r\n                              size=\"small\"\r\n                              sx={{ position: 'absolute', top: 4, right: 4, opacity: 0.7 }}\r\n                              onClick={(e) => setReactionMenuAnchor({ element: e.currentTarget, messageId: message.id })}\r\n                            >\r\n                              <IconMoodSmile size={14} />\r\n                            </IconButton>\r\n                          )}\r\n                        </Paper>\r\n                      </Box>\r\n                    </Box>\r\n                  ))}\r\n                  <div ref={messagesEndRef} />\r\n                </Stack>\r\n              </Box>\r\n\r\n              {/* Message Input */}\r\n              <Box sx={{ p: 2, borderTop: 1, borderColor: 'divider' }}>\r\n                <Stack direction=\"row\" spacing={1} alignItems=\"flex-end\">\r\n                  <TextField\r\n                    fullWidth\r\n                    multiline\r\n                    maxRows={4}\r\n                    placeholder=\"Type a message...\"\r\n                    value={messageText}\r\n                    onChange={(e) => setMessageText(e.target.value)}\r\n                    onKeyPress={handleKeyPress}\r\n                    disabled={sendingMessage}\r\n                    ref={messageInputRef}\r\n                  />\r\n                  <IconButton\r\n                    color=\"primary\"\r\n                    onClick={sendMessage}\r\n                    disabled={!messageText.trim() || sendingMessage}\r\n                  >\r\n                    {sendingMessage ? (\r\n                      <CircularProgress size={20} />\r\n                    ) : (\r\n                      <IconSend size={20} />\r\n                    )}\r\n                  </IconButton>\r\n                </Stack>\r\n              </Box>\r\n            </>\r\n          ) : (\r\n            <Box\r\n              sx={{\r\n                display: 'flex',\r\n                flexDirection: 'column',\r\n                justifyContent: 'center',\r\n                alignItems: 'center',\r\n                height: '100%',\r\n                p: 4,\r\n              }}\r\n            >\r\n              <IconMessage size={64} color=\"lightgray\" />\r\n              <Typography variant=\"h6\" mt={2} color=\"text.secondary\">\r\n                Select a conversation to start chatting\r\n              </Typography>\r\n              <Typography variant=\"body2\" color=\"text.secondary\">\r\n                Choose from your existing conversations or start a new one\r\n              </Typography>\r\n            </Box>\r\n          )}\r\n        </Box>\r\n\r\n        {/* Reaction Menu */}\r\n        <Menu\r\n          anchorEl={reactionMenuAnchor?.element}\r\n          open={Boolean(reactionMenuAnchor)}\r\n          onClose={() => setReactionMenuAnchor(null)}\r\n        >\r\n          {Object.entries(REACTION_EMOJIS).map(([type, emoji]) => (\r\n            <MenuItem\r\n              key={type}\r\n              onClick={() => reactionMenuAnchor && reactToMessage(reactionMenuAnchor.messageId, type)}\r\n            >\r\n              <Typography variant=\"body2\">\r\n                {emoji} {type.charAt(0).toUpperCase() + type.slice(1)}\r\n              </Typography>\r\n            </MenuItem>\r\n          ))}\r\n        </Menu>\r\n      </Card>\r\n\r\n      {/* Error Alert */}\r\n      {error && (\r\n        <Alert\r\n          severity=\"error\"\r\n          onClose={() => setError(null)}\r\n          sx={{ position: 'fixed', bottom: 16, right: 16, zIndex: 1000 }}\r\n        >\r\n          {error}\r\n        </Alert>\r\n      )}\r\n    </PageContainer>\r\n  );\r\n};\r\n\r\nexport default SocialChat; "],"names":["REACTION_EMOJIS","SocialChat","user","useAuth","navigate","useNavigate","location","useLocation","conversations","setConversations","useState","selectedConversation","setSelectedConversation","messages","setMessages","messageText","setMessageText","loading","setLoading","sendingMessage","setSendingMessage","error","setError","editingMessage","setEditingMessage","editText","setEditText","reactionMenuAnchor","setReactionMenuAnchor","searchQuery","setSearchQuery","messagesEndRef","useRef","messageInputRef","BCrumb","useEffect","fetchConversations","conversationId","_a","selectConversationById","fetchMessages","markConversationAsRead","scrollToBottom","__async","response","socialAPI","err","_b","conversation","c","conv","prev","__spreadProps","__spreadValues","sendMessage","newMessage","editMessage","messageId","newContent","msg","deleteMessage","reactToMessage","reactionType","getConversationDisplayName","participant","getConversationAvatar","getMessageTime","timestamp","date","isToday","format","isYesterday","getLastActivityTime","handleKeyPress","filteredConversations","jsxs","PageContainer","jsx","Breadcrumb","Card","Box","TextField","IconSearch","List","_","index","ListItem","ListItemAvatar","Skeleton","ListItemText","IconMessage","Typography","Button","IconUsers","ListItemButton","Badge","Avatar","Chip","Fragment","Stack","formatDistanceToNow","IconButton","IconDots","message","Paper","e","IconEdit","IconTrash","type","count","IconMoodSmile","CircularProgress","IconSend","Menu","emoji","MenuItem","Alert"],"mappings":"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"}