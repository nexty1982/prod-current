var v=(c,m,u)=>new Promise((d,i)=>{var j=n=>{try{h(u.next(n))}catch(x){i(x)}},o=n=>{try{h(u.throw(n))}catch(x){i(x)}},h=n=>n.done?d(n.value):Promise.resolve(n.value).then(j,o);h((u=u.apply(c,m)).next())});import{k as W,j as e,B as a,R as $,d as t,e as T,$ as b,U as k,Q as q,I as C,aH as z,C as J,p as P,h as U,T as O,J as M,Y as _,K as H,a0 as K,a1 as Q,a2 as Y,f as S,a3 as G}from"./index-CQJq875H.js";import{r as l}from"./vendor-DgfDxsY7.js";import{J as V}from"./JITTerminal-DFLzD8op.js";import{T as w}from"./Terminal-CLu1Re-c.js";import{W as X}from"./Warning-Be9xn7fT.js";import{L as Z,a as ee}from"./ListItem-C0K_HsLZ.js";import{L as se}from"./ListItemText-CD7DWOrd.js";import{D as ne}from"./Delete-C9NyKRln.js";import{I as te}from"./Info-CGEJdxjJ.js";import"./Download-Bdr0Llqc.js";import"./Close-DTVzWelY.js";import"./LinearProgress-Df_7ITNa.js";import"./listItemButtonClasses-B2JwQewU.js";const ye=()=>{var E;const{user:c}=W(),[m,u]=l.useState([]),[d,i]=l.useState(!1),[j,o]=l.useState(null),[h,n]=l.useState(!1),[x,f]=l.useState(null),[L,y]=l.useState(!1),[I,R]=l.useState(30),p=()=>v(void 0,null,function*(){try{i(!0),o(null);const s=yield fetch("/api/jit/sessions");if(!s.ok)throw new Error("Failed to fetch sessions");const r=yield s.json();u(r.sessions||[])}catch(s){o(s instanceof Error?s.message:"Failed to load sessions")}finally{i(!1)}}),F=()=>v(void 0,null,function*(){try{i(!0),o(null);const s=yield fetch("/api/jit/request-session",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({duration:I})});if(!s.ok){const g=yield s.json();throw new Error(g.message||"Failed to request session")}const r=yield s.json();f(r.sessionId),n(!0),y(!1),p()}catch(s){o(s instanceof Error?s.message:"Failed to request session")}finally{i(!1)}}),N=s=>v(void 0,null,function*(){try{if(i(!0),!(yield fetch("/api/jit/end-session",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sessionId:s})})).ok)throw new Error("Failed to end session");p(),x===s&&(n(!1),f(null))}catch(r){o(r instanceof Error?r.message:"Failed to end session")}finally{i(!1)}});l.useEffect(()=>{p();const s=setInterval(p,3e4);return()=>clearInterval(s)},[]);const A=s=>new Date(s).toLocaleString(),B=s=>{if(s<60)return`${s} minutes`;const r=Math.floor(s/60),g=s%60;return g>0?`${r}h ${g}m`:`${r}h`},D=m.filter(s=>s.isActive);return m.filter(s=>!s.isActive),e.jsxs(a,{sx:{p:3},children:[e.jsxs($,{sx:{p:3},children:[e.jsxs(a,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:3},children:[e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(w,{sx:{fontSize:40}}),e.jsxs(a,{children:[e.jsx(t,{variant:"h4",gutterBottom:!0,children:"JIT Terminal Access"}),e.jsx(t,{variant:"body2",color:"text.secondary",children:"Request and manage secure terminal sessions"})]})]}),e.jsx(T,{variant:"contained",startIcon:e.jsx(w,{}),onClick:()=>y(!0),disabled:d,children:"Request New Session"})]}),e.jsx(b,{severity:"warning",icon:e.jsx(X,{}),sx:{mb:3},children:e.jsxs(t,{variant:"body2",children:[e.jsx("strong",{children:"Security Notice:"})," JIT Terminal sessions provide direct server access and are monitored. All commands and outputs are logged for security and compliance purposes. Use responsibly."]})}),j&&e.jsx(b,{severity:"error",sx:{mb:3},onClose:()=>o(null),children:j}),e.jsx(k,{sx:{mb:3},children:e.jsxs(q,{children:[e.jsxs(a,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2},children:[e.jsx(t,{variant:"h6",children:"Active Sessions"}),e.jsx(C,{onClick:p,disabled:d,size:"small",children:e.jsx(z,{})})]}),d&&m.length===0?e.jsx(a,{sx:{display:"flex",justifyContent:"center",p:3},children:e.jsx(J,{})}):D.length===0?e.jsx(t,{variant:"body2",color:"text.secondary",children:"No active sessions"}):e.jsx(P,{children:D.map(s=>e.jsxs(Z,{children:[e.jsx(se,{primary:e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsxs(t,{variant:"body1",children:["Session ",s.id.substring(0,8)]}),e.jsx(U,{label:"Active",color:"success",size:"small"})]}),secondary:e.jsxs(a,{children:[e.jsxs(t,{variant:"body2",color:"text.secondary",children:["Started: ",A(s.startTime)]}),e.jsxs(t,{variant:"body2",color:"text.secondary",children:["Expires: ",A(s.expiryTime)]}),e.jsxs(t,{variant:"body2",color:"text.secondary",children:["Commands: ",s.commandCount]})]})}),e.jsxs(ee,{children:[e.jsx(O,{title:"Open Terminal",children:e.jsx(C,{edge:"end",onClick:()=>{f(s.id),n(!0)},children:e.jsx(w,{})})}),e.jsx(O,{title:"End Session",children:e.jsx(C,{edge:"end",onClick:()=>N(s.id),color:"error",children:e.jsx(ne,{})})})]})]},s.id))})]})}),e.jsx(k,{children:e.jsxs(q,{children:[e.jsxs(t,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(te,{}),"About JIT Terminal Access"]}),e.jsx(t,{variant:"body2",color:"text.secondary",paragraph:!0,children:"JIT (Just-In-Time) Terminal Access provides temporary, secure terminal sessions for super_admin users. Sessions are time-limited and fully monitored for security compliance."}),e.jsxs(a,{component:"ul",sx:{pl:2},children:[e.jsx("li",{children:"All sessions are logged and audited"}),e.jsx("li",{children:"Sessions expire automatically after the requested duration"}),e.jsx("li",{children:"Only one active session per user is allowed"}),e.jsx("li",{children:"All commands and outputs are recorded"})]})]})})]}),e.jsxs(M,{open:L,onClose:()=>y(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(_,{children:"Request New Terminal Session"}),e.jsxs(H,{children:[e.jsxs(K,{fullWidth:!0,sx:{mt:2},children:[e.jsx(Q,{children:"Session Duration"}),e.jsxs(Y,{value:I,label:"Session Duration",onChange:s=>R(Number(s.target.value)),children:[e.jsx(S,{value:15,children:"15 minutes"}),e.jsx(S,{value:30,children:"30 minutes"}),e.jsx(S,{value:60,children:"1 hour"}),e.jsx(S,{value:120,children:"2 hours"})]})]}),e.jsxs(b,{severity:"info",sx:{mt:2},children:["The session will automatically expire after ",B(I),". All activity will be logged for security purposes."]})]}),e.jsxs(G,{children:[e.jsx(T,{onClick:()=>y(!1),children:"Cancel"}),e.jsx(T,{onClick:F,variant:"contained",disabled:d,children:d?e.jsx(J,{size:20}):"Request Session"})]})]}),x&&c&&e.jsx(V,{isOpen:h,onClose:()=>{n(!1),f(null)},sessionId:x,user:{id:((E=c.id)==null?void 0:E.toString())||"",name:c.name||c.username||"Unknown",role:c.role||"super_admin"}})]})};export{ye as default};
//# sourceMappingURL=JITTerminalAccess-Oa5MX_i9.js.map
