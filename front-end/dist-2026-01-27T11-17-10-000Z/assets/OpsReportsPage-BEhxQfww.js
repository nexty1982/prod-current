var T=(f,w,i)=>new Promise((g,p)=>{var x=t=>{try{h(i.next(t))}catch(m){p(m)}},c=t=>{try{h(i.throw(t))}catch(m){p(m)}},h=t=>t.done?g(t.value):Promise.resolve(t.value).then(x,c);h((i=i.apply(f,w)).next())});import{a as U,j as e,B as n,d,U as I,Q as L,O as _,a0 as Q,a1 as J,a2 as Y,f as q,C as G,$ as K,p as X,h as k,I as A,J as Z,Y as ee,K as se,R as ae,a3 as te,e as F}from"./index-CQJq875H.js";import{r}from"./vendor-DgfDxsY7.js";import{S as re}from"./Search-PdWkGsoG.js";import{L as le,a as ne}from"./ListItem-C0K_HsLZ.js";import{L as oe}from"./ListItemText-CD7DWOrd.js";import{T as ie,a as V}from"./Tabs-Da3Qyh1W.js";import{D as B}from"./Description-Bf3Wep-W.js";import{C as ce}from"./Code-Bemk4iXW.js";import"./listItemButtonClasses-B2JwQewU.js";import"./KeyboardArrowRight-Z7vVVss9.js";const D=U(e.jsx("path",{d:"M19 19H5V5h7V3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2v-7h-2zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3z"})),de=[{value:"",label:"All Types"},{value:"analysis",label:"Analysis"},{value:"changelog",label:"Changelog"},{value:"system",label:"System Summary"},{value:"motivation",label:"Motivation"},{value:"roadmap",label:"Roadmap"},{value:"nginx",label:"Nginx"},{value:"uploads",label:"Uploads"},{value:"build",label:"Build"}];function pe(){const[f,w]=r.useState([]),[i,g]=r.useState(!0),[p,x]=r.useState(null),[c,h]=r.useState(""),[t,m]=r.useState(""),[o,E]=r.useState(null),[l,R]=r.useState(null),[W,y]=r.useState(""),[z,v]=r.useState(!1),[O,u]=r.useState(0);r.useEffect(()=>{M()},[c,t]);const M=()=>T(this,null,function*(){g(!0),x(null);try{const s={};c&&(s.type=c),t&&(s.q=t);const a=yield apiFetch("/api/admin/ops/artifacts",{params:s});a.success?w(a.artifacts):x("Failed to load artifacts")}catch(s){console.error("Error loading artifacts:",s),x(s.message||"Failed to load artifacts")}finally{g(!1)}}),P=(s,a)=>T(this,null,function*(){var j;E(s),R(a),v(!0),y("");try{const S=`/api/admin/ops/artifacts/${s.id}/file/${a}`,b=yield fetch(S,{credentials:"include"});if(!b.ok)throw new Error(`Failed to load file: ${b.statusText}`);const $=(j=a.split(".").pop())==null?void 0:j.toLowerCase();if($==="json"){const C=yield b.json();y(JSON.stringify(C,null,2)),u(1)}else{const C=yield b.text();y(C),u($==="html"?0:1)}}catch(S){y(`Error loading file: ${S.message}`),u(1)}}),H=s=>{try{return new Date(s).toLocaleString()}catch(a){return s}},N=s=>{switch(s){case"html":return e.jsx(B,{});case"json":return e.jsx(ce,{});default:return e.jsx(B,{})}};return e.jsxs(n,{sx:{p:3},children:[e.jsx(d,{variant:"h4",gutterBottom:!0,children:"OM-Ops Reports Hub"}),e.jsx(d,{variant:"body2",color:"text.secondary",sx:{mb:3},children:"Browse and view OM-Ops artifacts, reports, and analysis outputs"}),e.jsx(I,{sx:{mb:3},children:e.jsx(L,{children:e.jsxs(n,{sx:{display:"flex",gap:2,flexWrap:"wrap"},children:[e.jsx(_,{placeholder:"Search artifacts...",value:t,onChange:s=>m(s.target.value),InputProps:{startAdornment:e.jsx(re,{sx:{mr:1,color:"text.secondary"}})},sx:{flexGrow:1,minWidth:200}}),e.jsxs(Q,{sx:{minWidth:200},children:[e.jsx(J,{children:"Type"}),e.jsx(Y,{value:c,onChange:s=>h(s.target.value),label:"Type",children:de.map(s=>e.jsx(q,{value:s.value,children:s.label},s.value))})]})]})})}),i?e.jsx(n,{sx:{display:"flex",justifyContent:"center",p:4},children:e.jsx(G,{})}):p?e.jsx(K,{severity:"error",sx:{mb:2},children:p}):f.length===0?e.jsx(I,{children:e.jsx(L,{children:e.jsx(d,{color:"text.secondary",align:"center",children:"No artifacts found"})})}):e.jsx(I,{children:e.jsx(X,{children:f.map(s=>e.jsxs(le,{divider:!0,children:[e.jsx(oe,{primary:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(d,{variant:"h6",children:s.title}),e.jsx(k,{label:s.type,size:"small",color:"primary"})]}),secondary:e.jsxs(n,{children:[e.jsx(d,{variant:"body2",color:"text.secondary",children:s.summary}),e.jsxs(d,{variant:"caption",color:"text.secondary",children:[H(s.createdAt)," â€¢ ",s.files.length," file(s)"]}),e.jsx(n,{sx:{mt:1,display:"flex",gap:.5,flexWrap:"wrap"},children:s.tags.slice(0,5).map(a=>e.jsx(k,{label:a,size:"small",variant:"outlined"},a))})]})}),e.jsx(ne,{children:e.jsxs(n,{sx:{display:"flex",gap:1},children:[s.files.map(a=>e.jsx(A,{onClick:()=>P(s,a.name),title:`View ${a.name}`,size:"small",children:N(a.type)},a.name)),e.jsx(A,{onClick:()=>{var j;const a=`/api/admin/ops/artifacts/${s.id}/file/${(j=s.files[0])==null?void 0:j.name}`;window.open(a,"_blank")},title:"Open in new tab",size:"small",children:e.jsx(D,{})})]})})]},s.id))})}),e.jsxs(Z,{open:z,onClose:()=>v(!1),maxWidth:"lg",fullWidth:!0,children:[e.jsxs(ee,{children:[o==null?void 0:o.title," - ",l]}),e.jsxs(se,{children:[e.jsxs(ie,{value:O,onChange:(s,a)=>u(a),sx:{mb:2},children:[(l==null?void 0:l.endsWith(".html"))&&e.jsx(V,{label:"Preview"}),e.jsx(V,{label:"Source"})]}),O===0&&(l!=null&&l.endsWith(".html"))?e.jsx(n,{component:"iframe",src:`/api/admin/ops/artifacts/${o==null?void 0:o.id}/file/${l}`,sx:{width:"100%",height:"600px",border:"1px solid #ddd",borderRadius:1},sandbox:"allow-same-origin allow-scripts"}):e.jsx(ae,{sx:{p:2,bgcolor:"#f5f5f5",maxHeight:"600px",overflow:"auto"},children:e.jsx(n,{component:"pre",sx:{margin:0,fontFamily:"monospace",fontSize:"0.875rem",whiteSpace:"pre-wrap",wordBreak:"break-word"},children:W})})]}),e.jsxs(te,{children:[e.jsx(F,{onClick:()=>{if(o&&l){const s=`/api/admin/ops/artifacts/${o.id}/file/${l}`;window.open(s,"_blank")}},startIcon:e.jsx(D,{}),children:"Open in New Tab"}),e.jsx(F,{onClick:()=>v(!1),children:"Close"})]})]})]})}function Se(){return e.jsx(pe,{})}export{Se as default};
//# sourceMappingURL=OpsReportsPage-BEhxQfww.js.map
