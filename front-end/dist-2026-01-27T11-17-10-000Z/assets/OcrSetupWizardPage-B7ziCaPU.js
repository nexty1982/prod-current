var we=Object.defineProperty,Re=Object.defineProperties;var Be=Object.getOwnPropertyDescriptors;var de=Object.getOwnPropertySymbols;var Ie=Object.prototype.hasOwnProperty,Pe=Object.prototype.propertyIsEnumerable;var he=(h,p,t)=>p in h?we(h,p,{enumerable:!0,configurable:!0,writable:!0,value:t}):h[p]=t,r=(h,p)=>{for(var t in p||(p={}))Ie.call(p,t)&&he(h,t,p[t]);if(de)for(var t of de(p))Pe.call(p,t)&&he(h,t,p[t]);return h},l=(h,p)=>Re(h,Be(p));var S=(h,p,t)=>new Promise((y,f)=>{var s=j=>{try{w(t.next(j))}catch(V){f(V)}},u=j=>{try{w(t.throw(j))}catch(V){f(V)}},w=j=>j.done?y(j.value):Promise.resolve(j.value).then(s,u);w((t=t.apply(h,p)).next())});import{b9 as Fe,l as Le,j as e,B as m,C as ue,d,$ as E,R as Ve,e as x,b7 as A,F as g,aJ as R,a0 as z,Z as D,U as Oe,Q as Ee}from"./index-CQJq875H.js";import{r as k}from"./vendor-DgfDxsY7.js";import{S as $e,a as Me,b as We}from"./Stepper-Bwlcp4MN.js";import{C as Ae}from"./CheckCircle-CGfB6RRc.js";import{S as ze}from"./StepContent-DToMbd1p.js";import{A as De}from"./ArrowForward-DGwqg0-G.js";import{R as Ue,a as $}from"./RadioGroup-D19FSMZE.js";import{S as Ne}from"./Slider-C9M7HeMQ.js";const me=["Church Context & Permissions","OCR Settings","Storage & Uploads","Vision Integration","Mapping Baseline","Ready to Launch"];function Xe(){const[h]=Fe(),p=Le(),t=parseInt(h.get("church_id")||"46"),[y,f]=k.useState(0),[s,u]=k.useState({}),[w,j]=k.useState(0),[V,U]=k.useState(!1),[xe,ge]=k.useState(!0),[fe,N]=k.useState(!1),[c,je]=k.useState(null),[_,M]=k.useState(null);k.useEffect(()=>{Ce(),B()},[t]);const Ce=()=>S(this,null,function*(){try{const i=yield fetch(`/api/church/${t}/ocr/setup-state`);if(i.ok){const a=yield i.json();u(a.state||{}),j(a.percentComplete||0),U(a.isComplete||!1),a.percentComplete>=100?f(5):a.percentComplete>=80?f(4):a.percentComplete>=60?f(3):a.percentComplete>=40?f(2):a.percentComplete>=20&&f(1)}}catch(i){M(`Failed to load setup state: ${i.message}`)}finally{ge(!1)}}),B=()=>S(this,null,function*(){try{const i=yield fetch(`/api/church/${t}/ocr/setup-validate`,{method:"POST"});if(i.ok){const a=yield i.json();je(a)}}catch(i){console.error("Validation failed:",i)}}),I=(i,a)=>S(this,null,function*(){N(!0);try{const C=r(r({},s),i),v=Math.max(w,a),b=v>=100;if((yield fetch(`/api/church/${t}/ocr/setup-state`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({state:C,percentComplete:v,isComplete:b})})).ok)u(C),j(v),U(b),yield B();else throw new Error("Failed to save state")}catch(C){M(`Failed to save: ${C.message}`)}finally{N(!1)}}),P=()=>{y<me.length-1&&f(y+1)},O=()=>{y>0&&f(y-1)},ye=()=>S(this,null,function*(){yield I({step1:{churchId:t,permissionsVerified:!0}},20),P()}),ve=()=>S(this,null,function*(){var a,C,v,b;const i={language:((a=s.step2)==null?void 0:a.language)||"eng",defaultLanguage:((C=s.step2)==null?void 0:C.defaultLanguage)||"en",recordTypes:((v=s.step2)==null?void 0:v.recordTypes)||["baptism"],confidenceThreshold:((b=s.step2)==null?void 0:b.confidenceThreshold)||75};yield I({step2:i},40),P()}),Se=()=>S(this,null,function*(){yield B(),yield I({step3:{storagePath:`/var/www/orthodoxmetrics/data/church/${t}/ocr_uploads`,storageWritable:(c==null?void 0:c.checklist.storageReady.passed)||!1}},60),P()}),ke=()=>S(this,null,function*(){yield B(),yield I({step4:{visionConfigured:(c==null?void 0:c.checklist.visionReady.passed)||!1}},80),P()}),be=()=>S(this,null,function*(){yield I({step5:{mappingTemplates:{baptism:!0,marriage:!0,funeral:!0}}},100),P()}),Te=i=>{var a,C,v,b,W,G,J,Q,Y,Z,q,H,K,X,ee,se,te,ae,re,ne,ce,ie,oe,le,pe;switch(i){case 0:return e.jsxs(m,{sx:{p:2},children:[e.jsx(d,{variant:"body1",gutterBottom:!0,children:"Verify church context and permissions for OCR setup."}),e.jsx(Oe,{sx:{mt:2},children:e.jsxs(Ee,{children:[e.jsx(d,{variant:"h6",children:"Church Information"}),e.jsxs(d,{children:["Church ID: ",t]}),e.jsx(A,{sx:{mt:2},children:e.jsx(g,{control:e.jsx(R,{checked:((a=s.step1)==null?void 0:a.permissionsVerified)||!1,onChange:o=>{u(l(r({},s),{step1:{churchId:t,permissionsVerified:o.target.checked}}))}}),label:"I have permission to configure OCR for this church"})})]})}),e.jsx(x,{variant:"contained",onClick:ye,disabled:!((C=s.step1)!=null&&C.permissionsVerified),sx:{mt:2},children:"Continue"})]});case 1:return e.jsxs(m,{sx:{p:2},children:[e.jsx(d,{variant:"body1",gutterBottom:!0,children:"Configure OCR language settings and record types."}),e.jsxs(z,{fullWidth:!0,sx:{mt:2},children:[e.jsx(D,{children:"Default Language"}),e.jsxs(Ue,{value:((v=s.step2)==null?void 0:v.defaultLanguage)||"en",onChange:o=>{u(l(r({},s),{step2:l(r({},s.step2),{defaultLanguage:o.target.value,language:o.target.value==="en"?"eng":o.target.value})}))},children:[e.jsx(g,{value:"en",control:e.jsx($,{}),label:"English"}),e.jsx(g,{value:"el",control:e.jsx($,{}),label:"Greek"}),e.jsx(g,{value:"ru",control:e.jsx($,{}),label:"Russian"}),e.jsx(g,{value:"ar",control:e.jsx($,{}),label:"Arabic"})]})]}),e.jsxs(z,{fullWidth:!0,sx:{mt:2},children:[e.jsx(D,{children:"Record Types Enabled"}),e.jsxs(A,{children:[e.jsx(g,{control:e.jsx(R,{checked:((W=(b=s.step2)==null?void 0:b.recordTypes)==null?void 0:W.includes("baptism"))||!1,onChange:o=>{var T;const n=((T=s.step2)==null?void 0:T.recordTypes)||[],F=o.target.checked?[...n,"baptism"]:n.filter(L=>L!=="baptism");u(l(r({},s),{step2:l(r({},s.step2),{recordTypes:F})}))}}),label:"Baptism"}),e.jsx(g,{control:e.jsx(R,{checked:((J=(G=s.step2)==null?void 0:G.recordTypes)==null?void 0:J.includes("marriage"))||!1,onChange:o=>{var T;const n=((T=s.step2)==null?void 0:T.recordTypes)||[],F=o.target.checked?[...n,"marriage"]:n.filter(L=>L!=="marriage");u(l(r({},s),{step2:l(r({},s.step2),{recordTypes:F})}))}}),label:"Marriage"}),e.jsx(g,{control:e.jsx(R,{checked:((Y=(Q=s.step2)==null?void 0:Q.recordTypes)==null?void 0:Y.includes("funeral"))||!1,onChange:o=>{var T;const n=((T=s.step2)==null?void 0:T.recordTypes)||[],F=o.target.checked?[...n,"funeral"]:n.filter(L=>L!=="funeral");u(l(r({},s),{step2:l(r({},s.step2),{recordTypes:F})}))}}),label:"Funeral"})]})]}),e.jsxs(z,{fullWidth:!0,sx:{mt:2},children:[e.jsxs(D,{children:["Confidence Threshold: ",((Z=s.step2)==null?void 0:Z.confidenceThreshold)||75,"%"]}),e.jsx(Ne,{value:((q=s.step2)==null?void 0:q.confidenceThreshold)||75,onChange:(o,n)=>{u(l(r({},s),{step2:l(r({},s.step2),{confidenceThreshold:n})}))},min:50,max:100,step:5,marks:!0})]}),e.jsxs(m,{sx:{mt:2,display:"flex",gap:1},children:[e.jsx(x,{onClick:O,children:"Back"}),e.jsx(x,{variant:"contained",onClick:ve,disabled:(((K=(H=s.step2)==null?void 0:H.recordTypes)==null?void 0:K.length)||0)===0,children:"Save & Continue"})]})]});case 2:return e.jsxs(m,{sx:{p:2},children:[e.jsx(d,{variant:"body1",gutterBottom:!0,children:"Verify storage paths and upload readiness."}),c&&e.jsx(E,{severity:c.checklist.storageReady.passed?"success":"warning",sx:{mt:2},children:c.checklist.storageReady.message}),e.jsx(x,{variant:"outlined",onClick:B,sx:{mt:2},children:"Re-check Storage"}),e.jsxs(m,{sx:{mt:2,display:"flex",gap:1},children:[e.jsx(x,{onClick:O,children:"Back"}),e.jsx(x,{variant:"contained",onClick:Se,disabled:!(c!=null&&c.checklist.storageReady.passed),children:"Continue"})]})]});case 3:return e.jsxs(m,{sx:{p:2},children:[e.jsx(d,{variant:"body1",gutterBottom:!0,children:"Verify Vision API credentials are configured."}),c&&e.jsx(E,{severity:c.checklist.visionReady.passed?"success":"error",sx:{mt:2},children:c.checklist.visionReady.message}),e.jsx(d,{variant:"body2",sx:{mt:2},children:"Note: Credentials are configured server-side. This step only verifies they exist."}),e.jsxs(m,{sx:{mt:2,display:"flex",gap:1},children:[e.jsx(x,{onClick:O,children:"Back"}),e.jsx(x,{variant:"contained",onClick:ke,disabled:!(c!=null&&c.checklist.visionReady.passed),children:"Continue"})]})]});case 4:return e.jsxs(m,{sx:{p:2},children:[e.jsx(d,{variant:"body1",gutterBottom:!0,children:"Create or select mapping templates for record types."}),e.jsxs(A,{sx:{mt:2},children:[e.jsx(g,{control:e.jsx(R,{checked:((ee=(X=s.step5)==null?void 0:X.mappingTemplates)==null?void 0:ee.baptism)||!1,onChange:o=>{var n;u(l(r({},s),{step5:{mappingTemplates:l(r({},(n=s.step5)==null?void 0:n.mappingTemplates),{baptism:o.target.checked})}}))}}),label:"Baptism Mapping Template"}),e.jsx(g,{control:e.jsx(R,{checked:((te=(se=s.step5)==null?void 0:se.mappingTemplates)==null?void 0:te.marriage)||!1,onChange:o=>{var n;u(l(r({},s),{step5:{mappingTemplates:l(r({},(n=s.step5)==null?void 0:n.mappingTemplates),{marriage:o.target.checked})}}))}}),label:"Marriage Mapping Template"}),e.jsx(g,{control:e.jsx(R,{checked:((re=(ae=s.step5)==null?void 0:ae.mappingTemplates)==null?void 0:re.funeral)||!1,onChange:o=>{var n;u(l(r({},s),{step5:{mappingTemplates:l(r({},(n=s.step5)==null?void 0:n.mappingTemplates),{funeral:o.target.checked})}}))}}),label:"Funeral Mapping Template"})]}),e.jsxs(m,{sx:{mt:2,display:"flex",gap:1},children:[e.jsx(x,{onClick:O,children:"Back"}),e.jsx(x,{variant:"contained",onClick:be,disabled:!((ce=(ne=s.step5)==null?void 0:ne.mappingTemplates)!=null&&ce.baptism)&&!((oe=(ie=s.step5)==null?void 0:ie.mappingTemplates)!=null&&oe.marriage)&&!((pe=(le=s.step5)==null?void 0:le.mappingTemplates)!=null&&pe.funeral),children:"Complete Setup"})]})]});case 5:return e.jsxs(m,{sx:{p:2},children:[e.jsx(E,{severity:"success",sx:{mb:2},children:"Setup Complete! You're ready to use Enhanced OCR Uploader."}),e.jsx(d,{variant:"h6",gutterBottom:!0,children:"Summary"}),e.jsxs(d,{children:["Church ID: ",t]}),e.jsxs(d,{children:["Progress: ",w,"%"]}),e.jsx(x,{variant:"contained",size:"large",onClick:()=>p(`/devel/enhanced-ocr-uploader?church_id=${t}`),sx:{mt:2},startIcon:e.jsx(De,{}),children:"Launch Enhanced OCR Uploader"})]});default:return null}};return xe?e.jsx(m,{sx:{display:"flex",justifyContent:"center",p:4},children:e.jsx(ue,{})}):e.jsxs(m,{sx:{maxWidth:900,mx:"auto",p:3},children:[e.jsx(d,{variant:"h4",gutterBottom:!0,children:"OCR Setup Wizard"}),e.jsxs(d,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:["Church ID: ",t," â€¢ Progress: ",w,"%"]}),_&&e.jsx(E,{severity:"error",sx:{mb:2},onClose:()=>M(null),children:_}),e.jsx(Ve,{sx:{p:3,mt:2},children:e.jsx($e,{activeStep:y,orientation:"vertical",children:me.map((i,a)=>e.jsxs(Me,{children:[e.jsx(We,{optional:a===y?e.jsx(d,{variant:"caption",children:"Current step"}):a<y?e.jsx(Ae,{color:"success",fontSize:"small"}):null,children:i}),e.jsx(ze,{children:Te(a)})]},i))})}),fe&&e.jsxs(m,{sx:{display:"flex",alignItems:"center",gap:1,mt:2},children:[e.jsx(ue,{size:20}),e.jsx(d,{variant:"body2",children:"Saving..."})]})]})}export{Xe as default};
//# sourceMappingURL=OcrSetupWizardPage-B7ziCaPU.js.map
