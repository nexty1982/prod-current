var N=(s,p,b)=>new Promise((y,A)=>{var C=c=>{try{r(b.next(c))}catch(_){A(_)}},I=c=>{try{r(b.throw(c))}catch(_){A(_)}},r=c=>c.done?y(c.value):Promise.resolve(c.value).then(C,I);r((b=b.apply(s,p)).next())});import{k as pe,l as be,j as e,$ as P,G as l,Q as O,d as t,O as je,a0 as ve,a1 as ye,a2 as Ce,f as G,S as T,e as w,U as J,B as x,h as H,D as _e,I as K,J as X,Y as Z,K as ee,F as we,aJ as Ae,a3 as re}from"./index-CQJq875H.js";import{r as g}from"./vendor-DgfDxsY7.js";import{P as ae}from"./PageContainer-Dcom98rz.js";import{B as Ie}from"./Breadcrumb-DPJpPJYg.js";import{B as se}from"./BlankCard-DdczsrIb.js";import{a as te,b as Se}from"./admin.api-DTPb-BCU.js";import{l as d}from"./logger-Du9b5RCj.js";import{O as Me}from"./OrthodoxChurchIcon-Bk7Z66P2.js";import{I as ne}from"./IconBuilding-Brclp70H.js";import{I as ke}from"./InputAdornment-CNS_vxXH.js";import{I as De}from"./IconSearch-SCSVgCwv.js";import{I as Be}from"./IconFilter-qcYNzYeg.js";import{I as U}from"./IconPlus-WkeJvWvg.js";import{S as q}from"./Skeleton-BCA11ayB.js";import{A as ze}from"./Avatar-B9iJRGlM.js";import{I as Re}from"./IconMapPin-D5gn-IKM.js";import{I as Ee}from"./IconMail-BH9mHR3z.js";import{I as We}from"./IconCalendar-BNRvMIit.js";import{C as Le}from"./CardActions-CGk8bb8S.js";import{I as ie}from"./IconEye-9sqyYNKE.js";import{I as ce}from"./IconEdit-DVB0PrH1.js";import{I as oe}from"./IconTrash-CiHBPOoG.js";import"./Helmet-DNWYwtrp.js";import"./index-BvdvJza9.js";import"./Breadcrumbs-CV3hf9fU.js";import"./Link-QuBZyEDj.js";import"./api.config-C9UNSeTF.js";var de,he;const h=(he=(de=te)!=null?de:te)!=null?he:Se;function le(s){var b,y,A,C,I;const p=(I=(C=(A=(y=s==null?void 0:s.churches)!=null?y:(b=s==null?void 0:s.data)==null?void 0:b.churches)!=null?A:s==null?void 0:s.data)!=null?C:s)!=null?I:[];return Array.isArray(p)?p.map(r=>{var c,_,n,D,z,S,R,M,f,E,j,B,W,L;return{id:(n=(_=(c=r==null?void 0:r.id)!=null?c:r==null?void 0:r.church_id)!=null?_:r==null?void 0:r._id)!=null?n:Math.random(),name:(z=(D=r==null?void 0:r.name)!=null?D:r==null?void 0:r.church_name)!=null?z:"Unnamed Church",email:(S=r==null?void 0:r.email)!=null?S:"",address:(M=r==null?void 0:r.address)!=null?M:[r==null?void 0:r.city,(R=r==null?void 0:r.state_province)!=null?R:r==null?void 0:r.state].filter(Boolean).join(", "),city:(f=r==null?void 0:r.city)!=null?f:"",state_province:(j=(E=r==null?void 0:r.state_province)!=null?E:r==null?void 0:r.state)!=null?j:"",preferred_language:(B=r==null?void 0:r.preferred_language)!=null?B:"en",created_at:(L=(W=r==null?void 0:r.created_at)!=null?W:r==null?void 0:r.createdAt)!=null?L:null,is_active:typeof(r==null?void 0:r.is_active)=="boolean"?r==null?void 0:r.is_active:(r==null?void 0:r.is_active)===1}}):[]}const hr=()=>{var Y;const{hasRole:s}=pe(),p=be(),[b,y]=g.useState([]),[A,C]=g.useState(!0),[I,r]=g.useState(null),[c,_]=g.useState(""),[n,D]=g.useState(null),[z,S]=g.useState(!1),[R,M]=g.useState(!1),[f,E]=g.useState("all"),[j,B]=g.useState(!1),W=[{to:"/",title:"Home"},{title:"Church Management"}];g.useEffect(()=>{const a=()=>N(void 0,null,function*(){var o,u;try{if(C(!0),d.info("Church Management","Loading churches list",{userAction:"church_list_load_start"}),!((o=h==null?void 0:h.churches)!=null&&o.getAll))throw new Error("adminAPI.churches.getAll not available");const i=yield h.churches.getAll();if((i==null?void 0:i.success)===!1){const F=(i==null?void 0:i.message)||"API returned success=false";throw new Error(F)}const v=le(i);y(v),d.info("Church Management","Churches list loaded successfully",{count:((u=i==null?void 0:i.churches)==null?void 0:u.length)||0,userAction:"church_list_load_success"})}catch(i){const v=i instanceof Error?i.message:"Failed to fetch churches";r(v),d.error("Church Management","Failed to fetch churches list",{error:v,userAction:"church_list_load"})}finally{C(!1)}});s("admin")||s("super_admin")?(d.info("Church Management","Church list access granted",{userAction:"church_list_access_granted",hasRoles:["admin","super_admin"]}),a()):(r("Access denied. Admin privileges required."),C(!1),d.warn("Church Management","Access denied - insufficient privileges for church list",{userAction:"church_list_access_denied",requiredRoles:["admin","super_admin"]}))},[s]),g.useEffect(()=>{let a=!0;const o=(v=!0)=>N(void 0,null,function*(){var F,Q;try{if(!h||!h.churches||typeof h.churches.getAll!="function"){d.error("Church Management","adminAPI.churches.getAll not available",{adminAPI:h});return}if(!((F=h==null?void 0:h.churches)!=null&&F.getAll))throw new Error("adminAPI.churches.getAll not available");const m=yield h.churches.getAll();if(!a)return;if((m==null?void 0:m.success)===!1){const fe=(m==null?void 0:m.message)||"API returned success=false";throw new Error(fe)}const $=le(m);y($),v||d.info("Church Management","Churches list refreshed successfully",{count:((Q=m==null?void 0:m.churches)==null?void 0:Q.length)||0,userAction:"church_list_refresh_success"})}catch(m){const $=m instanceof Error?m.message:"Failed to refresh churches";d.error("Church Management","Failed to refresh churches list",{error:$,userAction:"church_list_refresh"})}}),u=()=>{!document.hidden&&(s("admin")||s("super_admin"))&&(d.info("Church Management","Page became visible, refreshing churches list",{userAction:"church_list_refresh_on_focus"}),o(!0))},i=()=>{(s("admin")||s("super_admin"))&&(d.info("Church Management","Window regained focus, refreshing churches list",{userAction:"church_list_refresh_on_window_focus"}),o(!0))};return document.addEventListener("visibilitychange",u),window.addEventListener("focus",i),o(!1),()=>{a=!1,document.removeEventListener("visibilitychange",u),window.removeEventListener("focus",i)}},[h,s]);const L=a=>{const o=a.target.value;_(o),d.info("Church Management","Church search performed",{query:o.trim(),queryLength:o.length,userAction:"church_search"})},k=b.filter(a=>{var i,v;const o=a.name.toLowerCase().includes(c.toLowerCase())||((i=a.address)==null?void 0:i.toLowerCase().includes(c.toLowerCase()))||((v=a.email)==null?void 0:v.toLowerCase().includes(c.toLowerCase())),u=f==="all"||f==="active"&&a.is_active||f==="inactive"&&!a.is_active;return o&&u}),V=a=>N(void 0,null,function*(){try{d.info("Church Management","Church deletion initiated",{churchId:a.id,churchName:a.name,deleteDatabase:j,userAction:"church_delete_attempt"}),yield h.churches.removeAllUsers(a.id),yield h.churches.delete(a.id,j),y(o=>o.filter(u=>u.id!==a.id)),S(!1),D(null),B(!1),d.info("Church Management","Church deleted successfully",{churchId:a.id,churchName:a.name,deletedDatabase:j,userAction:"church_delete"})}catch(o){const u=o instanceof Error?o.message:"Failed to delete church";r(u),u.includes("assigned users")&&r("Cannot delete church with assigned users. Please remove all users from this church first."),d.error("Church Management","Failed to delete church",{error:u,churchId:a.id,churchName:a.name,userAction:"church_delete"})}}),ue=a=>{D(a),M(!0),d.info("Church Management","Church details viewed",{churchId:a.id,churchName:a.name,userAction:"church_view"})},me=a=>{d.info("Church Management","Church edit initiated",{churchId:a.id,churchName:a.name,userAction:"church_edit_open"}),p(`/apps/church-management/edit/${a.id}`)},xe=a=>a?"success":"error",ge=a=>a?"Active":"Inactive";return s("admin")||s("super_admin")||s("manager")?e.jsxs(ae,{title:"Church Management",description:"Manage churches in the Orthodox Metrics system",children:[e.jsx(Ie,{title:"Church Management",items:W}),I&&e.jsx(P,{severity:"error",sx:{mb:3},children:I}),e.jsxs(l,{container:!0,spacing:3,children:[e.jsx(l,{item:!0,xs:12,children:e.jsx(se,{children:e.jsxs(O,{children:[e.jsxs(t,{variant:"h5",mb:1,children:[e.jsx(ne,{size:24,style:{marginRight:8,verticalAlign:"middle"}}),"Church Management"]}),e.jsx(t,{color:"textSecondary",mb:3,children:"Search, filter, and manage Orthodox churches"}),e.jsxs(l,{container:!0,spacing:2,alignItems:"center",children:[e.jsx(l,{item:!0,xs:12,md:6,children:e.jsx(je,{fullWidth:!0,size:"small",placeholder:"Search churches by name, location, or email...",value:c,onChange:L,InputProps:{startAdornment:e.jsx(ke,{position:"start",children:e.jsx(De,{size:20})})}})}),e.jsx(l,{item:!0,xs:12,md:3,children:e.jsxs(ve,{fullWidth:!0,size:"small",children:[e.jsx(ye,{children:"Status Filter"}),e.jsxs(Ce,{value:f,label:"Status Filter",onChange:a=>E(a.target.value),startAdornment:e.jsx(Be,{size:16,style:{marginLeft:8}}),children:[e.jsx(G,{value:"all",children:"All Churches"}),e.jsx(G,{value:"active",children:"Active Only"}),e.jsx(G,{value:"inactive",children:"Inactive Only"})]})]})}),e.jsx(l,{item:!0,xs:12,md:3,children:e.jsxs(T,{direction:"row",spacing:2,justifyContent:"flex-end",children:[s("super_admin")&&e.jsx(w,{variant:"outlined",startIcon:e.jsx(U,{}),onClick:()=>p("/apps/church-management/wizard"),children:"Setup Wizard"}),e.jsx(w,{variant:"contained",startIcon:e.jsx(U,{}),onClick:()=>p("/apps/church-management/create"),children:"Add Church"})]})})]})]})})}),e.jsx(l,{item:!0,xs:12,children:e.jsx(se,{children:e.jsxs(O,{children:[e.jsxs(t,{variant:"h5",mb:1,children:["Churches (",k.length,")"]}),e.jsx(t,{color:"textSecondary",mb:3,children:k.length===0?"No churches found matching your criteria":`Showing ${k.length} church${k.length!==1?"es":""}`}),A?e.jsx(l,{container:!0,spacing:3,children:[1,2,3,4,5,6].map(a=>e.jsx(l,{item:!0,xs:12,sm:6,lg:4,children:e.jsx(J,{children:e.jsx(O,{children:e.jsxs(T,{spacing:2,children:[e.jsx(q,{variant:"circular",width:40,height:40}),e.jsx(q,{variant:"text",width:"80%",height:28}),e.jsx(q,{variant:"text",width:"60%",height:20}),e.jsx(q,{variant:"text",width:"40%",height:20})]})})})},a))}):k.length===0?e.jsxs(x,{sx:{textAlign:"center",py:6},children:[e.jsx(ne,{size:64,style:{opacity:.3,marginBottom:16}}),e.jsx(t,{variant:"h6",color:"textSecondary",gutterBottom:!0,children:c||f!=="all"?"No churches match your search criteria":"No churches have been added yet"}),e.jsx(t,{variant:"body2",color:"textSecondary",sx:{mb:3},children:c||f!=="all"?"Try adjusting your search or filter settings":"Get started by adding your first church to the system"}),!c&&f==="all"&&e.jsx(w,{variant:"contained",startIcon:e.jsx(U,{}),onClick:()=>p("/apps/church-management/create"),children:"Add First Church"})]}):e.jsx(l,{container:!0,spacing:3,children:k.map(a=>e.jsx(l,{item:!0,xs:12,sm:6,lg:4,children:e.jsxs(J,{sx:{height:"100%",display:"flex",flexDirection:"column",transition:"transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out","&:hover":{transform:"translateY(-2px)",boxShadow:4}},children:[e.jsxs(O,{sx:{flexGrow:1},children:[e.jsxs(x,{sx:{display:"flex",alignItems:"flex-start",mb:2},children:[e.jsx(ze,{sx:{bgcolor:"primary.main",mr:2},children:e.jsx(Me,{})}),e.jsxs(x,{sx:{flexGrow:1,minWidth:0},children:[e.jsx(t,{variant:"h6",noWrap:!0,title:a.name,children:a.name}),e.jsx(H,{label:a.is_active?"Active":"Inactive",color:a.is_active?"success":"default",size:"small",sx:{mt:.5}})]})]}),e.jsxs(T,{spacing:1,children:[a.address&&e.jsxs(x,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(Re,{size:16,style:{marginRight:8,opacity:.7}}),e.jsx(t,{variant:"body2",color:"textSecondary",noWrap:!0,children:a.address})]}),a.email&&e.jsxs(x,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(Ee,{size:16,style:{marginRight:8,opacity:.7}}),e.jsx(t,{variant:"body2",color:"textSecondary",noWrap:!0,children:a.email})]}),a.created_at&&e.jsxs(x,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(We,{size:16,style:{marginRight:8,opacity:.7}}),e.jsxs(t,{variant:"body2",color:"textSecondary",children:["Added ",new Date(a.created_at).toLocaleDateString()]})]})]})]}),e.jsx(_e,{}),e.jsxs(Le,{sx:{justifyContent:"space-between",px:2,py:1.5},children:[e.jsx(w,{size:"small",startIcon:e.jsx(ie,{}),onClick:()=>ue(a),children:"View"}),e.jsxs(T,{direction:"row",spacing:1,children:[e.jsx(K,{size:"small",onClick:()=>me(a),sx:{color:"primary.main"},children:e.jsx(ce,{size:18})}),s("super_admin")&&e.jsx(K,{size:"small",onClick:()=>V(a),sx:{color:"error.main"},children:e.jsx(oe,{size:18})})]})]})]})},a.id))})]})})})]}),e.jsxs(X,{open:z,onClose:()=>S(!1),PaperProps:{sx:{borderRadius:4,background:"linear-gradient(145deg, #ffffff 0%, #f8f9ff 100%)",border:"1px solid rgba(239, 68, 68, 0.1)",boxShadow:"0 20px 40px rgba(0, 0, 0, 0.1)"}},children:[e.jsxs(Z,{sx:{background:"linear-gradient(135deg, #ef4444 0%, #dc2626 100%)",color:"white",fontWeight:"bold",display:"flex",alignItems:"center"},children:[e.jsx(oe,{size:24,style:{marginRight:8}}),"Delete Church"]}),e.jsxs(ee,{sx:{p:3,mt:2},children:[e.jsxs(t,{variant:"body1",children:["Are you sure you want to delete ",e.jsxs("strong",{children:['"',n==null?void 0:n.name,'"']}),"?"]}),e.jsx(t,{variant:"body2",color:"text.secondary",mt:1,children:"This action cannot be undone and will permanently remove the church from the system."}),e.jsx(we,{control:e.jsx(Ae,{checked:j,onChange:a=>B(a.target.checked),sx:{color:"#ef4444","&.Mui-checked":{color:"#ef4444"}}}),label:"Also remove the database and all church records",sx:{mt:2,mb:1}}),j&&e.jsx(P,{severity:"warning",sx:{mt:2},children:e.jsxs(t,{variant:"body2",children:[e.jsx("strong",{children:"⚠️ Warning:"})," This will permanently delete the church's database including all records, users, and data. This action is irreversible!"]})}),!j&&e.jsx(P,{severity:"info",sx:{mt:2},children:e.jsxs(t,{variant:"body2",children:[e.jsx("strong",{children:"ℹ️ Note:"})," The church record will be removed from the system, but the database and all church records will be preserved."]})})]}),e.jsxs(re,{sx:{p:3,gap:1},children:[e.jsx(w,{onClick:()=>S(!1),sx:{borderRadius:2,px:3,color:"#64748b","&:hover":{backgroundColor:"rgba(100, 116, 139, 0.1)"}},children:"Cancel"}),e.jsx(w,{onClick:()=>n&&V(n),variant:"contained",sx:{background:"linear-gradient(135deg, #ef4444 0%, #dc2626 100%)",borderRadius:2,px:3,fontWeight:"bold","&:hover":{background:"linear-gradient(135deg, #dc2626 0%, #b91c1c 100%)",transform:"translateY(-1px)",boxShadow:"0 4px 15px rgba(239, 68, 68, 0.4)"},transition:"all 0.3s ease"},children:"Delete Church"})]})]}),e.jsxs(X,{open:R,onClose:()=>M(!1),maxWidth:"md",fullWidth:!0,PaperProps:{sx:{borderRadius:4,background:"linear-gradient(145deg, #ffffff 0%, #f8f9ff 100%)",border:"1px solid rgba(102, 126, 234, 0.1)",boxShadow:"0 20px 40px rgba(0, 0, 0, 0.1)"}},children:[e.jsxs(Z,{sx:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"white",fontWeight:"bold",display:"flex",alignItems:"center"},children:[e.jsx(ie,{size:24,style:{marginRight:8}}),"Church Details"]}),e.jsx(ee,{sx:{p:4},children:n&&e.jsxs(l,{container:!0,spacing:3,children:[e.jsx(l,{item:!0,xs:12,md:6,children:e.jsxs(x,{sx:{p:2,backgroundColor:"rgba(102, 126, 234, 0.05)",borderRadius:2,border:"1px solid rgba(102, 126, 234, 0.1)"},children:[e.jsx(t,{variant:"subtitle2",gutterBottom:!0,color:"primary",fontWeight:"bold",children:"Church Name"}),e.jsx(t,{variant:"body1",gutterBottom:!0,children:n.name})]})}),e.jsx(l,{item:!0,xs:12,md:6,children:e.jsxs(x,{sx:{p:2,backgroundColor:"rgba(102, 126, 234, 0.05)",borderRadius:2,border:"1px solid rgba(102, 126, 234, 0.1)"},children:[e.jsx(t,{variant:"subtitle2",gutterBottom:!0,color:"primary",fontWeight:"bold",children:"Status"}),e.jsx(H,{label:ge(n.is_active),color:xe(n.is_active),size:"small",sx:{fontWeight:600}})]})}),e.jsx(l,{item:!0,xs:12,md:6,children:e.jsxs(x,{sx:{p:2,backgroundColor:"rgba(102, 126, 234, 0.05)",borderRadius:2,border:"1px solid rgba(102, 126, 234, 0.1)"},children:[e.jsx(t,{variant:"subtitle2",gutterBottom:!0,color:"primary",fontWeight:"bold",children:"Address"}),e.jsx(t,{variant:"body1",gutterBottom:!0,children:n.address||"Not specified"})]})}),e.jsx(l,{item:!0,xs:12,md:6,children:e.jsxs(x,{sx:{p:2,backgroundColor:"rgba(102, 126, 234, 0.05)",borderRadius:2,border:"1px solid rgba(102, 126, 234, 0.1)"},children:[e.jsx(t,{variant:"subtitle2",gutterBottom:!0,color:"primary",fontWeight:"bold",children:"Email"}),e.jsx(t,{variant:"body1",gutterBottom:!0,children:n.email||"Not specified"})]})}),e.jsx(l,{item:!0,xs:12,md:6,children:e.jsxs(x,{sx:{p:2,backgroundColor:"rgba(102, 126, 234, 0.05)",borderRadius:2,border:"1px solid rgba(102, 126, 234, 0.1)"},children:[e.jsx(t,{variant:"subtitle2",gutterBottom:!0,color:"primary",fontWeight:"bold",children:"Language"}),e.jsx(t,{variant:"body1",gutterBottom:!0,children:((Y=n.preferred_language)==null?void 0:Y.toUpperCase())||"EN"})]})}),e.jsx(l,{item:!0,xs:12,md:6,children:e.jsxs(x,{sx:{p:2,backgroundColor:"rgba(102, 126, 234, 0.05)",borderRadius:2,border:"1px solid rgba(102, 126, 234, 0.1)"},children:[e.jsx(t,{variant:"subtitle2",gutterBottom:!0,color:"primary",fontWeight:"bold",children:"Created"}),e.jsx(t,{variant:"body1",gutterBottom:!0,children:new Date(n.created_at).toLocaleDateString()})]})})]})}),e.jsxs(re,{sx:{p:3,gap:1},children:[e.jsx(w,{onClick:()=>M(!1),sx:{borderRadius:2,px:3,color:"#64748b","&:hover":{backgroundColor:"rgba(100, 116, 139, 0.1)"}},children:"Close"}),e.jsx(w,{variant:"contained",href:`/apps/church-management/edit/${n==null?void 0:n.id}`,startIcon:e.jsx(ce,{}),sx:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",borderRadius:2,px:3,fontWeight:"bold","&:hover":{background:"linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%)",transform:"translateY(-1px)",boxShadow:"0 4px 15px rgba(102, 126, 234, 0.4)"},transition:"all 0.3s ease"},children:"Edit Church"})]})]})]}):(d.warn("Church Management","Access denied. Administrator privileges required to view church management.",{userAction:"church_management_access_denied",requiredRoles:["admin","super_admin","manager"],path:"/apps/church-management"}),e.jsx(ae,{title:"Church Management",description:"Church management system",children:e.jsx(P,{severity:"error",children:"Access denied. Administrator privileges required to view church management."})}))};export{hr as default};
//# sourceMappingURL=ChurchList-BRum1Dqw.js.map
