var Ae=Object.defineProperty,Be=Object.defineProperties;var Ne=Object.getOwnPropertyDescriptors;var K=Object.getOwnPropertySymbols;var le=Object.prototype.hasOwnProperty,ie=Object.prototype.propertyIsEnumerable;var J=(n,s,t)=>s in n?Ae(n,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[s]=t,b=(n,s)=>{for(var t in s||(s={}))le.call(s,t)&&J(n,t,s[t]);if(K)for(var t of K(s))ie.call(s,t)&&J(n,t,s[t]);return n},C=(n,s)=>Be(n,Ne(s));var ce=(n,s)=>{var t={};for(var a in n)le.call(n,a)&&s.indexOf(a)<0&&(t[a]=n[a]);if(n!=null&&K)for(var a of K(n))s.indexOf(a)<0&&ie.call(n,a)&&(t[a]=n[a]);return t};var de=(n,s,t)=>J(n,typeof s!="symbol"?s+"":s,t);var _=(n,s,t)=>new Promise((a,u)=>{var f=i=>{try{m(t.next(i))}catch(p){u(p)}},l=i=>{try{m(t.throw(i))}catch(p){u(p)}},m=i=>i.done?a(i.value):Promise.resolve(i.value).then(f,l);m((t=t.apply(n,s)).next())});import{c as ge,_ as G,j as e,V as $,f as q,ba as Oe,W as Ge,bL as ue,s as We,c8 as ve,cA as w,B as h,$ as ae,e as M,aI as te,d as g,h as z,J as be,Y as ye,K as Ce,S as A,O as D,a0 as Ie,a1 as we,a2 as Re,F as Se,r as _e,a3 as Me,A as Te,R as se,T as H,I as X,cB as Ke,cC as Qe,G as Y}from"./index-CQJq875H.js";import{r as R,b as O}from"./vendor-DgfDxsY7.js";import{u as re}from"./useQuery-C46sD-Vs.js";import{u as E}from"./useMutation-BbFZ_Vyf.js";import{u as V,c as ke,g as Pe,a as De,b as Q,d as ze,G as U,e as he,f as Ue,h as Ve,i as Je,D as He,j as Xe}from"./DataGrid-BBgDzEun.js";import{I as W}from"./IconPlus-WkeJvWvg.js";import{B as Ye}from"./Badge-DjvORn3y.js";import{L as Ze}from"./ListItemIcon-DQq1oJdL.js";import{I as Fe}from"./IconEdit-DVB0PrH1.js";import{I as Le}from"./IconTrash-CiHBPOoG.js";import{I as qe}from"./IconCheck-DICc9aJH.js";import{I as ne}from"./IconMenu2-DYP2P5WK.js";import{A as et}from"./AppBar-q2Rzkawr.js";import{T as tt}from"./Toolbar-BixKUISM.js";import{I as pe}from"./IconDeviceDesktop-DkW7oIrr.js";import{I as st}from"./IconDatabase-BUJvQBRX.js";import{T as rt,a as Z}from"./Tabs-Da3Qyh1W.js";import"./index-BvdvJza9.js";import"./toPropertyKey-BRA8pAMC.js";import"./typeof-QjJsDpFa.js";import"./Autocomplete-DhSE1wrG.js";import"./usePreviousProps-BWumOsHT.js";import"./ListSubheader-CfeO8gwF.js";import"./ListItemText-CD7DWOrd.js";import"./InputAdornment-CNS_vxXH.js";import"./TablePagination-CStzre4i.js";import"./KeyboardArrowRight-Z7vVVss9.js";import"./LastPage-Nfpn9sHk.js";import"./TableCell-MgPOxDnu.js";import"./Skeleton-BCA11ayB.js";import"./useThemeProps-Bi4Dqx2d.js";/**
 * @license @tabler/icons-react v3.34.1 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const nt=[["path",{d:"M6.306 8.711c-2.602 .723 -4.306 1.926 -4.306 3.289c0 2.21 4.477 4 10 4c.773 0 1.526 -.035 2.248 -.102",key:"svg-0"}],["path",{d:"M17.692 15.289c2.603 -.722 4.308 -1.926 4.308 -3.289c0 -2.21 -4.477 -4 -10 -4c-.773 0 -1.526 .035 -2.25 .102",key:"svg-1"}],["path",{d:"M6.305 15.287c-.676 2.615 -.485 4.693 .695 5.373c1.913 1.105 5.703 -1.877 8.464 -6.66c.387 -.67 .733 -1.339 1.036 -2",key:"svg-2"}],["path",{d:"M17.694 8.716c.677 -2.616 .487 -4.696 -.694 -5.376c-1.913 -1.105 -5.703 1.877 -8.464 6.66c-.387 .67 -.733 1.34 -1.037 2",key:"svg-3"}],["path",{d:"M12 5.424c-1.925 -1.892 -3.82 -2.766 -5 -2.084c-1.913 1.104 -1.226 5.877 1.536 10.66c.386 .67 .793 1.304 1.212 1.896",key:"svg-4"}],["path",{d:"M12 18.574c1.926 1.893 3.821 2.768 5 2.086c1.913 -1.104 1.226 -5.877 -1.536 -10.66c-.375 -.65 -.78 -1.283 -1.212 -1.897",key:"svg-5"}],["path",{d:"M11.5 12.866a1 1 0 1 0 1 -1.732a1 1 0 0 0 -1 1.732z",key:"svg-6"}]],at=ge("outline","brand-react","BrandReact",nt);/**
 * @license @tabler/icons-react v3.34.1 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const ot=[["path",{d:"M3 13m0 2a2 2 0 0 1 2 -2h14a2 2 0 0 1 2 2v4a2 2 0 0 1 -2 2h-14a2 2 0 0 1 -2 -2z",key:"svg-0"}],["path",{d:"M17 17l0 .01",key:"svg-1"}],["path",{d:"M13 17l0 .01",key:"svg-2"}],["path",{d:"M15 13l0 -2",key:"svg-3"}],["path",{d:"M11.75 8.75a4 4 0 0 1 6.5 0",key:"svg-4"}],["path",{d:"M8.5 6.5a8 8 0 0 1 13 0",key:"svg-5"}]],lt=ge("outline","router","Router",ot),it=["label","icon","showInMenu","onClick"],ct=["label","icon","showInMenu","onClick","closeMenuOnClick","closeMenu"],xe=R.forwardRef((n,s)=>{const t=V();if(!n.showInMenu){var a;const{label:c,icon:x,onClick:d}=n,j=G(n,it),T=L=>{d==null||d(L)};return e.jsx(t.slots.baseIconButton,$({ref:s,size:"small",role:"menuitem","aria-label":c},j,{onClick:T},(a=t.slotProps)==null?void 0:a.baseIconButton,{children:R.cloneElement(x,{fontSize:"small"})}))}const{label:u,icon:f,onClick:l,closeMenuOnClick:m=!0,closeMenu:i}=n,p=G(n,ct),v=c=>{l==null||l(c),m&&(i==null||i())};return e.jsxs(q,$({ref:s},p,{onClick:v,children:[f&&e.jsx(Ze,{children:f}),u]}))}),dt=["className","children"],ut=n=>{const{classes:s}=n;return ke({root:["toolbarContainer"]},Pe,s)},ht=Oe("div",{name:"MuiDataGrid",slot:"ToolbarContainer",overridesResolver:(n,s)=>s.toolbarContainer})(({theme:n})=>({display:"flex",alignItems:"center",flexWrap:"wrap",gap:n.spacing(1),padding:n.spacing(.5,.5,0)})),pt=R.forwardRef(function(s,t){const{className:a,children:u}=s,f=G(s,dt),l=V(),m=ut(l);return u?e.jsx(ht,$({ref:t,className:Ge(a,m.root),ownerState:l},f,{children:u})):null}),xt=["onClick"],mt=R.forwardRef(function(s,t){var a;const{onClick:u}=s,f=G(s,xt),l=ue(),m=ue(),i=De(),p=V(),v=Q(i,ze),c=d=>{v.open&&v.openedPanelValue===U.columns?i.current.hidePreferences():i.current.showPreferences(U.columns,m,l),u==null||u(d)};if(p.disableColumnSelector)return null;const x=v.open&&v.panelId===m;return e.jsx(p.slots.baseButton,$({ref:t,id:l,size:"small","aria-label":i.current.getLocaleText("toolbarColumnsLabel"),"aria-haspopup":"menu","aria-expanded":x,"aria-controls":x?m:void 0,startIcon:e.jsx(p.slots.columnSelectorIcon,{})},f,{onClick:c},(a=p.slotProps)==null?void 0:a.baseButton,{children:i.current.getLocaleText("toolbarColumns")}))}),ft=["componentsProps"],jt=n=>{const{classes:s}=n;return ke({root:["toolbarFilterList"]},Pe,s)},gt=We("ul",{name:"MuiDataGrid",slot:"ToolbarFilterList",overridesResolver:(n,s)=>s.toolbarFilterList})(({theme:n})=>({margin:n.spacing(1,1,.5),padding:n.spacing(0,1)})),vt=R.forwardRef(function(s,t){var a,u;const{componentsProps:f={}}=s,l=G(s,ft),m=f.button||{},i=De(),p=V(),v=Q(i,Ue),c=Q(i,Ve),x=Q(i,ze),d=jt(p),j=he(),T=he(),L=R.useMemo(()=>{if(x.open)return i.current.getLocaleText("toolbarFiltersTooltipHide");if(v.length===0)return i.current.getLocaleText("toolbarFiltersTooltipShow");const o=r=>c[r.field].filterOperators.find(y=>y.value===r.operator).label||i.current.getLocaleText(`filterOperator${Je(r.operator)}`).toString(),S=r=>{const{getValueAsString:y}=c[r.field].filterOperators.find(F=>F.value===r.operator);return y?y(r.value):r.value};return e.jsxs("div",{children:[i.current.getLocaleText("toolbarFiltersTooltipActive")(v.length),e.jsx(gt,{className:d.root,ownerState:p,children:v.map((r,y)=>$({},c[r.field]&&e.jsx("li",{children:`${c[r.field].headerName||r.field}
                  ${o(r)}
                  ${r.value!=null?S(r):""}`},y)))})]})},[i,p,x.open,v,c,d]),B=o=>{var S;const{open:r,openedPanelValue:y}=x;r&&y===U.filters?i.current.hidePreferences():i.current.showPreferences(U.filters,T,j),(S=m.onClick)==null||S.call(m,o)};if(p.disableColumnFilter)return null;const N=x.open&&x.panelId===T;return e.jsx(p.slots.baseTooltip,$({title:L,enterDelay:1e3},l,(a=p.slotProps)==null?void 0:a.baseTooltip,{children:e.jsx(p.slots.baseButton,$({ref:t,id:j,size:"small","aria-label":i.current.getLocaleText("toolbarFiltersLabel"),"aria-controls":N?T:void 0,"aria-expanded":N,"aria-haspopup":!0,startIcon:e.jsx(Ye,{badgeContent:v.length,color:"primary",children:e.jsx(p.slots.openFilterButtonIcon,{})})},m,{onClick:B},(u=p.slotProps)==null?void 0:u.baseButton,{children:i.current.getLocaleText("toolbarFilters")}))}))});class bt{constructor(){de(this,"baseURL","/api/studio")}request(a){return _(this,arguments,function*(s,t={}){const u=`${this.baseURL}${s}`,f=b({headers:b({"Content-Type":"application/json"},t.headers)},t);try{const l=yield fetch(u,f),m=yield l.json();if(!l.ok)throw new Error(m.reason||`HTTP ${l.status}`);return m}catch(l){throw console.error(`API request failed for ${s}:`,l),l}})}getRoutes(){return _(this,arguments,function*(s={}){const t=new URLSearchParams;Object.entries(s).forEach(([f,l])=>{l!=null&&t.append(f,l.toString())});const a=t.toString()?`/routes?${t.toString()}`:"/routes";return(yield this.request(a)).routes||[]})}createRoute(s){return _(this,null,function*(){return(yield this.request("/routes",{method:"POST",body:JSON.stringify(s)})).route})}updateRoute(s,t){return _(this,null,function*(){return(yield this.request(`/routes/${s}`,{method:"PUT",body:JSON.stringify(t)})).route})}deleteRoute(s,t=!1){return _(this,null,function*(){const a=t?`/routes/${s}?hard=1`:`/routes/${s}`;yield this.request(a,{method:"DELETE"})})}getMenuTree(){return _(this,null,function*(){return(yield this.request("/menus/tree")).tree||[]})}getMenus(){return _(this,arguments,function*(s={}){const t=new URLSearchParams;Object.entries(s).forEach(([f,l])=>{l!=null&&t.append(f,l.toString())});const a=t.toString()?`/menus?${t.toString()}`:"/menus";return(yield this.request(a)).menus||[]})}createMenu(s){return _(this,null,function*(){return(yield this.request("/menus",{method:"POST",body:JSON.stringify(s)})).menu})}updateMenu(s,t){return _(this,null,function*(){return(yield this.request(`/menus/${s}`,{method:"PUT",body:JSON.stringify(t)})).menu})}deleteMenu(s,t=!1){return _(this,null,function*(){const a=t?`/menus/${s}?hard=1`:`/menus/${s}`;yield this.request(a,{method:"DELETE"})})}reorderMenus(s){return _(this,null,function*(){yield this.request("/menus/reorder",{method:"POST",body:JSON.stringify(s)})})}}const P=new bt,{getRoutes:ts,createRoute:ss,updateRoute:rs,deleteRoute:ns,getMenuTree:as,getMenus:os,createMenu:ls,updateMenu:is,deleteMenu:cs,reorderMenus:ds}=P,me=({onSelectRoute:n})=>{const s=ve(),[t,a]=R.useState({open:!1,mode:"create"}),[u,f]=R.useState([]),{data:l=[],isLoading:m,error:i,refetch:p}=re({queryKey:["routes"],queryFn:()=>P.getRoutes()}),v=E({mutationFn:o=>P.createRoute(o),onSuccess:()=>{w.success("Route created successfully"),s.invalidateQueries({queryKey:["routes"]}),a({open:!1,mode:"create"})},onError:o=>{w.error(`Failed to create route: ${o.message}`)}}),c=E({mutationFn:({id:o,data:S})=>P.updateRoute(o,S),onSuccess:()=>{w.success("Route updated successfully"),s.invalidateQueries({queryKey:["routes"]}),a({open:!1,mode:"create"})},onError:o=>{w.error(`Failed to update route: ${o.message}`)}}),x=E({mutationFn:({id:o,hard:S=!1})=>P.deleteRoute(o,S),onSuccess:()=>{w.success("Route deleted successfully"),s.invalidateQueries({queryKey:["routes"]})},onError:o=>{w.error(`Failed to delete route: ${o.message}`)}}),d=o=>{a({open:!0,mode:"edit",route:o})},j=o=>{window.confirm("Are you sure you want to delete this route?")&&x.mutate({id:o})},T=o=>{if(!o||o.length===0)return"None";const S={super_admin:"error",admin:"warning",user:"info",guest:"default"};return e.jsx(h,{sx:{display:"flex",gap:.5,flexWrap:"wrap"},children:o.map(r=>e.jsx(z,{label:r,size:"small",color:S[r]||"default",variant:"outlined"},r))})},L=o=>new Date(o).toLocaleDateString()+" "+new Date(o).toLocaleTimeString(),B=[{field:"id",headerName:"ID",width:70,type:"number"},{field:"path",headerName:"Path",width:200,renderCell:o=>e.jsx(g,{variant:"body2",fontFamily:"monospace",fontSize:"0.85rem",children:o.value})},{field:"component",headerName:"Component",width:250,renderCell:o=>e.jsx(g,{variant:"body2",fontFamily:"monospace",fontSize:"0.85rem",children:o.value})},{field:"title",headerName:"Title",width:200,renderCell:o=>o.value||e.jsx("em",{style:{color:"#666"},children:"No title"})},{field:"layout",headerName:"Layout",width:120,renderCell:o=>e.jsx(z,{label:o.value||"default",size:"small",variant:"outlined",color:o.value==="vertical"?"primary":"default"})},{field:"roles",headerName:"Roles",width:180,renderCell:o=>T(o.value),sortable:!1},{field:"is_active",headerName:"Active",width:100,type:"boolean",renderCell:o=>e.jsx(z,{label:o.value?"Active":"Inactive",size:"small",color:o.value?"success":"default",variant:o.value?"filled":"outlined"})},{field:"order_index",headerName:"Order",width:80,type:"number"},{field:"updated_at",headerName:"Updated",width:160,renderCell:o=>e.jsx(g,{variant:"caption",children:L(o.value)})},{field:"updated_by",headerName:"Updated By",width:120,renderCell:o=>e.jsx(g,{variant:"caption",children:o.value||"system"})},{field:"actions",type:"actions",headerName:"Actions",width:120,getActions:o=>[e.jsx(xe,{icon:e.jsx(Fe,{size:16}),label:"Edit",onClick:()=>d(o.row)},"edit"),e.jsx(xe,{icon:e.jsx(Le,{size:16}),label:"Delete",onClick:()=>j(o.row.id),disabled:x.isPending},"delete")]}],N=()=>e.jsxs(pt,{children:[e.jsx(M,{startIcon:e.jsx(W,{size:16}),onClick:()=>a({open:!0,mode:"create"}),variant:"contained",size:"small",children:"Add Route"}),e.jsx(M,{startIcon:e.jsx(te,{size:16}),onClick:()=>p(),variant:"outlined",size:"small",children:"Refresh"}),e.jsx(mt,{}),e.jsx(vt,{}),e.jsx(Xe,{})]});return e.jsxs(h,{sx:{height:"600px",width:"100%"},children:[i&&e.jsxs(ae,{severity:"error",sx:{mb:2},children:["Failed to load routes: ",i.message]}),e.jsx(He,{rows:l,columns:B,loading:m,checkboxSelection:!0,disableRowSelectionOnClick:!0,onRowSelectionModelChange:o=>f(o),rowSelectionModel:u,slots:{toolbar:N},initialState:{pagination:{paginationModel:{page:0,pageSize:25}}},pageSizeOptions:[10,25,50,100]}),e.jsx(yt,{open:t.open,mode:t.mode,route:t.route,onSubmit:o=>{t.mode==="create"?v.mutate(o):t.route&&c.mutate({id:t.route.id,data:o})},onClose:()=>a({open:!1,mode:"create"}),isLoading:v.isPending||c.isPending})]})},yt=({open:n,mode:s,route:t,onSubmit:a,onClose:u,isLoading:f})=>{const[l,m]=R.useState({path:"",component:"",title:null,description:null,layout:"vertical",roles:["user"],is_active:!0,order_index:0,tags:null,meta:null});O.useEffect(()=>{m(t?{path:t.path,component:t.component,title:t.title,description:t.description||"",layout:t.layout||"vertical",roles:t.roles,is_active:t.is_active,order_index:t.order_index,tags:t.tags||null,meta:t.meta||null}:{path:"",component:"",title:null,description:"",layout:"vertical",roles:["user"],is_active:!0,order_index:0,tags:null,meta:null})},[t,n]);const i=c=>{c.preventDefault(),a(l)},p=()=>{const c=prompt("Enter role name:");c&&!l.roles.includes(c)&&m(x=>C(b({},x),{roles:[...x.roles,c]}))},v=c=>{m(x=>C(b({},x),{roles:x.roles.filter(d=>d!==c)}))};return e.jsx(be,{open:n,onClose:u,maxWidth:"md",fullWidth:!0,children:e.jsxs("form",{onSubmit:i,children:[e.jsx(ye,{children:s==="create"?"Create Route":"Edit Route"}),e.jsx(Ce,{children:e.jsxs(A,{spacing:3,sx:{mt:1},children:[e.jsx(D,{required:!0,fullWidth:!0,label:"Path",value:l.path,onChange:c=>m(x=>C(b({},x),{path:c.target.value})),placeholder:"/example/path",helperText:"Route path (must start with /)"}),e.jsx(D,{required:!0,fullWidth:!0,label:"Component",value:l.component,onChange:c=>m(x=>C(b({},x),{component:c.target.value})),placeholder:"src/components/ExampleComponent",helperText:"Component file path"}),e.jsx(D,{fullWidth:!0,label:"Title",value:l.title||"",onChange:c=>m(x=>C(b({},x),{title:c.target.value||null})),placeholder:"Human-readable title"}),e.jsx(D,{fullWidth:!0,multiline:!0,rows:2,label:"Description",value:l.description||"",onChange:c=>m(x=>C(b({},x),{description:c.target.value||null})),placeholder:"Route description"}),e.jsxs(Ie,{fullWidth:!0,children:[e.jsx(we,{children:"Layout"}),e.jsxs(Re,{value:l.layout,onChange:c=>m(x=>C(b({},x),{layout:c.target.value})),label:"Layout",children:[e.jsx(q,{value:"vertical",children:"Vertical"}),e.jsx(q,{value:"horizontal",children:"Horizontal"}),e.jsx(q,{value:"fullscreen",children:"Fullscreen"}),e.jsx(q,{value:"",children:"Default"})]})]}),e.jsxs(h,{children:[e.jsx(g,{variant:"subtitle2",gutterBottom:!0,children:"Roles Required"}),e.jsx(h,{sx:{display:"flex",gap:1,flexWrap:"wrap",mb:1},children:l.roles.map(c=>e.jsx(z,{label:c,onDelete:()=>v(c),size:"small"},c))}),e.jsx(M,{size:"small",onClick:p,startIcon:e.jsx(W,{size:14}),children:"Add Role"})]}),e.jsxs(A,{direction:"row",spacing:3,children:[e.jsx(D,{type:"number",label:"Order Index",value:l.order_index,onChange:c=>m(x=>C(b({},x),{order_index:parseInt(c.target.value)||0})),inputProps:{min:0},sx:{width:150}}),e.jsx(Se,{control:e.jsx(_e,{checked:l.is_active,onChange:c=>m(x=>C(b({},x),{is_active:c.target.checked}))}),label:"Active"})]})]})}),e.jsxs(Me,{children:[e.jsxs(M,{onClick:u,disabled:f,children:[e.jsx(Te,{size:16,style:{marginRight:8}}),"Cancel"]}),e.jsx(M,{type:"submit",variant:"contained",disabled:f,startIcon:e.jsx(qe,{size:16}),children:f?"Saving...":s==="create"?"Create":"Update"})]})]})})},fe=({onSelectMenu:n})=>{const s=ve(),[t,a]=R.useState({open:!1,mode:"create"}),[u,f]=R.useState(null),[l,m]=R.useState(null),{data:i=[],isLoading:p,error:v,refetch:c}=re({queryKey:["menu-tree"],queryFn:()=>P.getMenuTree()}),{data:x=[]}=re({queryKey:["menus"],queryFn:()=>P.getMenus()}),d=E({mutationFn:r=>P.createMenu(r),onSuccess:()=>{w.success("Menu item created successfully"),s.invalidateQueries({queryKey:["menu-tree"]}),s.invalidateQueries({queryKey:["menus"]}),a({open:!1,mode:"create"})},onError:r=>{w.error(`Failed to create menu item: ${r.message}`)}}),j=E({mutationFn:({id:r,data:y})=>P.updateMenu(r,y),onSuccess:()=>{w.success("Menu item updated successfully"),s.invalidateQueries({queryKey:["menu-tree"]}),s.invalidateQueries({queryKey:["menus"]}),a({open:!1,mode:"create"})},onError:r=>{w.error(`Failed to update menu item: ${r.message}`)}}),T=E({mutationFn:({id:r,hard:y=!1})=>P.deleteMenu(r,y),onSuccess:()=>{w.success("Menu item deleted successfully"),s.invalidateQueries({queryKey:["menu-tree"]}),s.invalidateQueries({queryKey:["menus"]}),f(null)},onError:r=>{w.error(`Failed to delete menu item: ${r.message}`)}}),L=E({mutationFn:r=>P.reorderMenus(r),onSuccess:()=>{w.success("Menu order updated successfully"),s.invalidateQueries({queryKey:["menu-tree"]}),s.invalidateQueries({queryKey:["menus"]})},onError:r=>{w.error(`Failed to reorder menu items: ${r.message}`)}}),B=r=>{const y=r.children&&r.children.length>0,F=(u==null?void 0:u.id)===r.id;return e.jsxs(h,{sx:{mb:.5},children:[e.jsxs(h,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",p:1,borderRadius:1,backgroundColor:F?"action.selected":"transparent","&:hover":{backgroundColor:"action.hover"},cursor:"pointer"},onClick:()=>{f(r),n==null||n(r)},draggable:!0,onDragStart:I=>{m(r),I.dataTransfer.effectAllowed="move"},onDragOver:I=>{I.preventDefault(),I.dataTransfer.dropEffect="move"},onDrop:I=>{I.preventDefault(),l&&l.id!==r.id&&o(l,r)},children:[e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ne,{size:16}),e.jsx(g,{variant:"body2",fontWeight:r.is_active?"medium":"normal",children:r.label}),!r.is_active&&e.jsx(z,{label:"Inactive",size:"small",color:"default",variant:"outlined"}),r.path&&e.jsx(g,{variant:"caption",color:"text.secondary",fontFamily:"monospace",children:r.path})]}),e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:.5},children:[r.roles&&r.roles.length>0&&e.jsx(z,{label:`${r.roles.length} role${r.roles.length>1?"s":""}`,size:"small",variant:"outlined",color:"info"}),e.jsx(H,{title:"Add Child",children:e.jsx(X,{size:"small",onClick:I=>{I.stopPropagation(),a({open:!0,mode:"create",parentId:r.id})},children:e.jsx(W,{size:14})})}),e.jsx(H,{title:"Edit",children:e.jsx(X,{size:"small",onClick:I=>{I.stopPropagation(),a({open:!0,mode:"edit",menu:r})},children:e.jsx(Fe,{size:14})})}),e.jsx(H,{title:"Delete",children:e.jsx(X,{size:"small",onClick:I=>{I.stopPropagation(),N(r.id)},children:e.jsx(Le,{size:14})})})]})]}),y&&e.jsx(h,{sx:{ml:2},children:r.children.map(I=>B(I))})]},r.id)},N=r=>{window.confirm("Are you sure you want to delete this menu item?")&&T.mutate({id:r})},o=(r,y)=>{const I=x.filter(k=>k.parent_id===y.parent_id).filter(k=>k.id!==r.id),Ee=I.findIndex(k=>k.id===y.id);I.splice(Ee,0,r);const oe={items:I.map((k,$e)=>({id:k.id,parent_id:k.parent_id,order_index:$e}))};y.id!==r.id&&oe.items.forEach(k=>{k.id===r.id&&(k.parent_id=y.parent_id)}),L.mutate(oe)},S=r=>{if(!r||r.length===0)return"None";const y={super_admin:"error",admin:"warning",user:"info",guest:"default"};return e.jsx(h,{sx:{display:"flex",gap:.5,flexWrap:"wrap"},children:r.map(F=>e.jsx(z,{label:F,size:"small",color:y[F]||"default",variant:"filled"},F))})};return v?e.jsxs(h,{sx:{p:2},children:[e.jsxs(ae,{severity:"error",sx:{mb:2},children:["Failed to load menu tree: ",v.message]}),e.jsx(M,{onClick:()=>c(),startIcon:e.jsx(te,{size:16}),children:"Retry"})]}):e.jsxs(h,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[e.jsx(h,{sx:{p:2,borderBottom:1,borderColor:"divider"},children:e.jsxs(A,{direction:"row",spacing:1,alignItems:"center",justifyContent:"space-between",children:[e.jsxs(g,{variant:"h6",display:"flex",alignItems:"center",gap:1,children:[e.jsx(ne,{size:20}),"Menu Tree"]}),e.jsxs(h,{sx:{display:"flex",gap:1},children:[e.jsx(M,{startIcon:e.jsx(W,{size:16}),onClick:()=>a({open:!0,mode:"create"}),variant:"contained",size:"small",children:"Add Root Item"}),e.jsx(M,{startIcon:e.jsx(te,{size:16}),onClick:()=>c(),variant:"outlined",size:"small",children:"Refresh"})]})]})}),e.jsx(h,{sx:{flex:1,overflow:"auto",p:1},children:p?e.jsx(h,{sx:{display:"flex",justifyContent:"center",p:4},children:e.jsx(g,{children:"Loading menu tree..."})}):e.jsx(h,{sx:{height:"100%",flexGrow:1},children:i.map(B)})}),u&&e.jsxs(se,{elevation:3,sx:{p:2,mt:2},children:[e.jsx(g,{variant:"h6",gutterBottom:!0,children:"Menu Details"}),e.jsxs(A,{spacing:2,children:[e.jsxs(h,{children:[e.jsx(g,{variant:"subtitle2",color:"text.secondary",children:"Label"}),e.jsx(g,{children:u.label})]}),e.jsxs(h,{children:[e.jsx(g,{variant:"subtitle2",color:"text.secondary",children:"Key Name"}),e.jsx(g,{fontFamily:"monospace",children:u.key_name})]}),u.path&&e.jsxs(h,{children:[e.jsx(g,{variant:"subtitle2",color:"text.secondary",children:"Target Path"}),e.jsx(g,{fontFamily:"monospace",children:u.path})]}),e.jsxs(h,{children:[e.jsx(g,{variant:"subtitle2",color:"text.secondary",children:"Roles Required"}),S(u.roles)]}),e.jsxs(h,{children:[e.jsx(g,{variant:"subtitle2",color:"text.secondary",children:"Status"}),e.jsx(z,{label:u.is_active?"Active":"Inactive",color:u.is_active?"success":"default",size:"small"})]}),e.jsxs(h,{children:[e.jsx(g,{variant:"subtitle2",color:"text.secondary",children:"Order Index"}),e.jsx(g,{children:u.order_index})]}),e.jsxs(h,{children:[e.jsx(g,{variant:"subtitle2",color:"text.secondary",children:"Last Updated"}),e.jsx(g,{variant:"caption",children:new Date(u.updated_at).toLocaleString()})]})]})]}),e.jsx(Ct,{open:t.open,mode:t.mode,menu:t.menu,parentId:t.parentId,onSubmit:r=>{t.mode==="create"?d.mutate(r):t.menu&&j.mutate({id:t.menu.id,data:r})},onClose:()=>a({open:!1,mode:"create"}),isLoading:d.isPending||j.isPending,availableParents:x.filter(r=>!r.parent_id&&(!t.menu||r.id!==t.menu.id))})]})},Ct=({open:n,mode:s,menu:t,parentId:a,onSubmit:u,onClose:f,isLoading:l,availableParents:m})=>{const[i,p]=R.useState({parent_id:a||null,key_name:"",label:"",icon:"",path:"",roles:["user"],is_active:!0,order_index:0});O.useEffect(()=>{p(t?{parent_id:t.parent_id||null,key_name:t.key_name,label:t.label,icon:t.icon||"",path:t.path||"",roles:t.roles,is_active:t.is_active,order_index:t.order_index}:{parent_id:a||null,key_name:"",label:"",icon:"",path:"",roles:["user"],is_active:!0,order_index:0})},[t,a,n]);const v=d=>{d.preventDefault(),u(i)},c=()=>{const d=prompt("Enter role name:");d&&!i.roles.includes(d)&&p(j=>C(b({},j),{roles:[...j.roles,d]}))},x=d=>{p(j=>C(b({},j),{roles:j.roles.filter(T=>T!==d)}))};return e.jsx(be,{open:n,onClose:f,maxWidth:"md",fullWidth:!0,children:e.jsxs("form",{onSubmit:v,children:[e.jsx(ye,{children:s==="create"?"Create Menu Item":"Edit Menu Item"}),e.jsx(Ce,{children:e.jsxs(A,{spacing:3,sx:{mt:1},children:[e.jsx(D,{required:!0,fullWidth:!0,label:"Label",value:i.label,onChange:d=>p(j=>C(b({},j),{label:d.target.value})),placeholder:"Menu item label"}),e.jsx(D,{required:!0,fullWidth:!0,label:"Key Name",value:i.key_name,onChange:d=>p(j=>C(b({},j),{key_name:d.target.value})),placeholder:"unique-key-name",helperText:"Unique key for this menu item (used internally)"}),e.jsx(D,{fullWidth:!0,label:"Icon",value:i.icon,onChange:d=>p(j=>C(b({},j),{icon:d.target.value})),placeholder:"IconName",helperText:"Icon name (from icon library)"}),e.jsx(D,{fullWidth:!0,label:"Path",value:i.path,onChange:d=>p(j=>C(b({},j),{path:d.target.value})),placeholder:"/target/path",helperText:"Target route path (optional)"}),e.jsxs(Ie,{fullWidth:!0,children:[e.jsx(we,{children:"Parent Menu"}),e.jsxs(Re,{value:i.parent_id||"",onChange:d=>p(j=>C(b({},j),{parent_id:d.target.value||null})),label:"Parent Menu",children:[e.jsx(q,{value:"",children:"Root Level"}),m.map(d=>e.jsx(q,{value:d.id,children:d.label},d.id))]})]}),e.jsxs(h,{children:[e.jsx(g,{variant:"subtitle2",gutterBottom:!0,children:"Roles Required"}),e.jsx(h,{sx:{display:"flex",gap:1,flexWrap:"wrap",mb:1},children:i.roles.map(d=>e.jsx(z,{label:d,onDelete:()=>x(d),size:"small"},d))}),e.jsx(M,{size:"small",onClick:c,startIcon:e.jsx(W,{size:14}),children:"Add Role"})]}),e.jsxs(A,{direction:"row",spacing:3,children:[e.jsx(D,{type:"number",label:"Order Index",value:i.order_index,onChange:d=>p(j=>C(b({},j),{order_index:parseInt(d.target.value)||0})),inputProps:{min:0},sx:{width:150}}),e.jsx(Se,{control:e.jsx(_e,{checked:i.is_active,onChange:d=>p(j=>C(b({},j),{is_active:d.target.checked}))}),label:"Active"})]})]})}),e.jsxs(Me,{children:[e.jsxs(M,{onClick:f,disabled:l,children:[e.jsx(Te,{size:16,style:{marginRight:8}}),"Cancel"]}),e.jsx(M,{type:"submit",variant:"contained",disabled:l,startIcon:e.jsx(qe,{size:16}),children:l?"Saving...":s==="create"?"Create":"Update"})]})]})})},je=new Qe({defaultOptions:{queries:{retry:1,refetchOnWindowFocus:!1,staleTime:5*60*1e3},mutations:{retry:0}}});function ee(n){const f=n,{children:s,value:t,index:a}=f,u=ce(f,["children","value","index"]);return e.jsx("div",C(b({role:"tabpanel",hidden:t!==a,id:`studio-tabpanel-${a}`,"aria-labelledby":`studio-tab-${a}`},u),{children:t===a&&e.jsx(h,{sx:{height:"100%"},children:s})}))}const us=()=>{const[n,s]=O.useState(0),t=(f,l)=>{s(l)},[a,u]=O.useState(new Date);return O.useEffect(()=>{const f=setInterval(()=>{u(new Date)},3e4);return()=>clearInterval(f)},[]),e.jsx(Ke,{client:je,children:e.jsxs(h,{sx:{height:"100vh",display:"flex",flexDirection:"column"},children:[e.jsx(et,{position:"static",color:"default",elevation:1,children:e.jsxs(tt,{children:[e.jsx(pe,{size:24,style:{marginRight:16}}),e.jsx(g,{variant:"h6",component:"div",sx:{flexGrow:1},children:"Router/Menu Studio"}),e.jsxs(h,{sx:{display:"flex",gap:1,alignItems:"center"},children:[e.jsx(z,{label:"Role: super_admin",color:"primary",variant:"outlined",size:"small"}),e.jsxs(g,{variant:"caption",color:"text.secondary",children:["Last updated: ",a.toLocaleTimeString()]})]})]})}),e.jsxs(h,{sx:{flex:1,overflow:"hidden",p:0},children:[e.jsx(ae,{severity:"success",sx:{borderRadius:0},children:e.jsxs(A,{direction:"row",spacing:2,alignItems:"center",children:[e.jsx(st,{size:20}),e.jsx(g,{variant:"body2",children:"ðŸ“Š Database connected â€¢ ðŸ”— API endpoints active â€¢ âœ… Studio ready for use"}),e.jsx(M,{variant:"outlined",size:"small",onClick:()=>{je.invalidateQueries(),w.success("Data refreshed")},sx:{ml:"auto"},startIcon:e.jsx(at,{size:14}),children:"Refresh All"})]})}),e.jsxs(h,{sx:{height:"calc(100vh - 140px)"},children:[e.jsx(h,{sx:{borderBottom:1,borderColor:"divider"},children:e.jsxs(rt,{value:n,onChange:t,children:[e.jsx(Z,{label:e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(lt,{size:16}),"Routes Management"]}),id:"studio-tab-0","aria-controls":"studio-tabpanel-0"}),e.jsx(Z,{label:e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ne,{size:16}),"Menu Management"]}),id:"studio-tab-1","aria-controls":"studio-tabpanel-1"}),e.jsx(Z,{label:e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(pe,{size:16}),"Combined View"]}),id:"studio-tab-2","aria-controls":"studio-tabpanel-2"})]})}),e.jsx(ee,{value:n,index:0,children:e.jsx(h,{sx:{height:"100%",p:2},children:e.jsx(me,{})})}),e.jsx(ee,{value:n,index:1,children:e.jsx(h,{sx:{height:"100%",p:2},children:e.jsx(fe,{})})}),e.jsx(ee,{value:n,index:2,children:e.jsx(h,{sx:{height:"100%",p:2},children:e.jsxs(Y,{container:!0,spacing:2,sx:{height:"100%"},children:[e.jsx(Y,{item:!0,xs:12,md:7,children:e.jsxs(se,{elevation:2,sx:{height:"100%",display:"flex",flexDirection:"column",p:2},children:[e.jsx(g,{variant:"h6",gutterBottom:!0,children:"Routes (Live Database)"}),e.jsx(h,{sx:{flex:1,overflow:"hidden"},children:e.jsx(me,{})})]})}),e.jsx(Y,{item:!0,xs:12,md:5,children:e.jsxs(se,{elevation:2,sx:{height:"100%",display:"flex",flexDirection:"column",p:2},children:[e.jsx(g,{variant:"h6",gutterBottom:!0,children:"Menu Tree (Live Database)"}),e.jsx(h,{sx:{flex:1,overflow:"hidden"},children:e.jsx(fe,{})})]})})]})})})]})]})]})})};export{us as default};
//# sourceMappingURL=RouterMenuStudioPage-CYeve0Sd.js.map
