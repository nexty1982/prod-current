var O=Object.defineProperty,R=Object.defineProperties;var E=Object.getOwnPropertyDescriptors;var w=Object.getOwnPropertySymbols;var k=Object.prototype.hasOwnProperty,L=Object.prototype.propertyIsEnumerable;var A=(p,e,s)=>e in p?O(p,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):p[e]=s,C=(p,e)=>{for(var s in e||(e={}))k.call(e,s)&&A(p,s,e[s]);if(w)for(var s of w(e))L.call(e,s)&&A(p,s,e[s]);return p},v=(p,e)=>R(p,E(e));var d=(p,e,s)=>A(p,typeof e!="symbol"?e+"":e,s);var f=(p,e,s)=>new Promise((a,c)=>{var g=h=>{try{m(s.next(h))}catch(b){c(b)}},u=h=>{try{m(s.throw(h))}catch(b){c(b)}},m=h=>h.done?a(h.value):Promise.resolve(h.value).then(g,u);m((s=s.apply(p,e)).next())});import{c3 as P}from"./index-CQJq875H.js";import{A as I}from"./api.config-C9UNSeTF.js";const _=I.BASE_URL,T=I.TIMEOUT;class B{constructor(){d(this,"instance");console.log(`ðŸ”§ Initializing API Client with baseURL: "${_}"`),console.log("ðŸŒ Environment: DEV=false, PROD=true"),this.instance=P.create({baseURL:_,timeout:T,withCredentials:!0,headers:{"Content-Type":"application/json"}}),this.setupInterceptors()}setupInterceptors(){this.instance.interceptors.request.use(e=>{var m,h,b,S;if(e.url&&!e.url.startsWith("http")&&!e.url.startsWith("/api")&&(e.url=`/api${e.url}`),!(((m=e.url)==null?void 0:m.includes("/auth/"))||((h=e.url)==null?void 0:h.includes("/api/auth")))&&typeof window!="undefined"){const r=localStorage.getItem("access_token")||sessionStorage.getItem("access_token")||(localStorage.getItem("auth_user")?(b=JSON.parse(localStorage.getItem("auth_user")||"{}"))==null?void 0:b.access_token:null);r&&!e.headers.Authorization&&(e.headers.Authorization=`Bearer ${r}`)}const a=e.url||"",c=e.baseURL?`${e.baseURL}${a}`:a,u=["/api/my/churches","/api/churches","/api/auth/","/auth/","my/churches","churches"].some(r=>r==="churches"?a==="/api/churches"||a==="/churches"||c.includes("/api/churches")||c.includes("/churches"):a.includes(r)||c.includes(r));if(e.headers){const r=Object.keys(e.headers),i=["","none","undefined","null","nan"];r.forEach(o=>{const n=o.toLowerCase(),$=e.headers[o],y=$!=null?String($).toLowerCase().trim():"";n.includes("church")&&(n.includes("id")||n.includes("church-id"))&&(u||i.includes(y))&&(delete e.headers[o],console.log(`ðŸ§¹ Removed church_id header: ${o}="${$}" from ${a} (skip: ${u}, invalid: ${i.includes(y)})`))}),["x-church-id","X-Church-Id","X-CHURCH-ID","church-id","Church-Id","CHURCH-ID","churchId","ChurchId","CHURCHID","x-churchid","X-ChurchId"].forEach(o=>{const n=e.headers[o];if(n!=null){const $=String(n).toLowerCase().trim();(u||i.includes($))&&(delete e.headers[o],console.log(`ðŸ§¹ Removed church_id header (explicit): ${o}="${n}" from ${a}`))}else u&&n===null&&delete e.headers[o]})}if(u){if(e.headers){const r=Object.keys(e.headers).filter(i=>{const l=i.toLowerCase();return l.includes("church")&&(l.includes("id")||l.includes("church-id"))});r.length>0&&r.forEach(i=>{delete e.headers[i],console.log(`ðŸ§¹ Force-removed remaining church_id header: ${i} from ${a}`)})}if(e.commonHeaders&&Object.keys(e.commonHeaders).forEach(r=>{const i=r.toLowerCase();i.includes("church")&&(i.includes("id")||i.includes("church-id"))&&delete e.commonHeaders[r]}),e.headers){const r=Object.keys(e.headers).filter(i=>{const l=i.toLowerCase();return l.includes("church")&&(l.includes("id")||l.includes("church-id"))});r.length>0?console.warn(`âš ï¸ Warning: Church headers still present for ${a}:`,r):console.log(`âœ… Verified no church_id headers for ${a}`)}}return console.log(`ðŸŒ API Request: ${(S=e.method)==null?void 0:S.toUpperCase()} ${c}`),console.log(`ðŸ”§ BaseURL: "${e.baseURL||"none"}", URL: "${e.url}"`),e},e=>(console.error("âŒ Request Error:",e),Promise.reject(e))),this.instance.interceptors.response.use(e=>(console.log(`âœ… API Response: ${e.status} ${e.config.url}`),e),e=>{var a,c,g,u,m,h;console.error("âŒ Response Error:",(a=e.response)==null?void 0:a.status,(c=e.response)==null?void 0:c.data),((g=e.response)==null?void 0:g.status)===401&&(window.location.pathname.includes("/frontend-pages/homepage")||(localStorage.removeItem("auth_user"),window.location.href="/frontend-pages/homepage"));const s=new Error(((m=(u=e.response)==null?void 0:u.data)==null?void 0:m.message)||e.message||"Request failed");throw s.status=(h=e.response)==null?void 0:h.status,s.code=e.code,s.isNetworkError=!e.response,s.originalError=e,s})}request(e){return f(this,null,function*(){try{return(yield this.instance.request(e)).data}catch(s){throw s}})}get(e,s){return f(this,null,function*(){return this.request(v(C({},s),{method:"GET",url:e}))})}post(e,s,a){return f(this,null,function*(){return this.request(v(C({},a),{method:"POST",url:e,data:s}))})}put(e,s,a){return f(this,null,function*(){return this.request(v(C({},a),{method:"PUT",url:e,data:s}))})}patch(e,s,a){return f(this,null,function*(){return this.request(v(C({},a),{method:"PATCH",url:e,data:s}))})}delete(e,s){return f(this,null,function*(){return this.request(v(C({},s),{method:"DELETE",url:e}))})}uploadFile(e,s,a,c){return f(this,null,function*(){const g=new FormData;return g.append("file",s),a&&Object.entries(a).forEach(([u,m])=>{g.append(u,m)}),this.request({method:"POST",url:e,data:g,headers:{"Content-Type":"multipart/form-data"},onUploadProgress:u=>{if(c&&u.total){const m=Math.round(u.loaded*100/u.total);c(m)}}})})}buildQueryString(e){if(!e)return"";const s=new URLSearchParams;Object.entries(e).forEach(([c,g])=>{g!=null&&s.append(c,String(g))});const a=s.toString();return a?`?${a}`:""}}const t=new B;class H{constructor(){d(this,"churches",{getAll:e=>t.get(`/admin/churches${t.buildQueryString(e)}`),getById:e=>t.get(`/admin/churches/${e}`).then(s=>s.church),create:e=>t.post("/admin/churches",e),update:(e,s)=>t.put(`/admin/churches/${e}`,s),delete:(e,s)=>t.delete(`/admin/churches/${e}`,{data:{delete_database:s||!1}}),approve:(e,s)=>t.post(`/admin/churches/${e}/approve`,{notes:s}),suspend:(e,s)=>t.post(`/admin/churches/${e}/suspend`,{reason:s}),activate:e=>t.post(`/admin/churches/${e}/activate`),updateStatus:(e,s)=>t.patch(`/admin/churches/${e}/status`,{active:s}),removeAllUsers:e=>t.post(`/admin/churches/${e}/remove-all-users`),getActiveChurches:()=>t.get("/admin/churches?is_active=1"),getChurchesByLanguage:e=>t.get(`/admin/churches?preferred_language=${e}`),getChurchUsers:e=>t.get(`/admin/churches/${e}/users`),getChurchRecordCounts:e=>t.get(`/admin/churches/${e}/record-counts`),getChurchDatabaseInfo:e=>t.get(`/admin/churches/${e}/database-info`),testChurchConnection:e=>t.post(`/admin/churches/${e}/test-connection`),manageChurchUser:(e,s,a)=>t.post(`/admin/churches/${e}/users/${s}/${a}`),resetChurchUserPassword:(e,s)=>t.post(`/admin/churches/${e}/users/${s}/reset-password`),getChurchTables:e=>t.get(`/admin/churches/${e}/tables`),createChurchWizard:e=>t.post("/admin/churches/wizard",e),getChurchOverview:e=>t.get(`/admin/church/${e}/overview`),getChurchDatabaseRecordCounts:e=>t.get(`/admin/church-database/${e}/record-counts`),exportTemplate:(e,s)=>t.post(`/admin/churches/${e}/export-template`,s),getTableColumns:(e,s)=>f(this,null,function*(){var m,h,b,S;const a=encodeURIComponent,c=`?table=${a(s)}`,g=[`/api/admin/churches/${e}/tables/${a(s)}/columns`,`/api/admin/churches/${e}/columns${c}`,`/api/admin/churches/${e}/tables/${a(s)}`,`/api/admin/churches/${e}/table-columns${c}`,`/api/admin/churches/${e}/schema${c}`,`/api/admin/church/${e}/tables/${a(s)}/columns`,`/admin/churches/${e}/tables/${a(s)}/columns`,`/admin/churches/${e}/columns${c}`,`/admin/churches/${e}/tables/${a(s)}`,`/admin/churches/${e}/table-columns${c}`,`/admin/churches/${e}/schema${c}`,`/admin/church/${e}/tables/${a(s)}/columns`];let u=null;for(const r of g)try{const i=yield t.get(r),l=(b=(h=i==null?void 0:i.columns)!=null?h:(m=i==null?void 0:i.data)==null?void 0:m.columns)!=null?b:i;let o=[];if(Array.isArray(l)?o=l.map(n=>{var $,y;return typeof n=="string"?n:(y=($=n==null?void 0:n.column_name)!=null?$:n==null?void 0:n.COLUMN_NAME)!=null?y:""}).filter(Boolean):Array.isArray(l==null?void 0:l.columns)&&(o=l.columns.map(n=>{var $,y;return typeof n=="string"?n:(y=($=n==null?void 0:n.column_name)!=null?$:n==null?void 0:n.COLUMN_NAME)!=null?y:""}).filter(Boolean)),o.length)return{columns:o,via:r}}catch(i){u=i}try{const r=yield t.get(`/api/admin/churches/${e}/tables`).catch(()=>t.get(`/admin/churches/${e}/tables`)),i=(S=r==null?void 0:r.tables)!=null?S:r;if(Array.isArray(i)){const l=i.find(o=>((o==null?void 0:o.name)===s||(o==null?void 0:o.table_name)===s)&&Array.isArray(o==null?void 0:o.columns));if(l){const o=l.columns.map(n=>{var $,y;return typeof n=="string"?n:(y=($=n==null?void 0:n.column_name)!=null?$:n==null?void 0:n.COLUMN_NAME)!=null?y:""}).filter(Boolean);if(o.length)return{columns:o,via:"tables-listing"}}if(i.includes(s))throw new Error(`Table "${s}" exists but no column endpoint responded`)}}catch(r){u=r}throw u!=null?u:new Error("No matching columns endpoint responded")})});d(this,"users",{getAll:e=>t.get(`/admin/users${t.buildQueryString(e)}`),getById:e=>t.get(`/admin/users/${e}`),create:e=>t.post("/admin/users",e),update:(e,s)=>t.put(`/admin/users/${e}`,s),delete:e=>t.delete(`/admin/users/${e}`),toggleStatus:e=>t.put(`/admin/users/${e}/toggle-status`),adminResetPassword:e=>t.post("/auth/admin-reset-password",{userId:e})});d(this,"activityLogs",{getAll:e=>t.get(`/admin/activity-logs${t.buildQueryString(e)}`),getById:e=>t.get(`/admin/activity-logs/${e}`),getStats:()=>t.get("/admin/activity-logs/stats")});d(this,"provisioning",{getAll:e=>t.get(`/provisioning${t.buildQueryString(e)}`),getById:e=>t.get(`/provisioning/${e}`),create:e=>t.post("/provisioning",e),update:(e,s)=>t.put(`/provisioning/${e}`,s),delete:e=>t.delete(`/provisioning/${e}`),approve:(e,s)=>t.post(`/provisioning/${e}/approve`,{notes:s}),reject:(e,s)=>t.post(`/provisioning/${e}/reject`,{reason:s}),getStats:()=>t.get("/provisioning/stats")});d(this,"email",{sendTestEmail:e=>t.post("/email/test",e),sendBulkEmail:e=>t.post("/email/bulk",e),sendOcrResults:e=>t.post("/email/send-ocr-results",e)});d(this,"system",{getSystemStats:()=>t.get("/admin/system/system-stats"),getDatabaseHealth:()=>t.get("/admin/system/database-health"),getServerMetrics:()=>t.get("/admin/system/server-metrics"),getSystemInfo:()=>t.get("/admin/system/system-info"),getBackups:()=>t.get("/admin/system/backups"),performSystemAction:e=>t.post(e)});d(this,"services",{getStatus:()=>t.get("/admin/services/status"),getHealth:()=>t.get("/admin/services/health"),getRecentActions:()=>t.get("/admin/services/actions/recent"),performAction:(e,s)=>t.post(`/admin/services/${e}/${s}`),getBackendLogs:(e=50)=>t.get(`/admin/services/backend/logs?lines=${e}`),rebuildFrontend:()=>t.post("/admin/services/frontend/rebuild"),getServiceLogs:(e,s=100)=>t.get(`/admin/services/${e}/logs?lines=${s}`),getOmaiStatus:()=>t.get("/api/omai/status"),getOmaiHealth:()=>t.get("/api/omai/health"),getOmaiLogs:(e=1e3)=>t.get(`/api/omai/logs?max=${e}`),getOmaiSettings:()=>t.get("/api/omai/settings"),updateOmaiSettings:e=>t.put("/api/omai/settings",e),performOmaiAction:e=>t.post(`/api/omai/control/${e}`),getOmaiStats:()=>t.get("/api/omai/stats"),getOmaiAgentResults:e=>t.get(`/api/omai/agent-results/${e}`),getOmaiAgentMetrics:()=>t.get("/api/omai/agent-metrics")});d(this,"metrics",{getOrthodMetrics:()=>t.get("/metrics/orthod")});d(this,"menu",{getPermissions:()=>t.get("/menu-management/permissions"),updatePermissions:e=>t.put("/menu-management/permissions",e)});d(this,"menuPermissions",{getAll:()=>t.get("/menu-permissions"),getById:e=>t.get(`/menu-permissions/${e}`),createMenuItem:e=>t.post("/menu-permissions/menu-item",e)});d(this,"globalImages",{getAll:()=>t.get("/admin/global-images"),upload:e=>t.uploadFile("/admin/global-images/upload",e),update:(e,s)=>t.put(`/admin/global-images/${e}`,s),saveExtracted:e=>t.post("/admin/global-images/save-extracted",e),getDirectories:()=>t.get("/admin/global-images/directories"),addDirectory:e=>t.post("/admin/global-images/directories",e),updateDirectory:(e,s)=>t.put(`/admin/global-images/directories/${encodeURIComponent(e)}`,s),deleteDirectory:e=>t.delete(`/admin/global-images/directories/${encodeURIComponent(e)}`),scanDirectory:e=>t.post(`/admin/global-images/directories/${encodeURIComponent(e)}/scan`)});d(this,"backup",{getSettings:()=>t.get("/backup/settings"),updateSettings:e=>t.put("/backup/settings",e),getFiles:()=>t.get("/backup/files"),getStorage:()=>t.get("/backup/storage"),run:()=>t.post("/backup/run"),download:e=>t.get(`/backup/download/${e}`),delete:e=>t.delete(`/backup/delete/${e}`)});d(this,"nfsBackup",{getConfig:()=>t.get("/admin/nfs-backup/config"),updateConfig:e=>t.post("/admin/nfs-backup/config",e),testConnection:(e,s)=>t.post("/admin/nfs-backup/test",{nfsServerIP:e,remotePath:s}),mount:()=>t.post("/admin/nfs-backup/mount"),unmount:()=>t.post("/admin/nfs-backup/unmount"),getStatus:()=>t.get("/admin/nfs-backup/status")});d(this,"logs",{getComponents:()=>t.get("/logs/components"),getAll:e=>t.get(`/logs${t.buildQueryString(e)}`),getComponentLevel:e=>t.get(`/logs/components/${e}/level`),toggleComponent:e=>t.post(`/logs/components/${e}/toggle`),test:()=>t.post("/logs/test"),getFrontendLogs:()=>t.post("/logs/frontend")});d(this,"sessions",{getAll:e=>t.get(`/admin/sessions${t.buildQueryString(e)}`),getStats:()=>t.get("/admin/sessions/stats"),terminate:e=>t.delete(`/admin/sessions/${e}`),terminateAllForUser:e=>t.post(`/admin/sessions/user/${e}/terminate-all`),terminateAll:()=>t.post("/admin/sessions/terminate-all"),cleanup:(e=7)=>t.post("/admin/sessions/cleanup",{days_old:e})});d(this,"messages",{send:(e,s)=>t.post("/admin/messages/send",{user_id:e,message:s}),sendToSession:(e,s)=>t.post("/admin/messages/send-to-session",{session_id:e,message:s})});d(this,"test",{retryFailedJobs:()=>t.post("/admin/test/retry-failed-jobs")});d(this,"templates",{getAll:e=>t.get(`/admin/templates${t.buildQueryString(e)}`),getBySlug:e=>t.get(`/admin/templates/${e}`),create:e=>t.post("/admin/templates",e),update:(e,s)=>t.put(`/admin/templates/${e}`,s),delete:e=>t.delete(`/admin/templates/${e}`)})}}const U=new H,j=Object.freeze(Object.defineProperty({__proto__:null,adminAPI:U,default:U},Symbol.toStringTag,{value:"Module"}));export{U as a,j as b,t as c};
//# sourceMappingURL=admin.api-DTPb-BCU.js.map
