{"version":3,"file":"OMTasksPage-BlBhXcXV.js","sources":["../../node_modules/@mui/icons-material/esm/AttachFile.js","../../node_modules/@mui/icons-material/esm/Email.js","../../node_modules/@mui/icons-material/esm/InsertDriveFile.js","../../node_modules/@mui/icons-material/esm/Link.js","../../node_modules/@mui/icons-material/esm/RemoveRedEye.js","../../node_modules/@mui/icons-material/esm/Task.js","../../src/api/omai.api.ts","../../src/features/devel-tools/om-tasks/components/EmailSettingsForm.tsx","../../src/features/devel-tools/om-tasks/components/CreateTaskDialog.tsx","../../src/features/devel-tools/om-tasks/components/OMAITaskAssignmentWidget.tsx","../../src/features/devel-tools/om-tasks/OMTasksPage.tsx"],"sourcesContent":["\"use client\";\n\nimport createSvgIcon from './utils/createSvgIcon';\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nexport default createSvgIcon( /*#__PURE__*/_jsx(\"path\", {\n  d: \"M16.5 6v11.5c0 2.21-1.79 4-4 4s-4-1.79-4-4V5c0-1.38 1.12-2.5 2.5-2.5s2.5 1.12 2.5 2.5v10.5c0 .55-.45 1-1 1s-1-.45-1-1V6H10v9.5c0 1.38 1.12 2.5 2.5 2.5s2.5-1.12 2.5-2.5V5c0-2.21-1.79-4-4-4S7 2.79 7 5v12.5c0 3.04 2.46 5.5 5.5 5.5s5.5-2.46 5.5-5.5V6z\"\n}), 'AttachFile');","\"use client\";\n\nimport createSvgIcon from './utils/createSvgIcon';\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nexport default createSvgIcon( /*#__PURE__*/_jsx(\"path\", {\n  d: \"M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2m0 4-8 5-8-5V6l8 5 8-5z\"\n}), 'Email');","\"use client\";\n\nimport createSvgIcon from './utils/createSvgIcon';\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nexport default createSvgIcon( /*#__PURE__*/_jsx(\"path\", {\n  d: \"M6 2c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm7 7V3.5L18.5 9z\"\n}), 'InsertDriveFile');","\"use client\";\n\nimport createSvgIcon from './utils/createSvgIcon';\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nexport default createSvgIcon( /*#__PURE__*/_jsx(\"path\", {\n  d: \"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1M8 13h8v-2H8zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5\"\n}), 'Link');","\"use client\";\n\nimport createSvgIcon from './utils/createSvgIcon';\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nexport default createSvgIcon( /*#__PURE__*/_jsx(\"path\", {\n  d: \"M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5M12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5m0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3\"\n}), 'RemoveRedEye');","\"use client\";\n\nimport createSvgIcon from './utils/createSvgIcon';\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nexport default createSvgIcon( /*#__PURE__*/_jsx(\"path\", {\n  d: \"M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8zm-3.06 16L7.4 14.46l1.41-1.41 2.12 2.12 4.24-4.24 1.41 1.41zM13 9V3.5L18.5 9z\"\n}), 'Task');","// OMAI API - Task Assignment and Management\r\nexport const omaiAPI = {\r\n  // Validate email format\r\n  validateEmail: (email: string): boolean => {\r\n    const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\r\n    return emailRegex.test(email);\r\n  },\r\n\r\n  // Get task logs (recent activity)\r\n  getTaskLogs: async (limit: number = 50) => {\r\n    try {\r\n      const response = await fetch(`/api/omai/task-logs?limit=${limit}`, {\r\n        credentials: 'include'\r\n      });\r\n      \r\n      if (!response.ok) {\r\n        throw new Error(`Failed to fetch task logs: ${response.statusText}`);\r\n      }\r\n      \r\n      const data = await response.json();\r\n      return data;\r\n    } catch (error: any) {\r\n      console.error('Error fetching task logs:', error);\r\n      return {\r\n        success: false,\r\n        error: error.message || 'Failed to fetch task logs',\r\n        data: {\r\n          recent_links: [],\r\n          recent_submissions: [],\r\n          recent_logs: []\r\n        }\r\n      };\r\n    }\r\n  },\r\n\r\n  // Get task history with filters\r\n  getTaskHistory: async (filters: {\r\n    page?: number;\r\n    limit?: number;\r\n    email?: string;\r\n    status?: string;\r\n    type?: string;\r\n    dateFrom?: string;\r\n    dateTo?: string;\r\n  }) => {\r\n    try {\r\n      const params = new URLSearchParams();\r\n      if (filters.page) params.append('page', filters.page.toString());\r\n      if (filters.limit) params.append('limit', filters.limit.toString());\r\n      if (filters.email) params.append('email', filters.email);\r\n      if (filters.status) params.append('status', filters.status);\r\n      if (filters.type) params.append('type', filters.type);\r\n      if (filters.dateFrom) params.append('dateFrom', filters.dateFrom);\r\n      if (filters.dateTo) params.append('dateTo', filters.dateTo);\r\n\r\n      const response = await fetch(`/api/omai/task-history?${params.toString()}`, {\r\n        credentials: 'include'\r\n      });\r\n      \r\n      if (!response.ok) {\r\n        throw new Error(`Failed to fetch task history: ${response.statusText}`);\r\n      }\r\n      \r\n      const data = await response.json();\r\n      return data;\r\n    } catch (error: any) {\r\n      console.error('Error fetching task history:', error);\r\n      return {\r\n        success: false,\r\n        error: error.message || 'Failed to fetch task history',\r\n        data: {\r\n          submissions: [],\r\n          total: 0\r\n        }\r\n      };\r\n    }\r\n  },\r\n\r\n  // Generate task assignment link (Admin endpoint - based on PUBLIC_TASK_ASSIGNMENT_API.md)\r\n  // This is an admin version that includes email tracking\r\n  generateTaskLink: async (email: string, options: {\r\n    notes?: string;\r\n    expiresInMinutes?: number;\r\n  }) => {\r\n    try {\r\n      // Admin endpoint: POST /api/omai/task-link with email tracking\r\n      // Public endpoint (from docs): POST /api/omai/task-link without email\r\n      const response = await fetch('/api/omai/task-link', {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json'\r\n        },\r\n        credentials: 'include',\r\n        body: JSON.stringify({\r\n          email, // Admin-specific: track which admin generated the link\r\n          expiresInMinutes: options.expiresInMinutes || 1440,\r\n          meta: {\r\n            notes: options.notes || '',\r\n            source: 'admin-panel',\r\n            purpose: 'task-assignment'\r\n          }\r\n        })\r\n      });\r\n      \r\n      if (!response.ok) {\r\n        const errorData = await response.json().catch(() => ({}));\r\n        throw new Error(errorData.error || `Failed to generate task link: ${response.statusText}`);\r\n      }\r\n      \r\n      const data = await response.json();\r\n      return data;\r\n    } catch (error: any) {\r\n      console.error('Error generating task link:', error);\r\n      return {\r\n        success: false,\r\n        error: error.message || 'Failed to generate task link'\r\n      };\r\n    }\r\n  },\r\n\r\n  // Validate token (from PUBLIC_TASK_ASSIGNMENT_API.md)\r\n  validateToken: async (token: string) => {\r\n    try {\r\n      const response = await fetch(`/api/omai/validate-token?t=${token}`, {\r\n        credentials: 'include'\r\n      });\r\n      \r\n      if (!response.ok) {\r\n        throw new Error(`Failed to validate token: ${response.statusText}`);\r\n      }\r\n      \r\n      const data = await response.json();\r\n      return data;\r\n    } catch (error: any) {\r\n      console.error('Error validating token:', error);\r\n      return {\r\n        success: false,\r\n        valid: false,\r\n        error: error.message || 'Failed to validate token'\r\n      };\r\n    }\r\n  },\r\n\r\n  // Submit tasks (from PUBLIC_TASK_ASSIGNMENT_API.md)\r\n  submitTask: async (token: string, tasks: Array<{\r\n    title: string;\r\n    description?: string;\r\n    priority?: string;\r\n  }>) => {\r\n    try {\r\n      const response = await fetch('/api/omai/submit-task', {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json'\r\n        },\r\n        credentials: 'include',\r\n        body: JSON.stringify({\r\n          token,\r\n          tasks\r\n        })\r\n      });\r\n      \r\n      if (!response.ok) {\r\n        const errorData = await response.json().catch(() => ({}));\r\n        throw new Error(errorData.error || `Failed to submit tasks: ${response.statusText}`);\r\n      }\r\n      \r\n      const data = await response.json();\r\n      return data;\r\n    } catch (error: any) {\r\n      console.error('Error submitting tasks:', error);\r\n      return {\r\n        success: false,\r\n        error: error.message || 'Failed to submit tasks'\r\n      };\r\n    }\r\n  },\r\n\r\n  // Get public token statistics (from PUBLIC_TASK_ASSIGNMENT_API.md - Admin endpoint)\r\n  getPublicTokenStatistics: async () => {\r\n    try {\r\n      const response = await fetch('/api/omai/public-tokens', {\r\n        credentials: 'include'\r\n      });\r\n      \r\n      if (!response.ok) {\r\n        throw new Error(`Failed to fetch public token statistics: ${response.statusText}`);\r\n      }\r\n      \r\n      const data = await response.json();\r\n      return data;\r\n    } catch (error: any) {\r\n      console.error('Error fetching public token statistics:', error);\r\n      return {\r\n        success: false,\r\n        error: error.message || 'Failed to fetch public token statistics',\r\n        data: {\r\n          statistics: {\r\n            total: 0,\r\n            active: 0,\r\n            expired: 0,\r\n            used: 0,\r\n            rateLimitEntries: 0\r\n          },\r\n          active_tokens: []\r\n        }\r\n      };\r\n    }\r\n  },\r\n\r\n  // Delete public token (from PUBLIC_TASK_ASSIGNMENT_API.md - Admin endpoint)\r\n  deletePublicToken: async (token: string) => {\r\n    try {\r\n      const response = await fetch(`/api/omai/public-token/${token}`, {\r\n        method: 'DELETE',\r\n        credentials: 'include'\r\n      });\r\n      \r\n      if (!response.ok) {\r\n        const errorData = await response.json().catch(() => ({}));\r\n        throw new Error(errorData.error || `Failed to delete public token: ${response.statusText}`);\r\n      }\r\n      \r\n      const data = await response.json();\r\n      return data;\r\n    } catch (error: any) {\r\n      console.error('Error deleting public token:', error);\r\n      return {\r\n        success: false,\r\n        error: error.message || 'Failed to delete public token'\r\n      };\r\n    }\r\n  },\r\n\r\n  // Delete task link\r\n  deleteTaskLink: async (linkId: number) => {\r\n    try {\r\n      const response = await fetch(`/api/omai/task-link/${linkId}`, {\r\n        method: 'DELETE',\r\n        credentials: 'include'\r\n      });\r\n      \r\n      if (!response.ok) {\r\n        const errorData = await response.json().catch(() => ({}));\r\n        throw new Error(errorData.error || `Failed to delete task link: ${response.statusText}`);\r\n      }\r\n      \r\n      const data = await response.json();\r\n      return data;\r\n    } catch (error: any) {\r\n      console.error('Error deleting task link:', error);\r\n      return {\r\n        success: false,\r\n        error: error.message || 'Failed to delete task link'\r\n      };\r\n    }\r\n  },\r\n\r\n  // Delete task submission\r\n  deleteSubmission: async (submissionId: number) => {\r\n    try {\r\n      const response = await fetch(`/api/omai/task-submission/${submissionId}`, {\r\n        method: 'DELETE',\r\n        credentials: 'include'\r\n      });\r\n      \r\n      if (!response.ok) {\r\n        const errorData = await response.json().catch(() => ({}));\r\n        throw new Error(errorData.error || `Failed to delete submission: ${response.statusText}`);\r\n      }\r\n      \r\n      const data = await response.json();\r\n      return data;\r\n    } catch (error: any) {\r\n      console.error('Error deleting submission:', error);\r\n      return {\r\n        success: false,\r\n        error: error.message || 'Failed to delete submission'\r\n      };\r\n    }\r\n  },\r\n\r\n  // Delete multiple submissions (batch)\r\n  deleteSubmissionsBatch: async (submissionIds: number[]) => {\r\n    try {\r\n      const response = await fetch('/api/omai/task-submissions/batch', {\r\n        method: 'DELETE',\r\n        headers: {\r\n          'Content-Type': 'application/json'\r\n        },\r\n        credentials: 'include',\r\n        body: JSON.stringify({ ids: submissionIds })\r\n      });\r\n      \r\n      if (!response.ok) {\r\n        const errorData = await response.json().catch(() => ({}));\r\n        throw new Error(errorData.error || `Failed to delete submissions: ${response.statusText}`);\r\n      }\r\n      \r\n      const data = await response.json();\r\n      return data;\r\n    } catch (error: any) {\r\n      console.error('Error deleting submissions batch:', error);\r\n      return {\r\n        success: false,\r\n        error: error.message || 'Failed to delete submissions'\r\n      };\r\n    }\r\n  },\r\n\r\n  // Create task (Admin endpoint)\r\n  createTask: async (taskData: {\r\n    title: string;\r\n    category: string;\r\n    importance: string;\r\n    details: string;\r\n    tags: string[];\r\n    attachments?: string[];\r\n    status: number;\r\n    type: 'documentation' | 'configuration' | 'reference' | 'guide';\r\n    visibility: 'admin' | 'public';\r\n    date_created?: string;\r\n    date_completed?: string;\r\n    assignedTo?: string;\r\n    assignedBy?: string;\r\n    notes?: string;\r\n    remindMe?: boolean;\r\n    revisions?: any[];\r\n  }) => {\r\n    try {\r\n      const response = await fetch('/api/omai/tasks', {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json'\r\n        },\r\n        credentials: 'include',\r\n        body: JSON.stringify(taskData)\r\n      });\r\n      \r\n      if (!response.ok) {\r\n        let errorMessage = `Failed to create task: ${response.statusText}`;\r\n        let errorDetails: any = null;\r\n        \r\n        if (response.status === 404) {\r\n          errorMessage = 'Backend endpoint not found. The task creation API endpoint needs to be implemented on the server.';\r\n        } else {\r\n          try {\r\n            const errorData = await response.json();\r\n            errorMessage = errorData.error || errorMessage;\r\n            errorDetails = errorData.details || null;\r\n            \r\n            // Include SQL error details if available (for debugging)\r\n            if (errorDetails && errorDetails.sqlMessage) {\r\n              errorMessage += ` (${errorDetails.sqlMessage})`;\r\n            }\r\n          } catch {\r\n            // If response is not JSON, use status text\r\n          }\r\n        }\r\n        \r\n        const error = new Error(errorMessage) as any;\r\n        error.details = errorDetails;\r\n        throw error;\r\n      }\r\n      \r\n      const data = await response.json();\r\n      return {\r\n        success: true,\r\n        data\r\n      };\r\n    } catch (error: any) {\r\n      console.error('Error creating task:', error);\r\n      throw error; // Re-throw to let the caller handle it\r\n    }\r\n  },\r\n\r\n  // Get tasks (Admin endpoint - returns all tasks for admins)\r\n  getTasks: async (filters?: {\r\n    visibility?: 'admin' | 'public' | 'all';\r\n    status?: number;\r\n    category?: string;\r\n    type?: string;\r\n    page?: number;\r\n    limit?: number;\r\n  }) => {\r\n    try {\r\n      const params = new URLSearchParams();\r\n      if (filters?.visibility) params.append('visibility', filters.visibility);\r\n      if (filters?.status) params.append('status', filters.status.toString());\r\n      if (filters?.category) params.append('category', filters.category);\r\n      if (filters?.type) params.append('type', filters.type);\r\n      if (filters?.page) params.append('page', filters.page.toString());\r\n      if (filters?.limit) params.append('limit', filters.limit.toString());\r\n\r\n      const response = await fetch(`/api/omai/tasks?${params.toString()}`, {\r\n        credentials: 'include'\r\n      });\r\n      \r\n      if (!response.ok) {\r\n        throw new Error(`Failed to fetch tasks: ${response.statusText}`);\r\n      }\r\n      \r\n      const data = await response.json();\r\n      return data;\r\n    } catch (error: any) {\r\n      console.error('Error fetching tasks:', error);\r\n      return {\r\n        success: false,\r\n        error: error.message || 'Failed to fetch tasks',\r\n        data: {\r\n          tasks: [],\r\n          total: 0\r\n        }\r\n      };\r\n    }\r\n  },\r\n\r\n  // Get public tasks (Public endpoint - only returns visibility='public' tasks)\r\n  getPublicTasks: async (filters?: {\r\n    category?: string;\r\n    status?: number;\r\n    type?: string;\r\n    page?: number;\r\n    limit?: number;\r\n  }) => {\r\n    try {\r\n      const params = new URLSearchParams();\r\n      if (filters?.category) params.append('category', filters.category);\r\n      if (filters?.status) params.append('status', filters.status.toString());\r\n      if (filters?.type) params.append('type', filters.type);\r\n      if (filters?.page) params.append('page', filters.page.toString());\r\n      if (filters?.limit) params.append('limit', filters.limit.toString());\r\n\r\n      const response = await fetch(`/api/public/tasks?${params.toString()}`);\r\n      \r\n      if (!response.ok) {\r\n        throw new Error(`Failed to fetch public tasks: ${response.statusText}`);\r\n      }\r\n      \r\n      const data = await response.json();\r\n      return data;\r\n    } catch (error: any) {\r\n      console.error('Error fetching public tasks:', error);\r\n      return {\r\n        success: false,\r\n        error: error.message || 'Failed to fetch public tasks',\r\n        data: {\r\n          tasks: [],\r\n          total: 0\r\n        }\r\n      };\r\n    }\r\n  },\r\n\r\n  // Get public task by ID (Public endpoint)\r\n  getPublicTask: async (taskId: string | number) => {\r\n    try {\r\n      const response = await fetch(`/api/public/tasks/${taskId}`);\r\n      \r\n      if (!response.ok) {\r\n        throw new Error(`Failed to fetch task: ${response.statusText}`);\r\n      }\r\n      \r\n      const data = await response.json();\r\n      return data;\r\n    } catch (error: any) {\r\n      console.error('Error fetching public task:', error);\r\n      return {\r\n        success: false,\r\n        error: error.message || 'Failed to fetch task'\r\n      };\r\n    }\r\n  },\r\n\r\n  // Legacy placeholder methods (kept for compatibility)\r\n  assignTask: async (taskData: any) => {\r\n    console.warn('OMAI API assignTask is deprecated, use generateTaskLink instead');\r\n    return { success: false, message: 'OMAI API assignTask is deprecated' };\r\n  },\r\n  \r\n  \r\n  updateTask: async (taskId: string, updates: any) => {\r\n    console.warn('OMAI API updateTask is deprecated');\r\n    return { success: false, message: 'OMAI API updateTask is deprecated' };\r\n  }\r\n};\r\n","/**\r\n * EmailSettingsForm.tsx\r\n * SMTP Email Configuration Form for Admin Settings\r\n * Allows admins to configure custom email providers\r\n */\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport {\r\n  Card,\r\n  CardContent,\r\n  Typography,\r\n  TextField,\r\n  Button,\r\n  Alert,\r\n  CircularProgress,\r\n  Box,\r\n  FormControl,\r\n  InputLabel,\r\n  Select,\r\n  MenuItem,\r\n  FormControlLabel,\r\n  Switch,\r\n  Grid,\r\n  Divider,\r\n  Dialog,\r\n  DialogTitle,\r\n  DialogContent,\r\n  DialogActions,\r\n  Chip,\r\n  Paper\r\n} from '@mui/material';\r\nimport {\r\n  Save as SaveIcon,\r\n  Send as TestIcon,\r\n  Email as EmailIcon,\r\n  Settings as SettingsIcon,\r\n  CheckCircle as CheckCircleIcon,\r\n  Error as ErrorIcon,\r\n  Info as InfoIcon\r\n} from '@mui/icons-material';\r\nimport { useAuth } from '@/context/AuthContext';\r\n\r\n// Types\r\ninterface EmailConfig {\r\n  id?: number;\r\n  provider: string;\r\n  smtp_host: string;\r\n  smtp_port: number;\r\n  smtp_secure: boolean;\r\n  smtp_user: string;\r\n  smtp_pass?: string; // Only used when updating password\r\n  sender_name: string;\r\n  sender_email: string;\r\n  updated_at?: string;\r\n}\r\n\r\ninterface EmailTestResponse {\r\n  success: boolean;\r\n  message: string;\r\n  data?: {\r\n    test_email: string;\r\n    message_id: string;\r\n    provider: string;\r\n    smtp_host: string;\r\n  };\r\n  error?: string;\r\n}\r\n\r\nconst EmailSettingsForm: React.FC = () => {\r\n  const { hasRole, isSuperAdmin } = useAuth();\r\n  const [config, setConfig] = useState<EmailConfig>({\r\n    provider: 'Custom',\r\n    smtp_host: '',\r\n    smtp_port: 587,\r\n    smtp_secure: false,\r\n    smtp_user: '',\r\n    smtp_pass: '',\r\n    sender_name: 'OMAI Task System',\r\n    sender_email: ''\r\n  });\r\n  \r\n  const [loading, setLoading] = useState(true);\r\n  const [saving, setSaving] = useState(false);\r\n  const [testing, setTesting] = useState(false);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [success, setSuccess] = useState<string | null>(null);\r\n  const [testDialogOpen, setTestDialogOpen] = useState(false);\r\n  const [testEmail, setTestEmail] = useState('');\r\n\r\n  // Check if user has permission\r\n  const canManage = isSuperAdmin() || hasRole('admin');\r\n\r\n  // Provider presets\r\n  const providerPresets = {\r\n    'GoDaddy': {\r\n      smtp_host: 'smtpout.secureserver.net',\r\n      smtp_port: 465,\r\n      smtp_secure: true\r\n    },\r\n    'Outlook365': {\r\n      smtp_host: 'smtp-mail.outlook.com',\r\n      smtp_port: 587,\r\n      smtp_secure: false\r\n    },\r\n    'Gmail': {\r\n      smtp_host: 'smtp.gmail.com',\r\n      smtp_port: 587,\r\n      smtp_secure: false\r\n    },\r\n    'Yahoo': {\r\n      smtp_host: 'smtp.mail.yahoo.com',\r\n      smtp_port: 587,\r\n      smtp_secure: false\r\n    },\r\n    'Custom': {\r\n      smtp_host: '',\r\n      smtp_port: 587,\r\n      smtp_secure: false\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (canManage) {\r\n      fetchEmailConfig();\r\n    }\r\n  }, [canManage]);\r\n\r\n  const fetchEmailConfig = async () => {\r\n    try {\r\n      setError(null);\r\n      const response = await fetch('/api/settings/email', {\r\n        credentials: 'include'\r\n      });\r\n      \r\n      if (response.status === 404) {\r\n        // No config found, use defaults\r\n        setLoading(false);\r\n        return;\r\n      }\r\n      \r\n      if (!response.ok) {\r\n        throw new Error('Failed to fetch email configuration');\r\n      }\r\n      \r\n      const data = await response.json();\r\n      if (data.success && data.data) {\r\n        setConfig(prev => ({ ...prev, ...data.data })); // Keep existing password if not provided\r\n      }\r\n    } catch (err: any) {\r\n      setError(err.message || 'Failed to load email configuration');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleProviderChange = (provider: string) => {\r\n    const preset = providerPresets[provider as keyof typeof providerPresets];\r\n    if (preset) {\r\n      setConfig(prev => ({\r\n        ...prev,\r\n        provider,\r\n        ...preset\r\n      }));\r\n    }\r\n  };\r\n\r\n  const handleSave = async () => {\r\n    setError(null);\r\n    setSuccess(null);\r\n    setSaving(true);\r\n\r\n    try {\r\n      // Validate required fields (password is optional - only required for new configs)\r\n      if (!config.smtp_host || !config.smtp_user || !config.sender_email) {\r\n        throw new Error('Please fill in all required fields');\r\n      }\r\n      \r\n      // If this is a new configuration (no ID), password is required\r\n      if (!config.id && !config.smtp_pass) {\r\n        throw new Error('Password is required for new email configurations');\r\n      }\r\n\r\n      // Prepare request body - omit smtp_pass if it's empty/whitespace (for UPDATE operations)\r\n      const requestBody: any = { ...config };\r\n      // Only send password if it's provided (non-empty)\r\n      // If password is empty/whitespace and we have an existing config, omit it to preserve existing password\r\n      if ((!requestBody.smtp_pass || requestBody.smtp_pass.trim() === '') && config.id) {\r\n        delete requestBody.smtp_pass;\r\n      }\r\n\r\n      const response = await fetch('/api/settings/email', {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json'\r\n        },\r\n        credentials: 'include',\r\n        body: JSON.stringify(requestBody)\r\n      });\r\n\r\n      const data = await response.json();\r\n      \r\n      if (!response.ok) {\r\n        throw new Error(data.error || 'Failed to save email configuration');\r\n      }\r\n\r\n      if (data.success) {\r\n        setSuccess('Email configuration saved successfully!');\r\n        setConfig(prev => ({ ...prev, ...data.data })); // Keep password field\r\n      } else {\r\n        throw new Error(data.error || 'Failed to save configuration');\r\n      }\r\n    } catch (err: any) {\r\n      setError(err.message || 'Failed to save email configuration');\r\n    } finally {\r\n      setSaving(false);\r\n    }\r\n  };\r\n\r\n  const handleTestEmail = async () => {\r\n    if (!testEmail) {\r\n      setError('Please enter a test email address');\r\n      return;\r\n    }\r\n\r\n    setError(null);\r\n    setSuccess(null);\r\n    setTesting(true);\r\n\r\n    try {\r\n      const response = await fetch('/api/settings/email/test', {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json'\r\n        },\r\n        credentials: 'include',\r\n        body: JSON.stringify({ test_email: testEmail })\r\n      });\r\n\r\n      const data: EmailTestResponse = await response.json();\r\n      \r\n      if (!response.ok) {\r\n        throw new Error(data.error || 'Email test failed');\r\n      }\r\n\r\n      if (data.success) {\r\n        setSuccess(`Test email sent successfully to ${testEmail}!`);\r\n        setTestDialogOpen(false);\r\n        setTestEmail('');\r\n      } else {\r\n        throw new Error(data.error || 'Email test failed');\r\n      }\r\n    } catch (err: any) {\r\n      setError(err.message || 'Failed to send test email');\r\n    } finally {\r\n      setTesting(false);\r\n    }\r\n  };\r\n\r\n  if (!canManage) {\r\n    return (\r\n      <Alert severity=\"warning\" sx={{ m: 2 }}>\r\n        You don't have permission to manage email settings.\r\n      </Alert>\r\n    );\r\n  }\r\n\r\n  if (loading) {\r\n    return (\r\n      <Box display=\"flex\" justifyContent=\"center\" alignItems=\"center\" py={4}>\r\n        <CircularProgress />\r\n        <Typography variant=\"body1\" sx={{ ml: 2 }}>\r\n          Loading email configuration...\r\n        </Typography>\r\n      </Box>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <Card>\r\n        <CardContent>\r\n          {/* Header */}\r\n          <Box display=\"flex\" alignItems=\"center\" mb={3}>\r\n            <EmailIcon sx={{ mr: 2, color: '#8c249d' }} />\r\n            <Box>\r\n              <Typography variant=\"h5\">Email Configuration</Typography>\r\n              <Typography variant=\"body2\" color=\"text.secondary\">\r\n                Configure SMTP settings for OMAI task assignment emails\r\n              </Typography>\r\n            </Box>\r\n          </Box>\r\n\r\n          {/* Status Alerts */}\r\n          {error && (\r\n            <Alert severity=\"error\" sx={{ mb: 2 }} onClose={() => setError(null)}>\r\n              {error}\r\n            </Alert>\r\n          )}\r\n          \r\n          {success && (\r\n            <Alert severity=\"success\" sx={{ mb: 2 }} onClose={() => setSuccess(null)}>\r\n              {success}\r\n            </Alert>\r\n          )}\r\n\r\n          {/* Form */}\r\n          <Grid container spacing={3}>\r\n            {/* Provider Selection */}\r\n            <Grid item xs={12} md={6}>\r\n              <FormControl fullWidth>\r\n                <InputLabel>Email Provider</InputLabel>\r\n                <Select\r\n                  value={config.provider}\r\n                  label=\"Email Provider\"\r\n                  onChange={(e) => handleProviderChange(e.target.value)}\r\n                >\r\n                  {Object.keys(providerPresets).map((provider) => (\r\n                    <MenuItem key={provider} value={provider}>\r\n                      {provider}\r\n                    </MenuItem>\r\n                  ))}\r\n                </Select>\r\n              </FormControl>\r\n            </Grid>\r\n\r\n            {/* SMTP Host */}\r\n            <Grid item xs={12} md={6}>\r\n              <TextField\r\n                fullWidth\r\n                label=\"SMTP Host\"\r\n                value={config.smtp_host}\r\n                onChange={(e) => setConfig(prev => ({ ...prev, smtp_host: e.target.value }))}\r\n                placeholder=\"smtp.example.com\"\r\n                required\r\n              />\r\n            </Grid>\r\n\r\n            {/* SMTP Port and Security */}\r\n            <Grid item xs={12} md={6}>\r\n              <TextField\r\n                fullWidth\r\n                label=\"SMTP Port\"\r\n                type=\"number\"\r\n                value={config.smtp_port}\r\n                onChange={(e) => setConfig(prev => ({ ...prev, smtp_port: parseInt(e.target.value) || 587 }))}\r\n                required\r\n              />\r\n            </Grid>\r\n\r\n            <Grid item xs={12} md={6}>\r\n              <FormControlLabel\r\n                control={\r\n                  <Switch\r\n                    checked={config.smtp_secure}\r\n                    onChange={(e) => setConfig(prev => ({ ...prev, smtp_secure: e.target.checked }))}\r\n                  />\r\n                }\r\n                label={config.smtp_secure ? 'SSL (Port 465)' : 'STARTTLS (Port 587)'}\r\n              />\r\n            </Grid>\r\n\r\n            <Grid item xs={12}>\r\n              <Divider sx={{ my: 2 }} />\r\n              <Typography variant=\"h6\" gutterBottom>\r\n                Authentication\r\n              </Typography>\r\n            </Grid>\r\n\r\n            {/* SMTP Credentials */}\r\n            <Grid item xs={12} md={6}>\r\n              <TextField\r\n                fullWidth\r\n                label=\"SMTP Username\"\r\n                value={config.smtp_user}\r\n                onChange={(e) => setConfig(prev => ({ ...prev, smtp_user: e.target.value }))}\r\n                placeholder=\"your-email@example.com\"\r\n                required\r\n              />\r\n            </Grid>\r\n\r\n            <Grid item xs={12} md={6}>\r\n              <TextField\r\n                fullWidth\r\n                label=\"SMTP Password\"\r\n                type=\"password\"\r\n                value={config.smtp_pass}\r\n                onChange={(e) => setConfig(prev => ({ ...prev, smtp_pass: e.target.value }))}\r\n                placeholder=\"Leave blank to keep existing password\"\r\n                helperText=\"Only required when changing password. Leave blank to keep current encrypted password.\"\r\n              />\r\n            </Grid>\r\n\r\n            <Grid item xs={12}>\r\n              <Divider sx={{ my: 2 }} />\r\n              <Typography variant=\"h6\" gutterBottom>\r\n                Sender Information\r\n              </Typography>\r\n            </Grid>\r\n\r\n            {/* Sender Info */}\r\n            <Grid item xs={12} md={6}>\r\n              <TextField\r\n                fullWidth\r\n                label=\"Sender Name\"\r\n                value={config.sender_name}\r\n                onChange={(e) => setConfig(prev => ({ ...prev, sender_name: e.target.value }))}\r\n                placeholder=\"OMAI Task System\"\r\n                required\r\n              />\r\n            </Grid>\r\n\r\n            <Grid item xs={12} md={6}>\r\n              <TextField\r\n                fullWidth\r\n                label=\"Sender Email\"\r\n                type=\"email\"\r\n                value={config.sender_email}\r\n                onChange={(e) => setConfig(prev => ({ ...prev, sender_email: e.target.value }))}\r\n                placeholder=\"noreply@yourdomain.com\"\r\n                required\r\n              />\r\n            </Grid>\r\n          </Grid>\r\n\r\n          {/* Preview */}\r\n          {config.sender_name && config.sender_email && (\r\n            <Paper sx={{ p: 2, mt: 3, bgcolor: '#f9f9f9' }}>\r\n              <Typography variant=\"subtitle2\" gutterBottom>\r\n                Email Preview:\r\n              </Typography>\r\n              <Typography variant=\"body2\">\r\n                <strong>From:</strong> \"{config.sender_name}\" &lt;{config.sender_email}&gt;\r\n              </Typography>\r\n              <Typography variant=\"body2\">\r\n                <strong>Server:</strong> {config.smtp_host}:{config.smtp_port} ({config.smtp_secure ? 'SSL' : 'STARTTLS'})\r\n              </Typography>\r\n            </Paper>\r\n          )}\r\n\r\n          {/* Action Buttons */}\r\n          <Box display=\"flex\" gap={2} mt={3}>\r\n            <Button\r\n              variant=\"contained\"\r\n              onClick={handleSave}\r\n              disabled={saving}\r\n              startIcon={saving ? <CircularProgress size={20} /> : <SaveIcon />}\r\n              sx={{ bgcolor: '#8c249d' }}\r\n            >\r\n              {saving ? 'Saving...' : 'Save Configuration'}\r\n            </Button>\r\n\r\n            <Button\r\n              variant=\"outlined\"\r\n              onClick={() => setTestDialogOpen(true)}\r\n              disabled={!config.smtp_host || !config.smtp_user}\r\n              startIcon={<TestIcon />}\r\n            >\r\n              Test Email\r\n            </Button>\r\n          </Box>\r\n\r\n          {/* Help Text */}\r\n          <Alert severity=\"info\" sx={{ mt: 3 }}>\r\n            <Typography variant=\"body2\">\r\n              <strong>Provider Setup Tips:</strong>\r\n              <br />\r\n              • <strong>GoDaddy:</strong> Use your cPanel email or workspace email with an app password\r\n              • <strong>Outlook 365:</strong> Enable SMTP AUTH and use an app password if 2FA is enabled\r\n              • <strong>Gmail:</strong> Use an app password instead of your regular password\r\n              • <strong>Custom:</strong> Contact your email provider for SMTP settings\r\n            </Typography>\r\n          </Alert>\r\n        </CardContent>\r\n      </Card>\r\n\r\n      {/* Test Email Dialog */}\r\n      <Dialog open={testDialogOpen} onClose={() => setTestDialogOpen(false)} maxWidth=\"sm\" fullWidth>\r\n        <DialogTitle>Test Email Configuration</DialogTitle>\r\n        <DialogContent>\r\n          <Typography variant=\"body2\" color=\"text.secondary\" sx={{ mb: 2 }}>\r\n            Send a test email to verify your SMTP configuration is working correctly.\r\n          </Typography>\r\n          <TextField\r\n            fullWidth\r\n            label=\"Test Email Address\"\r\n            type=\"email\"\r\n            value={testEmail}\r\n            onChange={(e) => setTestEmail(e.target.value)}\r\n            placeholder=\"test@example.com\"\r\n            sx={{ mt: 1 }}\r\n          />\r\n        </DialogContent>\r\n        <DialogActions>\r\n          <Button onClick={() => setTestDialogOpen(false)}>\r\n            Cancel\r\n          </Button>\r\n          <Button\r\n            onClick={handleTestEmail}\r\n            variant=\"contained\"\r\n            disabled={testing || !testEmail}\r\n            startIcon={testing ? <CircularProgress size={20} /> : <TestIcon />}\r\n            sx={{ bgcolor: '#8c249d' }}\r\n          >\r\n            {testing ? 'Sending...' : 'Send Test Email'}\r\n          </Button>\r\n        </DialogActions>\r\n      </Dialog>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default EmailSettingsForm;\r\n\r\n","/**\r\n * CreateTaskDialog.tsx\r\n * Dialog for creating new tasks with visibility control\r\n * Features: Persistent draft state, localStorage, drag-and-drop .md files\r\n */\r\n\r\nimport React, { useState, useEffect, useRef, useCallback } from 'react';\r\nimport {\r\n  Dialog,\r\n  DialogTitle,\r\n  DialogContent,\r\n  DialogActions,\r\n  Button,\r\n  TextField,\r\n  FormControl,\r\n  InputLabel,\r\n  Select,\r\n  MenuItem,\r\n  Box,\r\n  Typography,\r\n  Chip,\r\n  Stack,\r\n  Divider,\r\n  Alert,\r\n  Autocomplete,\r\n  FormHelperText,\r\n  Backdrop,\r\n  CircularProgress\r\n} from '@mui/material';\r\nimport {\r\n  Save as SaveIcon,\r\n  Cancel as CancelIcon,\r\n  AttachFile as AttachFileIcon,\r\n  CloudUpload as CloudUploadIcon,\r\n  InsertDriveFile as FileIcon,\r\n  ExpandMore as ExpandMoreIcon\r\n} from '@mui/icons-material';\r\nimport Accordion from '@mui/material/Accordion';\r\nimport AccordionSummary from '@mui/material/AccordionSummary';\r\nimport AccordionDetails from '@mui/material/AccordionDetails';\r\n\r\n// Categories from requirements\r\nconst TASK_CATEGORIES = [\r\n  'Ingestion & Digitization',\r\n  'Data Structuring & Accuracy',\r\n  'Workflow & User Experience',\r\n  'Platform & Infrastructure',\r\n  'Analytics & Intelligence'\r\n];\r\n\r\n// Importance levels (B12-15 list - using common task priority levels)\r\nconst IMPORTANCE_LEVELS = [\r\n  { value: 'critical', label: 'Critical', color: 'error' },\r\n  { value: 'high', label: 'High', color: 'warning' },\r\n  { value: 'medium', label: 'Medium', color: 'info' },\r\n  { value: 'low', label: 'Low', color: 'default' }\r\n];\r\n\r\n// Status levels (1-7, including Assigned)\r\nconst TASK_STATUSES = [\r\n  { value: 1, label: 'Not Started' },\r\n  { value: 2, label: 'Assigned' },\r\n  { value: 3, label: 'In Progress' },\r\n  { value: 4, label: 'In Review' },\r\n  { value: 5, label: 'Blocked' },\r\n  { value: 6, label: 'On Hold' },\r\n  { value: 7, label: 'Task Completed' }\r\n];\r\n\r\n// Visibility options\r\nconst VISIBILITY_OPTIONS = [\r\n  { value: 'admin', label: 'Admin Only' },\r\n  { value: 'public', label: 'Public' }\r\n];\r\n\r\n// Type options (required field)\r\nconst TASK_TYPES = [\r\n  { value: 'documentation', label: 'Documentation', description: 'Descriptive overview of a feature/system (what it is, how it works at a high level)' },\r\n  { value: 'configuration', label: 'Configuration', description: 'Setup, env vars, flags, settings, install/runtime configuration' },\r\n  { value: 'reference', label: 'Reference', description: 'Authoritative, technical, exhaustive details (APIs, schemas, fields, rules, edge cases)' },\r\n  { value: 'guide', label: 'Guide', description: 'Step-by-step, task-oriented instructions (how to do X)' }\r\n];\r\n\r\n// Predefined tag groups (seed list)\r\nexport const TAG_GROUPS = [\r\n  {\r\n    group: 'OCR & Ingestion',\r\n    tags: [\r\n      'ocr',\r\n      'google-vision',\r\n      'document-ai',\r\n      'handwriting',\r\n      'printed-text',\r\n      'language-filtering',\r\n      'bounding-box',\r\n      'anchors',\r\n      'layout-detection',\r\n      'entry-detection',\r\n      'confidence-threshold',\r\n      'preprocessing',\r\n      'image-quality',\r\n      'dpi'\r\n    ]\r\n  },\r\n  {\r\n    group: 'Data & Records',\r\n    tags: [\r\n      'baptism',\r\n      'marriage',\r\n      'funeral',\r\n      'clergy',\r\n      'parish',\r\n      'records',\r\n      'schema',\r\n      'field-mapping',\r\n      'normalization',\r\n      'validation',\r\n      'duplicates',\r\n      'historical-data'\r\n    ]\r\n  },\r\n  {\r\n    group: 'Workflow & UI',\r\n    tags: [\r\n      'fusion',\r\n      'inspection-panel',\r\n      'review-finalize',\r\n      'drafts',\r\n      'overlays',\r\n      'highlights',\r\n      'entry-editor',\r\n      'empty-state',\r\n      'autosave',\r\n      'modal',\r\n      'ux',\r\n      'ui'\r\n    ]\r\n  },\r\n  {\r\n    group: 'Platform & Backend',\r\n    tags: [\r\n      'api',\r\n      'database',\r\n      'migrations',\r\n      'auth',\r\n      'roles',\r\n      'permissions',\r\n      'logging',\r\n      'error-handling',\r\n      'performance',\r\n      'security',\r\n      'backups',\r\n      'infrastructure'\r\n    ]\r\n  },\r\n  {\r\n    group: 'Analytics & Intelligence',\r\n    tags: [\r\n      'analytics',\r\n      'reports',\r\n      'trends',\r\n      'dashboards',\r\n      'charts',\r\n      'metrics',\r\n      'omai',\r\n      'bigbook',\r\n      'search',\r\n      'summarization',\r\n      'insights'\r\n    ]\r\n  },\r\n  {\r\n    group: 'Documentation Meta',\r\n    tags: [\r\n      'docs',\r\n      'reference',\r\n      'guide',\r\n      'configuration',\r\n      'legacy',\r\n      'task-history',\r\n      'public',\r\n      'admin-only'\r\n    ]\r\n  },\r\n  {\r\n    group: 'Status / Process',\r\n    tags: [\r\n      'blocked',\r\n      'needs-review',\r\n      'needs-design',\r\n      'needs-backend',\r\n      'needs-frontend',\r\n      'high-risk',\r\n      'breaking-change',\r\n      'cleanup',\r\n      'tech-debt'\r\n    ]\r\n  }\r\n];\r\n\r\n// Flatten all predefined tags for autocomplete\r\nexport const ALL_PREDEFINED_TAGS = TAG_GROUPS.flatMap(group => group.tags);\r\n\r\n/**\r\n * Normalize tag to kebab-case\r\n * Converts spaces, underscores, and other separators to hyphens\r\n * Converts to lowercase\r\n */\r\nexport const normalizeTag = (tag: string): string => {\r\n  return tag\r\n    .trim()\r\n    .toLowerCase()\r\n    .replace(/[\\s_]+/g, '-')  // Replace spaces and underscores with hyphens\r\n    .replace(/[^a-z0-9-]/g, '')  // Remove invalid characters\r\n    .replace(/-+/g, '-')  // Replace multiple hyphens with single hyphen\r\n    .replace(/^-|-$/g, '');  // Remove leading/trailing hyphens\r\n};\r\n\r\ninterface TaskRevision {\r\n  rev_index: number;\r\n  rev_number: number | null;\r\n  title: string;\r\n  markdown: string;\r\n}\r\n\r\ninterface TaskFormData {\r\n  title: string;\r\n  category: string;\r\n  importance: string;\r\n  details: string;\r\n  tags: string[];\r\n  attachments: string[];\r\n  status: number;\r\n  type: 'documentation' | 'configuration' | 'reference' | 'guide';\r\n  visibility: 'admin' | 'public';\r\n  date_created?: string;\r\n  date_completed?: string;\r\n  assignedTo?: string;\r\n  assignedBy?: string;\r\n  notes?: string;\r\n  remindMe?: boolean;\r\n  revisions?: TaskRevision[];\r\n}\r\n\r\ninterface CreateTaskDialogProps {\r\n  open: boolean;\r\n  onClose: () => void;\r\n  onSave: (taskData: TaskFormData) => Promise<void>;\r\n}\r\n\r\nconst DRAFT_STORAGE_KEY = 'om_tasks:create_task_draft:v1';\r\nconst MAX_FILE_SIZE = 2 * 1024 * 1024; // 2MB\r\nconst DEBOUNCE_DELAY = 300; // ms\r\n\r\nconst CreateTaskDialog: React.FC<CreateTaskDialogProps> = ({ open, onClose, onSave }) => {\r\n  // Load draft from localStorage on mount\r\n  const loadDraft = (): TaskFormData => {\r\n    try {\r\n      const saved = localStorage.getItem(DRAFT_STORAGE_KEY);\r\n      if (saved) {\r\n        const parsed = JSON.parse(saved);\r\n        // Validate structure\r\n        if (parsed && typeof parsed === 'object') {\r\n          return {\r\n            title: parsed.title || '',\r\n            category: parsed.category || '',\r\n            importance: parsed.importance || 'high',\r\n            details: parsed.details || '',\r\n            tags: Array.isArray(parsed.tags) ? parsed.tags : [],\r\n            attachments: Array.isArray(parsed.attachments) ? parsed.attachments : [],\r\n            status: parsed.status || 1,\r\n            type: parsed.type || ('' as any),\r\n            visibility: parsed.visibility || 'admin',\r\n            assignedTo: parsed.assignedTo || 'Nick Parsells',\r\n            assignedBy: parsed.assignedBy || 'system',\r\n            notes: parsed.notes || '',\r\n            remindMe: parsed.remindMe || false,\r\n            revisions: Array.isArray(parsed.revisions) ? parsed.revisions : undefined\r\n          };\r\n        }\r\n      }\r\n    } catch (e) {\r\n      console.warn('Failed to load draft:', e);\r\n    }\r\n    return {\r\n      title: '',\r\n      category: '',\r\n      importance: 'high', // Default to High\r\n      details: '',\r\n      tags: [],\r\n      attachments: [],\r\n      status: 1,\r\n      type: '' as any,\r\n      visibility: 'admin',\r\n      assignedTo: 'Nick Parsells', // Default\r\n      assignedBy: 'system', // Default\r\n      notes: '',\r\n      remindMe: false,\r\n      revisions: undefined\r\n    };\r\n  };\r\n\r\n  const [formData, setFormData] = useState<TaskFormData>(loadDraft);\r\n  const [tagInput, setTagInput] = useState('');\r\n  const [attachmentInput, setAttachmentInput] = useState('');\r\n  const [errors, setErrors] = useState<Record<string, string>>({});\r\n  const [saving, setSaving] = useState(false);\r\n  const [discardConfirmOpen, setDiscardConfirmOpen] = useState(false);\r\n  const [hasUnsavedChanges, setHasUnsavedChanges] = useState(false);\r\n  const [isDragging, setIsDragging] = useState(false);\r\n  const [dropDialogOpen, setDropDialogOpen] = useState(false);\r\n  const [droppedFile, setDroppedFile] = useState<{ name: string; content: string } | null>(null);\r\n  const [parsedRevisions, setParsedRevisions] = useState<TaskRevision[]>([]);\r\n  const [parseError, setParseError] = useState<string | null>(null);\r\n  \r\n  const saveTimeoutRef = useRef<NodeJS.Timeout | null>(null);\r\n  const detailsRef = useRef<HTMLTextAreaElement>(null);\r\n\r\n  // Auto-fill date created (locked) - Use ISO string for API, format for display\r\n  const now = new Date();\r\n  const dateCreated = now.toISOString(); // For API: ISO format (YYYY-MM-DDTHH:MM:SS)\r\n  const dateCreatedDisplay = now.toLocaleString('en-US', {\r\n    month: '2-digit',\r\n    day: '2-digit',\r\n    year: 'numeric',\r\n    hour: '2-digit',\r\n    minute: '2-digit',\r\n    hour12: false\r\n  }).replace(',', ''); // For display: MM/DD/YYYY HH:MM\r\n\r\n  // Debounced save to localStorage\r\n  const saveDraft = useCallback((data: TaskFormData) => {\r\n    if (saveTimeoutRef.current) {\r\n      clearTimeout(saveTimeoutRef.current);\r\n    }\r\n    saveTimeoutRef.current = setTimeout(() => {\r\n      try {\r\n        localStorage.setItem(DRAFT_STORAGE_KEY, JSON.stringify(data));\r\n        setHasUnsavedChanges(true);\r\n      } catch (e) {\r\n        console.warn('Failed to save draft:', e);\r\n      }\r\n    }, DEBOUNCE_DELAY);\r\n  }, []);\r\n\r\n  // Clear draft from localStorage\r\n  const clearDraft = useCallback(() => {\r\n    try {\r\n      localStorage.removeItem(DRAFT_STORAGE_KEY);\r\n      setHasUnsavedChanges(false);\r\n    } catch (e) {\r\n      console.warn('Failed to clear draft:', e);\r\n    }\r\n  }, []);\r\n\r\n  // Restore draft when dialog opens\r\n  useEffect(() => {\r\n    if (open) {\r\n      const draft = loadDraft();\r\n      setFormData(draft);\r\n      setHasUnsavedChanges(Object.values(draft).some(v => {\r\n        if (Array.isArray(v)) return v.length > 0;\r\n        if (typeof v === 'string') return v.trim().length > 0;\r\n        if (typeof v === 'number') return v !== 1; // status default is 1\r\n        if (typeof v === 'boolean') return v !== false;\r\n        return v !== '' && v !== null && v !== undefined;\r\n      }));\r\n    }\r\n  }, [open]);\r\n\r\n  const handleChange = (field: keyof TaskFormData, value: any) => {\r\n    setFormData(prev => {\r\n      const updated = { ...prev, [field]: value };\r\n      \r\n      // Auto-add default tag based on type\r\n      if (field === 'type' && value) {\r\n        const defaultTags: Record<string, string> = {\r\n          'documentation': 'document-ai',\r\n          'configuration': 'config-ai',\r\n          'reference': 'reference-ai',\r\n          'guide': 'guide-ai'\r\n        };\r\n        \r\n        const defaultTag = defaultTags[value];\r\n        if (defaultTag && !updated.tags.includes(defaultTag)) {\r\n          updated.tags = [...updated.tags, defaultTag];\r\n        }\r\n      }\r\n      \r\n      saveDraft(updated);\r\n      return updated;\r\n    });\r\n    // Clear error for this field\r\n    if (errors[field]) {\r\n      setErrors(prev => {\r\n        const newErrors = { ...prev };\r\n        delete newErrors[field];\r\n        return newErrors;\r\n      });\r\n    }\r\n  };\r\n\r\n  const handleAddTag = (tagValue?: string) => {\r\n    const tagToAdd = normalizeTag(tagValue || tagInput);\r\n    if (tagToAdd && !formData.tags.includes(tagToAdd)) {\r\n      handleChange('tags', [...formData.tags, tagToAdd]);\r\n      setTagInput('');\r\n    }\r\n  };\r\n\r\n  const handleTagSelect = (selectedTags: string[]) => {\r\n    // Normalize all tags and remove duplicates\r\n    const normalizedTags = selectedTags\r\n      .map(tag => normalizeTag(tag))\r\n      .filter((tag, index, self) => tag && self.indexOf(tag) === index);\r\n    handleChange('tags', normalizedTags);\r\n  };\r\n\r\n  const handleRemoveTag = (tagToRemove: string) => {\r\n    handleChange('tags', formData.tags.filter(tag => tag !== tagToRemove));\r\n  };\r\n\r\n  const handleAddAttachment = () => {\r\n    if (attachmentInput.trim() && !formData.attachments.includes(attachmentInput.trim())) {\r\n      handleChange('attachments', [...formData.attachments, attachmentInput.trim()]);\r\n      setAttachmentInput('');\r\n    }\r\n  };\r\n\r\n  const handleRemoveAttachment = (attachmentToRemove: string) => {\r\n    handleChange('attachments', formData.attachments.filter(att => att !== attachmentToRemove));\r\n  };\r\n\r\n  const validateForm = (): boolean => {\r\n    const newErrors: Record<string, string> = {};\r\n\r\n    if (!formData.title.trim()) {\r\n      newErrors.title = 'Title is required';\r\n    }\r\n\r\n    if (!formData.category) {\r\n      newErrors.category = 'Category is required';\r\n    }\r\n\r\n    if (!formData.importance) {\r\n      newErrors.importance = 'Importance is required';\r\n    }\r\n\r\n    if (!formData.details.trim()) {\r\n      newErrors.details = 'Details are required';\r\n    }\r\n\r\n    if (formData.tags.length === 0) {\r\n      newErrors.tags = 'At least one tag is required';\r\n    }\r\n\r\n    if (!formData.type) {\r\n      newErrors.type = 'Type is required';\r\n    }\r\n\r\n    setErrors(newErrors);\r\n    return Object.keys(newErrors).length === 0;\r\n  };\r\n\r\n  const resetForm = () => {\r\n    const emptyForm: TaskFormData = {\r\n      title: '',\r\n      category: '',\r\n      importance: '',\r\n      details: '',\r\n      tags: [],\r\n      attachments: [],\r\n      status: 1,\r\n      type: '' as any,\r\n      visibility: 'admin',\r\n      assignedTo: '',\r\n      assignedBy: '',\r\n      notes: '',\r\n      remindMe: false,\r\n      revisions: undefined\r\n    };\r\n    setFormData(emptyForm);\r\n    setTagInput('');\r\n    setAttachmentInput('');\r\n    setErrors({});\r\n    clearDraft();\r\n  };\r\n\r\n  const handleSave = async () => {\r\n    if (!validateForm()) {\r\n      return;\r\n    }\r\n\r\n    setSaving(true);\r\n    setErrors({}); // Clear previous errors\r\n    try {\r\n      // Prepare task data with date_completed if status is \"Task Completed\" (6)\r\n      const taskData = {\r\n        ...formData,\r\n        date_created: dateCreated,\r\n        date_completed: formData.status === 7 ? dateCreated : undefined\r\n      };\r\n      \r\n      const result = await onSave(taskData);\r\n      \r\n      // Check if result indicates failure\r\n      if (result && result.success === false) {\r\n        throw new Error(result.error || 'Failed to create task');\r\n      }\r\n      \r\n      // Clear draft and reset form on success\r\n      resetForm();\r\n      onClose();\r\n    } catch (error: any) {\r\n      console.error('Error saving task:', error);\r\n      console.error('Error details:', error.details);\r\n      \r\n      let errorMessage = error.message || 'Failed to create task. Please check your connection and try again.';\r\n      \r\n      // Include SQL error details if available (for debugging)\r\n      if (error.details && error.details.sqlMessage) {\r\n        errorMessage += `\\n\\nSQL Error: ${error.details.sqlMessage}`;\r\n        if (error.details.code) {\r\n          errorMessage += `\\nError Code: ${error.details.code}`;\r\n        }\r\n      }\r\n      \r\n      setErrors({ submit: errorMessage });\r\n    } finally {\r\n      setSaving(false);\r\n    }\r\n  };\r\n\r\n  const handleClose = () => {\r\n    if (saving) return;\r\n    \r\n    // Check if there are unsaved changes\r\n    if (hasUnsavedChanges) {\r\n      setDiscardConfirmOpen(true);\r\n    } else {\r\n      resetForm();\r\n      onClose();\r\n    }\r\n  };\r\n\r\n  const handleDiscardConfirm = () => {\r\n    resetForm();\r\n    setDiscardConfirmOpen(false);\r\n    onClose();\r\n  };\r\n\r\n  const handleDiscardCancel = () => {\r\n    setDiscardConfirmOpen(false);\r\n  };\r\n\r\n  // Drag and drop handlers\r\n  const dragCounterRef = useRef(0);\r\n\r\n  const handleDragEnter = (e: React.DragEvent) => {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    dragCounterRef.current++;\r\n    if (e.dataTransfer.items && e.dataTransfer.items.length > 0) {\r\n      setIsDragging(true);\r\n    }\r\n  };\r\n\r\n  const handleDragLeave = (e: React.DragEvent) => {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    dragCounterRef.current--;\r\n    if (dragCounterRef.current === 0) {\r\n      setIsDragging(false);\r\n    }\r\n  };\r\n\r\n  const handleDragOver = (e: React.DragEvent) => {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    if (e.dataTransfer.types.includes('Files')) {\r\n      e.dataTransfer.dropEffect = 'copy';\r\n    }\r\n  };\r\n\r\n  const handleDrop = async (e: React.DragEvent) => {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    dragCounterRef.current = 0;\r\n    setIsDragging(false);\r\n\r\n    const files = Array.from(e.dataTransfer.files);\r\n    const mdFile = files.find(f => \r\n      f.name.endsWith('.md') || \r\n      f.name.endsWith('.txt') ||\r\n      f.type === 'text/markdown' ||\r\n      f.type === 'text/plain'\r\n    );\r\n\r\n    if (!mdFile) {\r\n      setErrors({ submit: 'Please drop a .md or .txt file' });\r\n      return;\r\n    }\r\n\r\n    if (mdFile.size > MAX_FILE_SIZE) {\r\n      setErrors({ submit: `File size exceeds ${MAX_FILE_SIZE / 1024 / 1024}MB limit` });\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const content = await readFileAsText(mdFile);\r\n      \r\n      // Parse first 13 lines for metadata\r\n      const allLines = content.split('\\n');\r\n      const parseMetadataLine = (line: string, prefix: string): string => {\r\n        const trimmed = line.trim();\r\n        if (trimmed.toLowerCase().startsWith(prefix.toLowerCase() + ':')) {\r\n          return trimmed.substring(prefix.length + 1).trim();\r\n        }\r\n        return '';\r\n      };\r\n      \r\n      // Parse lines 1-13\r\n      const metadata: Partial<TaskFormData> = {};\r\n      \r\n      // Line 1: Title\r\n      if (allLines[0]) {\r\n        const title = parseMetadataLine(allLines[0], 'Title');\r\n        if (title) metadata.title = title;\r\n      }\r\n      \r\n      // Line 2: Category\r\n      if (allLines[1]) {\r\n        const category = parseMetadataLine(allLines[1], 'Category');\r\n        if (category) metadata.category = category;\r\n      }\r\n      \r\n      // Line 3: Importance (default to \"High\" if not specified)\r\n      if (allLines[2]) {\r\n        const importance = parseMetadataLine(allLines[2], 'Importance');\r\n        metadata.importance = importance || 'high';\r\n      } else {\r\n        metadata.importance = 'high';\r\n      }\r\n      \r\n      // Line 4: Details (starts here, may continue)\r\n      if (allLines[3]) {\r\n        const detailsStart = parseMetadataLine(allLines[3], 'Details');\r\n        // Details may continue on subsequent lines until next metadata field\r\n        let details = detailsStart;\r\n        for (let i = 4; i < 13 && i < allLines.length; i++) {\r\n          const line = allLines[i].trim();\r\n          // Stop if we hit another metadata field\r\n          if (line.match(/^(Title|Category|Importance|Type|tags|Attachment|Status|Visibility|Date|Optional|Assigned):/i)) {\r\n            break;\r\n          }\r\n          if (line) {\r\n            details += (details ? '\\n' : '') + line;\r\n          }\r\n        }\r\n        if (details) metadata.details = details;\r\n      }\r\n      \r\n      // Line 5: Type\r\n      if (allLines[4]) {\r\n        const type = parseMetadataLine(allLines[4], 'Type');\r\n        if (type) {\r\n          // Normalize type value\r\n          const normalizedType = type.toLowerCase();\r\n          if (['documentation', 'configuration', 'reference', 'guide'].includes(normalizedType)) {\r\n            metadata.type = normalizedType as any;\r\n          }\r\n        }\r\n      }\r\n      \r\n      // Line 6: tags (lowercase)\r\n      if (allLines[5]) {\r\n        const tagsStr = parseMetadataLine(allLines[5], 'tags');\r\n        if (tagsStr) {\r\n          const tags = tagsStr.split(',').map(t => normalizeTag(t.trim())).filter(t => t);\r\n          metadata.tags = tags;\r\n        }\r\n      }\r\n      \r\n      // Line 7: Attachment Link\r\n      if (allLines[6]) {\r\n        const attachment = parseMetadataLine(allLines[6], 'Attachment Link');\r\n        if (attachment) {\r\n          metadata.attachments = [attachment];\r\n        }\r\n      }\r\n      \r\n      // Line 8: Status (map \"Assigned\" to status 2)\r\n      if (allLines[7]) {\r\n        const statusStr = parseMetadataLine(allLines[7], 'Status');\r\n        if (statusStr) {\r\n          const statusMap: Record<string, number> = {\r\n            'not started': 1,\r\n            'assigned': 2,\r\n            'in progress': 3,\r\n            'in review': 4,\r\n            'blocked': 5,\r\n            'on hold': 6,\r\n            'task completed': 7,\r\n            'completed': 7\r\n          };\r\n          const normalizedStatus = statusStr.toLowerCase();\r\n          if (statusMap[normalizedStatus] !== undefined) {\r\n            metadata.status = statusMap[normalizedStatus];\r\n          }\r\n        }\r\n      }\r\n      \r\n      // Line 9: Visibility\r\n      if (allLines[8]) {\r\n        const visibility = parseMetadataLine(allLines[8], 'Visibility');\r\n        if (visibility) {\r\n          const normalized = visibility.toLowerCase();\r\n          if (normalized.includes('admin')) {\r\n            metadata.visibility = 'admin';\r\n          } else if (normalized.includes('public')) {\r\n            metadata.visibility = 'public';\r\n          }\r\n        }\r\n      }\r\n      \r\n      // Line 10: Date Created (skip, auto-filled)\r\n      \r\n      // Line 11: Assigned To (default \"Nick Parsells\")\r\n      if (allLines[10]) {\r\n        const assignedTo = parseMetadataLine(allLines[10], 'Optional Fields: Assigned To');\r\n        metadata.assignedTo = assignedTo || 'Nick Parsells';\r\n      } else {\r\n        metadata.assignedTo = 'Nick Parsells';\r\n      }\r\n      \r\n      // Line 12: Assigned By (default \"system\")\r\n      if (allLines[11]) {\r\n        const assignedBy = parseMetadataLine(allLines[11], 'Assigned by');\r\n        metadata.assignedBy = assignedBy || 'system';\r\n      } else {\r\n        metadata.assignedBy = 'system';\r\n      }\r\n      \r\n      // Line 13: Notes\r\n      if (allLines[12]) {\r\n        const notes = allLines[12].trim();\r\n        if (notes && !notes.toLowerCase().startsWith('notes:')) {\r\n          metadata.notes = notes;\r\n        }\r\n      }\r\n      \r\n      // Apply parsed metadata to form (only if field is empty)\r\n      Object.entries(metadata).forEach(([key, value]) => {\r\n        if (value !== undefined && value !== null && value !== '') {\r\n          const currentValue = formData[key as keyof TaskFormData];\r\n          // Only set if current value is empty\r\n          if (!currentValue || (Array.isArray(currentValue) && currentValue.length === 0)) {\r\n            handleChange(key as keyof TaskFormData, value);\r\n          }\r\n        }\r\n      });\r\n      \r\n      const revisions = parseRevisions(content);\r\n      \r\n      // Validate: check if any Title: markers were found\r\n      if (revisions.length === 0) {\r\n        setParseError('No Title: markers found. Import expects Title: lines.');\r\n        setDroppedFile({ name: mdFile.name, content });\r\n        setParsedRevisions([]);\r\n      } else {\r\n        setParseError(null);\r\n        setDroppedFile({ name: mdFile.name, content });\r\n        setParsedRevisions(revisions);\r\n      }\r\n      setDropDialogOpen(true);\r\n    } catch (error: any) {\r\n      setErrors({ submit: `Failed to read file: ${error.message}` });\r\n    }\r\n  };\r\n\r\n  const readFileAsText = (file: File): Promise<string> => {\r\n    return new Promise((resolve, reject) => {\r\n      const reader = new FileReader();\r\n      reader.onload = (e) => {\r\n        resolve(e.target?.result as string);\r\n      };\r\n      reader.onerror = () => {\r\n        reject(new Error('Failed to read file'));\r\n      };\r\n      reader.readAsText(file);\r\n    });\r\n  };\r\n\r\n  /**\r\n   * Parse markdown file for revision markers (Title: lines with rev numbers)\r\n   * Returns array of revision objects in file order\r\n   */\r\n  const parseRevisions = (content: string): TaskRevision[] => {\r\n    const lines = content.split('\\n');\r\n    const revisions: TaskRevision[] = [];\r\n    let currentSection: { title: string; content: string[]; rev_number: number | null } | null = null;\r\n    let rev_index = 0;\r\n    let foundFirstTitle = false;\r\n\r\n    for (let i = 0; i < lines.length; i++) {\r\n      const line = lines[i];\r\n      // Match Title: lines (case-insensitive, allow leading whitespace)\r\n      const titleMatch = line.match(/^\\s*Title:\\s*(.+)\\s*$/i);\r\n      \r\n      if (titleMatch) {\r\n        foundFirstTitle = true;\r\n        \r\n        // Save previous section if exists\r\n        if (currentSection) {\r\n          revisions.push({\r\n            rev_index: rev_index++,\r\n            rev_number: currentSection.rev_number,\r\n            title: currentSection.title,\r\n            markdown: currentSection.content.join('\\n')\r\n          });\r\n        }\r\n\r\n        // Extract title text\r\n        const titleText = titleMatch[1].trim();\r\n        \r\n        // Try to extract rev number: rev1, rev 1, rev-1, – rev1, etc.\r\n        const revMatch = titleText.match(/rev\\s*[-(]?\\s*(\\d+)\\s*[)]?/i);\r\n        const rev_number = revMatch ? parseInt(revMatch[1], 10) : null;\r\n\r\n        // Start new section\r\n        currentSection = {\r\n          title: titleText,\r\n          content: [],\r\n          rev_number\r\n        };\r\n      } else {\r\n        // Add line to current section content\r\n        if (currentSection) {\r\n          currentSection.content.push(line);\r\n        } else if (!foundFirstTitle) {\r\n          // Content before first Title: line - create intro section\r\n          if (!currentSection) {\r\n            currentSection = {\r\n              title: 'OM-tasks creation and revisions',\r\n              content: [],\r\n              rev_number: null\r\n            };\r\n          }\r\n          currentSection.content.push(line);\r\n        }\r\n      }\r\n    }\r\n\r\n    // Save last section\r\n    if (currentSection) {\r\n      revisions.push({\r\n        rev_index: rev_index++,\r\n        rev_number: currentSection.rev_number,\r\n        title: currentSection.title,\r\n        markdown: currentSection.content.join('\\n')\r\n      });\r\n    }\r\n\r\n    return revisions;\r\n  };\r\n\r\n  /**\r\n   * Get display label for a revision\r\n   */\r\n  const getRevisionLabel = (revision: TaskRevision): string => {\r\n    if (revision.rev_number !== null) {\r\n      return `rev${revision.rev_number}`;\r\n    }\r\n    return revision.title || 'intro';\r\n  };\r\n\r\n  const handleDropAction = (action: 'replace' | 'append' | 'attach' | 'import_revisions') => {\r\n    if (!droppedFile) return;\r\n\r\n    if (action === 'import_revisions') {\r\n      // Import as revisions - store revisions in form data\r\n      if (parsedRevisions.length > 0) {\r\n        handleChange('revisions', parsedRevisions);\r\n        // Also set details to full content for backward compatibility\r\n        handleChange('details', droppedFile.content);\r\n      }\r\n    } else if (action === 'replace') {\r\n      if (formData.details.trim()) {\r\n        // Confirm replace if details already has content\r\n        if (window.confirm('Replace existing Details content?')) {\r\n          handleChange('details', droppedFile.content);\r\n          // Clear revisions if replacing\r\n          handleChange('revisions', undefined);\r\n        } else {\r\n          setDropDialogOpen(false);\r\n          setDroppedFile(null);\r\n          setParsedRevisions([]);\r\n          setParseError(null);\r\n          return;\r\n        }\r\n      } else {\r\n        handleChange('details', droppedFile.content);\r\n        handleChange('revisions', undefined);\r\n      }\r\n    } else if (action === 'append') {\r\n      const separator = formData.details.trim() ? '\\n\\n---\\n\\n' : '';\r\n      handleChange('details', formData.details + separator + droppedFile.content);\r\n      // Don't modify revisions on append\r\n    } else if (action === 'attach') {\r\n      // For now, we'll store the filename in attachments\r\n      // In a real implementation, you'd upload the file and get a URL\r\n      const attachmentUrl = `[Local: ${droppedFile.name}]`;\r\n      if (!formData.attachments.includes(attachmentUrl)) {\r\n        handleChange('attachments', [...formData.attachments, attachmentUrl]);\r\n      }\r\n    }\r\n\r\n    setDropDialogOpen(false);\r\n    setDroppedFile(null);\r\n    setParsedRevisions([]);\r\n    setParseError(null);\r\n  };\r\n\r\n  const handleDropDialogCancel = () => {\r\n    setDropDialogOpen(false);\r\n    setDroppedFile(null);\r\n    setParsedRevisions([]);\r\n    setParseError(null);\r\n  };\r\n\r\n  // Cleanup on unmount\r\n  useEffect(() => {\r\n    return () => {\r\n      if (saveTimeoutRef.current) {\r\n        clearTimeout(saveTimeoutRef.current);\r\n      }\r\n    };\r\n  }, []);\r\n\r\n  // Check if status is \"Task Completed\" (status 6)\r\n  const isCompleted = formData.status === 7;\r\n\r\n  return (\r\n    <>\r\n      <Dialog \r\n        open={open} \r\n        onClose={handleClose} \r\n        maxWidth=\"md\" \r\n        fullWidth\r\n        disableEscapeKeyDown={hasUnsavedChanges}\r\n        onBackdropClick={(e) => {\r\n          if (hasUnsavedChanges) {\r\n            e.preventDefault();\r\n            handleClose();\r\n          }\r\n        }}\r\n      >\r\n      <DialogTitle>\r\n        <Box display=\"flex\" alignItems=\"center\" justifyContent=\"space-between\">\r\n          <Typography variant=\"h6\">Create New Task</Typography>\r\n          <Chip\r\n            label={formData.visibility === 'admin' ? 'Admin Only' : 'Public'}\r\n            color={formData.visibility === 'admin' ? 'default' : 'primary'}\r\n            size=\"small\"\r\n          />\r\n        </Box>\r\n      </DialogTitle>\r\n      <DialogContent>\r\n        {errors.submit && (\r\n          <Alert severity=\"error\" sx={{ mb: 2 }} onClose={() => setErrors(prev => ({ ...prev, submit: '' }))}>\r\n            {errors.submit}\r\n          </Alert>\r\n        )}\r\n\r\n        <Stack spacing={3} sx={{ mt: 1 }}>\r\n          {/* Title - Required */}\r\n          <TextField\r\n            fullWidth\r\n            label=\"Title\"\r\n            value={formData.title}\r\n            onChange={(e) => handleChange('title', e.target.value)}\r\n            error={!!errors.title}\r\n            helperText={errors.title}\r\n            required\r\n          />\r\n\r\n          {/* Category - Required */}\r\n          <FormControl fullWidth required error={!!errors.category}>\r\n            <InputLabel>Category</InputLabel>\r\n            <Select\r\n              value={formData.category}\r\n              onChange={(e) => handleChange('category', e.target.value)}\r\n              label=\"Category\"\r\n            >\r\n              {TASK_CATEGORIES.map((category) => (\r\n                <MenuItem key={category} value={category}>\r\n                  {category}\r\n                </MenuItem>\r\n              ))}\r\n            </Select>\r\n            {errors.category && <FormHelperText>{errors.category}</FormHelperText>}\r\n          </FormControl>\r\n\r\n          {/* Importance - Required */}\r\n          <FormControl fullWidth required error={!!errors.importance}>\r\n            <InputLabel>Importance</InputLabel>\r\n            <Select\r\n              value={formData.importance}\r\n              onChange={(e) => handleChange('importance', e.target.value)}\r\n              label=\"Importance\"\r\n            >\r\n              {IMPORTANCE_LEVELS.map((level) => (\r\n                <MenuItem key={level.value} value={level.value}>\r\n                  {level.label}\r\n                </MenuItem>\r\n              ))}\r\n            </Select>\r\n            {errors.importance && <FormHelperText>{errors.importance}</FormHelperText>}\r\n          </FormControl>\r\n\r\n          {/* Details - Required - Large resizable with drag-and-drop */}\r\n          <Box\r\n            onDragEnter={handleDragEnter}\r\n            onDragOver={handleDragOver}\r\n            onDragLeave={handleDragLeave}\r\n            onDrop={handleDrop}\r\n            sx={{\r\n              position: 'relative',\r\n              border: isDragging ? '2px dashed #8c249d' : '1px solid transparent',\r\n              borderRadius: 1,\r\n              bgcolor: isDragging ? 'action.hover' : 'transparent',\r\n              transition: 'all 0.2s',\r\n              minHeight: '400px'\r\n            }}\r\n          >\r\n            {isDragging && (\r\n              <Box\r\n                sx={{\r\n                  position: 'absolute',\r\n                  top: 0,\r\n                  left: 0,\r\n                  right: 0,\r\n                  bottom: 0,\r\n                  zIndex: 10,\r\n                  bgcolor: 'rgba(140, 36, 157, 0.15)',\r\n                  borderRadius: 1,\r\n                  display: 'flex',\r\n                  alignItems: 'center',\r\n                  justifyContent: 'center',\r\n                  flexDirection: 'column',\r\n                  gap: 2,\r\n                  pointerEvents: 'none'\r\n                }}\r\n              >\r\n                <CloudUploadIcon sx={{ fontSize: 48, color: '#8c249d' }} />\r\n                <Typography variant=\"h6\" color=\"primary\" fontWeight=\"bold\">\r\n                  Drop .md file to import\r\n                </Typography>\r\n                <Typography variant=\"body2\" color=\"text.secondary\">\r\n                  Release to add content to Details\r\n                </Typography>\r\n              </Box>\r\n            )}\r\n            <TextField\r\n              inputRef={detailsRef}\r\n              fullWidth\r\n              label=\"Details\"\r\n              multiline\r\n              minRows={12}\r\n              maxRows={30}\r\n              value={formData.details}\r\n              onChange={(e) => handleChange('details', e.target.value)}\r\n              error={!!errors.details}\r\n              helperText={errors.details || 'Drag and drop .md or .txt files here to import'}\r\n              required\r\n              sx={{\r\n                '& .MuiInputBase-root': {\r\n                  minHeight: '400px'\r\n                },\r\n                '& textarea': {\r\n                  resize: 'vertical',\r\n                  minHeight: '400px !important',\r\n                  fontFamily: 'monospace',\r\n                  fontSize: '0.875rem',\r\n                  lineHeight: 1.6\r\n                }\r\n              }}\r\n            />\r\n          </Box>\r\n\r\n          {/* Type - Required */}\r\n          <FormControl fullWidth required error={!!errors.type}>\r\n            <InputLabel>Type</InputLabel>\r\n            <Select\r\n              value={formData.type || ''}\r\n              onChange={(e) => handleChange('type', e.target.value)}\r\n              label=\"Type\"\r\n            >\r\n              {TASK_TYPES.map((type) => (\r\n                <MenuItem key={type.value} value={type.value}>\r\n                  <Box>\r\n                    <Typography variant=\"body1\">{type.label}</Typography>\r\n                    <Typography variant=\"caption\" color=\"text.secondary\">\r\n                      {type.description}\r\n                    </Typography>\r\n                  </Box>\r\n                </MenuItem>\r\n              ))}\r\n            </Select>\r\n            {errors.type && <FormHelperText>{errors.type}</FormHelperText>}\r\n            {!errors.type && (\r\n              <FormHelperText>\r\n                Category = domain (Ingestion, Workflow, etc.). Type = content nature (doc vs guide vs reference).\r\n              </FormHelperText>\r\n            )}\r\n          </FormControl>\r\n\r\n          {/* Tags - Required (at least one) - Autocomplete with predefined tags */}\r\n          <Box>\r\n            <Typography variant=\"body2\" gutterBottom>\r\n              Tags <span style={{ color: 'red' }}>*</span>\r\n            </Typography>\r\n            <Box display=\"flex\" gap={1} flexWrap=\"wrap\" mb={2}>\r\n              {formData.tags.map((tag) => (\r\n                <Chip\r\n                  key={tag}\r\n                  label={tag}\r\n                  onDelete={() => handleRemoveTag(tag)}\r\n                  size=\"small\"\r\n                  color=\"primary\"\r\n                  variant=\"outlined\"\r\n                />\r\n              ))}\r\n            </Box>\r\n            <Autocomplete\r\n              multiple\r\n              freeSolo\r\n              options={ALL_PREDEFINED_TAGS}\r\n              value={formData.tags}\r\n              onChange={(_, newValue) => {\r\n                handleTagSelect(newValue);\r\n                setTagInput(''); // Clear input after selection\r\n              }}\r\n              inputValue={tagInput}\r\n              onInputChange={(_, newInputValue, reason) => {\r\n                // Only normalize on input, not on selection\r\n                if (reason === 'input') {\r\n                  setTagInput(newInputValue);\r\n                } else {\r\n                  setTagInput('');\r\n                }\r\n              }}\r\n              groupBy={(option) => {\r\n                // Find which group this tag belongs to\r\n                const group = TAG_GROUPS.find(g => g.tags.includes(option));\r\n                return group ? group.group : 'Custom';\r\n              }}\r\n              renderGroup={(params) => (\r\n                <Box key={params.key}>\r\n                  <Typography\r\n                    variant=\"caption\"\r\n                    sx={{\r\n                      px: 1.5,\r\n                      py: 0.5,\r\n                      fontWeight: 'bold',\r\n                      color: 'text.secondary',\r\n                      bgcolor: 'grey.100',\r\n                      display: 'block'\r\n                    }}\r\n                  >\r\n                    {params.group}\r\n                  </Typography>\r\n                  {params.children}\r\n                </Box>\r\n              )}\r\n              renderInput={(params) => (\r\n                <TextField\r\n                  {...params}\r\n                  size=\"small\"\r\n                  placeholder=\"Type or select tags (kebab-case enforced)\"\r\n                  helperText={errors.tags || `${formData.tags.length} tag(s) selected. Tags are normalized to kebab-case.`}\r\n                  error={!!errors.tags}\r\n                  onKeyPress={(e) => {\r\n                    if (e.key === 'Enter' && tagInput.trim()) {\r\n                      e.preventDefault();\r\n                      handleAddTag();\r\n                    }\r\n                  }}\r\n                />\r\n              )}\r\n              renderOption={(props, option) => (\r\n                <Box component=\"li\" {...props} key={option}>\r\n                  {option}\r\n                </Box>\r\n              )}\r\n              getOptionLabel={(option) => typeof option === 'string' ? option : option}\r\n              filterOptions={(options, params) => {\r\n                const filtered = options.filter(option =>\r\n                  option.toLowerCase().includes(params.inputValue.toLowerCase())\r\n                );\r\n                \r\n                // If input doesn't match any predefined tag, allow custom entry\r\n                if (params.inputValue && !filtered.includes(params.inputValue)) {\r\n                  const normalized = normalizeTag(params.inputValue);\r\n                  if (normalized && !filtered.includes(normalized)) {\r\n                    filtered.push(normalized);\r\n                  }\r\n                }\r\n                \r\n                return filtered;\r\n              }}\r\n              sx={{ mb: 1 }}\r\n            />\r\n            {errors.tags && (\r\n              <FormHelperText error sx={{ mt: 0.5 }}>\r\n                {errors.tags}\r\n              </FormHelperText>\r\n            )}\r\n          </Box>\r\n\r\n          {/* Attachments - Optional */}\r\n          <Box>\r\n            <Typography variant=\"body2\" gutterBottom>\r\n              Attachments (Links to .md or other docs)\r\n            </Typography>\r\n            <Box display=\"flex\" gap={1} flexWrap=\"wrap\" mb={1}>\r\n              {formData.attachments.map((attachment, index) => (\r\n                <Chip\r\n                  key={index}\r\n                  label={attachment.length > 30 ? `${attachment.substring(0, 30)}...` : attachment}\r\n                  onDelete={() => handleRemoveAttachment(attachment)}\r\n                  size=\"small\"\r\n                  icon={<AttachFileIcon />}\r\n                />\r\n              ))}\r\n            </Box>\r\n            <Box display=\"flex\" gap={1}>\r\n              <TextField\r\n                size=\"small\"\r\n                fullWidth\r\n                placeholder=\"https://example.com/doc.md\"\r\n                value={attachmentInput}\r\n                onChange={(e) => setAttachmentInput(e.target.value)}\r\n                onKeyPress={(e) => {\r\n                  if (e.key === 'Enter') {\r\n                    e.preventDefault();\r\n                    handleAddAttachment();\r\n                  }\r\n                }}\r\n              />\r\n              <Button size=\"small\" onClick={handleAddAttachment} disabled={!attachmentInput.trim()}>\r\n                Add\r\n              </Button>\r\n            </Box>\r\n          </Box>\r\n\r\n          {/* Status - Required */}\r\n          <FormControl fullWidth required>\r\n            <InputLabel>Status</InputLabel>\r\n            <Select\r\n              value={formData.status}\r\n              onChange={(e) => handleChange('status', e.target.value)}\r\n              label=\"Status\"\r\n            >\r\n              {TASK_STATUSES.map((status) => (\r\n                <MenuItem key={status.value} value={status.value}>\r\n                  {status.label}\r\n                </MenuItem>\r\n              ))}\r\n            </Select>\r\n          </FormControl>\r\n\r\n          {/* Visibility - Required (New Field) */}\r\n          <FormControl fullWidth required>\r\n            <InputLabel>Visibility</InputLabel>\r\n            <Select\r\n              value={formData.visibility}\r\n              onChange={(e) => handleChange('visibility', e.target.value as 'admin' | 'public')}\r\n              label=\"Visibility\"\r\n            >\r\n              {VISIBILITY_OPTIONS.map((option) => (\r\n                <MenuItem key={option.value} value={option.value}>\r\n                  {option.label}\r\n                </MenuItem>\r\n              ))}\r\n            </Select>\r\n            <FormHelperText>\r\n              {formData.visibility === 'admin' \r\n                ? 'Only admins and superadmins can view this task'\r\n                : 'Anyone can view this task on public pages'}\r\n            </FormHelperText>\r\n          </FormControl>\r\n\r\n          <Divider />\r\n\r\n          {/* Date Created - Auto-filled and locked */}\r\n          <TextField\r\n            fullWidth\r\n            label=\"Date Created\"\r\n            value={dateCreatedDisplay}\r\n            disabled\r\n            helperText=\"Automatically set to current date and time\"\r\n          />\r\n\r\n          {/* Date Completed - Auto-filled when status is \"Task Completed\" */}\r\n          {isCompleted && (\r\n            <TextField\r\n              fullWidth\r\n              label=\"Date Completed\"\r\n              value={dateCreatedDisplay}\r\n              disabled\r\n              helperText=\"Automatically set when task is marked as completed\"\r\n            />\r\n          )}\r\n\r\n          <Divider />\r\n\r\n          {/* Optional Fields */}\r\n          <Typography variant=\"subtitle2\" color=\"text.secondary\">\r\n            Optional Fields\r\n          </Typography>\r\n\r\n          <TextField\r\n            fullWidth\r\n            label=\"Assigned To\"\r\n            value={formData.assignedTo}\r\n            onChange={(e) => handleChange('assignedTo', e.target.value)}\r\n            placeholder=\"Email or username\"\r\n          />\r\n\r\n          <TextField\r\n            fullWidth\r\n            label=\"Assigned By\"\r\n            value={formData.assignedBy}\r\n            onChange={(e) => handleChange('assignedBy', e.target.value)}\r\n            placeholder=\"Email or username\"\r\n          />\r\n\r\n          <TextField\r\n            fullWidth\r\n            label=\"Notes\"\r\n            multiline\r\n            rows={3}\r\n            value={formData.notes}\r\n            onChange={(e) => handleChange('notes', e.target.value)}\r\n            placeholder=\"Additional notes or context\"\r\n          />\r\n        </Stack>\r\n      </DialogContent>\r\n      <DialogActions>\r\n        <Button onClick={handleClose} disabled={saving} startIcon={<CancelIcon />}>\r\n          Cancel\r\n        </Button>\r\n        <Button\r\n          onClick={handleSave}\r\n          variant=\"contained\"\r\n          disabled={saving || !formData.type}\r\n          startIcon={saving ? null : <SaveIcon />}\r\n          sx={{ bgcolor: '#8c249d', '&:hover': { bgcolor: '#6a1b9a' } }}\r\n        >\r\n          {saving ? 'Creating...' : 'Create Task'}\r\n        </Button>\r\n      </DialogActions>\r\n    </Dialog>\r\n\r\n    {/* Discard Confirmation Dialog */}\r\n    <Dialog open={discardConfirmOpen} onClose={handleDiscardCancel}>\r\n      <DialogTitle>Discard Draft?</DialogTitle>\r\n      <DialogContent>\r\n        <Typography>\r\n          You have unsaved changes. Are you sure you want to discard them?\r\n        </Typography>\r\n      </DialogContent>\r\n      <DialogActions>\r\n        <Button onClick={handleDiscardCancel}>Keep Editing</Button>\r\n        <Button onClick={handleDiscardConfirm} color=\"error\" variant=\"contained\">\r\n          Discard\r\n        </Button>\r\n      </DialogActions>\r\n    </Dialog>\r\n\r\n    {/* Drop Action Dialog */}\r\n    <Dialog open={dropDialogOpen} onClose={handleDropDialogCancel} maxWidth=\"md\" fullWidth>\r\n      <DialogTitle>\r\n        <Box display=\"flex\" alignItems=\"center\" gap={1}>\r\n          <FileIcon />\r\n          <Typography>Import {droppedFile?.name}</Typography>\r\n        </Box>\r\n      </DialogTitle>\r\n      <DialogContent>\r\n        {parseError && (\r\n          <Alert severity=\"error\" sx={{ mb: 2 }}>\r\n            {parseError}\r\n          </Alert>\r\n        )}\r\n\r\n        {parsedRevisions.length > 0 && (\r\n          <Box sx={{ mb: 3 }}>\r\n            <Typography variant=\"subtitle1\" gutterBottom fontWeight=\"bold\">\r\n              Parsed Revisions ({parsedRevisions.length})\r\n            </Typography>\r\n            <Typography variant=\"caption\" color=\"text.secondary\" gutterBottom display=\"block\" sx={{ mb: 2 }}>\r\n              Revisions found in file order:\r\n            </Typography>\r\n            <Box sx={{ maxHeight: '400px', overflowY: 'auto' }}>\r\n              {parsedRevisions.map((revision, index) => (\r\n                <Accordion key={revision.rev_index} defaultExpanded={false}>\r\n                  <AccordionSummary expandIcon={<ExpandMoreIcon />}>\r\n                    <Box sx={{ display: 'flex', alignItems: 'center', gap: 1, width: '100%' }}>\r\n                      <Chip\r\n                        label={getRevisionLabel(revision)}\r\n                        size=\"small\"\r\n                        color={revision.rev_number !== null ? 'primary' : 'default'}\r\n                        sx={{ minWidth: '60px' }}\r\n                      />\r\n                      <Typography variant=\"body2\" color=\"text.secondary\" sx={{ flex: 1 }}>\r\n                        {revision.title}\r\n                      </Typography>\r\n                      <Typography variant=\"caption\" color=\"text.secondary\">\r\n                        {revision.markdown.split('\\n').length} lines\r\n                      </Typography>\r\n                    </Box>\r\n                  </AccordionSummary>\r\n                  <AccordionDetails>\r\n                    <Box\r\n                      component=\"pre\"\r\n                      sx={{\r\n                        whiteSpace: 'pre-wrap',\r\n                        fontFamily: 'monospace',\r\n                        fontSize: '0.75rem',\r\n                        bgcolor: 'grey.50',\r\n                        p: 2,\r\n                        borderRadius: 1,\r\n                        maxHeight: '300px',\r\n                        overflow: 'auto',\r\n                        border: '1px solid',\r\n                        borderColor: 'divider'\r\n                      }}\r\n                    >\r\n                      {revision.markdown}\r\n                    </Box>\r\n                  </AccordionDetails>\r\n                </Accordion>\r\n              ))}\r\n            </Box>\r\n          </Box>\r\n        )}\r\n\r\n        <Typography variant=\"body2\" color=\"text.secondary\" gutterBottom>\r\n          Choose how to handle the dropped file:\r\n        </Typography>\r\n        <Stack spacing={2} sx={{ mt: 2 }}>\r\n          {parsedRevisions.length > 0 && (\r\n            <Button\r\n              variant=\"contained\"\r\n              fullWidth\r\n              onClick={() => handleDropAction('import_revisions')}\r\n              disabled={!droppedFile || parsedRevisions.length === 0}\r\n              sx={{ bgcolor: '#8c249d', '&:hover': { bgcolor: '#6a1b9a' } }}\r\n            >\r\n              Import as Revisions ({parsedRevisions.length} sections)\r\n            </Button>\r\n          )}\r\n          <Button\r\n            variant=\"outlined\"\r\n            fullWidth\r\n            onClick={() => handleDropAction('replace')}\r\n            disabled={!droppedFile}\r\n          >\r\n            Replace Details\r\n          </Button>\r\n          <Button\r\n            variant={parsedRevisions.length === 0 ? 'contained' : 'outlined'}\r\n            fullWidth\r\n            onClick={() => handleDropAction('append')}\r\n            disabled={!droppedFile}\r\n            sx={parsedRevisions.length === 0 ? { bgcolor: '#8c249d', '&:hover': { bgcolor: '#6a1b9a' } } : {}}\r\n          >\r\n            Append to Details {parsedRevisions.length === 0 && '(Default)'}\r\n          </Button>\r\n          <Button\r\n            variant=\"outlined\"\r\n            fullWidth\r\n            onClick={() => handleDropAction('attach')}\r\n            disabled={!droppedFile}\r\n            startIcon={<AttachFileIcon />}\r\n          >\r\n            Attach as File Only\r\n          </Button>\r\n        </Stack>\r\n        {droppedFile && (\r\n          <Typography variant=\"caption\" color=\"text.secondary\" sx={{ mt: 2, display: 'block' }}>\r\n            File size: {(droppedFile.content.length / 1024).toFixed(2)} KB\r\n          </Typography>\r\n        )}\r\n      </DialogContent>\r\n      <DialogActions>\r\n        <Button onClick={handleDropDialogCancel}>Cancel</Button>\r\n      </DialogActions>\r\n    </Dialog>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default CreateTaskDialog;\r\n\r\n","/**\r\n * OMAITaskAssignmentWidget.tsx\r\n * Enhanced dashboard widget for OMAI task assignment management\r\n * For admin/super_admin users only\r\n */\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport {\r\n  Card,\r\n  CardContent,\r\n  Typography,\r\n  Box,\r\n  List,\r\n  ListItem,\r\n  ListItemText,\r\n  ListItemIcon,\r\n  Chip,\r\n  Alert,\r\n  CircularProgress,\r\n  Divider,\r\n  Button,\r\n  Dialog,\r\n  DialogTitle,\r\n  DialogContent,\r\n  DialogActions,\r\n  TextField,\r\n  Tabs,\r\n  Tab,\r\n  IconButton,\r\n  Tooltip,\r\n  Paper,\r\n  Grid,\r\n  Table,\r\n  TableBody,\r\n  TableCell,\r\n  TableContainer,\r\n  TableHead,\r\n  TableRow,\r\n  TablePagination,\r\n  FormControl,\r\n  InputLabel,\r\n  Select,\r\n  MenuItem,\r\n  TextField as MuiTextField,\r\n  Stack,\r\n  Accordion,\r\n  AccordionSummary,\r\n  AccordionDetails,\r\n  Switch,\r\n  FormControlLabel,\r\n  Badge,\r\n  Avatar,\r\n  CardHeader,\r\n  CardActions\r\n} from '@mui/material';\r\nimport {\r\n  Assignment as AssignmentIcon,\r\n  Email as EmailIcon,\r\n  CheckCircle as CheckCircleIcon,\r\n  Schedule as ScheduleIcon,\r\n  Send as SendIcon,\r\n  Visibility as VisibilityIcon,\r\n  Refresh as RefreshIcon,\r\n  Add as AddIcon,\r\n  History as HistoryIcon,\r\n  Delete as DeleteIcon,\r\n  ContentCopy as CopyIcon,\r\n  Settings as SettingsIcon,\r\n  Download as DownloadIcon,\r\n  RemoveRedEye as ViewIcon,\r\n  ExpandMore as ExpandMoreIcon,\r\n  FilterList as FilterIcon,\r\n  Search as SearchIcon,\r\n  Computer as ComputerIcon,\r\n  AccessTime as TimeIcon,\r\n  Person as PersonIcon,\r\n  Warning as WarningIcon,\r\n  Info as InfoIcon,\r\n  Task as TaskIcon,\r\n  Link as LinkIcon,\r\n  Archive as ArchiveIcon,\r\n  RestoreFromTrash as RestoreIcon\r\n} from '@mui/icons-material';\r\nimport { omaiAPI } from '@/api/omai.api';\r\nimport { useAuth } from '@/context/AuthContext';\r\nimport EmailSettingsForm from './EmailSettingsForm';\r\nimport CreateTaskDialog from './CreateTaskDialog';\r\n\r\ninterface TaskLink {\r\n  id: number;\r\n  email: string;\r\n  token: string;\r\n  created_at: string;\r\n  expires_at?: string;\r\n  is_used: boolean;\r\n  used_at?: string;\r\n  notes?: string;\r\n  status?: string;\r\n  ip_address?: string;\r\n}\r\n\r\ninterface TaskSubmission {\r\n  id: number;\r\n  email: string;\r\n  tasks_json: string;\r\n  submitted_at: string;\r\n  status: string;\r\n  notes?: string;\r\n  ip_address?: string;\r\n  user_agent?: string;\r\n  submission_type?: string;\r\n  sent_to_nick?: boolean;\r\n  sent_at?: string;\r\n}\r\n\r\ninterface TaskLog {\r\n  timestamp: string;\r\n  action: string;\r\n  email: string;\r\n  token?: string;\r\n  data: any;\r\n}\r\n\r\ninterface TaskAssignmentData {\r\n  recent_links: TaskLink[];\r\n  recent_submissions: TaskSubmission[];\r\n  recent_logs: TaskLog[];\r\n}\r\n\r\nconst OMAITaskAssignmentWidget: React.FC = () => {\r\n  const { hasRole, isSuperAdmin } = useAuth();\r\n  const [data, setData] = useState<TaskAssignmentData | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [tabValue, setTabValue] = useState(0);\r\n  \r\n  // Dialog states\r\n  const [generateDialogOpen, setGenerateDialogOpen] = useState(false);\r\n  const [createTaskDialogOpen, setCreateTaskDialogOpen] = useState(false);\r\n  const [deleteConfirmOpen, setDeleteConfirmOpen] = useState(false);\r\n  const [viewSubmissionOpen, setViewSubmissionOpen] = useState(false);\r\n  const [historyDialogOpen, setHistoryDialogOpen] = useState(false);\r\n  const [settingsDialogOpen, setSettingsDialogOpen] = useState(false);\r\n  \r\n  // Form states\r\n  const [newLinkEmail, setNewLinkEmail] = useState('');\r\n  const [newLinkNotes, setNewLinkNotes] = useState('');\r\n  const [newLinkExpiry, setNewLinkExpiry] = useState('1440'); // 24 hours default\r\n  \r\n  // Action states\r\n  const [generating, setGenerating] = useState(false);\r\n  const [deleting, setDeleting] = useState(false);\r\n  const [deletingType, setDeletingType] = useState<'link' | 'submission' | 'batch'>('link');\r\n  const [deletingId, setDeletingId] = useState<number | string | null>(null);\r\n  \r\n  // History and pagination\r\n  const [historyData, setHistoryData] = useState<any[]>([]);\r\n  const [historyLoading, setHistoryLoading] = useState(false);\r\n  const [historyPage, setHistoryPage] = useState(0);\r\n  const [historyRowsPerPage, setHistoryRowsPerPage] = useState(25);\r\n  const [historyFilters, setHistoryFilters] = useState({\r\n    email: '',\r\n    status: '',\r\n    type: '',\r\n    dateFrom: '',\r\n    dateTo: ''\r\n  });\r\n  \r\n  // Selected items\r\n  const [selectedSubmission, setSelectedSubmission] = useState<TaskSubmission | null>(null);\r\n  const [selectedItems, setSelectedItems] = useState<Set<number>>(new Set());\r\n\r\n  // Check if user has permission to view this widget\r\n  const canView = isSuperAdmin() || hasRole('admin');\r\n\r\n  const fetchData = async () => {\r\n    if (!canView) return;\r\n    \r\n    try {\r\n      setError(null);\r\n      setLoading(true);\r\n      const response = await omaiAPI.getTaskLogs(50); // Increased limit\r\n      if (response.success) {\r\n        setData(response.data);\r\n      } else {\r\n        setError(response.error || 'Failed to load task assignment data');\r\n      }\r\n    } catch (err: any) {\r\n      console.error('Error fetching task data:', err);\r\n      setError(err.message || err.response?.data?.error || 'Failed to load data');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const fetchHistory = async (filters = historyFilters, page = historyPage) => {\r\n    setHistoryLoading(true);\r\n    try {\r\n      const response = await omaiAPI.getTaskHistory({\r\n        page: page + 1,\r\n        limit: historyRowsPerPage,\r\n        ...filters\r\n      });\r\n      if (response.success) {\r\n        setHistoryData(response.data.submissions || []);\r\n      }\r\n    } catch (err: any) {\r\n      console.error('Failed to fetch history:', err);\r\n    } finally {\r\n      setHistoryLoading(false);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    fetchData();\r\n  }, [canView]);\r\n\r\n  const handleGenerateLink = async () => {\r\n    if (!newLinkEmail || !omaiAPI.validateEmail(newLinkEmail)) {\r\n      setError('Please enter a valid email address');\r\n      return;\r\n    }\r\n\r\n    setGenerating(true);\r\n    setError(null);\r\n\r\n    try {\r\n      const response = await omaiAPI.generateTaskLink(newLinkEmail, {\r\n        notes: newLinkNotes,\r\n        expiresInMinutes: parseInt(newLinkExpiry)\r\n      });\r\n      \r\n      if (response.success) {\r\n        setGenerateDialogOpen(false);\r\n        setNewLinkEmail('');\r\n        setNewLinkNotes('');\r\n        setNewLinkExpiry('1440');\r\n        fetchData();\r\n        showToast('Task link generated successfully', 'success');\r\n      } else {\r\n        setError(response.error || 'Failed to generate task link');\r\n      }\r\n    } catch (err: any) {\r\n      setError(err.response?.data?.error || 'Failed to generate link');\r\n    } finally {\r\n      setGenerating(false);\r\n    }\r\n  };\r\n\r\n  const handleRegenerateLink = async (email: string) => {\r\n    setGenerating(true);\r\n    setError(null);\r\n\r\n    try {\r\n      const response = await omaiAPI.generateTaskLink(email, {\r\n        notes: 'Regenerated link',\r\n        expiresInMinutes: parseInt(newLinkExpiry)\r\n      });\r\n      \r\n      if (response.success) {\r\n        fetchData();\r\n        showToast('Task link regenerated successfully', 'success');\r\n        \r\n        // Refresh the page to pull updated logo and assets\r\n        setTimeout(() => {\r\n          window.location.reload();\r\n        }, 1000);\r\n      } else {\r\n        setError(response.error || 'Failed to regenerate task link');\r\n      }\r\n    } catch (err: any) {\r\n      setError(err.response?.data?.error || 'Failed to regenerate link');\r\n    } finally {\r\n      setGenerating(false);\r\n    }\r\n  };\r\n\r\n  const handleDeleteItem = async (type: 'link' | 'submission' | 'batch', id: number | string | null) => {\r\n    setDeletingType(type);\r\n    setDeletingId(id);\r\n    setDeleteConfirmOpen(true);\r\n  };\r\n\r\n  const confirmDelete = async () => {\r\n    if (!deletingId) return;\r\n\r\n    setDeleting(true);\r\n    setError(null);\r\n\r\n    try {\r\n      let response;\r\n      \r\n      switch (deletingType) {\r\n        case 'link':\r\n          response = await omaiAPI.deleteTaskLink(deletingId as number);\r\n          break;\r\n        case 'submission':\r\n          response = await omaiAPI.deleteSubmission(deletingId as number);\r\n          break;\r\n        case 'batch':\r\n          response = await omaiAPI.deleteSubmissionsBatch(Array.from(selectedItems));\r\n          break;\r\n      }\r\n      \r\n      if (response?.success) {\r\n        fetchData();\r\n        setSelectedItems(new Set());\r\n        showToast(`${deletingType} deleted successfully`, 'success');\r\n      } else {\r\n        setError(`Failed to delete ${deletingType}`);\r\n      }\r\n    } catch (err: any) {\r\n      setError(err.response?.data?.error || `Failed to delete ${deletingType}`);\r\n    } finally {\r\n      setDeleting(false);\r\n      setDeleteConfirmOpen(false);\r\n      setDeletingId(null);\r\n    }\r\n  };\r\n\r\n  const handleCopyLink = async (token: string, email: string) => {\r\n    const baseURL = window.location.origin;\r\n    const taskURL = `${baseURL}/assign-task?token=${token}`;\r\n    \r\n    try {\r\n      await navigator.clipboard.writeText(taskURL);\r\n      showToast(`Task link copied to clipboard for ${email}`, 'success');\r\n    } catch (err) {\r\n      // Fallback for older browsers\r\n      const textArea = document.createElement('textarea');\r\n      textArea.value = taskURL;\r\n      document.body.appendChild(textArea);\r\n      textArea.select();\r\n      document.execCommand('copy');\r\n      document.body.removeChild(textArea);\r\n      showToast(`Task link copied to clipboard for ${email}`, 'success');\r\n    }\r\n  };\r\n\r\n  const showToast = (message: string, severity: 'success' | 'error' | 'warning' | 'info') => {\r\n    setError(severity === 'error' ? message : null);\r\n    if (severity === 'success') {\r\n      setError(null);\r\n      console.log('✅', message);\r\n    }\r\n  };\r\n\r\n  const handleViewSubmission = (submission: TaskSubmission) => {\r\n    setSelectedSubmission(submission);\r\n    setViewSubmissionOpen(true);\r\n  };\r\n\r\n  const handleDownloadSubmission = (submission: TaskSubmission) => {\r\n    try {\r\n      const tasks = JSON.parse(submission.tasks_json);\r\n      const filename = `task-submission-${submission.id}-${submission.email.replace('@', '_at_')}.txt`;\r\n      \r\n      const content = generateSubmissionReport(submission, tasks);\r\n      \r\n      const blob = new Blob([content], { type: 'text/plain' });\r\n      const url = URL.createObjectURL(blob);\r\n      const link = document.createElement('a');\r\n      link.href = url;\r\n      link.download = filename;\r\n      document.body.appendChild(link);\r\n      link.click();\r\n      document.body.removeChild(link);\r\n      URL.revokeObjectURL(url);\r\n      \r\n      showToast(`Task submission downloaded as ${filename}`, 'success');\r\n    } catch (error) {\r\n      setError('Failed to download submission');\r\n    }\r\n  };\r\n\r\n  const generateSubmissionReport = (submission: TaskSubmission, tasks: any[]) => {\r\n    const date = new Date(submission.submitted_at).toLocaleString();\r\n    \r\n    let report = `OMAI Task Submission Report\\n`;\r\n    report += `=====================================\\n\\n`;\r\n    report += `Submission ID: ${submission.id}\\n`;\r\n    report += `From Email: ${submission.email}\\n`;\r\n    report += `Submitted: ${date}\\n`;\r\n    report += `IP Address: ${submission.ip_address}\\n`;\r\n    report += `User Agent: ${submission.user_agent || 'Not provided'}\\n`;\r\n    report += `Submission Type: ${submission.submission_type}\\n`;\r\n    report += `Total Tasks: ${tasks.length}\\n`;\r\n    report += `Status: ${submission.status}\\n`;\r\n    report += `Sent to Nick: ${submission.sent_to_nick ? 'Yes' : 'No'}\\n`;\r\n    if (submission.sent_at) {\r\n      report += `Email Sent: ${new Date(submission.sent_at).toLocaleString()}\\n`;\r\n    }\r\n    report += `\\n`;\r\n    \r\n    report += `TASK DETAILS\\n`;\r\n    report += `=====================================\\n\\n`;\r\n    \r\n    tasks.forEach((task, index) => {\r\n      report += `Task ${index + 1}:\\n`;\r\n      report += `  Title: ${task.title}\\n`;\r\n      report += `  Priority: ${task.priority}\\n`;\r\n      if (task.description) {\r\n        report += `  Description:\\n    ${task.description.replace(/\\n/g, '\\n    ')}\\n`;\r\n      }\r\n      report += `\\n`;\r\n    });\r\n    \r\n    report += `\\nReport generated: ${new Date().toLocaleString()}\\n`;\r\n    report += `© Orthodox Metrics AI System\\n`;\r\n    \r\n    return report;\r\n  };\r\n\r\n  const formatDate = (dateString: string) => {\r\n    return new Date(dateString).toLocaleDateString('en-US', {\r\n      month: 'short',\r\n      day: 'numeric',\r\n      hour: '2-digit',\r\n      minute: '2-digit'\r\n    });\r\n  };\r\n\r\n  const getStatusColor = (status: string) => {\r\n    switch (status) {\r\n      case 'active': return 'success';\r\n      case 'used': return 'info';\r\n      case 'expired': return 'warning';\r\n      case 'deleted': return 'error';\r\n      case 'pending': return 'warning';\r\n      case 'processed': return 'info';\r\n      case 'completed': return 'success';\r\n      case 'failed': return 'error';\r\n      default: return 'default';\r\n    }\r\n  };\r\n\r\n  const getStatusIcon = (status: string) => {\r\n    switch (status) {\r\n      case 'active': return <LinkIcon />;\r\n      case 'used': return <CheckCircleIcon />;\r\n      case 'expired': return <ScheduleIcon />;\r\n      case 'deleted': return <DeleteIcon />;\r\n      case 'pending': return <ScheduleIcon />;\r\n      case 'processed': return <InfoIcon />;\r\n      case 'completed': return <CheckCircleIcon />;\r\n      case 'failed': return <WarningIcon />;\r\n      default: return <InfoIcon />;\r\n    }\r\n  };\r\n\r\n  const getActionIcon = (action: string) => {\r\n    const iconMap: { [key: string]: JSX.Element } = {\r\n      'TASK_LINK_GENERATED': <EmailIcon color=\"primary\" />,\r\n      'TASKS_SUBMITTED': <CheckCircleIcon color=\"success\" />,\r\n      'TOKEN_VALIDATED': <VisibilityIcon color=\"info\" />,\r\n      'TASK_LINK_ERROR': <AssignmentIcon color=\"error\" />,\r\n      'TASK_SUBMISSION_ERROR': <AssignmentIcon color=\"error\" />\r\n    };\r\n    return iconMap[action] || <HistoryIcon />;\r\n  };\r\n\r\n  const getActionLabel = (action: string) => {\r\n    const labelMap: { [key: string]: string } = {\r\n      'TASK_LINK_GENERATED': 'Link Generated',\r\n      'TASKS_SUBMITTED': 'Tasks Submitted',\r\n      'TOKEN_VALIDATED': 'Token Validated',\r\n      'TASK_LINK_ERROR': 'Link Error',\r\n      'TASK_SUBMISSION_ERROR': 'Submission Error'\r\n    };\r\n    return labelMap[action] || action;\r\n  };\r\n\r\n  const parseTasksJson = (tasksJson: string) => {\r\n    try {\r\n      const tasks = JSON.parse(tasksJson);\r\n      return Array.isArray(tasks) ? tasks : [];\r\n    } catch {\r\n      return [];\r\n    }\r\n  };\r\n\r\n  const handleHistoryPageChange = (event: unknown, newPage: number) => {\r\n    setHistoryPage(newPage);\r\n    fetchHistory(historyFilters, newPage);\r\n  };\r\n\r\n  const handleHistoryRowsPerPageChange = (event: React.ChangeEvent<HTMLInputElement>) => {\r\n    setHistoryRowsPerPage(parseInt(event.target.value, 10));\r\n    setHistoryPage(0);\r\n    fetchHistory(historyFilters, 0);\r\n  };\r\n\r\n  const handleHistoryFilterChange = (filter: string, value: string) => {\r\n    const newFilters = { ...historyFilters, [filter]: value };\r\n    setHistoryFilters(newFilters);\r\n    setHistoryPage(0);\r\n    fetchHistory(newFilters, 0);\r\n  };\r\n\r\n  // Don't render if user doesn't have permission\r\n  if (!canView) {\r\n    return null;\r\n  }\r\n\r\n  if (loading) {\r\n    return (\r\n      <Card sx={{ minHeight: 600 }}>\r\n        <CardContent>\r\n          <Box display=\"flex\" justifyContent=\"center\" alignItems=\"center\" height=\"100%\">\r\n            <CircularProgress />\r\n          </Box>\r\n        </CardContent>\r\n      </Card>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <Card sx={{ minHeight: 600 }}>\r\n        <CardContent sx={{ p: 0 }}>\r\n          {/* Header */}\r\n          <Box sx={{ p: 3, borderBottom: 1, borderColor: 'divider', bgcolor: '#f8f9fa' }}>\r\n            <Box display=\"flex\" justifyContent=\"space-between\" alignItems=\"center\">\r\n              <Box display=\"flex\" alignItems=\"center\">\r\n                <AssignmentIcon sx={{ mr: 2, color: '#8c249d', fontSize: 32 }} />\r\n                <Box>\r\n                  <Typography variant=\"h5\" fontWeight=\"bold\" color=\"#8c249d\">\r\n                    OMAI Task Assignment\r\n                  </Typography>\r\n                  <Typography variant=\"body2\" color=\"text.secondary\">\r\n                    Manage task links, submissions, and activity logs\r\n                  </Typography>\r\n                </Box>\r\n              </Box>\r\n              <Stack direction=\"row\" spacing={1}>\r\n                <Button\r\n                  variant=\"contained\"\r\n                  startIcon={<AddIcon />}\r\n                  onClick={() => setGenerateDialogOpen(true)}\r\n                  sx={{ bgcolor: '#8c249d', '&:hover': { bgcolor: '#6a1b9a' } }}\r\n                >\r\n                  Generate Link\r\n                </Button>\r\n                <Button\r\n                  variant=\"contained\"\r\n                  startIcon={<TaskIcon />}\r\n                  onClick={() => setCreateTaskDialogOpen(true)}\r\n                  sx={{ bgcolor: '#8c249d', '&:hover': { bgcolor: '#6a1b9a' } }}\r\n                >\r\n                  Create Task\r\n                </Button>\r\n                <Button\r\n                  variant=\"outlined\"\r\n                  startIcon={<HistoryIcon />}\r\n                  onClick={() => setHistoryDialogOpen(true)}\r\n                >\r\n                  Full History\r\n                </Button>\r\n                <Button\r\n                  variant=\"outlined\"\r\n                  startIcon={<SettingsIcon />}\r\n                  onClick={() => setSettingsDialogOpen(true)}\r\n                >\r\n                  Settings\r\n                </Button>\r\n                <Tooltip title=\"Refresh Data\">\r\n                  <IconButton onClick={fetchData} color=\"primary\">\r\n                    <RefreshIcon />\r\n                  </IconButton>\r\n                </Tooltip>\r\n              </Stack>\r\n            </Box>\r\n          </Box>\r\n\r\n          {/* Error Alert */}\r\n          {error && (\r\n            <Alert severity=\"error\" sx={{ m: 3 }}>\r\n              {error}\r\n            </Alert>\r\n          )}\r\n\r\n          {/* Tabs */}\r\n          <Tabs\r\n            value={tabValue}\r\n            onChange={(_, newValue) => setTabValue(newValue)}\r\n            sx={{ borderBottom: 1, borderColor: 'divider', px: 3 }}\r\n            variant=\"scrollable\"\r\n            scrollButtons=\"auto\"\r\n          >\r\n            <Tab \r\n              label={\r\n                <Box display=\"flex\" alignItems=\"center\">\r\n                  <LinkIcon sx={{ mr: 1 }} />\r\n                  Links\r\n                  <Badge badgeContent={data?.recent_links?.length || 0} color=\"primary\" sx={{ ml: 1 }} />\r\n                </Box>\r\n              } \r\n            />\r\n            <Tab \r\n              label={\r\n                <Box display=\"flex\" alignItems=\"center\">\r\n                  <TaskIcon sx={{ mr: 1 }} />\r\n                  Submissions\r\n                  <Badge badgeContent={data?.recent_submissions?.length || 0} color=\"secondary\" sx={{ ml: 1 }} />\r\n                </Box>\r\n              } \r\n            />\r\n            <Tab \r\n              label={\r\n                <Box display=\"flex\" alignItems=\"center\">\r\n                  <HistoryIcon sx={{ mr: 1 }} />\r\n                  Activity\r\n                  <Badge badgeContent={data?.recent_logs?.length || 0} color=\"info\" sx={{ ml: 1 }} />\r\n                </Box>\r\n              } \r\n            />\r\n          </Tabs>\r\n\r\n          {/* Tab Content */}\r\n          <Box sx={{ p: 3, minHeight: 400 }}>\r\n            {/* Recent Links Tab */}\r\n            {tabValue === 0 && (\r\n              <Box>\r\n                <Typography variant=\"h6\" gutterBottom>\r\n                  Task Assignment Links\r\n                </Typography>\r\n                {data?.recent_links?.length === 0 ? (\r\n                  <Alert severity=\"info\">\r\n                    No task links generated yet. Generate your first link to get started.\r\n                  </Alert>\r\n                ) : (\r\n                  <TableContainer component={Paper} variant=\"outlined\">\r\n                    <Table>\r\n                      <TableHead>\r\n                        <TableRow>\r\n                          <TableCell>Email</TableCell>\r\n                          <TableCell>Status</TableCell>\r\n                          <TableCell>Created</TableCell>\r\n                          <TableCell>IP Address</TableCell>\r\n                          <TableCell>Notes</TableCell>\r\n                          <TableCell>Actions</TableCell>\r\n                        </TableRow>\r\n                      </TableHead>\r\n                      <TableBody>\r\n                        {data?.recent_links?.map((link) => (\r\n                          <TableRow key={link.id}>\r\n                            <TableCell>\r\n                              <Box display=\"flex\" alignItems=\"center\">\r\n                                <Avatar sx={{ width: 32, height: 32, mr: 2, bgcolor: '#8c249d' }}>\r\n                                  {link.email.charAt(0).toUpperCase()}\r\n                                </Avatar>\r\n                                <Box>\r\n                                  <Typography variant=\"body2\" fontWeight=\"medium\">\r\n                                    {link.email}\r\n                                  </Typography>\r\n                                  <Typography variant=\"caption\" color=\"text.secondary\">\r\n                                    Token: {link.token ? `${link.token.substring(0, 8)}...` : 'No token'}\r\n                                  </Typography>\r\n                                </Box>\r\n                              </Box>\r\n                            </TableCell>\r\n                            <TableCell>\r\n                              <Chip\r\n                                icon={getStatusIcon(link.status || 'active')}\r\n                                label={link.status || 'active'}\r\n                                color={getStatusColor(link.status || 'active') as any}\r\n                                size=\"small\"\r\n                              />\r\n                            </TableCell>\r\n                            <TableCell>\r\n                              <Typography variant=\"body2\">\r\n                                {formatDate(link.created_at)}\r\n                              </Typography>\r\n                              {link.expires_at && (\r\n                                <Typography variant=\"caption\" color=\"text.secondary\" display=\"block\">\r\n                                  Expires: {formatDate(link.expires_at)}\r\n                                </Typography>\r\n                              )}\r\n                            </TableCell>\r\n                            <TableCell>\r\n                              {link.ip_address ? (\r\n                                <Box display=\"flex\" alignItems=\"center\">\r\n                                  <ComputerIcon sx={{ fontSize: 16, mr: 1, color: 'text.secondary' }} />\r\n                                  <Typography variant=\"body2\" fontFamily=\"monospace\">\r\n                                    {link.ip_address}\r\n                                  </Typography>\r\n                                </Box>\r\n                              ) : (\r\n                                <Typography variant=\"body2\" color=\"text.secondary\">\r\n                                  Unknown\r\n                                </Typography>\r\n                              )}\r\n                            </TableCell>\r\n                            <TableCell>\r\n                              {link.notes ? (\r\n                                <Typography variant=\"body2\" noWrap>\r\n                                  {link.notes}\r\n                                </Typography>\r\n                              ) : (\r\n                                <Typography variant=\"body2\" color=\"text.secondary\">\r\n                                  No notes\r\n                                </Typography>\r\n                              )}\r\n                            </TableCell>\r\n                            <TableCell>\r\n                              <Box display=\"flex\" gap={1}>\r\n                                {link.status === 'active' && (\r\n                                  <>\r\n                                    {link.token && (\r\n                                      <Tooltip title=\"Copy Link\">\r\n                                        <IconButton \r\n                                          size=\"small\" \r\n                                          onClick={() => handleCopyLink(link.token, link.email)}\r\n                                        >\r\n                                          <CopyIcon fontSize=\"small\" />\r\n                                        </IconButton>\r\n                                      </Tooltip>\r\n                                    )}\r\n                                    <Tooltip title=\"Delete Link\">\r\n                                      <IconButton \r\n                                        size=\"small\" \r\n                                        color=\"error\"\r\n                                        onClick={() => handleDeleteItem('link', link.id)}\r\n                                      >\r\n                                        <DeleteIcon fontSize=\"small\" />\r\n                                      </IconButton>\r\n                                    </Tooltip>\r\n                                    <Tooltip title=\"Regenerate Link\">\r\n                                      <IconButton \r\n                                        size=\"small\" \r\n                                        color=\"primary\"\r\n                                        onClick={() => handleRegenerateLink(link.email)}\r\n                                      >\r\n                                        <RefreshIcon fontSize=\"small\" />\r\n                                      </IconButton>\r\n                                    </Tooltip>\r\n                                  </>\r\n                                )}\r\n                                {link.status === 'used' && (\r\n                                  <Tooltip title=\"View Details\">\r\n                                    <IconButton size=\"small\">\r\n                                      <ViewIcon fontSize=\"small\" />\r\n                                    </IconButton>\r\n                                  </Tooltip>\r\n                                )}\r\n                              </Box>\r\n                            </TableCell>\r\n                          </TableRow>\r\n                        ))}\r\n                      </TableBody>\r\n                    </Table>\r\n                  </TableContainer>\r\n                )}\r\n              </Box>\r\n            )}\r\n\r\n            {/* Recent Submissions Tab */}\r\n            {tabValue === 1 && (\r\n              <Box>\r\n                <Box display=\"flex\" justifyContent=\"space-between\" alignItems=\"center\" mb={2}>\r\n                  <Typography variant=\"h6\">\r\n                    Task Submissions\r\n                  </Typography>\r\n                  {selectedItems.size > 0 && (\r\n                    <Button\r\n                      variant=\"outlined\"\r\n                      color=\"error\"\r\n                      startIcon={<DeleteIcon />}\r\n                      onClick={() => handleDeleteItem('batch', null)}\r\n                    >\r\n                      Delete Selected ({selectedItems.size})\r\n                    </Button>\r\n                  )}\r\n                </Box>\r\n                \r\n                {data?.recent_submissions?.length === 0 ? (\r\n                  <Alert severity=\"info\">\r\n                    No task submissions yet. Task submissions will appear here once users submit tasks.\r\n                  </Alert>\r\n                ) : (\r\n                  <TableContainer component={Paper} variant=\"outlined\">\r\n                    <Table>\r\n                      <TableHead>\r\n                        <TableRow>\r\n                          <TableCell padding=\"checkbox\">\r\n                            <Switch\r\n                              checked={selectedItems.size === data?.recent_submissions?.length}\r\n                              indeterminate={selectedItems.size > 0 && selectedItems.size < (data?.recent_submissions?.length || 0)}\r\n                              onChange={(e) => {\r\n                                if (e.target.checked) {\r\n                                  setSelectedItems(new Set(data?.recent_submissions?.map(s => s.id) || []));\r\n                                } else {\r\n                                  setSelectedItems(new Set());\r\n                                }\r\n                              }}\r\n                            />\r\n                          </TableCell>\r\n                          <TableCell>Email</TableCell>\r\n                          <TableCell>Tasks</TableCell>\r\n                          <TableCell>Submitted</TableCell>\r\n                          <TableCell>IP Address</TableCell>\r\n                          <TableCell>Status</TableCell>\r\n                          <TableCell>Actions</TableCell>\r\n                        </TableRow>\r\n                      </TableHead>\r\n                      <TableBody>\r\n                        {data?.recent_submissions?.map((submission) => {\r\n                          const tasks = parseTasksJson(submission.tasks_json);\r\n                          return (\r\n                            <TableRow key={submission.id}>\r\n                              <TableCell padding=\"checkbox\">\r\n                                <Switch\r\n                                  checked={selectedItems.has(submission.id)}\r\n                                  onChange={(e) => {\r\n                                    const newSelected = new Set(selectedItems);\r\n                                    if (e.target.checked) {\r\n                                      newSelected.add(submission.id);\r\n                                    } else {\r\n                                      newSelected.delete(submission.id);\r\n                                    }\r\n                                    setSelectedItems(newSelected);\r\n                                  }}\r\n                                />\r\n                              </TableCell>\r\n                              <TableCell>\r\n                                <Box display=\"flex\" alignItems=\"center\">\r\n                                  <Avatar sx={{ width: 32, height: 32, mr: 2, bgcolor: '#8c249d' }}>\r\n                                    {submission.email.charAt(0).toUpperCase()}\r\n                                  </Avatar>\r\n                                  <Box>\r\n                                    <Typography variant=\"body2\" fontWeight=\"medium\">\r\n                                      {submission.email}\r\n                                    </Typography>\r\n                                    <Typography variant=\"caption\" color=\"text.secondary\">\r\n                                      {submission.submission_type}\r\n                                    </Typography>\r\n                                  </Box>\r\n                                </Box>\r\n                              </TableCell>\r\n                              <TableCell>\r\n                                <Typography variant=\"body2\">\r\n                                  {tasks.length} task{tasks.length !== 1 ? 's' : ''}\r\n                                </Typography>\r\n                                <Typography variant=\"caption\" color=\"text.secondary\">\r\n                                  {tasks.slice(0, 2).map(t => t.title).join(', ')}\r\n                                  {tasks.length > 2 && '...'}\r\n                                </Typography>\r\n                              </TableCell>\r\n                              <TableCell>\r\n                                <Typography variant=\"body2\">\r\n                                  {formatDate(submission.submitted_at)}\r\n                                </Typography>\r\n                                {submission.sent_to_nick && submission.sent_at && (\r\n                                  <Typography variant=\"caption\" color=\"success.main\" display=\"block\">\r\n                                    Sent: {formatDate(submission.sent_at)}\r\n                                  </Typography>\r\n                                )}\r\n                              </TableCell>\r\n                              <TableCell>\r\n                                <Box display=\"flex\" alignItems=\"center\">\r\n                                  <ComputerIcon sx={{ fontSize: 16, mr: 1, color: 'text.secondary' }} />\r\n                                  <Typography variant=\"body2\" fontFamily=\"monospace\">\r\n                                    {submission.ip_address}\r\n                                  </Typography>\r\n                                </Box>\r\n                              </TableCell>\r\n                              <TableCell>\r\n                                <Chip\r\n                                  icon={getStatusIcon(submission.status)}\r\n                                  label={submission.status}\r\n                                  color={getStatusColor(submission.status) as any}\r\n                                  size=\"small\"\r\n                                />\r\n                              </TableCell>\r\n                              <TableCell>\r\n                                <Box display=\"flex\" gap={1}>\r\n                                  <Tooltip title=\"View Tasks\">\r\n                                    <IconButton \r\n                                      size=\"small\" \r\n                                      onClick={() => handleViewSubmission(submission)}\r\n                                    >\r\n                                      <ViewIcon fontSize=\"small\" />\r\n                                    </IconButton>\r\n                                  </Tooltip>\r\n                                  <Tooltip title=\"Download Report\">\r\n                                    <IconButton \r\n                                      size=\"small\" \r\n                                      onClick={() => handleDownloadSubmission(submission)}\r\n                                    >\r\n                                      <DownloadIcon fontSize=\"small\" />\r\n                                    </IconButton>\r\n                                  </Tooltip>\r\n                                  <Tooltip title=\"Delete Submission\">\r\n                                    <IconButton \r\n                                      size=\"small\" \r\n                                      color=\"error\"\r\n                                      onClick={() => handleDeleteItem('submission', submission.id)}\r\n                                    >\r\n                                      <DeleteIcon fontSize=\"small\" />\r\n                                    </IconButton>\r\n                                  </Tooltip>\r\n                                </Box>\r\n                              </TableCell>\r\n                            </TableRow>\r\n                          );\r\n                        })}\r\n                      </TableBody>\r\n                    </Table>\r\n                  </TableContainer>\r\n                )}\r\n              </Box>\r\n            )}\r\n\r\n            {/* Activity Logs Tab */}\r\n            {tabValue === 2 && (\r\n              <Box>\r\n                <Typography variant=\"h6\" gutterBottom>\r\n                  Recent Activity\r\n                </Typography>\r\n                {data?.recent_logs?.length === 0 ? (\r\n                  <Alert severity=\"info\">\r\n                    No recent activity. Activity logs will appear here as users interact with the system.\r\n                  </Alert>\r\n                ) : (\r\n                  <List>\r\n                    {data?.recent_logs?.map((log, index) => (\r\n                      <Paper key={index} sx={{ mb: 2, p: 2 }} variant=\"outlined\">\r\n                        <Box display=\"flex\" alignItems=\"flex-start\" gap={2}>\r\n                          <Box sx={{ mt: 0.5 }}>\r\n                            {getActionIcon(log.action)}\r\n                          </Box>\r\n                          <Box flex={1}>\r\n                            <Box display=\"flex\" alignItems=\"center\" gap={1} mb={1}>\r\n                              <Typography variant=\"body2\" fontWeight=\"medium\">\r\n                                {getActionLabel(log.action)}\r\n                              </Typography>\r\n                              {log.email && (\r\n                                <Chip label={log.email} size=\"small\" variant=\"outlined\" />\r\n                              )}\r\n                              <Typography variant=\"caption\" color=\"text.secondary\">\r\n                                {formatDate(log.timestamp)}\r\n                              </Typography>\r\n                            </Box>\r\n                            \r\n                            {log.token && (\r\n                              <Box display=\"flex\" alignItems=\"center\" gap={1} mb={1}>\r\n                                <Typography variant=\"caption\" color=\"text.secondary\">\r\n                                  Token: {log.token.substring(0, 8)}...\r\n                                </Typography>\r\n                              </Box>\r\n                            )}\r\n                            \r\n                            {log.data && (\r\n                              <Accordion variant=\"outlined\" sx={{ mt: 1 }}>\r\n                                <AccordionSummary expandIcon={<ExpandMoreIcon />}>\r\n                                  <Typography variant=\"caption\">View Details</Typography>\r\n                                </AccordionSummary>\r\n                                <AccordionDetails>\r\n                                  <pre style={{ fontSize: '12px', overflow: 'auto' }}>\r\n                                    {JSON.stringify(log.data, null, 2)}\r\n                                  </pre>\r\n                                </AccordionDetails>\r\n                              </Accordion>\r\n                            )}\r\n                          </Box>\r\n                        </Box>\r\n                      </Paper>\r\n                    ))}\r\n                  </List>\r\n                )}\r\n              </Box>\r\n            )}\r\n          </Box>\r\n        </CardContent>\r\n      </Card>\r\n\r\n      {/* Generate Link Dialog */}\r\n      <Dialog open={generateDialogOpen} onClose={() => setGenerateDialogOpen(false)} maxWidth=\"sm\" fullWidth>\r\n        <DialogTitle>Generate Task Assignment Link</DialogTitle>\r\n        <DialogContent>\r\n          <Typography variant=\"body2\" color=\"text.secondary\" sx={{ mb: 3 }}>\r\n            Enter an email address to generate a secure task assignment link. \r\n            The recipient will receive an email with instructions to assign tasks to Nick.\r\n          </Typography>\r\n          \r\n          <Stack spacing={3}>\r\n            <TextField\r\n              fullWidth\r\n              label=\"Email Address\"\r\n              type=\"email\"\r\n              value={newLinkEmail}\r\n              onChange={(e) => setNewLinkEmail(e.target.value)}\r\n              placeholder=\"user@example.com\"\r\n              required\r\n            />\r\n            \r\n            <TextField\r\n              fullWidth\r\n              label=\"Notes (Optional)\"\r\n              multiline\r\n              rows={2}\r\n              value={newLinkNotes}\r\n              onChange={(e) => setNewLinkNotes(e.target.value)}\r\n              placeholder=\"Add any notes about this task assignment...\"\r\n            />\r\n            \r\n            <FormControl fullWidth>\r\n              <InputLabel>Expiration Time</InputLabel>\r\n              <Select\r\n                value={newLinkExpiry}\r\n                onChange={(e) => setNewLinkExpiry(e.target.value)}\r\n                label=\"Expiration Time\"\r\n              >\r\n                <MenuItem value=\"60\">1 hour</MenuItem>\r\n                <MenuItem value=\"1440\">24 hours</MenuItem>\r\n                <MenuItem value=\"10080\">1 week</MenuItem>\r\n                <MenuItem value=\"43200\">1 month</MenuItem>\r\n              </Select>\r\n            </FormControl>\r\n          </Stack>\r\n        </DialogContent>\r\n        <DialogActions>\r\n          <Button onClick={() => setGenerateDialogOpen(false)}>\r\n            Cancel\r\n          </Button>\r\n          <Button\r\n            onClick={handleGenerateLink}\r\n            variant=\"contained\"\r\n            disabled={generating || !newLinkEmail}\r\n            sx={{ bgcolor: '#8c249d', '&:hover': { bgcolor: '#6a1b9a' } }}\r\n          >\r\n            {generating ? 'Generating...' : 'Generate Link'}\r\n          </Button>\r\n        </DialogActions>\r\n      </Dialog>\r\n\r\n      {/* Delete Confirmation Dialog */}\r\n      <Dialog open={deleteConfirmOpen} onClose={() => setDeleteConfirmOpen(false)}>\r\n        <DialogTitle>Confirm Deletion</DialogTitle>\r\n        <DialogContent>\r\n          <Typography>\r\n            Are you sure you want to delete this {deletingType}? This action cannot be undone.\r\n          </Typography>\r\n        </DialogContent>\r\n        <DialogActions>\r\n          <Button onClick={() => setDeleteConfirmOpen(false)}>\r\n            Cancel\r\n          </Button>\r\n          <Button\r\n            onClick={confirmDelete}\r\n            color=\"error\"\r\n            variant=\"contained\"\r\n            disabled={deleting}\r\n          >\r\n            {deleting ? 'Deleting...' : 'Delete'}\r\n          </Button>\r\n        </DialogActions>\r\n      </Dialog>\r\n\r\n      {/* View Submission Dialog */}\r\n      <Dialog \r\n        open={viewSubmissionOpen} \r\n        onClose={() => setViewSubmissionOpen(false)} \r\n        maxWidth=\"md\" \r\n        fullWidth\r\n      >\r\n        <DialogTitle>\r\n          Task Submission Details\r\n          {selectedSubmission && (\r\n            <Typography variant=\"subtitle2\" color=\"text.secondary\">\r\n              Submission #{selectedSubmission.id} from {selectedSubmission.email}\r\n            </Typography>\r\n          )}\r\n        </DialogTitle>\r\n        <DialogContent>\r\n          {selectedSubmission && (\r\n            <Box>\r\n              {/* Submission Info */}\r\n              <Paper sx={{ p: 3, mb: 3, bgcolor: '#f9f9f9' }}>\r\n                <Grid container spacing={3}>\r\n                  <Grid item xs={12} sm={6}>\r\n                    <Typography variant=\"body2\">\r\n                      <strong>Submitted:</strong> {formatDate(selectedSubmission.submitted_at)}\r\n                    </Typography>\r\n                  </Grid>\r\n                  <Grid item xs={12} sm={6}>\r\n                    <Typography variant=\"body2\">\r\n                      <strong>Status:</strong> \r\n                      <Chip \r\n                        label={selectedSubmission.status}\r\n                        color={getStatusColor(selectedSubmission.status) as any}\r\n                        size=\"small\"\r\n                        sx={{ ml: 1 }}\r\n                      />\r\n                    </Typography>\r\n                  </Grid>\r\n                  <Grid item xs={12} sm={6}>\r\n                    <Typography variant=\"body2\">\r\n                      <strong>IP Address:</strong> \r\n                      <Box display=\"flex\" alignItems=\"center\" sx={{ ml: 1 }}>\r\n                        <ComputerIcon sx={{ fontSize: 16, mr: 0.5, color: 'text.secondary' }} />\r\n                        <Typography variant=\"body2\" fontFamily=\"monospace\">\r\n                          {selectedSubmission.ip_address}\r\n                        </Typography>\r\n                      </Box>\r\n                    </Typography>\r\n                  </Grid>\r\n                  <Grid item xs={12} sm={6}>\r\n                    <Typography variant=\"body2\">\r\n                      <strong>Type:</strong> \r\n                      <Chip \r\n                        label={selectedSubmission.submission_type}\r\n                        size=\"small\"\r\n                        variant=\"outlined\"\r\n                        sx={{ ml: 1 }}\r\n                      />\r\n                    </Typography>\r\n                  </Grid>\r\n                  {selectedSubmission.sent_to_nick && selectedSubmission.sent_at && (\r\n                    <Grid item xs={12}>\r\n                      <Typography variant=\"body2\">\r\n                        <strong>Email Sent:</strong> {formatDate(selectedSubmission.sent_at)}\r\n                      </Typography>\r\n                    </Grid>\r\n                  )}\r\n                </Grid>\r\n              </Paper>\r\n\r\n              {/* Task List */}\r\n              <Typography variant=\"h6\" gutterBottom>\r\n                Submitted Tasks\r\n              </Typography>\r\n              \r\n              {(() => {\r\n                try {\r\n                  const tasks = JSON.parse(selectedSubmission.tasks_json);\r\n                  return (\r\n                    <List>\r\n                      {tasks.map((task: any, index: number) => (\r\n                        <Paper key={index} sx={{ mb: 2, p: 3 }} variant=\"outlined\">\r\n                          <Box display=\"flex\" alignItems=\"center\" mb={2}>\r\n                            <Typography variant=\"h6\" component=\"span\">\r\n                              Task {index + 1}\r\n                            </Typography>\r\n                            <Chip \r\n                              label={task.priority} \r\n                              color={\r\n                                task.priority === 'high' ? 'error' :\r\n                                task.priority === 'medium' ? 'warning' : 'default'\r\n                              }\r\n                              size=\"small\"\r\n                              sx={{ ml: 2 }}\r\n                            />\r\n                          </Box>\r\n                          \r\n                          <Typography variant=\"body1\" fontWeight=\"medium\" gutterBottom>\r\n                            {task.title}\r\n                          </Typography>\r\n                          \r\n                          {task.description && (\r\n                            <Typography variant=\"body2\" color=\"text.secondary\" sx={{ whiteSpace: 'pre-wrap' }}>\r\n                              {task.description}\r\n                            </Typography>\r\n                          )}\r\n                        </Paper>\r\n                      ))}\r\n                    </List>\r\n                  );\r\n                } catch (error) {\r\n                  return (\r\n                    <Alert severity=\"error\">\r\n                      Failed to parse task data: {selectedSubmission.tasks_json}\r\n                    </Alert>\r\n                  );\r\n                }\r\n              })()}\r\n            </Box>\r\n          )}\r\n        </DialogContent>\r\n        <DialogActions>\r\n          <Button onClick={() => setViewSubmissionOpen(false)}>\r\n            Close\r\n          </Button>\r\n          {selectedSubmission && (\r\n            <Button\r\n              onClick={() => handleDownloadSubmission(selectedSubmission)}\r\n              variant=\"contained\"\r\n              startIcon={<DownloadIcon />}\r\n              sx={{ bgcolor: '#8c249d' }}\r\n            >\r\n              Download Report\r\n            </Button>\r\n          )}\r\n        </DialogActions>\r\n      </Dialog>\r\n\r\n      {/* History Dialog */}\r\n      <Dialog \r\n        open={historyDialogOpen} \r\n        onClose={() => setHistoryDialogOpen(false)} \r\n        maxWidth=\"xl\" \r\n        fullWidth\r\n      >\r\n        <DialogTitle>\r\n          <Box display=\"flex\" alignItems=\"center\" justifyContent=\"space-between\">\r\n            <Typography variant=\"h6\">Task Assignment History</Typography>\r\n            <Button\r\n              variant=\"outlined\"\r\n              startIcon={<RefreshIcon />}\r\n              onClick={() => fetchHistory()}\r\n              disabled={historyLoading}\r\n            >\r\n              Refresh\r\n            </Button>\r\n          </Box>\r\n        </DialogTitle>\r\n        <DialogContent>\r\n          {/* Filters */}\r\n          <Paper sx={{ p: 2, mb: 3 }} variant=\"outlined\">\r\n            <Grid container spacing={2} alignItems=\"center\">\r\n              <Grid item xs={12} sm={3}>\r\n                <TextField\r\n                  fullWidth\r\n                  size=\"small\"\r\n                  label=\"Email\"\r\n                  value={historyFilters.email}\r\n                  onChange={(e) => handleHistoryFilterChange('email', e.target.value)}\r\n                  placeholder=\"Filter by email...\"\r\n                />\r\n              </Grid>\r\n              <Grid item xs={12} sm={2}>\r\n                <FormControl fullWidth size=\"small\">\r\n                  <InputLabel>Status</InputLabel>\r\n                  <Select\r\n                    value={historyFilters.status}\r\n                    onChange={(e) => handleHistoryFilterChange('status', e.target.value)}\r\n                    label=\"Status\"\r\n                  >\r\n                    <MenuItem value=\"\">All</MenuItem>\r\n                    <MenuItem value=\"pending\">Pending</MenuItem>\r\n                    <MenuItem value=\"processed\">Processed</MenuItem>\r\n                    <MenuItem value=\"completed\">Completed</MenuItem>\r\n                    <MenuItem value=\"failed\">Failed</MenuItem>\r\n                  </Select>\r\n                </FormControl>\r\n              </Grid>\r\n              <Grid item xs={12} sm={2}>\r\n                <FormControl fullWidth size=\"small\">\r\n                  <InputLabel>Type</InputLabel>\r\n                  <Select\r\n                    value={historyFilters.type}\r\n                    onChange={(e) => handleHistoryFilterChange('type', e.target.value)}\r\n                    label=\"Type\"\r\n                  >\r\n                    <MenuItem value=\"\">All</MenuItem>\r\n                    <MenuItem value=\"email_link\">Email Link</MenuItem>\r\n                    <MenuItem value=\"public_token\">Public Token</MenuItem>\r\n                    <MenuItem value=\"internal\">Internal</MenuItem>\r\n                  </Select>\r\n                </FormControl>\r\n              </Grid>\r\n              <Grid item xs={12} sm={2}>\r\n                <TextField\r\n                  fullWidth\r\n                  size=\"small\"\r\n                  type=\"date\"\r\n                  label=\"From Date\"\r\n                  value={historyFilters.dateFrom}\r\n                  onChange={(e) => handleHistoryFilterChange('dateFrom', e.target.value)}\r\n                  InputLabelProps={{ shrink: true }}\r\n                />\r\n              </Grid>\r\n              <Grid item xs={12} sm={2}>\r\n                <TextField\r\n                  fullWidth\r\n                  size=\"small\"\r\n                  type=\"date\"\r\n                  label=\"To Date\"\r\n                  value={historyFilters.dateTo}\r\n                  onChange={(e) => handleHistoryFilterChange('dateTo', e.target.value)}\r\n                  InputLabelProps={{ shrink: true }}\r\n                />\r\n              </Grid>\r\n            </Grid>\r\n          </Paper>\r\n\r\n          {/* History Table */}\r\n          {historyLoading ? (\r\n            <Box display=\"flex\" justifyContent=\"center\" p={4}>\r\n              <CircularProgress />\r\n            </Box>\r\n          ) : (\r\n            <TableContainer component={Paper} variant=\"outlined\">\r\n              <Table>\r\n                <TableHead>\r\n                  <TableRow>\r\n                    <TableCell>Email</TableCell>\r\n                    <TableCell>Tasks</TableCell>\r\n                    <TableCell>Submitted</TableCell>\r\n                    <TableCell>IP Address</TableCell>\r\n                    <TableCell>Status</TableCell>\r\n                    <TableCell>Type</TableCell>\r\n                    <TableCell>Actions</TableCell>\r\n                  </TableRow>\r\n                </TableHead>\r\n                <TableBody>\r\n                  {historyData.map((submission) => {\r\n                    const tasks = parseTasksJson(submission.tasks_json);\r\n                    return (\r\n                      <TableRow key={submission.id}>\r\n                        <TableCell>{submission.email}</TableCell>\r\n                        <TableCell>{tasks.length} tasks</TableCell>\r\n                        <TableCell>{formatDate(submission.submitted_at)}</TableCell>\r\n                        <TableCell>\r\n                          <Box display=\"flex\" alignItems=\"center\">\r\n                            <ComputerIcon sx={{ fontSize: 16, mr: 1, color: 'text.secondary' }} />\r\n                            <Typography variant=\"body2\" fontFamily=\"monospace\">\r\n                              {submission.ip_address}\r\n                            </Typography>\r\n                          </Box>\r\n                        </TableCell>\r\n                        <TableCell>\r\n                          <Chip\r\n                            label={submission.status}\r\n                            color={getStatusColor(submission.status) as any}\r\n                            size=\"small\"\r\n                          />\r\n                        </TableCell>\r\n                        <TableCell>\r\n                          <Chip\r\n                            label={submission.submission_type}\r\n                            size=\"small\"\r\n                            variant=\"outlined\"\r\n                          />\r\n                        </TableCell>\r\n                        <TableCell>\r\n                          <Box display=\"flex\" gap={1}>\r\n                            <Tooltip title=\"View Details\">\r\n                              <IconButton size=\"small\">\r\n                                <ViewIcon fontSize=\"small\" />\r\n                              </IconButton>\r\n                            </Tooltip>\r\n                            <Tooltip title=\"Download\">\r\n                              <IconButton size=\"small\">\r\n                                <DownloadIcon fontSize=\"small\" />\r\n                              </IconButton>\r\n                            </Tooltip>\r\n                          </Box>\r\n                        </TableCell>\r\n                      </TableRow>\r\n                    );\r\n                  })}\r\n                </TableBody>\r\n              </Table>\r\n              <TablePagination\r\n                rowsPerPageOptions={[10, 25, 50, 100]}\r\n                component=\"div\"\r\n                count={-1} // We don't have total count from API\r\n                rowsPerPage={historyRowsPerPage}\r\n                page={historyPage}\r\n                onPageChange={handleHistoryPageChange}\r\n                onRowsPerPageChange={handleHistoryRowsPerPageChange}\r\n              />\r\n            </TableContainer>\r\n          )}\r\n        </DialogContent>\r\n        <DialogActions>\r\n          <Button onClick={() => setHistoryDialogOpen(false)}>\r\n            Close\r\n          </Button>\r\n        </DialogActions>\r\n      </Dialog>\r\n\r\n      {/* Settings Dialog */}\r\n      <Dialog \r\n        open={settingsDialogOpen} \r\n        onClose={() => setSettingsDialogOpen(false)} \r\n        maxWidth=\"md\" \r\n        fullWidth\r\n      >\r\n        <DialogTitle>Email Settings</DialogTitle>\r\n        <DialogContent>\r\n          <EmailSettingsForm />\r\n        </DialogContent>\r\n        <DialogActions>\r\n          <Button onClick={() => setSettingsDialogOpen(false)}>\r\n            Close\r\n          </Button>\r\n        </DialogActions>\r\n      </Dialog>\r\n\r\n      {/* Create Task Dialog */}\r\n      <CreateTaskDialog\r\n        open={createTaskDialogOpen}\r\n        onClose={() => setCreateTaskDialogOpen(false)}\r\n        onSave={async (taskData) => {\r\n          try {\r\n            const result = await omaiAPI.createTask(taskData);\r\n            \r\n            // Check if result indicates failure\r\n            if (result && result.success === false) {\r\n              throw new Error(result.error || 'Failed to create task');\r\n            }\r\n            \r\n            // Refresh data after creating task\r\n            await fetchData();\r\n            showToast('Task created successfully', 'success');\r\n          } catch (error: any) {\r\n            // Error will be handled by CreateTaskDialog's error handling\r\n            throw error;\r\n          }\r\n        }}\r\n      />\r\n    </>\r\n  );\r\n};\r\n\r\nexport default OMAITaskAssignmentWidget;\r\n\r\n","/**\r\n * OMTasksPage.tsx\r\n * Main page for OMAI Task Assignment management\r\n * Located at /devel-tools/om-tasks\r\n */\r\n\r\nimport React from 'react';\r\nimport { Box } from '@mui/material';\r\nimport PageContainer from '@/shared/ui/PageContainer';\r\nimport Breadcrumb from '@/layouts/full/shared/breadcrumb/Breadcrumb';\r\nimport OMAITaskAssignmentWidget from './components/OMAITaskAssignmentWidget';\r\n\r\nconst OMTasksPage: React.FC = () => {\r\n  const BCrumb = [\r\n    { to: '/', title: 'Home' },\r\n    { to: '/devel-tools', title: 'Developer Tools' },\r\n    { title: 'OM Tasks' },\r\n  ];\r\n\r\n  return (\r\n    <PageContainer title=\"OMAI Task Assignment\" description=\"Manage OMAI task links, submissions, and activity logs\">\r\n      <Breadcrumb title=\"OMAI Task Assignment\" items={BCrumb} />\r\n      <Box p={3}>\r\n        <Box sx={{ minHeight: '80vh' }}>\r\n          <OMAITaskAssignmentWidget />\r\n        </Box>\r\n      </Box>\r\n    </PageContainer>\r\n  );\r\n};\r\n\r\nexport default OMTasksPage;\r\n\r\n"],"names":["AttachFileIcon","createSvgIcon","_jsx","EmailIcon","FileIcon","LinkIcon","ViewIcon","TaskIcon","omaiAPI","email","limit","__async","response","error","filters","params","options","errorData","token","tasks","linkId","submissionId","submissionIds","taskData","errorMessage","errorDetails","e","taskId","updates","EmailSettingsForm","hasRole","isSuperAdmin","useAuth","config","setConfig","useState","loading","setLoading","saving","setSaving","testing","setTesting","setError","success","setSuccess","testDialogOpen","setTestDialogOpen","testEmail","setTestEmail","canManage","providerPresets","useEffect","fetchEmailConfig","data","__spreadValues","prev","err","handleProviderChange","provider","preset","__spreadProps","handleSave","requestBody","handleTestEmail","jsxs","Box","jsx","CircularProgress","Typography","Fragment","Card","CardContent","Alert","Grid","FormControl","InputLabel","Select","MenuItem","TextField","FormControlLabel","Switch","Divider","Paper","Button","SaveIcon","TestIcon","Dialog","DialogTitle","DialogContent","DialogActions","TASK_CATEGORIES","IMPORTANCE_LEVELS","TASK_STATUSES","VISIBILITY_OPTIONS","TASK_TYPES","TAG_GROUPS","ALL_PREDEFINED_TAGS","group","normalizeTag","tag","DRAFT_STORAGE_KEY","MAX_FILE_SIZE","DEBOUNCE_DELAY","CreateTaskDialog","open","onClose","onSave","loadDraft","saved","parsed","formData","setFormData","tagInput","setTagInput","attachmentInput","setAttachmentInput","errors","setErrors","discardConfirmOpen","setDiscardConfirmOpen","hasUnsavedChanges","setHasUnsavedChanges","isDragging","setIsDragging","dropDialogOpen","setDropDialogOpen","droppedFile","setDroppedFile","parsedRevisions","setParsedRevisions","parseError","setParseError","saveTimeoutRef","useRef","detailsRef","now","dateCreated","dateCreatedDisplay","saveDraft","useCallback","clearDraft","draft","v","handleChange","field","value","updated","defaultTag","newErrors","handleAddTag","tagValue","tagToAdd","handleTagSelect","selectedTags","normalizedTags","index","self","handleRemoveTag","tagToRemove","handleAddAttachment","handleRemoveAttachment","attachmentToRemove","att","validateForm","resetForm","result","handleClose","handleDiscardConfirm","handleDiscardCancel","dragCounterRef","handleDragEnter","handleDragLeave","handleDragOver","handleDrop","mdFile","f","content","readFileAsText","allLines","parseMetadataLine","line","prefix","trimmed","metadata","title","category","importance","details","i","type","normalizedType","tagsStr","tags","t","attachment","statusStr","statusMap","normalizedStatus","visibility","normalized","assignedTo","assignedBy","notes","key","currentValue","revisions","parseRevisions","file","resolve","reject","reader","_a","lines","currentSection","rev_index","foundFirstTitle","titleMatch","titleText","revMatch","rev_number","getRevisionLabel","revision","handleDropAction","action","separator","attachmentUrl","handleDropDialogCancel","isCompleted","Chip","Stack","FormHelperText","level","CloudUploadIcon","Autocomplete","_","newValue","newInputValue","reason","option","g","props","createElement","filtered","status","CancelIcon","Accordion","AccordionSummary","ExpandMoreIcon","AccordionDetails","OMAITaskAssignmentWidget","setData","tabValue","setTabValue","generateDialogOpen","setGenerateDialogOpen","createTaskDialogOpen","setCreateTaskDialogOpen","deleteConfirmOpen","setDeleteConfirmOpen","viewSubmissionOpen","setViewSubmissionOpen","historyDialogOpen","setHistoryDialogOpen","settingsDialogOpen","setSettingsDialogOpen","newLinkEmail","setNewLinkEmail","newLinkNotes","setNewLinkNotes","newLinkExpiry","setNewLinkExpiry","generating","setGenerating","deleting","setDeleting","deletingType","setDeletingType","deletingId","setDeletingId","historyData","setHistoryData","historyLoading","setHistoryLoading","historyPage","setHistoryPage","historyRowsPerPage","setHistoryRowsPerPage","historyFilters","setHistoryFilters","selectedSubmission","setSelectedSubmission","selectedItems","setSelectedItems","canView","fetchData","_b","fetchHistory","_0","page","handleGenerateLink","showToast","handleRegenerateLink","handleDeleteItem","id","confirmDelete","handleCopyLink","taskURL","textArea","message","severity","handleViewSubmission","submission","handleDownloadSubmission","filename","generateSubmissionReport","blob","url","link","date","report","task","formatDate","dateString","getStatusColor","getStatusIcon","CheckCircleIcon","ScheduleIcon","DeleteIcon","InfoIcon","WarningIcon","getActionIcon","VisibilityIcon","AssignmentIcon","HistoryIcon","getActionLabel","parseTasksJson","tasksJson","handleHistoryPageChange","event","newPage","handleHistoryRowsPerPageChange","handleHistoryFilterChange","filter","newFilters","AddIcon","SettingsIcon","Tooltip","IconButton","RefreshIcon","Tabs","Tab","Badge","_c","_d","TableContainer","Table","TableHead","TableRow","TableCell","TableBody","_e","Avatar","ComputerIcon","CopyIcon","_f","_g","_h","s","_i","newSelected","DownloadIcon","_j","List","_k","log","TablePagination","OMTasksPage","BCrumb","PageContainer","Breadcrumb"],"mappings":"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","x_google_ignoreList":[0,1,2,3,4,5]}