# Enhanced OCR Uploader - Complete Documentation
**Date:** December 22, 2025  
**Version:** 1.0  
**Author:** Orthodox Metrics Development Team

---

## Table of Contents

1. [Overview](#overview)
2. [Architecture](#architecture)
3. [Workflow](#workflow)
4. [Components](#components)
5. [Configuration](#configuration)
6. [Pre-Processing Script Hook](#pre-processing-script-hook)
7. [API Endpoints](#api-endpoints)
8. [Database Schema](#database-schema)
9. [Customization](#customization)
10. [Troubleshooting](#troubleshooting)
11. [Advanced Features](#advanced-features)

---

## Overview

The Enhanced OCR Uploader is a production-ready system for digitizing Orthodox Church sacramental records (baptism, marriage, funeral) using Google Cloud Vision API. It provides a complete workflow from image upload to database commit, with intelligent field mapping and validation.

### Key Features

- **Batch Image Upload**: Upload multiple images simultaneously with progress tracking
- **Google Vision OCR**: High-accuracy text extraction with bounding box coordinates
- **Fusion Workflow**: 4-step intelligent entry detection and field mapping
- **Multi-Church Support**: Church-specific database isolation
- **Auto-Mapping**: Intelligent field mapping based on label detection
- **Manual Override**: Full manual editing capabilities
- **Review & Finalize**: Validation and commit workflow
- **Pre-Processing Hooks**: Custom script execution before processing completes

### Access

- **Route**: `/devel/enhanced-ocr-uploader`
- **Required Roles**: `admin`, `super_admin`, `church_admin`, `priest`, `deacon`, `editor`

---

## Architecture

### System Components

```
┌─────────────────────────────────────────────────────────────┐
│                    Enhanced OCR Uploader                     │
│                    (React Frontend)                         │
├─────────────────────────────────────────────────────────────┤
│                                                               │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐      │
│  │   Upload     │  │  Inspection  │  │   Fusion     │      │
│  │   Manager    │→ │    Panel     │→ │  Workflow    │      │
│  └──────────────┘  └──────────────┘  └──────────────┘      │
│         │                 │                  │              │
│         └─────────────────┴──────────────────┘             │
│                            │                                 │
│                            ↓                                 │
│  ┌──────────────────────────────────────────────┐          │
│  │         Backend API (Express/Node.js)         │          │
│  │  - /api/ocr/jobs/upload                      │          │
│  │  - /api/church/:id/ocr/jobs/:jobId/...       │          │
│  └──────────────────────────────────────────────┘          │
│                            │                                 │
│                            ↓                                 │
│  ┌──────────────────────────────────────────────┐          │
│  │      Google Cloud Vision API                  │          │
│  │  - TEXT_DETECTION                            │          │
│  │  - DOCUMENT_TEXT_DETECTION                   │          │
│  └──────────────────────────────────────────────┘          │
│                            │                                 │
│                            ↓                                 │
│  ┌──────────────────────────────────────────────┐          │
│  │   Church-Specific Database                    │          │
│  │  - ocr_jobs table                            │          │
│  │  - ocr_fused_drafts table                    │          │
│  │  - baptism_records, marriage_records, etc.   │          │
│  └──────────────────────────────────────────────┘          │
└─────────────────────────────────────────────────────────────┘
```

### File Structure

```
front-end/src/features/devel-tools/om-ocr/
├── EnhancedOCRUploader.tsx      # Main component
├── components/
│   ├── InspectionPanel.tsx      # Image viewer with tabs
│   ├── FusionTab.tsx            # 4-step fusion workflow
│   ├── MappingTab.tsx           # Field mapping interface
│   ├── ReviewFinalizeTab.tsx    # Review & commit workflow
│   ├── ProcessedImagesTable.tsx # Job list table
│   ├── FusionOverlay.tsx       # Bounding box overlay
│   └── EntryEditorDialog.tsx   # Entry editor
├── config/
│   ├── recordFields.ts          # Field definitions
│   └── defaultRecordColumns.ts  # Default column configs
├── hooks/
│   └── useOcrJobs.ts            # OCR jobs data hook
├── types/
│   ├── fusion.ts                # Fusion workflow types
│   ├── ocrJob.ts                # OCR job types
│   └── inspection.ts           # Inspection types
└── utils/
    ├── visionParser.ts          # Vision API parser
    └── imageViewportMetrics.ts  # Coordinate conversion

server/routes/
└── ocr.js                       # OCR API routes
```

---

## Workflow

### 1. Upload Phase

**Location**: `EnhancedOCRUploader.tsx`

1. User selects church (if SuperAdmin)
2. User uploads one or more images
3. Images are queued for processing
4. Each image creates an OCR job in the database
5. Background processing begins automatically

**API Endpoint**: `POST /api/ocr/jobs/upload`

**Request Body**:
```json
{
  "churchId": 46,
  "files": [File, File, ...],
  "recordType": "baptism",
  "settings": {
    "engine": "Google Vision",
    "language": "en",
    "dpi": 300,
    "confidenceThreshold": 85
  }
}
```

### 2. OCR Processing Phase

**Location**: `server/routes/ocr.js` → `processOcrJobAsync()`

1. Image is read from upload directory
2. Google Vision API is called with image
3. OCR results are extracted (text + bounding boxes)
4. Results are written to files:
   - `{filename}_ocr.txt` - Plain text
   - `{filename}_ocr.json` - Full Vision JSON with bboxes
5. **Pre-processing script runs** (if configured)
6. Image is moved to processed directory
7. Database is updated with results
8. Job status set to "completed"

**Processing Flow**:
```
Upload → Vision API → Extract Text → Write Files → 
Pre-Processing Script → Move Image → Update DB → Complete
```

### 3. Inspection Phase

**Location**: `InspectionPanel.tsx`

User can view:
- **Text Tab**: Raw OCR text
- **Structured Tab**: Parsed structure
- **Mapping Tab**: Field mapping interface
- **Fusion Tab**: 4-step fusion workflow
- **Review & Finalize Tab**: Draft review and commit

### 4. Fusion Workflow Phase

**Location**: `FusionTab.tsx`

**Step 1: Detect Entries**
- Auto-detects individual record entries from image
- Uses multiple strategies:
  - Quadrant detection (4-card layouts)
  - Gap-based detection (vertical spacing)
  - Text-based fallback (blank lines, name patterns)
- Creates entry bounding boxes

**Step 2: Anchor Labels**
- Detects form labels (e.g., "NAME OF CHILD", "DATE OF BIRTH")
- Uses fuzzy matching against label dictionary
- Maps labels to database fields

**Step 3: Map Fields**
- Auto-maps detected labels to field values
- Extracts values from text (right of label, below label)
- Supports manual editing
- Handles name splitting (first/last name)

**Step 4: Save & Commit**
- Saves drafts to database
- Option to send to Review & Finalize
- Creates fusion drafts for review

### 5. Review & Finalize Phase

**Location**: `ReviewFinalizeTab.tsx`

1. **Validate**: Check for missing required fields
2. **Finalize**: Create history snapshot
3. **Commit**: Insert into record tables (baptism_records, etc.)

---

## Components

### EnhancedOCRUploader

**File**: `front-end/src/features/devel-tools/om-ocr/EnhancedOCRUploader.tsx`

**Props**: None (uses context/hooks)

**State Management**:
- `files`: Upload queue
- `selectedChurchId`: Active church
- `settings`: OCR settings (engine, language, etc.)
- `stickyDefaults`: Per-record-type default column settings

**Key Features**:
- Drag & drop file upload
- Batch processing with pause/resume
- Progress tracking per file
- Error handling with retry
- Church selector (SuperAdmin only)

### InspectionPanel

**File**: `front-end/src/features/devel-tools/om-ocr/components/InspectionPanel.tsx`

**Props**:
```typescript
{
  job: JobDetail;
  imageUrl: string;
  churchId: number;
  activeTab?: number; // 0=Text, 1=Structured, 2=Mapping, 3=Fusion, 4=Review
  onMappingTabClick?: () => void;
  onTokenClick?: (tokenId, bbox, text) => void;
  onTokenDoubleClick?: (tokenId, bbox, text) => void;
}
```

**Features**:
- Image viewer with zoom/pan
- OCR token overlay (clickable text boxes)
- Tab navigation between workflows
- Fusion overlay integration

### FusionTab

**File**: `front-end/src/features/devel-tools/om-ocr/components/FusionTab.tsx`

**Props**:
```typescript
{
  jobId: number;
  churchId: number;
  ocrText: string | null;
  ocrResult: VisionResponse | null;
  recordType: 'baptism' | 'marriage' | 'funeral';
  imageUrl: string | null;
  onHighlightBbox?: (bbox, color) => void;
  onHighlightMultiple?: (bboxes[]) => void;
  onSendToReview?: () => void;
  stickyDefaults?: Record<'baptism' | 'marriage' | 'funeral', boolean>;
}
```

**4-Step Workflow**:
1. **Detect Entries**: Auto-detect or manual entry count
2. **Anchor Labels**: Detect form labels
3. **Map Fields**: Auto-map or manual field mapping
4. **Save & Commit**: Save drafts, send to review

**Entry Detection Strategies**:
- **Quadrant**: Divides page into 4 quadrants (TL, TR, BL, BR)
- **Gap-Based**: Groups lines by vertical gaps (>30px)
- **Text-Based**: Splits by blank lines or name patterns

### MappingTab

**File**: `front-end/src/features/devel-tools/om-ocr/components/MappingTab.tsx`

**Props**:
```typescript
{
  jobId: string;
  churchId: number;
  recordType: 'baptism' | 'marriage' | 'funeral';
  ocrText: string | null;
  existingMapping?: any;
  onSaveSuccess?: () => void;
  onSendToReview?: () => void;
}
```

**Features**:
- Click-to-insert detected text
- Auto-map using heuristics
- Field validation
- Name splitting (first/last name)
- Save mapping to database
- Create draft records

### ReviewFinalizeTab

**File**: `front-end/src/features/devel-tools/om-ocr/components/ReviewFinalizeTab.tsx`

**Features**:
- Draft list with status indicators
- Validation (check required fields)
- Finalization (create history)
- Commit to database
- History tracking

---

## Configuration

### Environment Variables

**Backend** (`server/routes/ocr.js`):

```bash
# Google Cloud Vision
GOOGLE_CLOUD_PROJECT_ID=your-project-id
GOOGLE_VISION_KEY_PATH=/path/to/service-account.json
# OR
GOOGLE_APPLICATION_CREDENTIALS=/path/to/service-account.json

# Upload Paths
UPLOAD_BASE_PATH=/var/www/orthodoxmetrics/prod/server/uploads

# Pre-Processing Script (optional)
OCR_PRE_PROCESSING_SCRIPT=/path/to/your/script.sh
```

### OCR Settings

**Default Settings** (`EnhancedOCRUploader.tsx`):
```typescript
{
  engine: 'Google Vision',
  dpi: 300,
  confidenceThreshold: 85,
  autoDetectLanguage: true,
  forceGrayscale: false,
  deskewImages: true,
  language: 'en'
}
```

### Sticky Defaults

Controls which database columns are shown in mapping interfaces. Stored per record type in localStorage.

**Location**: `EnhancedOCRUploader.tsx` → `stickyDefaults` state

**Usage**: When enabled, only default columns are shown in field mapping, reducing clutter.

---

## Pre-Processing Script Hook

### Overview

A custom script can be executed **after OCR completes but before database update**. This allows you to:
- Post-process OCR text
- Modify extracted data
- Run custom validations
- Integrate with external systems
- Transform data formats

### Configuration

**Option 1: Environment Variable**
```bash
export OCR_PRE_PROCESSING_SCRIPT=/path/to/your/script.sh
```

**Option 2: Per-Job (Future Enhancement)**
Pass in `options.preProcessingScript` when calling `processOcrJobAsync()`.

### Script Execution

**When**: After OCR text and JSON files are written, but before database update.

**Environment Variables Available**:
```bash
OCR_JOB_ID=1097                    # Current job ID
OCR_CHURCH_ID=46                   # Church ID
OCR_IMAGE_PATH=/path/to/image.jpg  # Processed image path
OCR_TEXT_FILE=/path/to/ocr.txt     # OCR text file path
OCR_JSON_FILE=/path/to/ocr.json    # OCR JSON file path
OCR_EXTRACTED_TEXT="..."           # Extracted text content
OCR_CONFIDENCE=0.85                # Confidence score (0-1)
OCR_RECORD_TYPE=baptism            # Record type
OCR_LANGUAGE=en                    # Language code
OCR_PROCESSING_TIME=1234           # Processing time in ms
```

### Example Script

```bash
#!/bin/bash
# /path/to/custom-ocr-processor.sh

echo "Processing OCR job $OCR_JOB_ID for church $OCR_CHURCH_ID"

# Read OCR text
OCR_TEXT=$(cat "$OCR_TEXT_FILE")

# Post-process the text (example: normalize dates)
NORMALIZED_TEXT=$(echo "$OCR_TEXT" | sed 's/Jan\./January/g')

# Write back to file (optional)
echo "$NORMALIZED_TEXT" > "$OCR_TEXT_FILE"

# Or process JSON file
python3 /path/to/process-ocr-json.py "$OCR_JSON_FILE"

echo "Pre-processing complete"
```

### Error Handling

- Script errors are **non-blocking** (OCR job continues)
- Errors are logged to console
- Script timeout: 5 minutes
- Exit code is logged but doesn't affect OCR success

### Best Practices

1. **Make script executable**: `chmod +x /path/to/script.sh`
2. **Use absolute paths**: Don't rely on PATH
3. **Handle errors gracefully**: Use `set -e` carefully
4. **Log output**: Use stdout/stderr for debugging
5. **Keep it fast**: Long scripts delay job completion

---

## API Endpoints

### Upload

**POST** `/api/ocr/jobs/upload`

**Request**:
- `Content-Type: multipart/form-data`
- `churchId`: number (query param)
- `files`: File[] (form data)
- `recordType`: 'baptism' | 'marriage' | 'funeral' (form data)
- `settings`: JSON string (form data)

**Response**:
```json
{
  "success": true,
  "jobs": [
    {
      "id": 1097,
      "filename": "4.jpg",
      "status": "pending"
    }
  ]
}
```

### Get Jobs

**GET** `/api/ocr/jobs?churchId=46`

**Response**:
```json
{
  "jobs": [
    {
      "id": 1097,
      "filename": "4.jpg",
      "status": "completed",
      "confidenceScore": 0.85,
      "recordType": "baptism"
    }
  ]
}
```

### Get Job Detail

**GET** `/api/church/:churchId/ocr/jobs/:jobId`

**Response**:
```json
{
  "id": 1097,
  "filename": "4.jpg",
  "ocrText": "...",
  "ocrResult": { ... },
  "status": "completed",
  "confidenceScore": 0.85
}
```

### Save Mapping

**POST** `/api/church/:churchId/ocr/jobs/:jobId/mapping`

**Request**:
```json
{
  "record_type": "baptism",
  "mapping_json": {
    "first_name": { "value": "Olga", "confidence": 0.8 },
    "last_name": { "value": "Маковецкая", "confidence": 0.8 }
  }
}
```

### Create Draft

**POST** `/api/church/:churchId/ocr/jobs/:jobId/draft-record`

**Request**:
```json
{
  "record_type": "baptism",
  "payload_json": {
    "first_name": "Olga",
    "last_name": "Маковецкая",
    "birth_date": "1931-05-10"
  }
}
```

### Fusion Workflow

**GET** `/api/church/:churchId/ocr/jobs/:jobId/fusion/drafts`

**POST** `/api/church/:churchId/ocr/jobs/:jobId/fusion/ready-for-review`

**POST** `/api/church/:churchId/ocr/jobs/:jobId/review/finalize`

**POST** `/api/church/:churchId/ocr/jobs/:jobId/review/commit`

---

## Database Schema

### ocr_jobs Table

**Location**: Church-specific database

**Columns**:
```sql
id INT PRIMARY KEY AUTO_INCREMENT
church_id INT NOT NULL
filename VARCHAR(255)
original_filename VARCHAR(255)
file_path VARCHAR(500)
status ENUM('pending', 'processing', 'completed', 'failed')
record_type ENUM('baptism', 'marriage', 'funeral', 'custom')
language CHAR(2)
confidence_score DECIMAL(5,2)
ocr_text LONGTEXT
ocr_result_json JSON
error TEXT
file_size BIGINT
mime_type VARCHAR(100)
pages INT
created_at TIMESTAMP
updated_at TIMESTAMP
```

### ocr_fused_drafts Table

**Location**: Church-specific database

**Columns**:
```sql
id INT PRIMARY KEY AUTO_INCREMENT
ocr_job_id INT NOT NULL
entry_index INT NOT NULL
record_type ENUM('baptism', 'marriage', 'funeral')
record_number VARCHAR(50)
payload_json JSON
bbox_json JSON
status ENUM('draft', 'in_review', 'finalized', 'committed')
workflow_status ENUM('draft', 'in_review', 'finalized', 'committed')
church_id INT
created_by VARCHAR(255)
last_saved_at TIMESTAMP
finalized_at TIMESTAMP
finalized_by VARCHAR(255)
committed_record_id INT
created_at TIMESTAMP
updated_at TIMESTAMP
```

### Record Tables

**baptism_records**, **marriage_records**, **funeral_records**

Final records are committed to these tables after review and finalization.

---

## Customization

### Label Dictionaries

**File**: `front-end/src/features/devel-tools/om-ocr/types/fusion.ts`

**Location**: `LABEL_DICTIONARIES` constant

**Add New Labels**:
```typescript
baptism: {
  'YOUR LABEL TEXT': 'database_field_name',
  'CHILD NAME': 'first_name',
  // ... existing mappings
}
```

### Auto-Map Logic

**File**: `front-end/src/features/devel-tools/om-ocr/utils/visionParser.ts`

**Function**: `autoMapFields()`

**Customize**:
- Field name mapping (internal → DB columns)
- Value processing (dates, names, etc.)
- Name splitting logic
- Confidence scoring

**Example Customization**:
```typescript
// In autoMapFields() function
if (recordType === 'baptism') {
  const fieldNameMapping = {
    'child_name': 'first_name',
    'date_of_birth': 'birth_date',
    // ... your mappings
  };
  
  // Custom processing
  if (dbFieldName === 'first_name') {
    // Split full names
    const nameParts = value.trim().split(/\s+/);
    if (nameParts.length > 1) {
      processedValue = nameParts[0];
      result['last_name'] = {
        value: nameParts.slice(1).join(' '),
        confidence: confidence * 0.9,
      };
    }
  }
}
```

### Entry Detection

**File**: `front-end/src/features/devel-tools/om-ocr/utils/visionParser.ts`

**Functions**:
- `detectEntries()`: Main detection function
- `detectEntriesGap()`: Gap-based detection
- `detectEntriesQuadrant()`: Quadrant-based detection
- `detectEntriesFromText()`: Text-based fallback

**Tune Parameters**:
- Gap threshold: `yGapThreshold` (default: 30px)
- Single record dominance: Coverage threshold (default: 60%)
- Minimum area: `minAreaThreshold` (default: 5% of page)

### Field Definitions

**File**: `front-end/src/features/devel-tools/om-ocr/config/recordFields.ts`

**Add/Modify Fields**:
```typescript
baptism: [
  {
    key: 'first_name',
    label: 'First Name',
    type: 'text',
    required: true,
    // ... other properties
  }
]
```

---

## Troubleshooting

### Entry Detection Issues

**Problem**: Only 1 entry detected when there should be 10.

**Solutions**:
1. **Check gap threshold**: Reduce `yGapThreshold` in `detectEntriesGap()`
2. **Disable single record dominance**: Increase coverage threshold in `checkSingleRecordDominance()`
3. **Use manual count**: Set entry count manually in Fusion workflow
4. **Check image quality**: Ensure image is clear and properly oriented

**Debug**:
- Enable debug logging: `localStorage.setItem('om.ocr.debug', 'true')`
- Check console for detection logs
- Verify Vision JSON has proper bounding boxes

### OCR Tokens Not Displaying

**Problem**: OCR text boxes not visible on image overlay.

**Solutions**:
1. **Check overlay toggle**: Ensure "Overlay" is enabled in InspectionPanel
2. **Verify Vision JSON**: Check that `ocrResult` contains `textAnnotations`
3. **Check coordinate conversion**: Verify `visionWidth` and `visionHeight` are correct
4. **Browser console**: Check for JavaScript errors

### Pre-Processing Script Not Running

**Problem**: Custom script not executing.

**Solutions**:
1. **Check environment variable**: `echo $OCR_PRE_PROCESSING_SCRIPT`
2. **Verify script path**: Use absolute path
3. **Check permissions**: `chmod +x /path/to/script.sh`
4. **Check logs**: Look for script execution logs in console
5. **Test manually**: Run script with environment variables set

### Name Splitting Not Working

**Problem**: Full names not splitting into first/last.

**Solutions**:
1. **Check field selection**: Ensure "First Name" field is selected when clicking
2. **Verify record type**: Name splitting only works for `baptism` records
3. **Check token format**: Ensure token contains space-separated name parts
4. **Manual override**: Use manual edit mode if auto-split fails

### Database Update Errors

**Problem**: "Unknown column" errors in logs.

**Solutions**:
1. **Check schema**: Verify table has expected columns
2. **Dynamic columns**: Code now checks columns before updating
3. **Fallback logic**: System falls back to minimal update if full update fails
4. **Migration**: Run database migrations if needed

---

## Advanced Features

### Auto-Save

**Location**: `FusionTab.tsx`

Drafts are automatically saved when:
- Fields are mapped
- Entry is completed
- User navigates between entries

**Configuration**: Controlled by `autoSaveEnabled` state.

### Entry Editor

**Location**: `EntryEditorDialog.tsx`

Allows manual editing of:
- Entry bounding box
- Entry display name
- Record number
- Entry lines/tokens

**Access**: Double-click entry in Fusion workflow.

### Field Extraction

**Location**: `FusionTab.tsx` → Field extraction logic

Extracts field values by:
1. Finding label bounding box
2. Looking for text to the right (same Y-band)
3. Falling back to text below (within 50px)
4. Merging tokens into value

### Confidence Scoring

Confidence is calculated from:
- Vision API confidence scores
- Label detection similarity
- Field extraction quality

**Usage**: Displayed as percentage chips in UI.

### Sticky Defaults

**Purpose**: Limit visible fields to default columns only.

**Storage**: localStorage key `om.ocr.stickyDefaults`

**Format**:
```json
{
  "baptism": true,
  "marriage": false,
  "funeral": true
}
```

---

## Best Practices

### Image Preparation

1. **Resolution**: Minimum 300 DPI
2. **Format**: JPG or PNG
3. **Orientation**: Ensure images are properly rotated
4. **Clarity**: High contrast, clear text
5. **Size**: Reasonable file size (< 10MB recommended)

### Workflow

1. **Upload**: Upload all images first
2. **Wait**: Let OCR processing complete
3. **Review**: Check OCR text quality
4. **Fusion**: Use Fusion workflow for multi-entry documents
5. **Mapping**: Use Mapping tab for single-entry documents
6. **Validate**: Always validate before committing
7. **Commit**: Commit in batches for efficiency

### Performance

1. **Batch Size**: Upload 5-10 images at a time
2. **Processing**: Let background processing complete
3. **Browser**: Use modern browser (Chrome, Firefox, Edge)
4. **Network**: Ensure stable connection for large files

---

## Future Enhancements

### Planned Features

1. **Multi-Language Support**: Enhanced language detection
2. **Template Matching**: Pre-defined form templates
3. **Machine Learning**: Improved entry detection
4. **Batch Operations**: Bulk edit/delete/commit
5. **Export**: Export drafts to CSV/Excel
6. **Integration**: API for external systems

### Known Limitations

1. **Entry Detection**: May struggle with irregular layouts
2. **Handwriting**: Best results with printed text
3. **Complex Forms**: Multi-column forms may need manual adjustment
4. **Language**: Primarily optimized for English/Cyrillic

---

## Support & Resources

### Code Locations

- **Frontend**: `front-end/src/features/devel-tools/om-ocr/`
- **Backend**: `server/routes/ocr.js`
- **Types**: `front-end/src/features/devel-tools/om-ocr/types/`
- **Utils**: `front-end/src/features/devel-tools/om-ocr/utils/`

### Related Documentation

- `front-end/docs/ingestion-digitization/documentation/enhanced-ocr-uploader.md`
- `front-end/docs/ingestion-digitization/documentation/ocr-enhanced-uploader-workflow.md`

### Debugging

**Enable Debug Mode**:
```javascript
localStorage.setItem('om.ocr.debug', 'true');
localStorage.setItem('om.ocr.debugMetrics', 'true');
```

**Console Logs**:
- All components log with `[ComponentName]` prefix
- Check browser console for detailed logs
- Server logs include `[OCR Processing]` prefix

---

## Changelog

### December 22, 2025

- Added pre-processing script hook
- Improved entry detection (gap threshold, single record dominance)
- Enhanced text-based entry detection (blank lines, name patterns)
- Fixed name splitting for baptism records
- Improved error handling for missing database columns
- Added comprehensive documentation

---

**End of Documentation**

