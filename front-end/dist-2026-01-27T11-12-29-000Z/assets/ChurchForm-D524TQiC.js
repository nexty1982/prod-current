var te=Object.defineProperty,se=Object.defineProperties;var ne=Object.getOwnPropertyDescriptors;var K=Object.getOwnPropertySymbols;var ie=Object.prototype.hasOwnProperty,le=Object.prototype.propertyIsEnumerable;var Y=(s,o,c)=>o in s?te(s,o,{enumerable:!0,configurable:!0,writable:!0,value:c}):s[o]=c,J=(s,o)=>{for(var c in o||(o={}))ie.call(o,c)&&Y(s,c,o[c]);if(K)for(var c of K(o))le.call(o,c)&&Y(s,c,o[c]);return s},Q=(s,o)=>se(s,ne(o));var I=(s,o,c)=>new Promise((S,f)=>{var v=m=>{try{_(c.next(m))}catch(j){f(j)}},A=m=>{try{_(c.throw(m))}catch(j){f(j)}},_=m=>m.done?S(m.value):Promise.resolve(m.value).then(v,A);_((c=c.apply(s,o)).next())});import{aK as oe,l as ce,k as de,j as e,$ as E,S as y,C as M,d as x,B as ue,G as b,Q as D,O as C,y as he,F as U,r as R,a0 as P,a1 as N,a2 as q,f as d,e as T,b8 as me,b9 as pe}from"./index-CHjTtHW2.js";import{r as i}from"./vendor-DgfDxsY7.js";import{u as ge,c as fe,a as _e,b as p}from"./index.esm-B49NPeaF.js";import{P as X}from"./PageContainer-DmS_qDLp.js";import{B as xe}from"./Breadcrumb-DTsvC1YP.js";import{B as F}from"./BlankCard-CTflXlGL.js";import{a as W}from"./admin.api-BRdbrdSp.js";import{l as g}from"./logger-Du9b5RCj.js";import{I as be}from"./IconBuilding-BBmPLSaL.js";import{I as je}from"./IconMail-mhh1urmd.js";import{I as Ce}from"./IconMapPin-5VnBGz_P.js";import{I as ve}from"./IconDatabase-DXxjTReF.js";import{C as ye}from"./CardHeader-DyWZbi8Y.js";import"./isSymbol-D488ncVs.js";import"./Helmet-DNWYwtrp.js";import"./index-BvdvJza9.js";import"./Breadcrumbs-Cb-T7Rgi.js";import"./Link-CQ4x0WOQ.js";import"./api.config-C9UNSeTF.js";const Z=fe({name:p().required("Church name is required").min(2,"Name must be at least 2 characters"),email:p().email("Invalid email format").required("Email is required"),city:p(),state_province:p(),postal_code:p(),country:p(),preferred_language:p().required("Language preference is required"),timezone:p().required("Timezone is required"),currency:p(),tax_id:p(),church_id:_e().positive("Church ID must be a positive number").integer("Church ID must be an integer").nullable()}),pa=()=>{const{id:s}=oe(),o=ce(),{user:c,hasRole:S}=de(),[f,v]=i.useState(!1),[A,_]=i.useState(null),[m,j]=i.useState(null),[Se,ee]=i.useState([]),[we,V]=i.useState(!1),[Ie,Ee]=i.useState({}),[Te,Ae]=i.useState({users:!1,advanced:!1,database:!1}),[Be,ke]=i.useState([]),[Me,De]=i.useState({}),[B,ae]=i.useState(""),[L,$]=i.useState(!1),[z,k]=i.useState(null),[Ue,Re]=i.useState(null),[Fe,Le]=i.useState([]),[ze,Pe]=i.useState(!1),[Ne,qe]=i.useState(!1),[We,Ve]=i.useState(!1),[$e,Oe]=i.useState({open:!1,user:null,action:""}),[Ge,He]=i.useState({open:!1,user:null}),n=!!s;i.useEffect(()=>{I(void 0,null,function*(){if(!n)try{V(!0);const l=yield fetch("/api/admin/churches?preferred_language=en",{credentials:"include"});if(!l.ok)throw new Error("Failed to fetch template churches");const u=yield l.json();ee(u.churches||[])}catch(l){console.error("Error fetching template churches:",l)}finally{V(!1)}})},[n]);const r=ge({initialValues:{name:"",email:"",phone:"",address:"",city:"",state_province:"",postal_code:"",country:"",preferred_language:"en",timezone:"UTC",currency:"USD",tax_id:"",website:"",description_multilang:"",settings:"",is_active:!0,database_name:"",has_baptism_records:!0,has_marriage_records:!0,has_funeral_records:!0,setup_complete:!1,template_church_id:null,default_landing_page:"church_records",church_id:null},validationSchema:Z,onSubmit:t=>I(void 0,null,function*(){console.log("Submitting form with values:",t);try{v(!0),_(null),j(null),g.info("Church Management",`Church form submission started: ${n?"update":"create"}`,{churchName:t.name,churchEmail:t.email,isEdit:n,churchId:s,userAction:n?"church_update_submit":"church_create_submit"});const l=Q(J({},t),{preferred_language:t.preferred_language,description_multilang:t.description_multilang,settings:t.settings,database_name:t.database_name,has_baptism_records:t.has_baptism_records,has_marriage_records:t.has_marriage_records,has_funeral_records:t.has_funeral_records,setup_complete:t.setup_complete,template_church_id:t.template_church_id,church_id:t.church_id});n&&s?(yield W.churches.update(parseInt(s),l),j("Church updated successfully!"),g.info("Church Management","Church updated successfully",{churchId:s,churchName:r.values.name,userAction:"church_update"})):(yield W.churches.create(l),j("Church created successfully!"),g.info("Church Management","Church created successfully",{churchName:r.values.name,userAction:"church_create"})),g.info("Church Management","Redirecting to church list after successful operation",{operation:n?"update":"create",churchName:t.name,userAction:"church_form_redirect"}),setTimeout(()=>{o("/apps/church-management")},2e3)}catch(l){const u=l instanceof Error?l.message:"An error occurred";_(u),g.error("Church Management",`Church ${n?"update":"creation"} failed`,{error:u,churchName:r.values.name,churchEmail:r.values.email,isEdit:n,churchId:s,userAction:n?"church_update":"church_create",formValues:r.values})}finally{v(!1)}}),validateOnBlur:!0,validateOnChange:!0,validate:t=>{const l={},u=Z.validateSync(t,{abortEarly:!1});return u&&u.inner&&u.inner.length>0&&(u.inner.forEach(w=>{l[w.path]=w.message}),console.log("Formik validation errors:",l)),l}}),re=()=>I(void 0,null,function*(){if(!(!B||!s))try{$(!0),k(null);const t=yield fetch(`/api/admin/churches/${s}/update-database`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({template:B})}),l=yield t.json();t.ok?k({success:!0,message:l.message||"Database updated successfully!"}):k({success:!1,message:l.error||"Failed to update database"})}catch(t){k({success:!1,message:"Error updating database: "+(t instanceof Error?t.message:"Unknown error")})}finally{$(!1)}});return i.useEffect(()=>{n&&s?I(void 0,null,function*(){var l,u,w,O,G;try{v(!0),g.info("Church Management","Loading church data for editing",{churchId:s,userAction:"church_load_for_edit_start"});const a=yield W.churches.getById(parseInt(s));if(!a)throw new Error("Church data not found or invalid response from server");console.log("ðŸ“‹ Loaded church data for editing:",a);const h={name:(a==null?void 0:a.name)||"",email:(a==null?void 0:a.email)||"",phone:(a==null?void 0:a.phone)||"",address:(a==null?void 0:a.address)||"",city:(a==null?void 0:a.city)||"",state_province:(a==null?void 0:a.state_province)||"",postal_code:(a==null?void 0:a.postal_code)||"",country:(a==null?void 0:a.country)||"",preferred_language:(a==null?void 0:a.preferred_language)||"en",timezone:(a==null?void 0:a.timezone)||"UTC",currency:(a==null?void 0:a.currency)||"USD",tax_id:(a==null?void 0:a.tax_id)||"",website:(a==null?void 0:a.website)||"",description_multilang:(a==null?void 0:a.description_multilang)||"",settings:(a==null?void 0:a.settings)||"",is_active:(l=a==null?void 0:a.is_active)!=null?l:!0,database_name:(a==null?void 0:a.database_name)||"",has_baptism_records:(u=a==null?void 0:a.has_baptism_records)!=null?u:!0,has_marriage_records:(w=a==null?void 0:a.has_marriage_records)!=null?w:!0,has_funeral_records:(O=a==null?void 0:a.has_funeral_records)!=null?O:!0,setup_complete:(G=a==null?void 0:a.setup_complete)!=null?G:!1,template_church_id:(a==null?void 0:a.template_church_id)||null,default_landing_page:(a==null?void 0:a.default_landing_page)||"church_records",church_id:(a==null?void 0:a.id)||(a==null?void 0:a.church_id)||null};!h.name&&(a!=null&&a.church_name)&&(h.name=a.church_name),console.log("ðŸ“ Setting form values:",h),r.setValues(h),Object.keys(h).forEach(H=>{r.setFieldValue(H,h[H])}),console.log("âœ… Form values set, current formik values:",r.values),g.info("Church Management","Church data loaded successfully for editing",{churchId:s,churchName:(a==null?void 0:a.name)||"Unknown",userAction:"church_load_for_edit_success"})}catch(a){const h=a instanceof Error?a.message:"Failed to load church data";console.error("Error loading church for edit:",a),h.includes("404")||h.includes("not found")?(_(`Church with ID ${s} not found. Please check the URL or navigate back to the church list.`),setTimeout(()=>{o("/apps/church-management")},3e3)):_(`Unable to load church data: ${h}. You can still create a new church with the form below.`),g.error("Church Management","Failed to load church data for editing",{error:h,churchId:s,userAction:"church_load_for_edit",errorType:h.includes("404")?"not_found":"server_error"})}finally{v(!1)}}):n||g.info("Church Management","New church form opened",{userAction:"church_form_open_create"})},[s,n]),!S("admin")&&!S("super_admin")&&!S("supervisor")?(g.warn("Church Management","Access denied. Administrator privileges required to edit/create churches.",{userAction:"church_form_access_denied",requiredRoles:["admin","super_admin","supervisor"],path:window.location.pathname,isEdit:n}),e.jsx(X,{title:"Church Management",description:"Church management system",children:e.jsx(E,{severity:"error",children:"Access denied. Administrator privileges required."})})):e.jsxs(X,{title:n?"Edit Church":"Add Church",description:n?"Edit church information":"Create a new church",children:[e.jsx(xe,{title:n?"Edit Church":"Add Church",items:[{to:"/",title:"Home"},{to:"/apps/church-management",title:"Church Management"},{title:n?"Edit Church":"Add Church"}]}),A&&e.jsx(E,{severity:"error",sx:{mb:3},children:A}),m&&e.jsx(E,{severity:"success",sx:{mb:3},children:m}),f&&n&&e.jsx(E,{severity:"info",sx:{mb:3},children:e.jsxs(y,{direction:"row",spacing:2,alignItems:"center",children:[e.jsx(M,{size:20}),e.jsx(x,{children:"Loading church data..."})]})}),e.jsx("form",{onSubmit:r.handleSubmit,children:f&&n?e.jsx(ue,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:e.jsxs(y,{spacing:3,alignItems:"center",children:[e.jsx(M,{size:60}),e.jsx(x,{variant:"h6",children:"Loading church data..."}),e.jsx(x,{color:"textSecondary",children:"Please wait while we fetch the church information."})]})}):e.jsxs(b,{container:!0,spacing:3,children:[e.jsx(b,{item:!0,xs:12,lg:6,children:e.jsx(F,{children:e.jsxs(D,{children:[e.jsxs(x,{variant:"h5",mb:1,children:[e.jsx(be,{size:24,style:{marginRight:8,verticalAlign:"middle"}}),"Church Identity & Contact"]}),e.jsx(x,{color:"textSecondary",mb:3,children:"Basic church information and contact details"}),e.jsxs(y,{spacing:3,children:[e.jsx(C,{fullWidth:!0,label:"Church Name",name:"name",value:r.values.name,onChange:r.handleChange,onBlur:r.handleBlur,error:r.touched.name&&!!r.errors.name,helperText:r.touched.name&&r.errors.name,required:!0}),e.jsx(C,{fullWidth:!0,label:"Email Address",name:"email",type:"email",value:r.values.email,onChange:r.handleChange,onBlur:r.handleBlur,error:r.touched.email&&!!r.errors.email,helperText:r.touched.email&&r.errors.email,InputProps:{startAdornment:e.jsx(je,{size:20,style:{marginRight:8,opacity:.7}})}}),e.jsx(C,{fullWidth:!0,label:"Phone Number",name:"phone",value:r.values.phone,onChange:r.handleChange,onBlur:r.handleBlur,error:r.touched.phone&&!!r.errors.phone,helperText:r.touched.phone&&r.errors.phone}),e.jsx(C,{fullWidth:!0,label:"Address",name:"address",multiline:!0,rows:3,value:r.values.address,onChange:r.handleChange,onBlur:r.handleBlur,error:r.touched.address&&!!r.errors.address,helperText:r.touched.address&&r.errors.address,InputProps:{startAdornment:e.jsx(Ce,{size:20,style:{marginRight:8,opacity:.7,alignSelf:"flex-start",marginTop:12}})}}),e.jsx(C,{fullWidth:!0,label:"Website URL",name:"website",value:r.values.website,onChange:r.handleChange,onBlur:r.handleBlur,error:r.touched.website&&!!r.errors.website,helperText:r.touched.website&&r.errors.website,placeholder:"https://example.com"}),e.jsx(C,{fullWidth:!0,label:"Description",name:"description_multilang",multiline:!0,rows:4,value:r.values.description_multilang,onChange:r.handleChange,onBlur:r.handleBlur,error:r.touched.description_multilang&&!!r.errors.description_multilang,helperText:r.touched.description_multilang&&r.errors.description_multilang,placeholder:"Brief description of the church..."})]})]})})}),e.jsx(b,{item:!0,xs:12,lg:6,children:e.jsx(F,{children:e.jsxs(D,{children:[e.jsxs(x,{variant:"h5",mb:1,children:[e.jsx(he,{size:24,style:{marginRight:8,verticalAlign:"middle"}}),"Status & Configuration"]}),e.jsx(x,{color:"textSecondary",mb:3,children:"Church status, timezone, and system settings"}),e.jsxs(y,{spacing:3,children:[e.jsx(U,{control:e.jsx(R,{checked:r.values.is_active,onChange:t=>r.setFieldValue("is_active",t.target.checked),name:"is_active"}),label:"Church Active Status"}),e.jsxs(P,{fullWidth:!0,children:[e.jsx(N,{children:"Preferred Language"}),e.jsxs(q,{name:"preferred_language",value:r.values.preferred_language,onChange:r.handleChange,label:"Preferred Language",children:[e.jsx(d,{value:"en",children:"English"}),e.jsx(d,{value:"el",children:"Greek"}),e.jsx(d,{value:"ru",children:"Russian"}),e.jsx(d,{value:"serbian",children:"Serbian"}),e.jsx(d,{value:"ro",children:"Romanian"}),e.jsx(d,{value:"bulgarian",children:"Bulgarian"}),e.jsx(d,{value:"arabic",children:"Arabic"})]})]}),e.jsxs(P,{fullWidth:!0,children:[e.jsx(N,{children:"Timezone"}),e.jsxs(q,{name:"timezone",value:r.values.timezone,onChange:r.handleChange,label:"Timezone",children:[e.jsx(d,{value:"America/New_York",children:"Eastern Time (ET)"}),e.jsx(d,{value:"America/Chicago",children:"Central Time (CT)"}),e.jsx(d,{value:"America/Denver",children:"Mountain Time (MT)"}),e.jsx(d,{value:"America/Los_Angeles",children:"Pacific Time (PT)"}),e.jsx(d,{value:"Europe/London",children:"Greenwich Mean Time (GMT)"}),e.jsx(d,{value:"Europe/Athens",children:"Eastern European Time (EET)"}),e.jsx(d,{value:"Europe/Moscow",children:"Moscow Time (MSK)"})]})]}),e.jsx(C,{fullWidth:!0,label:"Database Name",name:"database_name",value:r.values.database_name,onChange:r.handleChange,onBlur:r.handleBlur,error:r.touched.database_name&&!!r.errors.database_name,helperText:r.touched.database_name&&r.errors.database_name||"Unique identifier for church database",InputProps:{startAdornment:e.jsx(ve,{size:20,style:{marginRight:8,opacity:.7}})}}),e.jsx(U,{control:e.jsx(R,{checked:r.values.enable_multilingual,onChange:t=>r.setFieldValue("enable_multilingual",t.target.checked),name:"enable_multilingual"}),label:"Enable Multilingual Support"}),e.jsx(U,{control:e.jsx(R,{checked:r.values.enable_notifications,onChange:t=>r.setFieldValue("enable_notifications",t.target.checked),name:"enable_notifications"}),label:"Enable Email Notifications"}),e.jsx(U,{control:e.jsx(R,{checked:r.values.public_calendar,onChange:t=>r.setFieldValue("public_calendar",t.target.checked),name:"public_calendar"}),label:"Public Calendar Access"})]})]})})}),n&&e.jsx(b,{item:!0,xs:12,children:e.jsxs(F,{children:[e.jsx(ye,{title:"Database Management"}),e.jsxs(D,{children:[e.jsx(x,{variant:"body2",color:"textSecondary",sx:{mb:2},children:"Update the church database by adding missing tables from a template."}),e.jsxs(b,{container:!0,spacing:2,alignItems:"center",children:[e.jsx(b,{item:!0,xs:12,md:6,children:e.jsxs(P,{fullWidth:!0,children:[e.jsx(N,{children:"Select Template"}),e.jsx(q,{value:B,onChange:t=>ae(t.target.value),label:"Select Template",children:e.jsx(d,{value:"record_template1",children:"record_template1"})})]})}),e.jsx(b,{item:!0,xs:12,md:6,children:e.jsx(T,{variant:"contained",color:"secondary",onClick:re,disabled:!B||L,startIcon:L?e.jsx(M,{size:16}):null,fullWidth:!0,children:L?"Updating Database...":"Update Database"})})]}),z&&e.jsx(E,{severity:z.success?"success":"error",sx:{mt:2},children:z.message})]})]})}),e.jsx(b,{item:!0,xs:12,children:e.jsx(F,{children:e.jsx(D,{children:e.jsxs(y,{direction:"row",spacing:2,justifyContent:"space-between",alignItems:"center",children:[e.jsx(T,{variant:"outlined",startIcon:e.jsx(me,{}),onClick:()=>o("/apps/church-management"),children:"Back to Churches"}),e.jsxs(y,{direction:"row",spacing:2,children:[n&&e.jsx(T,{variant:"outlined",onClick:()=>window.open(`/apps/church-management/${s}/field-mapper`,"_blank","noopener,noreferrer,width=1200,height=800"),sx:{borderRadius:"16px"},children:"DB â†’ Table Mapping"}),e.jsx(T,{variant:"outlined",onClick:()=>r.resetForm(),children:"Reset"}),e.jsx(T,{type:"submit",variant:"contained",startIcon:f?e.jsx(M,{size:16}):e.jsx(pe,{}),disabled:f||!r.isValid,children:f?"Saving...":n?"Update Church":"Create Church"})]})]})})})})]})})]})};export{pa as default};
//# sourceMappingURL=ChurchForm-D524TQiC.js.map
