{"version":3,"file":"InteractiveReportJobsPage-CF7c3lDg.js","sources":["../../src/features/devel-tools/interactive-reports/InteractiveReportJobsPage.tsx"],"sourcesContent":["/**\r\n * Interactive Report Jobs Page\r\n * Shows background job status for interactive report operations\r\n */\r\n\r\nimport React, { useState, useEffect, useCallback, useRef } from 'react';\r\nimport {\r\n  Box,\r\n  Typography,\r\n  Paper,\r\n  Table,\r\n  TableBody,\r\n  TableCell,\r\n  TableContainer,\r\n  TableHead,\r\n  TableRow,\r\n  Chip,\r\n  Button,\r\n  TextField,\r\n  InputAdornment,\r\n  LinearProgress,\r\n  IconButton,\r\n  Drawer,\r\n  Stack,\r\n  Divider,\r\n  Alert,\r\n  CircularProgress,\r\n  Tabs,\r\n  Tab,\r\n  Snackbar,\r\n} from '@mui/material';\r\nimport {\r\n  Search as SearchIcon,\r\n  Refresh as RefreshIcon,\r\n  Visibility as VisibilityIcon,\r\n  Cancel as CancelIcon,\r\n  Close as CloseIcon,\r\n} from '@mui/icons-material';\r\nimport { useTheme } from '@mui/material/styles';\r\nimport PageContainer from '@/shared/ui/PageContainer';\r\nimport BlankCard from '@/shared/ui/BlankCard';\r\nimport Breadcrumb from '@/layouts/full/shared/breadcrumb/Breadcrumb';\r\n\r\nconst BCrumb = [\r\n  {\r\n    to: '/',\r\n    title: 'Home',\r\n  },\r\n  {\r\n    title: 'Interactive Report Jobs',\r\n  },\r\n];\r\n\r\ninterface Job {\r\n  id: number;\r\n  jobType: string;\r\n  status: 'PENDING' | 'RUNNING' | 'COMPLETED' | 'FAILED' | 'CANCELLED';\r\n  progress: number;\r\n  attempts: number;\r\n  maxAttempts: number;\r\n  createdAt: string;\r\n  updatedAt: string;\r\n  startedAt: string | null;\r\n  finishedAt: string | null;\r\n  churchId: number | null;\r\n  reportId: string | null;\r\n  createdByUserId: string | null;\r\n  errorMessage: string | null;\r\n  payload: any;\r\n  result: any;\r\n}\r\n\r\ninterface TabPanelProps {\r\n  children?: React.ReactNode;\r\n  index: number;\r\n  value: number;\r\n}\r\n\r\nfunction TabPanel(props: TabPanelProps) {\r\n  const { children, value, index, ...other } = props;\r\n  return (\r\n    <div role=\"tabpanel\" hidden={value !== index} {...other}>\r\n      {value === index && <Box sx={{ p: 3 }}>{children}</Box>}\r\n    </div>\r\n  );\r\n}\r\n\r\nconst InteractiveReportJobsPage: React.FC = () => {\r\n  const theme = useTheme();\r\n  const [jobs, setJobs] = useState<Job[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [selectedJob, setSelectedJob] = useState<Job | null>(null);\r\n  const [drawerOpen, setDrawerOpen] = useState(false);\r\n  const [searchQuery, setSearchQuery] = useState('');\r\n  const [churchIdFilter, setChurchIdFilter] = useState('');\r\n  const [reportIdFilter, setReportIdFilter] = useState('');\r\n  const [statusFilter, setStatusFilter] = useState<string>('ALL');\r\n  const [snackbar, setSnackbar] = useState<{ message: string; severity: 'success' | 'error' } | null>(null);\r\n  const [total, setTotal] = useState(0);\r\n  const abortControllerRef = useRef<AbortController | null>(null);\r\n  const pollingIntervalRef = useRef<NodeJS.Timeout | null>(null);\r\n  const isPageVisibleRef = useRef(true);\r\n\r\n  // Handle page visibility for polling\r\n  useEffect(() => {\r\n    const handleVisibilityChange = () => {\r\n      isPageVisibleRef.current = !document.hidden;\r\n      if (isPageVisibleRef.current) {\r\n        fetchJobs();\r\n      } else if (pollingIntervalRef.current) {\r\n        clearInterval(pollingIntervalRef.current);\r\n        pollingIntervalRef.current = null;\r\n      }\r\n    };\r\n\r\n    document.addEventListener('visibilitychange', handleVisibilityChange);\r\n    return () => {\r\n      document.removeEventListener('visibilitychange', handleVisibilityChange);\r\n    };\r\n  }, []);\r\n\r\n  // Fetch jobs\r\n  const fetchJobs = useCallback(async () => {\r\n    if (!isPageVisibleRef.current) return;\r\n\r\n    try {\r\n      // Cancel previous request if exists\r\n      if (abortControllerRef.current) {\r\n        abortControllerRef.current.abort();\r\n      }\r\n\r\n      abortControllerRef.current = new AbortController();\r\n      const params = new URLSearchParams();\r\n      \r\n      if (statusFilter !== 'ALL') {\r\n        params.append('status', statusFilter);\r\n      }\r\n      if (churchIdFilter) {\r\n        params.append('churchId', churchIdFilter);\r\n      }\r\n      if (reportIdFilter) {\r\n        params.append('reportId', reportIdFilter);\r\n      }\r\n      if (searchQuery) {\r\n        params.append('q', searchQuery);\r\n      }\r\n      params.append('limit', '50');\r\n      params.append('offset', '0');\r\n\r\n      const response = await fetch(`/api/records/interactive-reports/jobs?${params.toString()}`, {\r\n        signal: abortControllerRef.current.signal,\r\n      });\r\n\r\n      if (response.status === 401 || response.status === 403) {\r\n        setError('Unauthorized. Please log in.');\r\n        return;\r\n      }\r\n\r\n      if (!response.ok) {\r\n        throw new Error(`Failed to fetch jobs: ${response.statusText}`);\r\n      }\r\n\r\n      const data = await response.json();\r\n      setJobs(data.items || []);\r\n      setTotal(data.total || 0);\r\n      setError(null);\r\n    } catch (err: any) {\r\n      if (err.name === 'AbortError') {\r\n        return; // Request was cancelled, ignore\r\n      }\r\n      setError(err.message || 'Failed to load jobs');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, [statusFilter, churchIdFilter, reportIdFilter, searchQuery]);\r\n\r\n  // Initial load\r\n  useEffect(() => {\r\n    fetchJobs();\r\n  }, [fetchJobs]);\r\n\r\n  // Polling (every 5 seconds when page is visible)\r\n  useEffect(() => {\r\n    if (pollingIntervalRef.current) {\r\n      clearInterval(pollingIntervalRef.current);\r\n    }\r\n\r\n    pollingIntervalRef.current = setInterval(() => {\r\n      if (isPageVisibleRef.current) {\r\n        fetchJobs();\r\n      }\r\n    }, 5000);\r\n\r\n    return () => {\r\n      if (pollingIntervalRef.current) {\r\n        clearInterval(pollingIntervalRef.current);\r\n      }\r\n    };\r\n  }, [fetchJobs]);\r\n\r\n  // Cleanup on unmount\r\n  useEffect(() => {\r\n    return () => {\r\n      if (abortControllerRef.current) {\r\n        abortControllerRef.current.abort();\r\n      }\r\n      if (pollingIntervalRef.current) {\r\n        clearInterval(pollingIntervalRef.current);\r\n      }\r\n    };\r\n  }, []);\r\n\r\n  // Fetch job details\r\n  const fetchJobDetails = async (jobId: number) => {\r\n    try {\r\n      const response = await fetch(`/api/records/interactive-reports/jobs/${jobId}`);\r\n      if (!response.ok) {\r\n        throw new Error('Failed to fetch job details');\r\n      }\r\n      const job = await response.json();\r\n      setSelectedJob(job);\r\n      setDrawerOpen(true);\r\n    } catch (err: any) {\r\n      setSnackbar({ message: err.message || 'Failed to load job details', severity: 'error' });\r\n    }\r\n  };\r\n\r\n  // Cancel job\r\n  const handleCancelJob = async (jobId: number) => {\r\n    if (!window.confirm('Are you sure you want to cancel this job?')) {\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const response = await fetch(`/api/records/interactive-reports/jobs/${jobId}/cancel`, {\r\n        method: 'POST',\r\n      });\r\n\r\n      if (!response.ok) {\r\n        throw new Error('Failed to cancel job');\r\n      }\r\n\r\n      setSnackbar({ message: 'Job cancelled successfully', severity: 'success' });\r\n      fetchJobs(); // Refresh list\r\n    } catch (err: any) {\r\n      setSnackbar({ message: err.message || 'Failed to cancel job', severity: 'error' });\r\n    }\r\n  };\r\n\r\n  // Get status color\r\n  const getStatusColor = (status: string) => {\r\n    switch (status) {\r\n      case 'COMPLETED':\r\n        return 'success';\r\n      case 'RUNNING':\r\n        return 'info';\r\n      case 'PENDING':\r\n        return 'warning';\r\n      case 'FAILED':\r\n        return 'error';\r\n      case 'CANCELLED':\r\n        return 'default';\r\n      default:\r\n        return 'default';\r\n    }\r\n  };\r\n\r\n  // Format date\r\n  const formatDate = (dateString: string | null) => {\r\n    if (!dateString) return 'N/A';\r\n    return new Date(dateString).toLocaleString();\r\n  };\r\n\r\n  // Filter jobs by status tab\r\n  const filteredJobs = jobs.filter((job) => {\r\n    if (statusFilter === 'ALL') return true;\r\n    return job.status === statusFilter;\r\n  });\r\n\r\n  return (\r\n    <PageContainer title=\"Interactive Report Jobs\" description=\"Monitor background jobs for interactive reports\">\r\n      <Breadcrumb title=\"Interactive Report Jobs\" items={BCrumb} />\r\n      \r\n      <BlankCard>\r\n        <Box sx={{ p: 3 }}>\r\n          {/* Header */}\r\n          <Box sx={{ mb: 3, display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>\r\n            <Typography variant=\"h4\">Interactive Report Jobs</Typography>\r\n            <Button\r\n              variant=\"outlined\"\r\n              startIcon={<RefreshIcon />}\r\n              onClick={fetchJobs}\r\n              disabled={loading}\r\n            >\r\n              Refresh\r\n            </Button>\r\n          </Box>\r\n\r\n          {/* Filters */}\r\n          <Box sx={{ mb: 3, display: 'flex', gap: 2, flexWrap: 'wrap' }}>\r\n            <TextField\r\n              size=\"small\"\r\n              placeholder=\"Search jobs...\"\r\n              value={searchQuery}\r\n              onChange={(e) => setSearchQuery(e.target.value)}\r\n              InputProps={{\r\n                startAdornment: (\r\n                  <InputAdornment position=\"start\">\r\n                    <SearchIcon />\r\n                  </InputAdornment>\r\n                ),\r\n              }}\r\n              sx={{ minWidth: 200 }}\r\n            />\r\n            <TextField\r\n              size=\"small\"\r\n              placeholder=\"Church ID\"\r\n              value={churchIdFilter}\r\n              onChange={(e) => setChurchIdFilter(e.target.value)}\r\n              type=\"number\"\r\n              sx={{ width: 120 }}\r\n            />\r\n            <TextField\r\n              size=\"small\"\r\n              placeholder=\"Report ID\"\r\n              value={reportIdFilter}\r\n              onChange={(e) => setReportIdFilter(e.target.value)}\r\n              sx={{ width: 200 }}\r\n            />\r\n          </Box>\r\n\r\n          {/* Status Tabs */}\r\n          <Box sx={{ borderBottom: 1, borderColor: 'divider', mb: 2 }}>\r\n            <Tabs\r\n              value={statusFilter === 'ALL' ? 0 : statusFilter === 'PENDING' ? 1 : statusFilter === 'RUNNING' ? 2 : statusFilter === 'FAILED' ? 3 : statusFilter === 'COMPLETED' ? 4 : 5}\r\n              onChange={(_, newValue) => {\r\n                const statusMap = ['ALL', 'PENDING', 'RUNNING', 'FAILED', 'COMPLETED', 'CANCELLED'];\r\n                setStatusFilter(statusMap[newValue]);\r\n              }}\r\n            >\r\n              <Tab label={`All (${total})`} />\r\n              <Tab label=\"Pending\" />\r\n              <Tab label=\"Running\" />\r\n              <Tab label=\"Failed\" />\r\n              <Tab label=\"Completed\" />\r\n              <Tab label=\"Cancelled\" />\r\n            </Tabs>\r\n          </Box>\r\n\r\n          {/* Error Alert */}\r\n          {error && (\r\n            <Alert severity=\"error\" sx={{ mb: 2 }} onClose={() => setError(null)}>\r\n              {error}\r\n            </Alert>\r\n          )}\r\n\r\n          {/* Loading */}\r\n          {loading && jobs.length === 0 && (\r\n            <Box sx={{ display: 'flex', justifyContent: 'center', p: 4 }}>\r\n              <CircularProgress />\r\n            </Box>\r\n          )}\r\n\r\n          {/* Jobs Table */}\r\n          {!loading && (\r\n            <TableContainer>\r\n              <Table>\r\n                <TableHead>\r\n                  <TableRow>\r\n                    <TableCell>Job ID</TableCell>\r\n                    <TableCell>Type</TableCell>\r\n                    <TableCell>Status</TableCell>\r\n                    <TableCell>Progress</TableCell>\r\n                    <TableCell>Attempts</TableCell>\r\n                    <TableCell>Created</TableCell>\r\n                    <TableCell>Updated</TableCell>\r\n                    <TableCell>Actions</TableCell>\r\n                  </TableRow>\r\n                </TableHead>\r\n                <TableBody>\r\n                  {filteredJobs.length === 0 ? (\r\n                    <TableRow>\r\n                      <TableCell colSpan={8} align=\"center\" sx={{ py: 4 }}>\r\n                        <Typography variant=\"body2\" color=\"text.secondary\">\r\n                          No jobs found. Create an interactive report to see jobs here.\r\n                        </Typography>\r\n                      </TableCell>\r\n                    </TableRow>\r\n                  ) : (\r\n                    filteredJobs.map((job) => (\r\n                      <TableRow key={job.id} hover>\r\n                        <TableCell>{job.id}</TableCell>\r\n                        <TableCell>{job.jobType}</TableCell>\r\n                        <TableCell>\r\n                          <Chip\r\n                            label={job.status}\r\n                            color={getStatusColor(job.status) as any}\r\n                            size=\"small\"\r\n                          />\r\n                        </TableCell>\r\n                        <TableCell>\r\n                          <Box sx={{ display: 'flex', alignItems: 'center', gap: 1, minWidth: 150 }}>\r\n                            <LinearProgress\r\n                              variant=\"determinate\"\r\n                              value={job.progress}\r\n                              sx={{ flex: 1, height: 8, borderRadius: 4 }}\r\n                            />\r\n                            <Typography variant=\"caption\" sx={{ minWidth: 35 }}>\r\n                              {job.progress}%\r\n                            </Typography>\r\n                          </Box>\r\n                        </TableCell>\r\n                        <TableCell>\r\n                          {job.attempts} / {job.maxAttempts}\r\n                        </TableCell>\r\n                        <TableCell>{formatDate(job.createdAt)}</TableCell>\r\n                        <TableCell>{formatDate(job.updatedAt)}</TableCell>\r\n                        <TableCell>\r\n                          <Stack direction=\"row\" spacing={1}>\r\n                            <IconButton\r\n                              size=\"small\"\r\n                              onClick={() => fetchJobDetails(job.id)}\r\n                              title=\"View Details\"\r\n                            >\r\n                              <VisibilityIcon fontSize=\"small\" />\r\n                            </IconButton>\r\n                            {(job.status === 'PENDING' || job.status === 'RUNNING') && (\r\n                              <IconButton\r\n                                size=\"small\"\r\n                                onClick={() => handleCancelJob(job.id)}\r\n                                title=\"Cancel Job\"\r\n                                color=\"error\"\r\n                              >\r\n                                <CancelIcon fontSize=\"small\" />\r\n                              </IconButton>\r\n                            )}\r\n                          </Stack>\r\n                        </TableCell>\r\n                      </TableRow>\r\n                    ))\r\n                  )}\r\n                </TableBody>\r\n              </Table>\r\n            </TableContainer>\r\n          )}\r\n        </Box>\r\n      </BlankCard>\r\n\r\n      {/* Job Details Drawer */}\r\n      <Drawer\r\n        anchor=\"right\"\r\n        open={drawerOpen}\r\n        onClose={() => setDrawerOpen(false)}\r\n        PaperProps={{ sx: { width: 600 } }}\r\n      >\r\n        <Box sx={{ p: 3 }}>\r\n          <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', mb: 2 }}>\r\n            <Typography variant=\"h5\">Job Details</Typography>\r\n            <IconButton onClick={() => setDrawerOpen(false)}>\r\n              <CloseIcon />\r\n            </IconButton>\r\n          </Box>\r\n\r\n          {selectedJob && (\r\n            <Stack spacing={2}>\r\n              <Divider />\r\n              <Box>\r\n                <Typography variant=\"subtitle2\" color=\"text.secondary\">\r\n                  Job ID\r\n                </Typography>\r\n                <Typography variant=\"body1\">{selectedJob.id}</Typography>\r\n              </Box>\r\n              <Box>\r\n                <Typography variant=\"subtitle2\" color=\"text.secondary\">\r\n                  Type\r\n                </Typography>\r\n                <Typography variant=\"body1\">{selectedJob.jobType}</Typography>\r\n              </Box>\r\n              <Box>\r\n                <Typography variant=\"subtitle2\" color=\"text.secondary\">\r\n                  Status\r\n                </Typography>\r\n                <Chip\r\n                  label={selectedJob.status}\r\n                  color={getStatusColor(selectedJob.status) as any}\r\n                  size=\"small\"\r\n                />\r\n              </Box>\r\n              <Box>\r\n                <Typography variant=\"subtitle2\" color=\"text.secondary\">\r\n                  Progress\r\n                </Typography>\r\n                <LinearProgress\r\n                  variant=\"determinate\"\r\n                  value={selectedJob.progress}\r\n                  sx={{ mt: 1, height: 8, borderRadius: 4 }}\r\n                />\r\n                <Typography variant=\"caption\">{selectedJob.progress}%</Typography>\r\n              </Box>\r\n              <Box>\r\n                <Typography variant=\"subtitle2\" color=\"text.secondary\">\r\n                  Attempts\r\n                </Typography>\r\n                <Typography variant=\"body1\">\r\n                  {selectedJob.attempts} / {selectedJob.maxAttempts}\r\n                </Typography>\r\n              </Box>\r\n              <Box>\r\n                <Typography variant=\"subtitle2\" color=\"text.secondary\">\r\n                  Created\r\n                </Typography>\r\n                <Typography variant=\"body1\">{formatDate(selectedJob.createdAt)}</Typography>\r\n              </Box>\r\n              {selectedJob.startedAt && (\r\n                <Box>\r\n                  <Typography variant=\"subtitle2\" color=\"text.secondary\">\r\n                    Started\r\n                  </Typography>\r\n                  <Typography variant=\"body1\">{formatDate(selectedJob.startedAt)}</Typography>\r\n                </Box>\r\n              )}\r\n              {selectedJob.finishedAt && (\r\n                <Box>\r\n                  <Typography variant=\"subtitle2\" color=\"text.secondary\">\r\n                    Finished\r\n                  </Typography>\r\n                  <Typography variant=\"body1\">{formatDate(selectedJob.finishedAt)}</Typography>\r\n                </Box>\r\n              )}\r\n              {selectedJob.churchId && (\r\n                <Box>\r\n                  <Typography variant=\"subtitle2\" color=\"text.secondary\">\r\n                    Church ID\r\n                  </Typography>\r\n                  <Typography variant=\"body1\">{selectedJob.churchId}</Typography>\r\n                </Box>\r\n              )}\r\n              {selectedJob.reportId && (\r\n                <Box>\r\n                  <Typography variant=\"subtitle2\" color=\"text.secondary\">\r\n                    Report ID\r\n                  </Typography>\r\n                  <Typography variant=\"body1\">{selectedJob.reportId}</Typography>\r\n                </Box>\r\n              )}\r\n              {selectedJob.errorMessage && (\r\n                <Box>\r\n                  <Typography variant=\"subtitle2\" color=\"text.secondary\">\r\n                    Error Message\r\n                  </Typography>\r\n                  <Alert severity=\"error\" sx={{ mt: 1 }}>\r\n                    {selectedJob.errorMessage}\r\n                  </Alert>\r\n                </Box>\r\n              )}\r\n              {selectedJob.payload && (\r\n                <Box>\r\n                  <Typography variant=\"subtitle2\" color=\"text.secondary\">\r\n                    Payload\r\n                  </Typography>\r\n                  <Paper sx={{ p: 2, mt: 1, bgcolor: 'grey.50' }}>\r\n                    <pre style={{ margin: 0, fontSize: '0.875rem', overflow: 'auto' }}>\r\n                      {JSON.stringify(selectedJob.payload, null, 2)}\r\n                    </pre>\r\n                  </Paper>\r\n                </Box>\r\n              )}\r\n              {selectedJob.result && (\r\n                <Box>\r\n                  <Typography variant=\"subtitle2\" color=\"text.secondary\">\r\n                    Result\r\n                  </Typography>\r\n                  <Paper sx={{ p: 2, mt: 1, bgcolor: 'grey.50' }}>\r\n                    <pre style={{ margin: 0, fontSize: '0.875rem', overflow: 'auto' }}>\r\n                      {JSON.stringify(selectedJob.result, null, 2)}\r\n                    </pre>\r\n                  </Paper>\r\n                </Box>\r\n              )}\r\n            </Stack>\r\n          )}\r\n        </Box>\r\n      </Drawer>\r\n\r\n      {/* Snackbar */}\r\n      <Snackbar\r\n        open={!!snackbar}\r\n        autoHideDuration={6000}\r\n        onClose={() => setSnackbar(null)}\r\n        message={snackbar?.message}\r\n      />\r\n    </PageContainer>\r\n  );\r\n};\r\n\r\nexport default InteractiveReportJobsPage;\r\n"],"names":["BCrumb","InteractiveReportJobsPage","useTheme","jobs","setJobs","useState","loading","setLoading","error","setError","selectedJob","setSelectedJob","drawerOpen","setDrawerOpen","searchQuery","setSearchQuery","churchIdFilter","setChurchIdFilter","reportIdFilter","setReportIdFilter","statusFilter","setStatusFilter","snackbar","setSnackbar","total","setTotal","abortControllerRef","useRef","pollingIntervalRef","isPageVisibleRef","useEffect","handleVisibilityChange","fetchJobs","useCallback","__async","params","response","data","err","fetchJobDetails","jobId","job","handleCancelJob","getStatusColor","status","formatDate","dateString","filteredJobs","jsxs","PageContainer","jsx","Breadcrumb","BlankCard","Box","Typography","Button","RefreshIcon","TextField","e","InputAdornment","SearchIcon","Tabs","_","newValue","Tab","Alert","CircularProgress","TableContainer","Table","TableHead","TableRow","TableCell","TableBody","Chip","LinearProgress","Stack","IconButton","VisibilityIcon","CancelIcon","Drawer","CloseIcon","Divider","Paper","Snackbar"],"mappings":"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"}