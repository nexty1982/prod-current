{"version":3,"mappings":"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","names":["InvoiceContext","createContext","useInvoiceContext","context","useContext","InvoiceProvider","children","invoices","setInvoices","useState","loading","setLoading","error","setError","totalCount","setTotalCount","currentPage","setCurrentPage","filters","setFilters","fetchInvoices","__async","response","__spreadProps","__spreadValues","err","useEffect","contextValue","id","invoiceNumber","invoiceData","newInvoice","updates","updatedInvoice","paidDate","invoice","options","generateInvoicePDF","__vitePreload","generateInvoicePDF2","downloadInvoicePDF","email","format"],"ignoreList":[],"sources":["../../src/context/InvoiceContext/index.tsx"],"sourcesContent":["import React, { createContext, useEffect, useState, useContext } from 'react';\r\nimport { InvoiceList } from '../../types/apps/invoice';\r\nimport type {\r\n  InvoiceFilters,\r\n  CreateInvoiceData,\r\n  Invoice,\r\n  PaginatedResponse\r\n} from '@/types/orthodox-metrics.types';\r\n\r\ninterface InvoiceContextType {\r\n  invoices: InvoiceList[];\r\n  loading: boolean;\r\n  error: Error | null;\r\n  totalCount: number;\r\n  currentPage: number;\r\n  setCurrentPage: (page: number) => void;\r\n  filters: InvoiceFilters;\r\n  setFilters: (filters: InvoiceFilters) => void;\r\n  fetchInvoices: () => Promise<void>;\r\n  getInvoiceById: (id: number) => Promise<Invoice | null>;\r\n  getInvoiceByNumber: (invoiceNumber: string) => Promise<Invoice | null>;\r\n  createInvoice: (invoice: CreateInvoiceData) => Promise<Invoice | null>;\r\n  updateInvoice: (id: number, updates: Partial<Invoice>) => Promise<Invoice | null>;\r\n  deleteInvoice: (id: number) => Promise<boolean>;\r\n  markInvoiceAsPaid: (id: number, paidDate?: string) => Promise<Invoice | null>;\r\n  generateInvoicePDF: (id: number) => Promise<Blob | null>;\r\n  generateClientSidePDF: (invoice: Invoice, options?: any) => Promise<Blob>;\r\n  downloadClientSidePDF: (invoice: Invoice, options?: any) => Promise<void>;\r\n  sendInvoiceEmail: (id: number, email: string) => Promise<boolean>;\r\n  exportInvoices: (format: 'csv' | 'xlsx' | 'pdf') => Promise<Blob | null>;\r\n}\r\n\r\nconst InvoiceContext = createContext<InvoiceContextType | any>(undefined);\r\n\r\n// Custom hook to use the invoice context\r\nexport const useInvoiceContext = () => {\r\n  const context = useContext(InvoiceContext);\r\n  if (!context) {\r\n    throw new Error('useInvoiceContext must be used within an InvoiceProvider');\r\n  }\r\n  return context;\r\n};\r\n\r\nexport const InvoiceProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {\r\n  const [invoices, setInvoices] = useState<InvoiceList[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<Error | null>(null);\r\n  const [totalCount, setTotalCount] = useState(0);\r\n  const [currentPage, setCurrentPage] = useState(1);\r\n  const [filters, setFilters] = useState<InvoiceFilters>({\r\n    page: 1,\r\n    limit: 10,\r\n    status: undefined,\r\n    church_id: undefined,\r\n    date_from: undefined,\r\n    date_to: undefined,\r\n    search: undefined,\r\n  });\r\n\r\n  // Fetch invoices with current filters\r\n  const fetchInvoices = async () => {\r\n    try {\r\n      setLoading(true);\r\n      setError(null);\r\n\r\n      const response: PaginatedResponse<Invoice> = await metricsAPI.invoices.getAll({\r\n        ...filters,\r\n        page: currentPage,\r\n      });\r\n\r\n      setInvoices(response.data);\r\n      setTotalCount(response.pagination.total);\r\n    } catch (err) {\r\n      setError(err as Error);\r\n      console.error('Error fetching invoices:', err);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  // Fetch invoices when filters or page changes\r\n  useEffect(() => {\r\n    fetchInvoices();\r\n  }, [filters, currentPage]);\r\n\r\n  // Get invoice by ID\r\n  const getInvoiceById = async (id: number): Promise<Invoice | null> => {\r\n    try {\r\n      const invoice = await metricsAPI.invoices.getById(id);\r\n      return invoice;\r\n    } catch (err) {\r\n      console.error('Error fetching invoice:', err);\r\n      return null;\r\n    }\r\n  };\r\n\r\n  // Get invoice by invoice number (v1 API)\r\n  const getInvoiceByNumber = async (invoiceNumber: string): Promise<Invoice | null> => {\r\n    try {\r\n      const invoice = await metricsAPI.invoices.getByInvoiceNumber(invoiceNumber);\r\n      return invoice;\r\n    } catch (err) {\r\n      console.error('Error fetching invoice by number:', err);\r\n      return null;\r\n    }\r\n  };\r\n\r\n  // Create new invoice\r\n  const createInvoice = async (invoiceData: CreateInvoiceData): Promise<Invoice | null> => {\r\n    try {\r\n      const newInvoice = await metricsAPI.invoices.create(invoiceData);\r\n      await fetchInvoices(); // Refresh the list\r\n      return newInvoice;\r\n    } catch (err) {\r\n      console.error('Error creating invoice:', err);\r\n      return null;\r\n    }\r\n  };\r\n\r\n  // Update existing invoice\r\n  const updateInvoice = async (id: number, updates: Partial<Invoice>): Promise<Invoice | null> => {\r\n    try {\r\n      const updatedInvoice = await metricsAPI.invoices.update(id, updates);\r\n      await fetchInvoices(); // Refresh the list\r\n      return updatedInvoice;\r\n    } catch (err) {\r\n      console.error('Error updating invoice:', err);\r\n      return null;\r\n    }\r\n  };\r\n\r\n  // Delete invoice\r\n  const deleteInvoice = async (id: number): Promise<boolean> => {\r\n    try {\r\n      await metricsAPI.invoices.delete(id);\r\n      await fetchInvoices(); // Refresh the list\r\n      return true;\r\n    } catch (err) {\r\n      console.error('Error deleting invoice:', err);\r\n      return false;\r\n    }\r\n  };\r\n\r\n  // Mark invoice as paid\r\n  const markInvoiceAsPaid = async (id: number, paidDate?: string): Promise<Invoice | null> => {\r\n    try {\r\n      const updatedInvoice = await metricsAPI.invoices.markPaid(id, paidDate);\r\n      await fetchInvoices(); // Refresh the list\r\n      return updatedInvoice;\r\n    } catch (err) {\r\n      console.error('Error marking invoice as paid:', err);\r\n      return null;\r\n    }\r\n  };\r\n\r\n  // Generate PDF\r\n  const generateInvoicePDF = async (id: number): Promise<Blob | null> => {\r\n    try {\r\n      const pdfBlob = await metricsAPI.invoices.generatePDF(id);\r\n      return pdfBlob;\r\n    } catch (err) {\r\n      console.error('Error generating PDF:', err);\r\n      return null;\r\n    }\r\n  };\r\n\r\n  // Generate PDF using client-side generator\r\n  const generateClientSidePDF = async (invoice: Invoice, options?: any): Promise<Blob> => {\r\n    try {\r\n      const { generateInvoicePDF } = await import('@/shared/lib/invoicePDFGenerator');\r\n      return await generateInvoicePDF(invoice, options);\r\n    } catch (err) {\r\n      console.error('Error generating client-side PDF:', err);\r\n      throw err;\r\n    }\r\n  };\r\n\r\n  // Download PDF using client-side generator\r\n  const downloadClientSidePDF = async (invoice: Invoice, options?: any): Promise<void> => {\r\n    try {\r\n      const { downloadInvoicePDF } = await import('@/shared/lib/invoicePDFGenerator');\r\n      await downloadInvoicePDF(invoice, options);\r\n    } catch (err) {\r\n      console.error('Error downloading client-side PDF:', err);\r\n      throw err;\r\n    }\r\n  };\r\n\r\n  // Send invoice via email\r\n  const sendInvoiceEmail = async (id: number, email: string): Promise<boolean> => {\r\n    try {\r\n      await metricsAPI.invoices.sendEmail(id, email);\r\n      return true;\r\n    } catch (err) {\r\n      console.error('Error sending invoice email:', err);\r\n      return false;\r\n    }\r\n  };\r\n\r\n  // Export invoices\r\n  const exportInvoices = async (format: 'csv' | 'xlsx' | 'pdf'): Promise<Blob | null> => {\r\n    try {\r\n      const exportBlob = await metricsAPI.invoices.export(filters, format);\r\n      return exportBlob;\r\n    } catch (err) {\r\n      console.error('Error exporting invoices:', err);\r\n      return null;\r\n    }\r\n  };\r\n\r\n  const contextValue: InvoiceContextType = {\r\n    invoices,\r\n    loading,\r\n    error,\r\n    totalCount,\r\n    currentPage,\r\n    setCurrentPage,\r\n    filters,\r\n    setFilters,\r\n    fetchInvoices,\r\n    getInvoiceById,\r\n    getInvoiceByNumber,\r\n    createInvoice,\r\n    updateInvoice,\r\n    deleteInvoice,\r\n    markInvoiceAsPaid,\r\n    generateInvoicePDF,\r\n    generateClientSidePDF,\r\n    downloadClientSidePDF,\r\n    sendInvoiceEmail,\r\n    exportInvoices,\r\n  };\r\n\r\n  return (\r\n    <InvoiceContext.Provider value={contextValue}>\r\n      {children}\r\n    </InvoiceContext.Provider>\r\n  );\r\n};\r\n\r\n// Legacy export for backward compatibility\r\nexport { InvoiceContext };"],"file":"assets/index-TepHui4c.js"}