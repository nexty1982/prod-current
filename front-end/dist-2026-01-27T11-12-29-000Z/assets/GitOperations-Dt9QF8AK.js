var C=(I,h,i)=>new Promise((x,d)=>{var j=a=>{try{u(i.next(a))}catch(o){d(o)}},g=a=>{try{u(i.throw(a))}catch(o){d(o)}},u=a=>a.done?x(a.value):Promise.resolve(a.value).then(j,g);u((i=i.apply(I,h)).next())});import{k as U,j as e,$ as v,B as l,S as f,d as t,U as T,Q as A,e as E,aI as W,C as F,h as w,A as G,D as M,R as q}from"./index-CHjTtHW2.js";import{r as n}from"./vendor-DgfDxsY7.js";import{C as P}from"./Container-DQ6QG2MT.js";import{I as L}from"./IconAlertCircle-CFjeM3OU.js";import{I as B}from"./IconGitBranch-CF4oeSVD.js";import{I as S}from"./IconCheck-BL6R6MPS.js";const Z=()=>{const{user:I}=U(),[h,i]=n.useState(!1),[x,d]=n.useState(!1),[j,g]=n.useState(null),[u,a]=n.useState(null),[o,$]=n.useState(null),[z,m]=n.useState(null),[k,b]=n.useState(!1),[c,R]=n.useState(null);n.useEffect(()=>{D()},[]);const D=()=>C(void 0,null,function*(){i(!0),m(null),b(!1);try{const s=yield fetch("/api/ops/git/status",{credentials:"include"});if(s.status===401||s.status===403){b(!0),i(!1);return}if(!s.ok)throw new Error(`HTTP ${s.status}`);const r=yield s.json();if(r.success&&r.output){g(r.output);const p=r.output.match(/^##\s+([^\s.]+)/m);p&&a(p[1]);const O=r.output.split(`
`).filter(y=>y.trim()).some(y=>y.match(/^[ MADRCU?!]/));$(!O)}else m(r.error||"Failed to fetch git status")}catch(s){m(s.message||"Failed to fetch git status")}finally{i(!1)}}),H=()=>C(void 0,null,function*(){d(!0),m(null),R(null);try{const s=yield fetch("/api/ops/git/branches/create-default",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"}});if(s.status===401||s.status===403){b(!0),d(!1);return}if(!s.ok){const p=yield s.json();throw new Error(p.message||`HTTP ${s.status}`)}const r=yield s.json();R(r)}catch(s){m(s.message||"Failed to create branches")}finally{d(!1)}});return k?e.jsx(P,{maxWidth:"lg",sx:{py:4},children:e.jsx(v,{severity:"error",icon:e.jsx(L,{}),children:"Not authorized. Admin or super_admin access required."})}):e.jsxs(P,{maxWidth:"lg",sx:{py:4},children:[e.jsxs(l,{mb:4,children:[e.jsxs(f,{direction:"row",spacing:2,alignItems:"center",mb:2,children:[e.jsx(B,{size:32}),e.jsx(t,{variant:"h4",children:"Git Operations"})]}),e.jsx(t,{variant:"body2",color:"text.secondary",children:"Safe, allowlisted git operations for repository management"})]}),e.jsx(T,{sx:{mb:4},children:e.jsxs(A,{children:[e.jsxs(f,{direction:"row",spacing:2,alignItems:"center",mb:2,children:[e.jsx(t,{variant:"h6",children:"Git Status"}),e.jsx(E,{variant:"outlined",size:"small",startIcon:e.jsx(W,{}),onClick:D,disabled:h,children:"Refresh"})]}),h&&e.jsx(l,{display:"flex",justifyContent:"center",py:4,children:e.jsx(F,{})}),z&&e.jsx(v,{severity:"error",sx:{mb:2},children:z}),j&&!h&&e.jsxs(e.Fragment,{children:[u&&e.jsxs(l,{mb:2,children:[e.jsx(t,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:"Current Branch"}),e.jsx(w,{label:u,icon:e.jsx(B,{size:16}),color:"primary",variant:"outlined"})]}),o!==null&&e.jsxs(l,{mb:2,children:[e.jsx(t,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:"Repository Status"}),e.jsx(w,{label:o?"Clean":"Dirty",icon:o?e.jsx(S,{size:16}):e.jsx(G,{size:16}),color:o?"success":"warning",variant:"outlined"})]}),e.jsx(M,{sx:{my:2}}),e.jsx(t,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:"Raw Output"}),e.jsx(q,{variant:"outlined",sx:{p:2,bgcolor:"background.default",fontFamily:"monospace",fontSize:"0.875rem",whiteSpace:"pre-wrap",wordBreak:"break-word",maxHeight:"400px",overflow:"auto"},children:j})]})]})}),e.jsx(T,{children:e.jsxs(A,{children:[e.jsx(t,{variant:"h6",gutterBottom:!0,children:"Create Default Branches"}),e.jsxs(t,{variant:"body2",color:"text.secondary",paragraph:!0,children:["Creates the following branches from the current HEAD:",e.jsxs("ul",{children:[e.jsx("li",{children:e.jsx("code",{children:"fix/build-events-users-softdelete"})}),e.jsx("li",{children:e.jsx("code",{children:"chore/gallery-dir-bootstrap"})})]}),"This operation is idempotent - existing branches will not be recreated."]}),e.jsx(E,{variant:"contained",startIcon:e.jsx(B,{}),onClick:H,disabled:x||k,sx:{mb:2},children:x?"Creating...":"Create Default Branches"}),x&&e.jsxs(l,{display:"flex",alignItems:"center",gap:2,mb:2,children:[e.jsx(F,{size:20}),e.jsx(t,{variant:"body2",children:"Creating branches..."})]}),c&&e.jsxs(l,{mt:2,children:[e.jsx(v,{severity:c.ok?"success":"error",sx:{mb:2},children:c.ok?`Branches processed. Base branch: ${c.baseBranch} (${c.baseSha.substring(0,7)})`:c.error||"Failed to create branches"}),e.jsx(t,{variant:"subtitle2",gutterBottom:!0,children:"Results:"}),e.jsx(f,{spacing:1,children:c.results.map((s,r)=>e.jsx(l,{children:e.jsxs(f,{direction:"row",spacing:2,alignItems:"center",children:[e.jsx(t,{variant:"body2",sx:{fontFamily:"monospace",minWidth:"300px"},children:s.name}),e.jsx(w,{label:s.status,color:s.status==="created"?"success":s.status==="exists"?"info":"error",size:"small",icon:s.status==="created"?e.jsx(S,{size:14}):s.status==="exists"?e.jsx(S,{size:14}):e.jsx(G,{size:14})}),s.message&&e.jsx(t,{variant:"caption",color:"text.secondary",children:s.message})]})},r))})]})]})})]})};export{Z as default};
//# sourceMappingURL=GitOperations-Dt9QF8AK.js.map
